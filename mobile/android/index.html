<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?">
  <title>
    
      Android | PyTorch
    
  </title>
  <meta property="og:title" content="PyTorch"/>
<meta property="og:description" content="An open source deep learning platform that provides a seamless path from research prototyping to production deployment."/>
<meta property="og:url" content="https://www.pytorch.org"/>
<meta property="og:type" content="website"/>
<meta property="og:image" content="https://pytorch.org/assets/images/pytorch-logo.png"/>

  <link rel="stylesheet" href="/assets/main.css">
  <script src="/assets/vendor/jquery.min.js"></script>
  <script src="/assets/vendor/popper.min.js"></script>
  <script src="/assets/vendor/bootstrap.min.js"></script>
  <script src="/assets/vendor/anchor.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
  
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-90545585-1', 'auto');
  ga('create', 'UA-117752657-2', 'auto', 'newCampaignTracker');
  ga('send', 'pageview');

</script>

    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window,document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '243028289693773');
    fbq('track', 'PageView');
</script>

<noscript>
  <img height="1" width="1"
  src="https://www.facebook.com/tr?id=243028289693773&ev=PageView
  &noscript=1"/>
</noscript>

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-117752657-2"></script>

<script>

  window.dataLayer = window.dataLayer || [];

  function gtag(){dataLayer.push(arguments);}

  gtag('js', new Date());
  gtag('config', 'UA-117752657-2');

</script>

    <!-- Twitter universal website tag code -->
<img height="1" width="1" style="display:none;" alt="" src="https://analytics.twitter.com/i/adsct?p_id=Twitter&p_user_id=0&txn_id=o2gi1&events=%5B%5B%22pageview%22%2Cnull%5D%5D&tw_sale_amount=0&tw_order_quantity=0 (https://urldefense.proofpoint.com/v2/url?u=https-3A__analytics.twitter.com_i_adsct-3Fp-5Fid-3DTwitter-26p-5Fuser-5Fid-3D0-26txn-5Fid-3Do2gi1-26events-3D-255B-255B-2522pageview-2522-252Cnull-255D-255D-26tw-5Fsale-5Famount-3D0-26tw-5Forder-5Fquantity-3D0&d=DwMGaQ&c=5VD0RTtNlTh3ycd41b3MUw&r=GMr8XYCDyeQQZuD3noL91A&m=dAJyokk16UvYy-vMrGn_JwYiGfp_eEgo25B9iGDCG-A&s=o6i4D0V0088WH2RnzIoqiF-vj45PL-2sTrsxQ0SNO3A&e=)" />
<img height="1" width="1" style="display:none;" alt="" src="//t.co/i/adsct?p_id=Twitter&p_user_id=0&txn_id=o2gi1&events=%5B%5B%22pageview%22%2Cnull%5D%5D&tw_sale_amount=0&tw_order_quantity=0 (https://urldefense.proofpoint.com/v2/url?u=https-3A__linkprotect.cudasvc.com_url-3Fa-3Dhttp-253a-252f-252ft.co-252fi-252fadsct-253fp-5Fid-253dTwitter-2526p-5Fuser-5Fid-253d0-2526txn-5Fid-253do2gi1-2526events-253d-25255B-25255B-252522pageview-252522-25252Cnull-25255D-25255D-2526tw-5Fsale-5Famount-253d0-2526tw-5Forder-5Fquantity-253d0-26c-3DE-2C1-2CC33dLwIhtuEcl5FhdztSnUwsioeej5k-2DWy0RYREBAq51kGji32A2Cw94YU9vQBpY5tPN3AukEw3C-5F-2DlbtndnLoR7-5FA-5FLoH0Rr7zLtP1ykptN-26typo-3D1&d=DwMGaQ&c=5VD0RTtNlTh3ycd41b3MUw&r=GMr8XYCDyeQQZuD3noL91A&m=dAJyokk16UvYy-vMrGn_JwYiGfp_eEgo25B9iGDCG-A&s=Abgc3XBkhESv8XBYtLchdDZyISGsK6v_BB6cLMJGyCw&e=)" />
<!-- End Twitter universal website tag code -->

  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
</head>

  <body class="mobile">
    <div class="container-fluid header-holder mobile-header">
  <div class="container">
    

<div class="header-container">
  <a class="header-logo" href="https://pytorch.org" aria-label="PyTorch"></a>

  <div class="main-menu">
  <ul>
    <li class="main-menu-item ">
      <a href="/get-started">Get Started</a>
    </li>

    <li class="main-menu-item ">

      <div class="ecosystem-dropdown">
        <a id="dropdownMenuButton" data-toggle="ecosystem-dropdown">
          Ecosystem
        </a>
        <div class="ecosystem-dropdown-menu">
          <a class="nav-dropdown-item" href="/hub">
            <span class=dropdown-title>Models (Beta)</span>
            <p>Discover, publish, and reuse pre-trained models</p>
          </a>
          <a class="nav-dropdown-item" href="/ecosystem">
            <span class=dropdown-title>Tools & Libraries</span>
            <p>Explore the ecosystem of tools and libraries</p>
          </a>
        </div>
      </div>
    </li>

    <li class="main-menu-item active">
      <a href="/mobile">Mobile</a>
    </li>

    <li class="main-menu-item ">
      <a href="/blog">Blog</a>
    </li>

    <li class="main-menu-item">
      <a href="https://pytorch.org/tutorials">Tutorials</a>
    </li>

    <li class="main-menu-item">
      <a href="/docs">Docs</a>
    </li>

    <li class="main-menu-item ">

      <div class="resources-dropdown">
        <a id="resourcesDropdownButton" data-toggle="resources-dropdown">
          Resources
        </a>
        <div class="resources-dropdown-menu">
          <a class="nav-dropdown-item" href="/resources">
            <span class=dropdown-title>Developer Resources</span>
            <p>Find resources and get questions answered</p>
          </a>
          <a class="nav-dropdown-item" href="/features">
            <span class=dropdown-title>About</span>
            <p>Learn about PyTorch’s features and capabilities</p>
          </a>
        </div>
      </div>
    </li>

    <li class="main-menu-item" id="github-main-menu-link">
      <a href="https://github.com/pytorch/pytorch">GitHub</a>
    </li>

    <li class="navSearchWrapper reactNavSearchWrapper" key="search">
      <div class="search-border">
        <div id="search-icon"></div>
        <input
          id="search-input"
          type="text"
          title="Search"
        />
        <div id="close-search">X</div>
      </div>
    </li>
  </ul>
</div>

<script src="/assets/main-menu-dropdown.js"></script>


  <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
</div>

  </div>
</div>


    <div class="main-background mobile-background"></div>

    

    <div class="jumbotron jumbotron-fluid on-dark-background">
      <div class="container">
        <h1>PyTorch Mobile</h1>

        <p class="lead">End-to-end workflow from Python to deployment on iOS and Android</p>
      </div>
    </div>

    <div class="main-content-wrapper">
      <div class="main-content">
        <div class="container-fluid nav-menu-wrapper">
          <div class="container">
            <nav class="navbar navbar-expand-lg navbar-light main-content-menu">
              <ul class="navbar-nav">
                
                  <li class="nav-item nav-select">
                    <a class="nav-link" data-id="home" href="/mobile/home/">Home</a>
                  </li>
                
                  <li class="nav-item nav-select">
                    <a class="nav-link" data-id="ios" href="/mobile/ios/">iOS</a>
                  </li>
                
                  <li class="nav-item nav-select">
                    <a class="nav-link" data-id="android" href="/mobile/android/">Android</a>
                  </li>
                
              </ul>
            </nav>
          </div>
        </div>

        <div class="container">
          <div class="row">
            <div class="col-md-3">
              <div class="sticky-top mobile-page-sidebar">
  <p id="shortcuts-menu">Shortcuts</p>
  <ul id="mobile-page-sidebar-list"></ul>
</div>


            </div>
            <div class="col-md-8 offset-md-1">
              <div class="article-wrapper" data-id="">
                <article class="pytorch-article">
                  <h1 id="android">Android</h1>

<h2 id="quickstart-with-a-helloworld-example">Quickstart with a HelloWorld Example</h2>

<p><a href="https://github.com/pytorch/android-demo-app/tree/master/HelloWorldApp">HelloWorld</a> is a simple image classification application that demonstrates how to use PyTorch Android API.
This application runs TorchScript serialized TorchVision pretrained resnet18 model on static image which is packaged inside the app as android asset.</p>

<h4 id="1-model-preparation">1. Model Preparation</h4>

<p>Let’s start with model preparation. If you are familiar with PyTorch, you probably should already know how to train and save your model. In case you don’t, we are going to use a pre-trained image classification model (<a href="https://pytorch.org/hub/pytorch_vision_resnet/">Resnet18</a>), which is packaged in <a href="https://pytorch.org/docs/stable/torchvision/index.html">TorchVision</a>.
To install it, run the command below:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install torchvision
</code></pre></div></div>

<p>To serialize the model you can use python <a href="https://github.com/pytorch/android-demo-app/blob/master/HelloWorldApp/trace_model.py">script</a> in the root folder of HelloWorld app:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">import</span> <span class="n">torch</span>
<span class="n">import</span> <span class="n">torchvision</span>

<span class="k">model</span> <span class="p">=</span> <span class="n">torchvision</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="n">resnet18</span><span class="p">(</span><span class="n">pretrained</span><span class="p">=</span><span class="nb">True</span><span class="p">)</span>
<span class="k">model</span><span class="p">.</span><span class="n">eval</span><span class="p">()</span>
<span class="n">example</span> <span class="p">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">rand</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">224</span><span class="p">,</span> <span class="m">224</span><span class="p">)</span>
<span class="n">traced_script_module</span> <span class="p">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">jit</span><span class="p">.</span><span class="n">trace</span><span class="p">(</span><span class="k">model</span><span class="p">,</span> <span class="n">example</span><span class="p">)</span>
<span class="n">traced_script_module</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s2">"app/src/main/assets/model.pt"</span><span class="p">)</span>
</code></pre></div></div>
<p>If everything works well, we should have our model - <code class="highlighter-rouge">model.pt</code> generated in the assets folder of android application.
That will be packaged inside android application as <code class="highlighter-rouge">asset</code> and can be used on the device.</p>

<p>More details about TorchScript you can find in <a href="https://pytorch.org/docs/stable/jit.html">tutorials on pytorch.org</a></p>

<h4 id="2-cloning-from-github">2. Cloning from github</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/pytorch/android-demo-app.git
cd HelloWorldApp
</code></pre></div></div>
<p>If <a href="https://developer.android.com/studio/index.html#command-tools">Android SDK</a> and <a href="https://developer.android.com/ndk/downloads">Android NDK</a> are already installed you can install this application to the connected android device or emulator with:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./gradlew installDebug
</code></pre></div></div>

<p>We recommend you to open this project in <a href="https://developer.android.com/studio">Android Studio 3.5.1+</a>. At the moment PyTorch Android and demo applications use <a href="https://developer.android.com/studio/releases/gradle-plugin#3-5-0">android gradle plugin of version 3.5.0</a>, which is supported only by Android Studio version 3.5.1 and higher.
Using Android Studio you will be able to install Android NDK and Android SDK with Android Studio UI.</p>

<h4 id="3-gradle-dependencies">3. Gradle dependencies</h4>

<p>Pytorch android is added to the HelloWorld as <a href="https://github.com/pytorch/android-demo-app/blob/master/HelloWorldApp/app/build.gradle#L28-L29">gradle dependencies</a> in build.gradle:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>repositories {
    jcenter()
}

dependencies {
    implementation 'org.pytorch:pytorch_android:1.4.0'
    implementation 'org.pytorch:pytorch_android_torchvision:1.4.0'
}
</code></pre></div></div>
<p>Where <code class="highlighter-rouge">org.pytorch:pytorch_android</code> is the main dependency with PyTorch Android API, including libtorch native library for all 4 android abis (armeabi-v7a, arm64-v8a, x86, x86_64).
Further in this doc you can find how to rebuild it only for specific list of android abis.</p>

<p><code class="highlighter-rouge">org.pytorch:pytorch_android_torchvision</code> - additional library with utility functions for converting <code class="highlighter-rouge">android.media.Image</code> and <code class="highlighter-rouge">android.graphics.Bitmap</code> to tensors.</p>

<h4 id="4-reading-image-from-android-asset">4. Reading image from Android Asset</h4>

<p>All the logic happens in <a href="https://github.com/pytorch/android-demo-app/blob/master/HelloWorldApp/app/src/main/java/org/pytorch/helloworld/MainActivity.java#L31-L69"><code class="highlighter-rouge">org.pytorch.helloworld.MainActivity</code></a>.
As a first step we read <code class="highlighter-rouge">image.jpg</code> to <code class="highlighter-rouge">android.graphics.Bitmap</code> using the standard Android API.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Bitmap bitmap = BitmapFactory.decodeStream(getAssets().open("image.jpg"));
</code></pre></div></div>

<h4 id="5-loading-torchscript-module">5. Loading TorchScript Module</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Module module = Module.load(assetFilePath(this, "model.pt"));
</code></pre></div></div>
<p><code class="highlighter-rouge">org.pytorch.Module</code> represents <code class="highlighter-rouge">torch::jit::script::Module</code> that can be loaded with <code class="highlighter-rouge">load</code> method specifying file path to the serialized to file model.</p>

<h4 id="6-preparing-input">6. Preparing Input</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Tensor inputTensor = TensorImageUtils.bitmapToFloat32Tensor(bitmap,
    TensorImageUtils.TORCHVISION_NORM_MEAN_RGB, TensorImageUtils.TORCHVISION_NORM_STD_RGB);
</code></pre></div></div>
<p><code class="highlighter-rouge">org.pytorch.torchvision.TensorImageUtils</code> is part of <code class="highlighter-rouge">org.pytorch:pytorch_android_torchvision</code> library.
The <code class="highlighter-rouge">TensorImageUtils#bitmapToFloat32Tensor</code> method creates tensors in the <a href="https://pytorch.org/docs/stable/torchvision/models.html">torchvision format</a> using <code class="highlighter-rouge">android.graphics.Bitmap</code> as a source.</p>

<blockquote>
  <p>All pre-trained models expect input images normalized in the same way, i.e. mini-batches of 3-channel RGB images of shape (3 x H x W), where H and W are expected to be at least 224.
The images have to be loaded in to a range of <code class="highlighter-rouge">[0, 1]</code> and then normalized using <code class="highlighter-rouge">mean = [0.485, 0.456, 0.406]</code> and <code class="highlighter-rouge">std = [0.229, 0.224, 0.225]</code></p>
</blockquote>

<p><code class="highlighter-rouge">inputTensor</code>’s shape is <code class="highlighter-rouge">1x3xHxW</code>, where <code class="highlighter-rouge">H</code> and <code class="highlighter-rouge">W</code> are bitmap height and width appropriately.</p>

<h4 id="7-run-inference">7. Run Inference</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Tensor outputTensor = module.forward(IValue.from(inputTensor)).toTensor();
float[] scores = outputTensor.getDataAsFloatArray();
</code></pre></div></div>

<p><code class="highlighter-rouge">org.pytorch.Module.forward</code> method runs loaded module’s <code class="highlighter-rouge">forward</code> method and gets result as <code class="highlighter-rouge">org.pytorch.Tensor</code> outputTensor with shape <code class="highlighter-rouge">1x1000</code>.</p>

<h4 id="8-processing-results">8. Processing results</h4>
<p>Its content is retrieved using <code class="highlighter-rouge">org.pytorch.Tensor.getDataAsFloatArray()</code> method that returns java array of floats with scores for every image net class.</p>

<p>After that we just find index with maximum score and retrieve predicted class name from <code class="highlighter-rouge">ImageNetClasses.IMAGENET_CLASSES</code> array that contains all ImageNet classes.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>float maxScore = -Float.MAX_VALUE;
int maxScoreIdx = -1;
for (int i = 0; i &lt; scores.length; i++) {
  if (scores[i] &gt; maxScore) {
    maxScore = scores[i];
    maxScoreIdx = i;
  }
}
String className = ImageNetClasses.IMAGENET_CLASSES[maxScoreIdx];
</code></pre></div></div>

<p>In the following sections you can find detailed explanations of PyTorch Android API, code walk through for a bigger <a href="https://github.com/pytorch/android-demo-app/tree/master/PyTorchDemoApp">demo application</a>,
implementation details of the API, how to customize and build it from source.</p>

<h2 id="pytorch-demo-application">PyTorch Demo Application</h2>

<p>We have also created another more complex PyTorch Android demo application that does image classification from camera output and text classification in the <a href="https://github.com/pytorch/android-demo-app/tree/master/PyTorchDemoApp">same github repo</a>.</p>

<p>To get device camera output it uses <a href="https://developer.android.com/training/camerax">Android CameraX API</a>.
All the logic that works with CameraX is separated to <a href="https://github.com/pytorch/android-demo-app/blob/master/PyTorchDemoApp/app/src/main/java/org/pytorch/demo/vision/AbstractCameraXActivity.java"><code class="highlighter-rouge">org.pytorch.demo.vision.AbstractCameraXActivity</code></a> class.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>void setupCameraX() {
    final PreviewConfig previewConfig = new PreviewConfig.Builder().build();
    final Preview preview = new Preview(previewConfig);
    preview.setOnPreviewOutputUpdateListener(output -&gt; mTextureView.setSurfaceTexture(output.getSurfaceTexture()));

    final ImageAnalysisConfig imageAnalysisConfig =
        new ImageAnalysisConfig.Builder()
            .setTargetResolution(new Size(224, 224))
            .setCallbackHandler(mBackgroundHandler)
            .setImageReaderMode(ImageAnalysis.ImageReaderMode.ACQUIRE_LATEST_IMAGE)
            .build();
    final ImageAnalysis imageAnalysis = new ImageAnalysis(imageAnalysisConfig);
    imageAnalysis.setAnalyzer(
        (image, rotationDegrees) -&gt; {
          analyzeImage(image, rotationDegrees);
        });

    CameraX.bindToLifecycle(this, preview, imageAnalysis);
  }

  void analyzeImage(android.media.Image, int rotationDegrees)
</code></pre></div></div>

<p>Where the <code class="highlighter-rouge">analyzeImage</code> method process the camera output, <code class="highlighter-rouge">android.media.Image</code>.</p>

<p>It uses the aforementioned <a href="https://github.com/pytorch/pytorch/blob/master/android/pytorch_android_torchvision/src/main/java/org/pytorch/torchvision/TensorImageUtils.java#L90"><code class="highlighter-rouge">TensorImageUtils.imageYUV420CenterCropToFloat32Tensor</code></a> method to convert <code class="highlighter-rouge">android.media.Image</code> in <code class="highlighter-rouge">YUV420</code> format to input tensor.</p>

<p>After getting predicted scores from the model it finds top K classes with the highest scores and shows on the UI.</p>

<h4 id="language-processing-example">Language Processing Example</h4>

<p>Another example is natural language processing, based on an LSTM model, trained on a reddit comments dataset.
The logic happens in <a href="https://github.com/pytorch/android-demo-app/blob/master/PyTorchDemoApp/app/src/main/java/org/pytorch/demo/nlp/TextClassificationActivity.java"><code class="highlighter-rouge">TextClassificattionActivity</code></a>.</p>

<p>Result class names are packaged inside the TorchScript model and initialized just after initial module initialization.
The module has a <code class="highlighter-rouge">get_classes</code> method that returns <code class="highlighter-rouge">List[str]</code>, which can be called using method <code class="highlighter-rouge">Module.runMethod(methodName)</code>:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    mModule = Module.load(moduleFileAbsoluteFilePath);
    IValue getClassesOutput = mModule.runMethod("get_classes");
</code></pre></div></div>
<p>The returned <code class="highlighter-rouge">IValue</code> can be converted to java array of <code class="highlighter-rouge">IValue</code> using <code class="highlighter-rouge">IValue.toList()</code> and processed to an array of strings using <code class="highlighter-rouge">IValue.toStr()</code>:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    IValue[] classesListIValue = getClassesOutput.toList();
    String[] moduleClasses = new String[classesListIValue.length];
    int i = 0;
    for (IValue iv : classesListIValue) {
      moduleClasses[i++] = iv.toStr();
    }
</code></pre></div></div>

<p>Entered text is converted to java array of bytes with <code class="highlighter-rouge">UTF-8</code> encoding. <code class="highlighter-rouge">Tensor.fromBlobUnsigned</code> creates tensor of <code class="highlighter-rouge">dtype=uint8</code> from that array of bytes.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    byte[] bytes = text.getBytes(Charset.forName("UTF-8"));
    final long[] shape = new long[]{1, bytes.length};
    final Tensor inputTensor = Tensor.fromBlobUnsigned(bytes, shape);
</code></pre></div></div>

<p>Running inference of the model is similar to previous examples:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Tensor outputTensor = mModule.forward(IValue.from(inputTensor)).toTensor()
</code></pre></div></div>

<p>After that, the code processes the output, finding classes with the highest scores.</p>

<h2 id="building-pytorch-android-from-source">Building PyTorch Android from Source</h2>

<p>In some cases you might want to use a local build of pytorch android, for example you may build custom libtorch binary with another set of operators or to make local changes.</p>

<p>For this you can use <code class="highlighter-rouge">./scripts/build_pytorch_android.sh</code> script.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/pytorch/pytorch.git
cd pytorch
sh ./scripts/build_pytorch_android.sh
</code></pre></div></div>

<p>The workflow contains several steps:</p>

<p>1. Build libtorch for android for all 4 android abis (armeabi-v7a, arm64-v8a, x86, x86_64)</p>

<p>2. Create symbolic links to the results of those builds:
<code class="highlighter-rouge">android/pytorch_android/src/main/jniLibs/${abi}</code> to the directory with output libraries
<code class="highlighter-rouge">android/pytorch_android/src/main/cpp/libtorch_include/${abi}</code> to the directory with headers. These directories are used to build <code class="highlighter-rouge">libpytorch.so</code> library that will be loaded on android device.</p>

<p>3. And finally run <code class="highlighter-rouge">gradle</code> in <code class="highlighter-rouge">android/pytorch_android</code> directory with task <code class="highlighter-rouge">assembleRelease</code></p>

<p>Script requires that Android SDK, Android NDK and gradle are installed.
They are specified as environment variables:</p>

<p><code class="highlighter-rouge">ANDROID_HOME</code> - path to <a href="https://developer.android.com/studio/command-line/sdkmanager.html">Android SDK</a></p>

<p><code class="highlighter-rouge">ANDROID_NDK</code> - path to <a href="https://developer.android.com/studio/projects/install-ndk">Android NDK</a></p>

<p><code class="highlighter-rouge">GRADLE_HOME</code> - path to <a href="https://gradle.org/releases/">gradle</a></p>

<p>After successful build you should see the result as aar file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ find pytorch_android/build/ -type f -name *aar
pytorch_android/build/outputs/aar/pytorch_android.aar
pytorch_android_torchvision/build/outputs/aar/pytorch_android.aar
libs/fbjni_local/build/outputs/aar/pytorch_android_fbjni.aar
</code></pre></div></div>

<p>It can be used directly in android projects, as a gradle dependency:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>allprojects {
    repositories {
        flatDir {
            dirs 'libs'
        }
    }
}

android {
    ...
    packagingOptions {
        pickFirst "**/libfbjni.so"
    }
    ...
}

dependencies {
    implementation(name:'pytorch_android', ext:'aar')
    implementation(name:'pytorch_android_torchvision', ext:'aar')
    implementation(name:'pytorch_android_fbjni', ext:'aar')
    ...
    implementation 'com.android.support:appcompat-v7:28.0.0'
    implementation 'com.facebook.soloader:nativeloader:0.8.0'
}
</code></pre></div></div>

<p>At the moment for the case of using aar files directly we need additional configuration due to packaging specific (<code class="highlighter-rouge">libfbjni.so</code> is packaged in both <code class="highlighter-rouge">pytorch_android_fbjni.aar</code> and <code class="highlighter-rouge">pytorch_android.aar</code>).</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>packagingOptions {
    pickFirst "**/libfbjni.so"
}
</code></pre></div></div>

<p>Also we have to add all transitive dependencies of our aars. As <code class="highlighter-rouge">pytorch_android</code> depends on <code class="highlighter-rouge">com.android.support:appcompat-v7:28.0.0</code> and <code class="highlighter-rouge">com.facebook.soloader:nativeloader:0.8.0</code>, we need to add them. (In case of using maven dependencies they are added automatically from <code class="highlighter-rouge">pom.xml</code>).</p>

<h2 id="custom-build">Custom Build</h2>

<p>To reduce the size of binaries you can do custom build of PyTorch Android with only set of operators required by your model.
This includes two steps: preparing the list of operators from your model, rebuilding pytorch android with specified list.</p>

<p>1. Verify your PyTorch version is 1.4.0 or above. You can do that by checking the value of <code class="highlighter-rouge">torch.__version__</code>.</p>

<p>2. Preparation of the list of operators</p>

<p>List of operators of your serialized torchscript model can be prepared in yaml format using python api function <code class="highlighter-rouge">torch.jit.export_opnames()</code>.
To dump the operators in your model, say <code class="highlighter-rouge">MobileNetV2</code>, run the following lines of Python code:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">#</span> <span class="n">Dump</span> <span class="k">list</span> <span class="k">of</span> <span class="n">operators</span> <span class="n">used</span> <span class="n">by</span> <span class="n">MobileNetV2</span><span class="p">:</span>
<span class="n">import</span> <span class="n">torch</span><span class="p">,</span> <span class="n">yaml</span>
<span class="k">model</span> <span class="p">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">jit</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="s1">'MobileNetV2.pt'</span><span class="p">)</span>
<span class="n">ops</span> <span class="p">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">jit</span><span class="p">.</span><span class="n">export_opnames</span><span class="p">(</span><span class="k">model</span><span class="p">)</span>
<span class="k">with</span> <span class="n">open</span><span class="p">(</span><span class="s1">'MobileNetV2.yaml'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
    <span class="n">yaml</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">ops</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</code></pre></div></div>
<p>3. Building PyTorch Android with prepared operators list.</p>

<p>To build PyTorch Android with the prepared yaml list of operators, specify it in the environment variable <code class="highlighter-rouge">SELECTED_OP_LIST</code>. Also in the arguments, specify which Android ABIs it should build; by default it builds all 4 Android ABIs.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Build PyTorch Android library customized for MobileNetV2:
SELECTED_OP_LIST=MobileNetV2.yaml scripts/build_pytorch_android.sh arm64-v8a
</code></pre></div></div>

<p>After successful build you can integrate the result aar files to your android gradle project, following the steps from previous section of this tutorial (Building PyTorch Android from Source).</p>

<h2 id="api-docs">API Docs</h2>

<p>You can find more details about the PyTorch Android API in the <a href="https://pytorch.org/javadoc/">Javadoc</a>.</p>

<!-- Do not remove the below script -->

<script page-id="android" src="/assets/menu-tab-selection.js"></script>


                </article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-fluid docs-tutorials-resources">
  <div class="container">
    <div class="row">
      <div class="col-md-4 text-center">
        <h2>Docs</h2>
        <p>Access comprehensive developer documentation for PyTorch</p>
        <a class="with-right-arrow" href="/docs">View Docs</a>
      </div>

      <div class="col-md-4 text-center">
        <h2>Tutorials</h2>
        <p>Get in-depth tutorials for beginners and advanced developers</p>
        <a class="with-right-arrow" href="https://pytorch.org/tutorials">View Tutorials</a>
      </div>

      <div class="col-md-4 text-center">
        <h2>Resources</h2>
        <p>Find development resources and get your questions answered</p>
        <a class="with-right-arrow" href="/resources">View Resources</a>
      </div>
    </div>
  </div>
</div>

<footer class="site-footer">
  <div class="container footer-container">
    <div class="footer-logo-wrapper">
      <a href="https://pytorch.org" class="footer-logo"></a>
    </div>

    <div class="footer-links-wrapper">
      <div class="footer-links-col">
        <ul>
          <li class="list-title"><a href="https://pytorch.org">PyTorch</a></li>
          <li><a href="/get-started">Get Started</a></li>
          <li><a href="/features">Features</a></li>
          <li><a href="/ecosystem">Ecosystem</a></li>
          <li><a href="/blog">Blog</a></li>
          <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md" target="_blank">Contributing</a></li>
        </ul>
      </div>

      <div class="footer-links-col">
        <ul>
          <li class="list-title"><a href="/resources">Resources</a></li>
          <li><a href="https://pytorch.org/tutorials">Tutorials</a></li>
          <li><a href="/docs">Docs</a></li>
          <li><a href="https://discuss.pytorch.org" target="_blank">Discuss</a></li>
          <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">GitHub Issues</a></li>
          <li><a href="https://goo.gl/forms/PP1AGvNHpSaJP8to1" target="_blank">Slack</a></li>
        </ul>
      </div>

      <div class="footer-links-col follow-us-col">
        <ul>
          <li class="list-title">Stay Connected</li>
          <li>
            
            <div id="mc_embed_signup">
  <form
    action="https://twitter.us14.list-manage.com/subscribe/post?u=75419c71fe0a935e53dfa4a3f&id=91d0dccd39"
    method="post"
    id="mc-embedded-subscribe-form"
    name="mc-embedded-subscribe-form"
    class="email-subscribe-form validate"
    target="_blank"
    novalidate>
    <div id="mc_embed_signup_scroll" class="email-subscribe-form-fields-wrapper">
      <div class="mc-field-group">
        <label for="mce-EMAIL" style="display:none;">Email Address</label>
        <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="Email Address">
      </div>

      <div id="mce-responses" class="clear">
        <div class="response" id="mce-error-response" style="display:none"></div>
        <div class="response" id="mce-success-response" style="display:none"></div>
      </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->

      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_75419c71fe0a935e53dfa4a3f_91d0dccd39" tabindex="-1" value=""></div>

      <div class="clear">
        <input type="submit" value="" name="subscribe" id="mc-embedded-subscribe" class="button email-subscribe-button">
      </div>
    </div>
  </form>
</div>

          </li>
        </ul>

        <div class="footer-social-icons">
          <a href="https://www.facebook.com/pytorch" target="_blank" class="facebook"></a>
          <a href="https://twitter.com/pytorch" target="_blank" class="twitter"></a>
          <a href="https://www.youtube.com/pytorch" target="_blank" class="youtube"></a>
        </div>
      </div>
    </div>
  </div>
  <img height="1" width="1" style="border-style:none;" alt="" src="https://www.googleadservices.com/pagead/conversion/795629140/?label=txkmCPmdtosBENSssfsC&amp;guid=ON&amp;script=0"/>

</footer>

<div class="mobile-main-menu">
  <div class="container-fluid">
    <div class="container">
      <div class="mobile-main-menu-header-container">
        <a class="header-logo" href="https://pytorch.org" aria-label="PyTorch"></a>
        <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
      </div>
    </div>
  </div>

  <div class="mobile-main-menu-links-container">

    <div class="main-menu">
      <ul>
        <li class="navSearchWrapper reactNavSearchWrapper tabletSearchWrapper" key="search">
          <div class="mobile-search-border">
            <input
              id="mobile-search-input"
              type="text"
              title="Search"
            />
            <div id="mobile-search-icon"></div>
          </div>
        </li>

        <li class="">
          <a href="/get-started">Get Started</a>
        </li>

        <li class="">
          <a href="/features">Features</a>
        </li>

        <li class="">
          <a href="/ecosystem">Ecosystem</a>
        </li>

        <li class="active">
          <a href="/mobile">Mobile</a>
        </li>

        <li class="">
          <a href="/hub">PyTorch Hub</a>
        </li>

        <li class="">
          <a href="/blog">Blog</a>
        </li>

        <li>
          <a href="https://pytorch.org/tutorials">Tutorials</a>
        </li>

        <li>
          <a href="/docs">Docs</a>
        </li>

        <li class="">
          <a href="/resources">Resources</a>
        </li>

        <li id="github-mobile-menu-link">
          <a href="https://github.com/pytorch/pytorch">GitHub</a>
        </li>
      </ul>
    </div>

  </div>
</div>


<script src="/assets/mobile-menu.js"></script>
<script src="/assets/scroll-to-anchor.js"></script>
<script src="/assets/external-links-new-tab.js"></script>

  <script src="/assets/search-bar.js"></script>

<script src="/assets/cookie-banner.js"></script>

<script type="text/javascript">
  mobileMenu.bind();
  anchors.add('.pytorch-article h2, .pytorch-article h3, .pytorch-article h4, .pytorch-article h5');

  // Add class to links that have code blocks, since we cannot create links in code blocks
  $("a code.highlighter-rouge").each(function(e) {
    $(this).closest("a").addClass("has-code");
  });

  scrollToAnchor.bind();

  var hasStaticHeader = $(".blog-header, .blog-detail-header, .resources-header, .get-started-header, .features-header, .ecosystem-header, .hub-header, .mobile-header").length > 0;

  if (!hasStaticHeader) {
    $(window).on("scroll", function() {
      var top = $(this).scrollTop();
      var fullPosition = $(".main-background").height() - $(".header-holder").height();

      if (top === 0) {
        $(".header-holder").css({"backgroundColor": "transparent"});
      } else if (top >= fullPosition) {
        $(".header-holder").css({"backgroundColor": "#000000"});
      } else {
        var bgColor = "rgba(0, 0, 0, " + top / fullPosition + ")";
        $(".header-holder").css({"backgroundColor": bgColor});
      }
    });
  }
</script>


  <script src="/assets/track-events.js"></script>
  <script>trackEvents.bind();</script>



<div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebook’s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="/assets/images/pytorch-x.svg">
  </div>
</div>


  </body>
</html>

<script src="/assets/mobile-page-sidebar.js"></script>
