


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta name="robots" content="noindex">
  <meta name="robots" content="noindex">
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>torch.utils.benchmark.utils.timer &mdash; PyTorch 1.11.0 documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://pytorch.org/docs/stable/_modules/torch/utils/benchmark/utils/timer.html"/>
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="../../../../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/katex-math.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/jit.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />


  <!-- Google Analytics -->
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-117752657-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-117752657-2');
    </script>
  
  <!-- End Google Analytics -->
  


  
  <script src="../../../../../_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="../../../../../_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../../_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../../_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../../_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../../_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../../_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="active docs-active">
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-orange-arrow">
                Docs
              </a>
              <div class="resources-dropdown-menu">
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/docs/stable/index.html">
                  <span class="dropdown-title">PyTorch</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/audio/stable/index.html">
                  <span class="dropdown-title">torchaudio</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/text/stable/index.html">
                  <span class="dropdown-title">torchtext</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/vision/stable/index.html">
                  <span class="dropdown-title">torchvision</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/torchrec">
                  <span class="dropdown-title">TorchRec</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/data">
                  <span class="dropdown-title">TorchData</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/serve/">
                  <span class="dropdown-title">TorchServe</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/xla">
                  <span class="dropdown-title">PyTorch on XLA Devices</span>
                  <p></p>
                </a>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-arrow">
                Resources
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/features">
                  <span class="dropdown-title">About</span>
                  <p>Learn about PyTorchâ€™s features and capabilities</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/#community-module">
                  <span class="dropdown-title">Community</span>
                  <p>Join the PyTorch developer community to contribute, learn, and get your questions answered.</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/resources">
                  <span class="dropdown-title">Developer Resources</span>
                  <p>Find resources and get questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="https://discuss.pytorch.org/" target="_blank">
                  <span class="dropdown-title">Forums</span>
                  <p>A place to discuss PyTorch code, issues, install, research</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/hub">
                  <span class="dropdown-title">Models (Beta)</span>
                  <p>Discover, publish, and reuse pre-trained models</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <a href="https://github.com/pytorch/pytorch">GitHub</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>

<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            
    <div class="version">
      <a href='https://pytorch.org/docs/versions.html'>1.11.0 &#x25BC</a>
    </div>
    


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          </div>

          


            
            
              
            
            
              <p class="caption"><span class="caption-text">Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../notes/amp_examples.html">Automatic Mixed Precision examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../notes/autograd.html">Autograd mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../notes/broadcasting.html">Broadcasting semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../notes/cpu_threading_torchscript_inference.html">CPU threading and TorchScript inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../notes/cuda.html">CUDA semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../notes/ddp.html">Distributed Data Parallel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../notes/extending.html">Extending PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../notes/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../notes/gradcheck.html">Gradcheck mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../notes/hip.html">HIP (ROCm) semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../notes/large_scale_deployments.html">Features for large-scale deployments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../notes/modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../notes/multiprocessing.html">Multiprocessing best practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../notes/numerical_accuracy.html">Numerical accuracy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../notes/randomness.html">Reproducibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../notes/serialization.html">Serialization semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../notes/windows.html">Windows FAQ</a></li>
</ul>
<p class="caption"><span class="caption-text">Language Bindings</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../cpp_index.html">C++</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/javadoc/">Javadoc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../deploy.html">torch::deploy</a></li>
</ul>
<p class="caption"><span class="caption-text">Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../torch.html">torch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../nn.html">torch.nn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../nn.functional.html">torch.nn.functional</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tensors.html">torch.Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tensor_attributes.html">Tensor Attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tensor_view.html">Tensor Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../autograd.html">torch.autograd</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../cuda.html">torch.cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../amp.html">torch.cuda.amp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../backends.html">torch.backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../distributed.html">torch.distributed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../distributed.algorithms.join.html">torch.distributed.algorithms.join</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../distributed.elastic.html">torch.distributed.elastic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../fsdp.html">torch.distributed.fsdp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../distributed.optim.html">torch.distributed.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../distributions.html">torch.distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../fft.html">torch.fft</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../futures.html">torch.futures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../fx.html">torch.fx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../hub.html">torch.hub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../jit.html">torch.jit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../linalg.html">torch.linalg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../monitor.html">torch.monitor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../special.html">torch.special</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../torch.overrides.html">torch.overrides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../package.html">torch.package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../profiler.html">torch.profiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../nn.init.html">torch.nn.init</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../onnx.html">torch.onnx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../optim.html">torch.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../complex_numbers.html">Complex Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ddp_comm_hooks.html">DDP Communication Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../pipeline.html">Pipeline Parallelism</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../quantization.html">Quantization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../rpc.html">Distributed RPC Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../random.html">torch.random</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../sparse.html">torch.sparse</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../storage.html">torch.Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../testing.html">torch.testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../benchmark_utils.html">torch.utils.benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../bottleneck.html">torch.utils.bottleneck</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../checkpoint.html">torch.utils.checkpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../cpp_extension.html">torch.utils.cpp_extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../data.html">torch.utils.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../dlpack.html">torch.utils.dlpack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../mobile_optimizer.html">torch.utils.mobile_optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../model_zoo.html">torch.utils.model_zoo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tensorboard.html">torch.utils.tensorboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../type_info.html">Type Info</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../named_tensor.html">Named Tensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../name_inference.html">Named Tensors operator coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../__config__.html">torch.__config__</a></li>
</ul>
<p class="caption"><span class="caption-text">Libraries</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/audio/stable">torchaudio</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/text/stable">torchtext</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/vision/stable">torchvision</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/serve">TorchServe</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pytorch.org/xla/">PyTorch on XLA Devices</a></li>
</ul>
<p class="caption"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../community/contribution_guide.html">PyTorch Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../community/governance.html">PyTorch Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../community/persons_of_interest.html">PyTorch Governance | Persons of Interest</a></li>
</ul>

            
          

        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="../../../../../index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
          <li><a href="../../../../index.html">Module code</a> &gt;</li>
        
          <li><a href="../../../../torch.html">torch</a> &gt;</li>
        
      <li>torch.utils.benchmark.utils.timer</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <h1>Source code for torch.utils.benchmark.utils.timer</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Timer class based on the timeit.Timer class, but torch aware.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">enum</span>
<span class="kn">import</span> <span class="nn">timeit</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">overload</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">NoReturn</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.utils.benchmark.utils</span> <span class="kn">import</span> <span class="n">common</span><span class="p">,</span> <span class="n">cpp_jit</span>
<span class="kn">from</span> <span class="nn">torch.utils.benchmark.utils._stubs</span> <span class="kn">import</span> <span class="n">TimerClass</span><span class="p">,</span> <span class="n">TimeitModuleType</span>
<span class="kn">from</span> <span class="nn">torch.utils.benchmark.utils.valgrind_wrapper</span> <span class="kn">import</span> <span class="n">timer_interface</span> <span class="k">as</span> <span class="n">valgrind_timer_interface</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Timer&quot;</span><span class="p">,</span> <span class="s2">&quot;timer&quot;</span><span class="p">,</span> <span class="s2">&quot;Language&quot;</span><span class="p">]</span>


<span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">has_cuda</span> <span class="ow">and</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">timer</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span>


<span class="k">class</span> <span class="nc">Language</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">PYTHON</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">CPP</span> <span class="o">=</span> <span class="mi">1</span>


<span class="k">class</span> <span class="nc">CPPTimer</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">stmt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">setup</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">global_setup</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">timer</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="nb">float</span><span class="p">],</span>
        <span class="nb">globals</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">timer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;PyTorch was built with CUDA and a GPU is present; however &quot;</span>
                <span class="s2">&quot;Timer does not yet support GPU measurements. If your &quot;</span>
                <span class="s2">&quot;code is CPU only, pass `timer=timeit.default_timer` to the &quot;</span>
                <span class="s2">&quot;Timer&#39;s constructor to indicate this. (Note that this will &quot;</span>
                <span class="s2">&quot;produce incorrect results if the GPU is in fact used, as &quot;</span>
                <span class="s2">&quot;Timer will not synchronize CUDA.)&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">globals</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;C++ timing does not support globals.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_stmt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">setup</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_global_setup</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">global_setup</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timeit_module</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TimeitModuleType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">timeit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timeit_module</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_timeit_module</span> <span class="o">=</span> <span class="n">cpp_jit</span><span class="o">.</span><span class="n">compile_timeit_template</span><span class="p">(</span>
                <span class="n">stmt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_stmt</span><span class="p">,</span>
                <span class="n">setup</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">,</span>
                <span class="n">global_setup</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_global_setup</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timeit_module</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>


<div class="viewcode-block" id="Timer"><a class="viewcode-back" href="../../../../../benchmark_utils.html#torch.utils.benchmark.Timer">[docs]</a><span class="k">class</span> <span class="nc">Timer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper class for measuring execution time of PyTorch statements.</span>

<span class="sd">    For a full tutorial on how to use this class, see:</span>
<span class="sd">    https://pytorch.org/tutorials/recipes/recipes/benchmark.html</span>

<span class="sd">    The PyTorch Timer is based on `timeit.Timer` (and in fact uses</span>
<span class="sd">    `timeit.Timer` internally), but with several key differences:</span>

<span class="sd">    1) Runtime aware:</span>
<span class="sd">        Timer will perform warmups (important as some elements of PyTorch are</span>
<span class="sd">        lazily initialized), set threadpool size so that comparisons are</span>
<span class="sd">        apples-to-apples, and synchronize asynchronous CUDA functions when</span>
<span class="sd">        necessary.</span>

<span class="sd">    2) Focus on replicates:</span>
<span class="sd">        When measuring code, and particularly complex kernels / models,</span>
<span class="sd">        run-to-run variation is a significant confounding factor. It is</span>
<span class="sd">        expected that all measurements should include replicates to quantify</span>
<span class="sd">        noise and allow median computation, which is more robust than mean.</span>
<span class="sd">        To that effect, this class deviates from the `timeit` API by</span>
<span class="sd">        conceptually merging `timeit.Timer.repeat` and `timeit.Timer.autorange`.</span>
<span class="sd">        (Exact algorithms are discussed in method docstrings.) The `timeit`</span>
<span class="sd">        method is replicated for cases where an adaptive strategy is not</span>
<span class="sd">        desired.</span>

<span class="sd">    3) Optional metadata:</span>
<span class="sd">        When defining a Timer, one can optionally specify `label`, `sub_label`,</span>
<span class="sd">        `description`, and `env`. (Defined later) These fields are included in</span>
<span class="sd">        the representation of result object and by the `Compare` class to group</span>
<span class="sd">        and display results for comparison.</span>

<span class="sd">    4) Instruction counts</span>
<span class="sd">        In addition to wall times, Timer can run a statement under Callgrind</span>
<span class="sd">        and report instructions executed.</span>

<span class="sd">    Directly analogous to `timeit.Timer` constructor arguments:</span>

<span class="sd">        `stmt`, `setup`, `timer`, `globals`</span>

<span class="sd">    PyTorch Timer specific constructor arguments:</span>

<span class="sd">        `label`, `sub_label`, `description`, `env`, `num_threads`</span>

<span class="sd">    Args:</span>
<span class="sd">        stmt: Code snippet to be run in a loop and timed.</span>

<span class="sd">        setup: Optional setup code. Used to define variables used in `stmt`</span>

<span class="sd">        global_setup: (C++ only)</span>
<span class="sd">            Code which is placed at the top level of the file for things like</span>
<span class="sd">            `#include` statements.</span>

<span class="sd">        timer:</span>
<span class="sd">            Callable which returns the current time. If PyTorch was built</span>
<span class="sd">            without CUDA or there is no GPU present, this defaults to</span>
<span class="sd">            `timeit.default_timer`; otherwise it will synchronize CUDA before</span>
<span class="sd">            measuring the time.</span>

<span class="sd">        globals:</span>
<span class="sd">            A dict which defines the global variables when `stmt` is being</span>
<span class="sd">            executed. This is the other method for providing variables which</span>
<span class="sd">            `stmt` needs.</span>

<span class="sd">        label:</span>
<span class="sd">            String which summarizes `stmt`. For instance, if `stmt` is</span>
<span class="sd">            &quot;torch.nn.functional.relu(torch.add(x, 1, out=out))&quot;</span>
<span class="sd">            one might set label to &quot;ReLU(x + 1)&quot; to improve readability.</span>

<span class="sd">        sub_label:</span>
<span class="sd">            Provide supplemental information to disambiguate measurements</span>
<span class="sd">            with identical stmt or label. For instance, in our example</span>
<span class="sd">            above sub_label might be &quot;float&quot; or &quot;int&quot;, so that it is easy</span>
<span class="sd">            to differentiate:</span>
<span class="sd">            &quot;ReLU(x + 1): (float)&quot;</span>

<span class="sd">            &quot;ReLU(x + 1): (int)&quot;</span>
<span class="sd">            when printing Measurements or summarizing using `Compare`.</span>

<span class="sd">        description:</span>
<span class="sd">            String to distinguish measurements with identical label and</span>
<span class="sd">            sub_label. The principal use of `description` is to signal to</span>
<span class="sd">            `Compare` the columns of data. For instance one might set it</span>
<span class="sd">            based on the input size  to create a table of the form: ::</span>

<span class="sd">                                        | n=1 | n=4 | ...</span>
<span class="sd">                                        ------------- ...</span>
<span class="sd">                ReLU(x + 1): (float)    | ... | ... | ...</span>
<span class="sd">                ReLU(x + 1): (int)      | ... | ... | ...</span>


<span class="sd">            using `Compare`. It is also included when printing a Measurement.</span>

<span class="sd">        env:</span>
<span class="sd">            This tag indicates that otherwise identical tasks were run in</span>
<span class="sd">            different environments, and are therefore not equivilent, for</span>
<span class="sd">            instance when A/B testing a change to a kernel. `Compare` will</span>
<span class="sd">            treat Measurements with different `env` specification as distinct</span>
<span class="sd">            when merging replicate runs.</span>

<span class="sd">        num_threads:</span>
<span class="sd">            The size of the PyTorch threadpool when executing `stmt`. Single</span>
<span class="sd">            threaded performace is important as both a key inference workload</span>
<span class="sd">            and a good indicator of intrinsic algorithmic efficiency, so the</span>
<span class="sd">            default is set to one. This is in contrast to the default PyTorch</span>
<span class="sd">            threadpool size which tries to utilize all cores.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_timer_cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">TimerClass</span><span class="p">]</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">Timer</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">stmt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pass&quot;</span><span class="p">,</span>
        <span class="n">setup</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pass&quot;</span><span class="p">,</span>
        <span class="n">global_setup</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">timer</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">timer</span><span class="p">,</span>
        <span class="nb">globals</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sub_label</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">language</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Language</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Language</span><span class="o">.</span><span class="n">PYTHON</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Currently only a `str` stmt is supported.&quot;</span><span class="p">)</span>

        <span class="c1"># We copy `globals` to prevent mutations from leaking.</span>
        <span class="c1"># (For instance, `eval` adds the `__builtins__` key)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_globals</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">globals</span> <span class="ow">or</span> <span class="p">{})</span>

        <span class="n">timer_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">language</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Language</span><span class="o">.</span><span class="n">PYTHON</span><span class="p">,</span> <span class="s2">&quot;py&quot;</span><span class="p">,</span> <span class="s2">&quot;python&quot;</span><span class="p">):</span>
            <span class="c1"># Include `torch` if not specified as a convenience feature.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_globals</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">,</span> <span class="n">torch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_language</span><span class="p">:</span> <span class="n">Language</span> <span class="o">=</span> <span class="n">Language</span><span class="o">.</span><span class="n">PYTHON</span>
            <span class="k">if</span> <span class="n">global_setup</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;global_setup is C++ only, got `</span><span class="si">{</span><span class="n">global_setup</span><span class="si">}</span><span class="s2">`. Most &quot;</span>
                    <span class="s2">&quot;likely this code can simply be moved to `setup`.&quot;</span>
                <span class="p">)</span>

        <span class="k">elif</span> <span class="n">language</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Language</span><span class="o">.</span><span class="n">CPP</span><span class="p">,</span> <span class="s2">&quot;cpp&quot;</span><span class="p">,</span> <span class="s2">&quot;c++&quot;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timer_cls</span> <span class="ow">is</span> <span class="n">timeit</span><span class="o">.</span><span class="n">Timer</span><span class="p">,</span> <span class="s2">&quot;_timer_cls has already been swapped.&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_timer_cls</span> <span class="o">=</span> <span class="n">CPPTimer</span>
            <span class="n">setup</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">setup</span> <span class="o">==</span> <span class="s2">&quot;pass&quot;</span> <span class="k">else</span> <span class="n">setup</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_language</span> <span class="o">=</span> <span class="n">Language</span><span class="o">.</span><span class="n">CPP</span>
            <span class="n">timer_kwargs</span><span class="p">[</span><span class="s2">&quot;global_setup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">global_setup</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid language `</span><span class="si">{</span><span class="n">language</span><span class="si">}</span><span class="s2">`.&quot;</span><span class="p">)</span>

        <span class="c1"># Convenience adjustment so that multi-line code snippets defined in</span>
        <span class="c1"># functions do not IndentationError (Python) or look odd (C++). The</span>
        <span class="c1"># leading newline removal is for the initial newline that appears when</span>
        <span class="c1"># defining block strings. For instance:</span>
        <span class="c1">#   textwrap.dedent(&quot;&quot;&quot;</span>
        <span class="c1">#     print(&quot;This is a stmt&quot;)</span>
        <span class="c1">#   &quot;&quot;&quot;)</span>
        <span class="c1"># produces &#39;\nprint(&quot;This is a stmt&quot;)\n&#39;.</span>
        <span class="c1">#</span>
        <span class="c1"># Stripping this down to &#39;print(&quot;This is a stmt&quot;)&#39; doesn&#39;t change</span>
        <span class="c1"># what gets executed, but it makes __repr__&#39;s nicer.</span>
        <span class="n">stmt</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
        <span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span><span class="n">stmt</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="n">stmt</span> <span class="ow">and</span> <span class="n">stmt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">else</span> <span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="n">setup</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">setup</span><span class="p">)</span>
        <span class="n">setup</span> <span class="o">=</span> <span class="p">(</span><span class="n">setup</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="n">setup</span> <span class="ow">and</span> <span class="n">setup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">else</span> <span class="n">setup</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timer_cls</span><span class="p">(</span>
            <span class="n">stmt</span><span class="o">=</span><span class="n">stmt</span><span class="p">,</span>
            <span class="n">setup</span><span class="o">=</span><span class="n">setup</span><span class="p">,</span>
            <span class="n">timer</span><span class="o">=</span><span class="n">timer</span><span class="p">,</span>
            <span class="nb">globals</span><span class="o">=</span><span class="n">valgrind_timer_interface</span><span class="o">.</span><span class="n">CopyIfCallgrind</span><span class="o">.</span><span class="n">unwrap_all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_globals</span><span class="p">),</span>
            <span class="o">**</span><span class="n">timer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_task_spec</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">TaskSpec</span><span class="p">(</span>
            <span class="n">stmt</span><span class="o">=</span><span class="n">stmt</span><span class="p">,</span>
            <span class="n">setup</span><span class="o">=</span><span class="n">setup</span><span class="p">,</span>
            <span class="n">global_setup</span><span class="o">=</span><span class="n">global_setup</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
            <span class="n">sub_label</span><span class="o">=</span><span class="n">sub_label</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span>
            <span class="n">num_threads</span><span class="o">=</span><span class="n">num_threads</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_timeit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="c1"># Even calling a timer in C++ takes ~50 ns, so no real operation should</span>
        <span class="c1"># take less than 1 ns. (And this prevents divide by zero errors.)</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_timer</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="n">number</span><span class="p">),</span> <span class="mf">1e-9</span><span class="p">)</span>

<div class="viewcode-block" id="Timer.timeit"><a class="viewcode-back" href="../../../../../benchmark_utils.html#torch.utils.benchmark.Timer.timeit">[docs]</a>    <span class="k">def</span> <span class="nf">timeit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">common</span><span class="o">.</span><span class="n">Measurement</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Mirrors the semantics of timeit.Timer.timeit().</span>

<span class="sd">        Execute the main statement (`stmt`) `number` times.</span>
<span class="sd">        https://docs.python.org/3/library/timeit.html#timeit.Timer.timeit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">common</span><span class="o">.</span><span class="n">set_torch_threads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_spec</span><span class="o">.</span><span class="n">num_threads</span><span class="p">):</span>
            <span class="c1"># Warmup</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_timeit</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">number</span> <span class="o">//</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">common</span><span class="o">.</span><span class="n">Measurement</span><span class="p">(</span>
                <span class="n">number_per_run</span><span class="o">=</span><span class="n">number</span><span class="p">,</span>
                <span class="n">raw_times</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_timeit</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">)],</span>
                <span class="n">task_spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_spec</span>
            <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">repeat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repeat</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;See `Timer.blocked_autorange.`&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">autorange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">NoReturn</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;See `Timer.blocked_autorange.`&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_threaded_measurement_loop</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">time_hook</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">stop_hook</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span> <span class="nb">bool</span><span class="p">],</span>
        <span class="n">min_run_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">max_run_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">NoReturn</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="n">total_time</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">can_stop</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">times</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="n">common</span><span class="o">.</span><span class="n">set_torch_threads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_spec</span><span class="o">.</span><span class="n">num_threads</span><span class="p">):</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">total_time</span> <span class="o">&lt;</span> <span class="n">min_run_time</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">can_stop</span><span class="p">):</span>
                <span class="n">time_spent</span> <span class="o">=</span> <span class="n">time_hook</span><span class="p">()</span>
                <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time_spent</span><span class="p">)</span>
                <span class="n">total_time</span> <span class="o">+=</span> <span class="n">time_spent</span>
                <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
                    <span class="n">callback</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">time_spent</span><span class="p">)</span>
                <span class="n">can_stop</span> <span class="o">=</span> <span class="n">stop_hook</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">max_run_time</span> <span class="ow">and</span> <span class="n">total_time</span> <span class="o">&gt;</span> <span class="n">max_run_time</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="n">times</span>

    <span class="k">def</span> <span class="nf">_estimate_block_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_run_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">common</span><span class="o">.</span><span class="n">set_torch_threads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_spec</span><span class="o">.</span><span class="n">num_threads</span><span class="p">):</span>
            <span class="c1"># Estimate the block size needed for measurement to be negligible</span>
            <span class="c1"># compared to the inner loop. This also serves as a warmup.</span>
            <span class="n">overhead</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_timeit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)])</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="n">number</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">time_taken</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timeit</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
                <span class="n">relative_overhead</span> <span class="o">=</span> <span class="n">overhead</span> <span class="o">/</span> <span class="n">time_taken</span>
                <span class="k">if</span> <span class="n">relative_overhead</span> <span class="o">&lt;=</span> <span class="mf">1e-4</span> <span class="ow">and</span> <span class="n">time_taken</span> <span class="o">&gt;=</span> <span class="n">min_run_time</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="n">time_taken</span> <span class="o">&gt;</span> <span class="n">min_run_time</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="c1"># Avoid overflow in C++ pybind11 interface</span>
                <span class="k">if</span> <span class="n">number</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">&gt;</span> <span class="mi">2147483647</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">number</span> <span class="o">*=</span> <span class="mi">10</span>
        <span class="k">return</span> <span class="n">number</span>

    <span class="k">def</span> <span class="nf">adaptive_autorange</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="o">*</span><span class="p">,</span>
            <span class="n">min_run_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
            <span class="n">max_run_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">,</span>
            <span class="n">callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">NoReturn</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">common</span><span class="o">.</span><span class="n">Measurement</span><span class="p">:</span>
        <span class="n">number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_block_size</span><span class="p">(</span><span class="n">min_run_time</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">time_hook</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timeit</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">stop_hook</span><span class="p">(</span><span class="n">times</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">common</span><span class="o">.</span><span class="n">Measurement</span><span class="p">(</span>
                    <span class="n">number_per_run</span><span class="o">=</span><span class="n">number</span><span class="p">,</span>
                    <span class="n">raw_times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span>
                    <span class="n">task_spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_spec</span>
                <span class="p">)</span><span class="o">.</span><span class="n">meets_confidence</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threaded_measurement_loop</span><span class="p">(</span>
            <span class="n">number</span><span class="p">,</span> <span class="n">time_hook</span><span class="p">,</span> <span class="n">stop_hook</span><span class="p">,</span> <span class="n">min_run_time</span><span class="p">,</span> <span class="n">max_run_time</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">common</span><span class="o">.</span><span class="n">Measurement</span><span class="p">(</span>
            <span class="n">number_per_run</span><span class="o">=</span><span class="n">number</span><span class="p">,</span>
            <span class="n">raw_times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span>
            <span class="n">task_spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_spec</span>
        <span class="p">)</span>

<div class="viewcode-block" id="Timer.blocked_autorange"><a class="viewcode-back" href="../../../../../benchmark_utils.html#torch.utils.benchmark.Timer.blocked_autorange">[docs]</a>    <span class="k">def</span> <span class="nf">blocked_autorange</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">NoReturn</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">min_run_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">common</span><span class="o">.</span><span class="n">Measurement</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Measure many replicates while keeping timer overhead to a minimum.</span>

<span class="sd">        At a high level, blocked_autorange executes the following pseudo-code::</span>

<span class="sd">            `setup`</span>

<span class="sd">            total_time = 0</span>
<span class="sd">            while total_time &lt; min_run_time</span>
<span class="sd">                start = timer()</span>
<span class="sd">                for _ in range(block_size):</span>
<span class="sd">                    `stmt`</span>
<span class="sd">                total_time += (timer() - start)</span>

<span class="sd">        Note the variable `block_size` in the inner loop. The choice of block</span>
<span class="sd">        size is important to measurement quality, and must balance two</span>
<span class="sd">        competing objectives:</span>

<span class="sd">            1) A small block size results in more replicates and generally</span>
<span class="sd">               better statistics.</span>

<span class="sd">            2) A large block size better amortizes the cost of `timer`</span>
<span class="sd">               invocation, and results in a less biased measurement. This is</span>
<span class="sd">               important because CUDA syncronization time is non-trivial</span>
<span class="sd">               (order single to low double digit microseconds) and would</span>
<span class="sd">               otherwise bias the measurement.</span>

<span class="sd">        blocked_autorange sets block_size by running a warmup period,</span>
<span class="sd">        increasing block size until timer overhead is less than 0.1% of</span>
<span class="sd">        the overall computation. This value is then used for the main</span>
<span class="sd">        measurement loop.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A `Measurement` object that contains measured runtimes and</span>
<span class="sd">            repetition counts, and can be used to compute statistics.</span>
<span class="sd">            (mean, median, etc.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_block_size</span><span class="p">(</span><span class="n">min_run_time</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">time_hook</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timeit</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">stop_hook</span><span class="p">(</span><span class="n">times</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="n">times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threaded_measurement_loop</span><span class="p">(</span>
            <span class="n">number</span><span class="p">,</span> <span class="n">time_hook</span><span class="p">,</span> <span class="n">stop_hook</span><span class="p">,</span>
            <span class="n">min_run_time</span><span class="o">=</span><span class="n">min_run_time</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">common</span><span class="o">.</span><span class="n">Measurement</span><span class="p">(</span>
            <span class="n">number_per_run</span><span class="o">=</span><span class="n">number</span><span class="p">,</span>
            <span class="n">raw_times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span>
            <span class="n">task_spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_spec</span>
        <span class="p">)</span></div>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">collect_callgrind</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">repeats</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">collect_baseline</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">retain_out_file</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">valgrind_timer_interface</span><span class="o">.</span><span class="n">CallgrindStats</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">collect_callgrind</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">repeats</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">collect_baseline</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">retain_out_file</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">valgrind_timer_interface</span><span class="o">.</span><span class="n">CallgrindStats</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="o">...</span>

<div class="viewcode-block" id="Timer.collect_callgrind"><a class="viewcode-back" href="../../../../../benchmark_utils.html#torch.utils.benchmark.Timer.collect_callgrind">[docs]</a>    <span class="k">def</span> <span class="nf">collect_callgrind</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">repeats</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">collect_baseline</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">retain_out_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Collect instruction counts using Callgrind.</span>

<span class="sd">        Unlike wall times, instruction counts are deterministic</span>
<span class="sd">        (modulo non-determinism in the program itself and small amounts of</span>
<span class="sd">        jitter from the Python interpreter.) This makes them ideal for detailed</span>
<span class="sd">        performance analysis. This method runs `stmt` in a separate process</span>
<span class="sd">        so that Valgrind can instrument the program. Performance is severely</span>
<span class="sd">        degraded due to the instrumentation, however this is ameliorated by</span>
<span class="sd">        the fact that a small number of iterations is generally sufficient to</span>
<span class="sd">        obtain good measurements.</span>

<span class="sd">        In order to to use this method `valgrind`, `callgrind_control`, and</span>
<span class="sd">        `callgrind_annotate` must be installed.</span>

<span class="sd">        Because there is a process boundary between the caller (this process)</span>
<span class="sd">        and the `stmt` execution, `globals` cannot contain arbitrary in-memory</span>
<span class="sd">        data structures. (Unlike timing methods) Instead, globals are</span>
<span class="sd">        restricted to builtins, `nn.Modules`&#39;s, and TorchScripted functions/modules</span>
<span class="sd">        to reduce the surprise factor from serialization and subsequent</span>
<span class="sd">        deserialization. The `GlobalsBridge` class provides more detail on this</span>
<span class="sd">        subject. Take particular care with nn.Modules: they rely on pickle and</span>
<span class="sd">        you may need to add an import to `setup` for them to transfer properly.</span>

<span class="sd">        By default, a profile for an empty statement will be collected and</span>
<span class="sd">        cached to indicate how many instructions are from the Python loop which</span>
<span class="sd">        drives `stmt`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A `CallgrindStats` object which provides instruction counts and</span>
<span class="sd">            some basic facilities for analyzing and manipulating results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_spec</span><span class="o">.</span><span class="n">stmt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`collect_callgrind` currently only supports string `stmt`&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">repeats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">repeats</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If specified, `repeats` must be &gt;= 1&quot;</span><span class="p">)</span>

        <span class="c1"># Check that the statement is valid. It doesn&#39;t guarantee success, but it&#39;s much</span>
        <span class="c1"># simpler and quicker to raise an exception for a faulty `stmt` or `setup` in</span>
        <span class="c1"># the parent process rather than the valgrind subprocess.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timeit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">is_python</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_language</span> <span class="o">==</span> <span class="n">Language</span><span class="o">.</span><span class="n">PYTHON</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">is_python</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_globals</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">valgrind_timer_interface</span><span class="o">.</span><span class="n">wrapper_singleton</span><span class="p">()</span><span class="o">.</span><span class="n">collect_callgrind</span><span class="p">(</span>
            <span class="n">task_spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_spec</span><span class="p">,</span>
            <span class="nb">globals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_globals</span><span class="p">,</span>
            <span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">,</span>
            <span class="n">repeats</span><span class="o">=</span><span class="n">repeats</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">collect_baseline</span><span class="o">=</span><span class="n">collect_baseline</span> <span class="ow">and</span> <span class="n">is_python</span><span class="p">,</span>
            <span class="n">is_python</span><span class="o">=</span><span class="n">is_python</span><span class="p">,</span>
            <span class="n">retain_out_file</span><span class="o">=</span><span class="n">retain_out_file</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">repeats</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">result</span><span class="p">)</span></div></div>
</pre></div>

             </article>
             
            </div>
            <footer>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Torch Contributors.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              
            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
         <script src="../../../../../_static/jquery.js"></script>
         <script src="../../../../../_static/underscore.js"></script>
         <script src="../../../../../_static/doctools.js"></script>
         <script src="../../../../../_static/clipboard.min.js"></script>
         <script src="../../../../../_static/copybutton.js"></script>
     

  

  <script type="text/javascript" src="../../../../../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../../../../../_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 
<script script type="text/javascript">
  var collapsedSections = ['Notes', 'Language Bindings', 'Libraries', 'Community'];
</script>

<img height="1" width="1" style="border-style:none;" alt="" src="https://www.googleadservices.com/pagead/conversion/795629140/?label=txkmCPmdtosBENSssfsC&amp;guid=ON&amp;script=0"/>


  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access comprehensive developer documentation for PyTorch</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get in-depth tutorials for beginners and advanced developers</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Resources</h2>
          <p>Find development resources and get your questions answered</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">View Resources</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">Get Started</a></li>
            <li><a href="https://pytorch.org/features">Features</a></li>
            <li><a href="https://pytorch.org/ecosystem">Ecosystem</a></li>
            <li><a href="https://pytorch.org/blog/">Blog</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">Contributing</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/resources">Resources</a></li>
            <li><a href="https://pytorch.org/tutorials">Tutorials</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">Docs</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">Discuss</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github Issues</a></li>
            <li><a href="https://pytorch.org/assets/brand-guidelines/PyTorch-Brand-Guidelines.pdf" target="_blank">Brand Guidelines</a></li>
          </ul>
        </div>

        <div class="footer-links-col follow-us-col">
          <ul>
            <li class="list-title">Stay Connected</li>
            <li>
              <div id="mc_embed_signup">
                <form
                  action="https://twitter.us14.list-manage.com/subscribe/post?u=75419c71fe0a935e53dfa4a3f&id=91d0dccd39"
                  method="post"
                  id="mc-embedded-subscribe-form"
                  name="mc-embedded-subscribe-form"
                  class="email-subscribe-form validate"
                  target="_blank"
                  novalidate>
                  <div id="mc_embed_signup_scroll" class="email-subscribe-form-fields-wrapper">
                    <div class="mc-field-group">
                      <label for="mce-EMAIL" style="display:none;">Email Address</label>
                      <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="Email Address">
                    </div>

                    <div id="mce-responses" class="clear">
                      <div class="response" id="mce-error-response" style="display:none"></div>
                      <div class="response" id="mce-success-response" style="display:none"></div>
                    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->

                    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_75419c71fe0a935e53dfa4a3f_91d0dccd39" tabindex="-1" value=""></div>

                    <div class="clear">
                      <input type="submit" value="" name="subscribe" id="mc-embedded-subscribe" class="button email-subscribe-button">
                    </div>
                  </div>
                </form>
              </div>

            </li>
          </ul>

          <div class="footer-social-icons">
            <a href="https://www.facebook.com/pytorch" target="_blank" class="facebook"></a>
            <a href="https://twitter.com/pytorch" target="_blank" class="twitter"></a>
            <a href="https://www.youtube.com/pytorch" target="_blank" class="youtube"></a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebookâ€™s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="../../../../../_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/hub">PyTorch Hub</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="resources-mobile-menu-title" class="active">
            Docs
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/docs/stable/index.html">PyTorch</a>
            </li>

            <li>
              <a href="https://pytorch.org/audio/stable/index.html">torchaudio</a>
            </li>

            <li>
              <a href="https://pytorch.org/text/stable/index.html">torchtext</a>
            </li>

            <li>
              <a href="https://pytorch.org/vision/stable/index.html">torchvision</a>
            </li>

            <li>
              <a href="https://pytorch.org/elastic/">TorchElastic</a>
            </li>

            <li>
              <a href="https://pytorch.org/serve/">TorchServe</a>
            </li>

            <li>
              <a href="https://pytorch.org/xla">PyTorch on XLA Devices</a>
            </li>
          </ul>

          <li class="resources-mobile-menu-title">
            Resources
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/resources">Developer Resources</a>
            </li>

            <li>
              <a href="https://pytorch.org/features">About</a>
            </li>

            <li>
              <a href="https://pytorch.org/hub">Models (Beta)</a>
            </li>

            <li>
              <a href="https://pytorch.org/#community-module">Community</a>
            </li>

            <li>
              <a href="https://discuss.pytorch.org/">Forums</a>
            </li>
          </ul>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../../../../../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>