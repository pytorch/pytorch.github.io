


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta name="robots" content="noindex">
  <meta name="robots" content="noindex">
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>torch.distributed.algorithms.join &mdash; PyTorch 1.11.0 documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://pytorch.org/docs/stable/_modules/torch/distributed/algorithms/join.html"/>
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="../../../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/katex-math.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/jit.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />


  <!-- Google Analytics -->
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-117752657-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-117752657-2');
    </script>
  
  <!-- End Google Analytics -->
  


  
  <script src="../../../../_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="active docs-active">
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-orange-arrow">
                Docs
              </a>
              <div class="resources-dropdown-menu">
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/docs/stable/index.html">
                  <span class="dropdown-title">PyTorch</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/audio/stable/index.html">
                  <span class="dropdown-title">torchaudio</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/text/stable/index.html">
                  <span class="dropdown-title">torchtext</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/vision/stable/index.html">
                  <span class="dropdown-title">torchvision</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/torchrec">
                  <span class="dropdown-title">TorchRec</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/data">
                  <span class="dropdown-title">TorchData</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/serve/">
                  <span class="dropdown-title">TorchServe</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/xla">
                  <span class="dropdown-title">PyTorch on XLA Devices</span>
                  <p></p>
                </a>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-arrow">
                Resources
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/features">
                  <span class="dropdown-title">About</span>
                  <p>Learn about PyTorchâ€™s features and capabilities</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/#community-module">
                  <span class="dropdown-title">Community</span>
                  <p>Join the PyTorch developer community to contribute, learn, and get your questions answered.</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/resources">
                  <span class="dropdown-title">Developer Resources</span>
                  <p>Find resources and get questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="https://discuss.pytorch.org/" target="_blank">
                  <span class="dropdown-title">Forums</span>
                  <p>A place to discuss PyTorch code, issues, install, research</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/hub">
                  <span class="dropdown-title">Models (Beta)</span>
                  <p>Discover, publish, and reuse pre-trained models</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <a href="https://github.com/pytorch/pytorch">GitHub</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>

<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            
    <div class="version">
      <a href='https://pytorch.org/docs/versions.html'>1.11.0 &#x25BC</a>
    </div>
    


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          </div>

          


            
            
              
            
            
              <p class="caption"><span class="caption-text">Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/amp_examples.html">Automatic Mixed Precision examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/autograd.html">Autograd mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/broadcasting.html">Broadcasting semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/cpu_threading_torchscript_inference.html">CPU threading and TorchScript inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/cuda.html">CUDA semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/ddp.html">Distributed Data Parallel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/extending.html">Extending PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/gradcheck.html">Gradcheck mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/hip.html">HIP (ROCm) semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/large_scale_deployments.html">Features for large-scale deployments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/multiprocessing.html">Multiprocessing best practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/numerical_accuracy.html">Numerical accuracy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/randomness.html">Reproducibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/serialization.html">Serialization semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/windows.html">Windows FAQ</a></li>
</ul>
<p class="caption"><span class="caption-text">Language Bindings</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../cpp_index.html">C++</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/javadoc/">Javadoc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../deploy.html">torch::deploy</a></li>
</ul>
<p class="caption"><span class="caption-text">Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../torch.html">torch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nn.html">torch.nn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nn.functional.html">torch.nn.functional</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tensors.html">torch.Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tensor_attributes.html">Tensor Attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tensor_view.html">Tensor Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../autograd.html">torch.autograd</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cuda.html">torch.cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../amp.html">torch.cuda.amp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../backends.html">torch.backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../distributed.html">torch.distributed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../distributed.algorithms.join.html">torch.distributed.algorithms.join</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../distributed.elastic.html">torch.distributed.elastic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../fsdp.html">torch.distributed.fsdp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../distributed.optim.html">torch.distributed.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../distributions.html">torch.distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../fft.html">torch.fft</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../futures.html">torch.futures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../fx.html">torch.fx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hub.html">torch.hub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../jit.html">torch.jit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../linalg.html">torch.linalg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../monitor.html">torch.monitor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../special.html">torch.special</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../torch.overrides.html">torch.overrides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../package.html">torch.package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../profiler.html">torch.profiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nn.init.html">torch.nn.init</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../onnx.html">torch.onnx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../optim.html">torch.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../complex_numbers.html">Complex Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ddp_comm_hooks.html">DDP Communication Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pipeline.html">Pipeline Parallelism</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quantization.html">Quantization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rpc.html">Distributed RPC Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../random.html">torch.random</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sparse.html">torch.sparse</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../storage.html">torch.Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../testing.html">torch.testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../benchmark_utils.html">torch.utils.benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bottleneck.html">torch.utils.bottleneck</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../checkpoint.html">torch.utils.checkpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cpp_extension.html">torch.utils.cpp_extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../data.html">torch.utils.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dlpack.html">torch.utils.dlpack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mobile_optimizer.html">torch.utils.mobile_optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../model_zoo.html">torch.utils.model_zoo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tensorboard.html">torch.utils.tensorboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../type_info.html">Type Info</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../named_tensor.html">Named Tensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../name_inference.html">Named Tensors operator coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../__config__.html">torch.__config__</a></li>
</ul>
<p class="caption"><span class="caption-text">Libraries</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/audio/stable">torchaudio</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/text/stable">torchtext</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/vision/stable">torchvision</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/serve">TorchServe</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pytorch.org/xla/">PyTorch on XLA Devices</a></li>
</ul>
<p class="caption"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../community/contribution_guide.html">PyTorch Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../community/governance.html">PyTorch Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../community/persons_of_interest.html">PyTorch Governance | Persons of Interest</a></li>
</ul>

            
          

        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="../../../../index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
          <li><a href="../../../index.html">Module code</a> &gt;</li>
        
          <li><a href="../../../torch.html">torch</a> &gt;</li>
        
          <li><a href="../../distributed.html">torch.distributed</a> &gt;</li>
        
      <li>torch.distributed.algorithms.join</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <h1>Source code for torch.distributed.algorithms.join</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">TracebackType</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">NamedTuple</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Type</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.distributed</span> <span class="k">as</span> <span class="nn">dist</span>


<div class="viewcode-block" id="JoinHook"><a class="viewcode-back" href="../../../../distributed.algorithms.join.html#torch.distributed.algorithms.JoinHook">[docs]</a><span class="k">class</span> <span class="nc">JoinHook</span><span class="p">():</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This defines a join hook, which provides two entry points in the join</span>
<span class="sd">    context manager: a main hook, which is called repeatedly while there exists</span>
<span class="sd">    a non-joined process, and a post-hook, which is called once all processes</span>
<span class="sd">    have joined.</span>

<span class="sd">    To implement a join hook for the generic join context manager, define a</span>
<span class="sd">    class that inherits from :class:`JoinHook` and override ``main_hook()`` and</span>
<span class="sd">    ``post_hook()`` as appropriate.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="JoinHook.main_hook"><a class="viewcode-back" href="../../../../distributed.algorithms.join.html#torch.distributed.algorithms.JoinHook.main_hook">[docs]</a>    <span class="k">def</span> <span class="nf">main_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This hook is called repeatedly while there exists a non-joined process</span>
<span class="sd">        to shadow collective communications in one training iteration (i.e. in</span>
<span class="sd">        one forward pass, backward pass, and optimizer step).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span></div>

<div class="viewcode-block" id="JoinHook.post_hook"><a class="viewcode-back" href="../../../../distributed.algorithms.join.html#torch.distributed.algorithms.JoinHook.post_hook">[docs]</a>    <span class="k">def</span> <span class="nf">post_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_last_joiner</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This hook is called after all processes have joined. It is passed an</span>
<span class="sd">        additional ``bool`` argument ``is_last_joiner``, which indicates if the</span>
<span class="sd">        rank is one of the last to join.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            is_last_joiner (bool): ``True`` if the rank is one of the last to</span>
<span class="sd">                join; ``False`` otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span></div></div>


<div class="viewcode-block" id="Joinable"><a class="viewcode-back" href="../../../../distributed.algorithms.join.html#torch.distributed.algorithms.Joinable">[docs]</a><span class="k">class</span> <span class="nc">Joinable</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This defines an abstract base class for joinable classes. A joinable class</span>
<span class="sd">    (inheriting from :class:`Joinable`) should implement :meth:`join_hook`,</span>
<span class="sd">    which returns a :class:`JoinHook` instance, in addition to</span>
<span class="sd">    :meth:`join_device` and :meth:`join_process_group` that return device and</span>
<span class="sd">    process group information, respectively.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Joinable</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_join_config</span> <span class="o">=</span> <span class="n">_JoinConfig</span><span class="o">.</span><span class="n">construct_disabled_join_config</span><span class="p">()</span>

<div class="viewcode-block" id="Joinable.join_hook"><a class="viewcode-back" href="../../../../distributed.algorithms.join.html#torch.distributed.algorithms.Joinable.join_hook">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">join_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JoinHook</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a :class:`JoinHook` instance for the given :class:`Joinable`.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            kwargs (dict): a :class:`dict` containing any keyword arguments</span>
<span class="sd">                to modify the behavior of the join hook at run time; all</span>
<span class="sd">                :class:`Joinable` instances sharing the same join context</span>
<span class="sd">                manager are forwarded the same value for ``kwargs``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span></div>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">join_device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the device from which to perform collective communications</span>
<span class="sd">        needed by the join context manager implementation itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">join_process_group</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the process group for the collective communications needed by</span>
<span class="sd">        the join context manager itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span></div>


<span class="k">class</span> <span class="nc">_JoinConfig</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This includes all fields needed from a :class:`Joinable` instance for the</span>
<span class="sd">    join context manager side.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">enable</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">throw_on_early_termination</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">is_first_joinable</span><span class="p">:</span> <span class="nb">bool</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">construct_disabled_join_config</span><span class="p">():</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a :class:`_JoinConfig` instance indicating that join-related</span>
<span class="sd">        logic should be disabled, e.g. if the caller is not in a join context</span>
<span class="sd">        manager.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_JoinConfig</span><span class="p">(</span>
            <span class="n">enable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">throw_on_early_termination</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">is_first_joinable</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>



<div class="viewcode-block" id="Join"><a class="viewcode-back" href="../../../../distributed.algorithms.join.html#torch.distributed.algorithms.Join">[docs]</a><span class="k">class</span> <span class="nc">Join</span><span class="p">():</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class defines the generic join context manager, which allows custom</span>
<span class="sd">    hooks to be called after a process joins. These hooks should shadow the</span>
<span class="sd">    collective communications of non-joined processes to prevent hanging and</span>
<span class="sd">    erroring and to ensure algorithmic correctness. Refer to :class:`JoinHook`</span>
<span class="sd">    for details about the hook definition.</span>

<span class="sd">    .. warning::</span>
<span class="sd">        The context manager requires each participating :class:`Joinable` to</span>
<span class="sd">        call the method :meth:`notify_join_context()` before its own per-</span>
<span class="sd">        iteration collective communications to ensure correctness.</span>

<span class="sd">    .. warning::</span>
<span class="sd">        The context manager requires that all ``process_group`` attributes in</span>
<span class="sd">        the :class:`JoinHook` objects are the same. If there are multiple</span>
<span class="sd">        :class:`JoinHook` objects, then the ``device`` of the first is used.</span>
<span class="sd">        The process group and device information is used for checking for non-</span>
<span class="sd">        joined processes and for notifying processes to throw an exception if</span>
<span class="sd">        ``throw_on_early_termination`` is enabled, both of which using an all-</span>
<span class="sd">        reduce.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        joinables (List[Joinable]): a list of the participating</span>
<span class="sd">            :class:`Joinable` s; their hooks are iterated over in the given</span>
<span class="sd">            order.</span>

<span class="sd">        enable (bool): a flag enabling uneven input detection; setting to</span>
<span class="sd">            ``False`` disables the context manager&#39;s functionality and should</span>
<span class="sd">            only be set when the user knows the inputs will not be uneven</span>
<span class="sd">            (default: ``True``).</span>

<span class="sd">        throw_on_early_termination (bool): a flag controlling whether to throw an</span>
<span class="sd">            exception upon detecting uneven inputs (default: ``False``).</span>

<span class="sd">    Example::</span>

<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; import torch</span>
<span class="sd">        &gt;&gt;&gt; import torch.distributed as dist</span>
<span class="sd">        &gt;&gt;&gt; import torch.multiprocessing as mp</span>
<span class="sd">        &gt;&gt;&gt; import torch.nn.parallel.DistributedDataParallel as DDP</span>
<span class="sd">        &gt;&gt;&gt; import torch.distributed.optim.ZeroRedundancyOptimizer as ZeRO</span>
<span class="sd">        &gt;&gt;&gt; from torch.distributed.algorithms.join import Join</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # On each spawned worker</span>
<span class="sd">        &gt;&gt;&gt; def worker(rank):</span>
<span class="sd">        &gt;&gt;&gt;     dist.init_process_group(&quot;nccl&quot;, rank=rank, world_size=2)</span>
<span class="sd">        &gt;&gt;&gt;     model = DDP(torch.nn.Linear(1, 1).to(rank), device_ids=[rank])</span>
<span class="sd">        &gt;&gt;&gt;     optim = ZeRO(model.parameters(), torch.optim.Adam, lr=0.01)</span>
<span class="sd">        &gt;&gt;&gt;     # Rank 1 gets one more input than rank 0</span>
<span class="sd">        &gt;&gt;&gt;     inputs = [torch.tensor([1.]).to(rank) for _ in range(10 + rank)]</span>
<span class="sd">        &gt;&gt;&gt;     with Join([model, optim]):</span>
<span class="sd">        &gt;&gt;&gt;         for input in inputs:</span>
<span class="sd">        &gt;&gt;&gt;             loss = model(input).sum()</span>
<span class="sd">        &gt;&gt;&gt;             loss.backward()</span>
<span class="sd">        &gt;&gt;&gt;             optim.step()</span>
<span class="sd">        &gt;&gt;&gt;     # All ranks reach here without hanging/erroring</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">joinables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Joinable</span><span class="p">],</span>
        <span class="n">enable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">throw_on_early_termination</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">joinables</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The join context manager requires at least one joinable&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_joinables</span> <span class="o">=</span> <span class="n">joinables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_join_hooks</span> <span class="o">=</span> <span class="p">[</span><span class="n">joinable</span><span class="o">.</span><span class="n">join_hook</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">joinable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_joinables</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enable</span> <span class="o">=</span> <span class="n">enable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_throw_on_early_termination</span> <span class="o">=</span> <span class="n">throw_on_early_termination</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_joinable_configs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extract_dist_info</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_set_joinable_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the :class:`_JoinConfig` of each participating :class:`Joinable`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_joinables</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">is_first_joinable</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">joinable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_joinables</span><span class="p">:</span>
            <span class="n">joinable</span><span class="o">.</span><span class="n">_join_config</span> <span class="o">=</span> <span class="n">_JoinConfig</span><span class="p">(</span>
                <span class="n">enable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_enable</span><span class="p">,</span>
                <span class="n">throw_on_early_termination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_throw_on_early_termination</span><span class="p">,</span>
                <span class="n">is_first_joinable</span><span class="o">=</span><span class="n">is_first_joinable</span>
            <span class="p">)</span>
            <span class="n">is_first_joinable</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_extract_dist_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts the process group and device information from the joinables.</span>
<span class="sd">        If there are multiple joinables, then the context manager uses the</span>
<span class="sd">        first specified device.</span>

<span class="sd">        Preconditions:</span>
<span class="sd">            ``self._joinables`` is not ``None`` and is non-empty.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError</span>
<span class="sd">                If there are multiple conflicting ``process_group`` attributes</span>
<span class="sd">                among the ``Joinable`` objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">process_group</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">device</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">joinable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_joinables</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">process_group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">process_group</span> <span class="o">=</span> <span class="n">joinable</span><span class="o">.</span><span class="n">join_process_group</span>
            <span class="k">elif</span> <span class="n">process_group</span> <span class="o">!=</span> <span class="n">joinable</span><span class="o">.</span><span class="n">join_process_group</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Using join context manager with multiple process groups&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">device</span> <span class="o">=</span> <span class="n">joinable</span><span class="o">.</span><span class="n">join_device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process_group</span> <span class="o">=</span> <span class="n">process_group</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rank</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">get_rank</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_group</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_device</span> <span class="o">=</span> <span class="n">device</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="nb">type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]],</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">],</span>
        <span class="n">traceback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TracebackType</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Repeatedly runs the main hooks until all processes join; then, runs</span>
<span class="sd">        the post-hooks.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError</span>
<span class="sd">                If ``throw_on_early_termination=True``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enable</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">:</span>
            <span class="k">return</span>  <span class="c1"># propagate the exception directly if one was raised</span>

        <span class="n">all_procs_joined</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">is_last_joiner</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">WARN_THRESHOLD</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;once&quot;</span><span class="p">)</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="n">all_procs_joined</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">WARN_THRESHOLD</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Detected uneven input skew of greater than &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">WARN_THRESHOLD</span><span class="si">}</span><span class="s2">. This means that rank &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_rank</span><span class="si">}</span><span class="s2"> has at least </span><span class="si">{</span><span class="n">WARN_THRESHOLD</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;fewer inputs than other currently-active ranks. &quot;</span>
                    <span class="s2">&quot;This level of skew could lead to performance &quot;</span>
                    <span class="s2">&quot;degradataion during training.&quot;</span>
                <span class="p">)</span>
            <span class="c1"># Shadow the all-reduce in non-joined processes</span>
            <span class="n">num_nonjoined_procs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_num_nonjoined_procs</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">num_nonjoined_procs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">all_procs_joined</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_throw_on_early_termination</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_notify_procs_to_terminate</span><span class="p">()</span>

                <span class="c1"># Run main hooks</span>
                <span class="k">for</span> <span class="n">join_hook</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join_hooks</span><span class="p">:</span>
                    <span class="n">join_hook</span><span class="o">.</span><span class="n">main_hook</span><span class="p">()</span>

                <span class="n">is_last_joiner</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Run post-hooks</span>
        <span class="k">for</span> <span class="n">join_hook</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join_hooks</span><span class="p">:</span>
            <span class="n">join_hook</span><span class="o">.</span><span class="n">post_hook</span><span class="p">(</span><span class="n">is_last_joiner</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_num_nonjoined_procs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the number of non-joined processes by shadowing an all-reduce</span>
<span class="sd">        in the non-joined processes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">num_nonjoined_procs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="p">)</span>
        <span class="n">dist</span><span class="o">.</span><span class="n">all_reduce</span><span class="p">(</span><span class="n">num_nonjoined_procs</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_group</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">num_nonjoined_procs</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_notify_procs_to_terminate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Schedules an all-reduce to notify non-joined processes to terminate</span>
<span class="sd">        and raises a ``RuntimeError`` indicating that the current process has</span>
<span class="sd">        exhausted its inputs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ones</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="p">)</span>
        <span class="n">dist</span><span class="o">.</span><span class="n">all_reduce</span><span class="p">(</span><span class="n">ones</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_group</span><span class="p">)</span>
        <span class="c1"># NOTE: Raising `StopIteration` does not throw an error in Python 3.6</span>
        <span class="c1"># and throws a `RuntimeError` in Python 3.7+ (PEP 479), so we just</span>
        <span class="c1"># raise a `RuntimeError` here</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rank </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_rank</span><span class="si">}</span><span class="s2"> exhausted all inputs.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Join.notify_join_context"><a class="viewcode-back" href="../../../../distributed.algorithms.join.html#torch.distributed.algorithms.Join.notify_join_context">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">notify_join_context</span><span class="p">(</span><span class="n">joinable</span><span class="p">:</span> <span class="n">Joinable</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Notifies the join context manager that the calling process has not yet</span>
<span class="sd">        joined; then, if ``throw_on_early_termination=True``, checks if uneven</span>
<span class="sd">        inputs have been detected (i.e. if one process has already joined) and</span>
<span class="sd">        throws an exception if so.</span>

<span class="sd">        This method should be called from a :class:`Joinable` object before</span>
<span class="sd">        its per-iteration collective communications. For example, this should</span>
<span class="sd">        be called at the beginning of the forward pass in</span>
<span class="sd">        :class:`DistributedDataParallel`.</span>

<span class="sd">        Only the first :class:`Joinable` object passed into the context</span>
<span class="sd">        manager performs the collective communications in this method, and</span>
<span class="sd">        for the others, this method is vacuous.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            joinable (Joinable): the :class:`Joinable` object calling this</span>
<span class="sd">                method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An async work handle for the all-reduce meant to notify the context</span>
<span class="sd">            manager that the process has not yet joined if ``joinable`` is the</span>
<span class="sd">            first one passed into the context manager; ``None`` otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">joinable</span><span class="p">,</span> <span class="s2">&quot;_join_config&quot;</span><span class="p">),</span> \
            <span class="sa">f</span><span class="s2">&quot;Check that the </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">joinable</span><span class="p">)</span><span class="si">}</span><span class="s2"> constructor calls the &quot;</span> \
            <span class="s2">&quot;``Joinable`` constructor&quot;</span>

        <span class="n">join_config</span> <span class="o">=</span> <span class="n">joinable</span><span class="o">.</span><span class="n">_join_config</span>
        <span class="c1"># First joinable is responsible for the collective communications</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">join_config</span><span class="o">.</span><span class="n">is_first_joinable</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">join_config</span><span class="o">.</span><span class="n">enable</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">device</span> <span class="o">=</span> <span class="n">joinable</span><span class="o">.</span><span class="n">join_device</span>
        <span class="n">process_group</span> <span class="o">=</span> <span class="n">joinable</span><span class="o">.</span><span class="n">join_process_group</span>

        <span class="c1"># Schedule an all-reduce to indicate that the caller has not yet joined</span>
        <span class="n">ones</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
        <span class="n">work</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">all_reduce</span><span class="p">(</span><span class="n">ones</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">process_group</span><span class="p">,</span> <span class="n">async_op</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">join_config</span><span class="o">.</span><span class="n">throw_on_early_termination</span><span class="p">:</span>
            <span class="c1"># Check if uneven inputs have been detected</span>
            <span class="n">zeros</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
            <span class="n">dist</span><span class="o">.</span><span class="n">all_reduce</span><span class="p">(</span><span class="n">zeros</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">process_group</span><span class="p">)</span>
            <span class="n">should_throw</span> <span class="o">=</span> <span class="n">zeros</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">should_throw</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Detected at least one rank that exhausted inputs. &quot;</span>
                    <span class="s2">&quot;Throwing across all ranks.&quot;</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">work</span></div></div>
</pre></div>

             </article>
             
            </div>
            <footer>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Torch Contributors.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              
            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
         <script src="../../../../_static/jquery.js"></script>
         <script src="../../../../_static/underscore.js"></script>
         <script src="../../../../_static/doctools.js"></script>
         <script src="../../../../_static/clipboard.min.js"></script>
         <script src="../../../../_static/copybutton.js"></script>
     

  

  <script type="text/javascript" src="../../../../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../../../../_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 
<script script type="text/javascript">
  var collapsedSections = ['Notes', 'Language Bindings', 'Libraries', 'Community'];
</script>

<img height="1" width="1" style="border-style:none;" alt="" src="https://www.googleadservices.com/pagead/conversion/795629140/?label=txkmCPmdtosBENSssfsC&amp;guid=ON&amp;script=0"/>


  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access comprehensive developer documentation for PyTorch</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get in-depth tutorials for beginners and advanced developers</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Resources</h2>
          <p>Find development resources and get your questions answered</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">View Resources</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">Get Started</a></li>
            <li><a href="https://pytorch.org/features">Features</a></li>
            <li><a href="https://pytorch.org/ecosystem">Ecosystem</a></li>
            <li><a href="https://pytorch.org/blog/">Blog</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">Contributing</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/resources">Resources</a></li>
            <li><a href="https://pytorch.org/tutorials">Tutorials</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">Docs</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">Discuss</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github Issues</a></li>
            <li><a href="https://pytorch.org/assets/brand-guidelines/PyTorch-Brand-Guidelines.pdf" target="_blank">Brand Guidelines</a></li>
          </ul>
        </div>

        <div class="footer-links-col follow-us-col">
          <ul>
            <li class="list-title">Stay Connected</li>
            <li>
              <div id="mc_embed_signup">
                <form
                  action="https://twitter.us14.list-manage.com/subscribe/post?u=75419c71fe0a935e53dfa4a3f&id=91d0dccd39"
                  method="post"
                  id="mc-embedded-subscribe-form"
                  name="mc-embedded-subscribe-form"
                  class="email-subscribe-form validate"
                  target="_blank"
                  novalidate>
                  <div id="mc_embed_signup_scroll" class="email-subscribe-form-fields-wrapper">
                    <div class="mc-field-group">
                      <label for="mce-EMAIL" style="display:none;">Email Address</label>
                      <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="Email Address">
                    </div>

                    <div id="mce-responses" class="clear">
                      <div class="response" id="mce-error-response" style="display:none"></div>
                      <div class="response" id="mce-success-response" style="display:none"></div>
                    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->

                    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_75419c71fe0a935e53dfa4a3f_91d0dccd39" tabindex="-1" value=""></div>

                    <div class="clear">
                      <input type="submit" value="" name="subscribe" id="mc-embedded-subscribe" class="button email-subscribe-button">
                    </div>
                  </div>
                </form>
              </div>

            </li>
          </ul>

          <div class="footer-social-icons">
            <a href="https://www.facebook.com/pytorch" target="_blank" class="facebook"></a>
            <a href="https://twitter.com/pytorch" target="_blank" class="twitter"></a>
            <a href="https://www.youtube.com/pytorch" target="_blank" class="youtube"></a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebookâ€™s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="../../../../_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/hub">PyTorch Hub</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="resources-mobile-menu-title" class="active">
            Docs
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/docs/stable/index.html">PyTorch</a>
            </li>

            <li>
              <a href="https://pytorch.org/audio/stable/index.html">torchaudio</a>
            </li>

            <li>
              <a href="https://pytorch.org/text/stable/index.html">torchtext</a>
            </li>

            <li>
              <a href="https://pytorch.org/vision/stable/index.html">torchvision</a>
            </li>

            <li>
              <a href="https://pytorch.org/elastic/">TorchElastic</a>
            </li>

            <li>
              <a href="https://pytorch.org/serve/">TorchServe</a>
            </li>

            <li>
              <a href="https://pytorch.org/xla">PyTorch on XLA Devices</a>
            </li>
          </ul>

          <li class="resources-mobile-menu-title">
            Resources
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/resources">Developer Resources</a>
            </li>

            <li>
              <a href="https://pytorch.org/features">About</a>
            </li>

            <li>
              <a href="https://pytorch.org/hub">Models (Beta)</a>
            </li>

            <li>
              <a href="https://pytorch.org/#community-module">Community</a>
            </li>

            <li>
              <a href="https://discuss.pytorch.org/">Forums</a>
            </li>
          </ul>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../../../../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>