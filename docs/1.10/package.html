


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta name="robots" content="noindex">
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>torch.package &mdash; PyTorch 1.10 documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://pytorch.org/docs/stable/package.html"/>
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/katex-math.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/jit.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="torch.profiler" href="profiler.html" />
    <link rel="prev" title="torch.overrides" href="torch.overrides.html" />



  
  <script src="_static/js/modernizr.min.js"></script>
  <!-- Google Analytics -->

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-117752657-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-117752657-2');
    </script>


  <!-- Preload the theme fonts -->

<link rel="preload" href="_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="active docs-active">
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-orange-arrow">
                Docs
              </a>
              <div class="resources-dropdown-menu">
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/docs/stable/index.html">
                  <span class="dropdown-title">PyTorch</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/audio/stable/index.html">
                  <span class="dropdown-title">torchaudio</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/text/stable/index.html">
                  <span class="dropdown-title">torchtext</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/vision/stable/index.html">
                  <span class="dropdown-title">torchvision</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/elastic/">
                  <span class="dropdown-title">TorchElastic</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/serve/">
                  <span class="dropdown-title">TorchServe</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/xla">
                  <span class="dropdown-title">PyTorch on XLA Devices</span>
                  <p></p>
                </a>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-arrow">
                Resources
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/features">
                  <span class="dropdown-title">About</span>
                  <p>Learn about PyTorch’s features and capabilities</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/#community-module">
                  <span class="dropdown-title">Community</span>
                  <p>Join the PyTorch developer community to contribute, learn, and get your questions answered.</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/resources">
                  <span class="dropdown-title">Developer Resources</span>
                  <p>Find resources and get questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="https://discuss.pytorch.org/" target="_blank">
                  <span class="dropdown-title">Forums</span>
                  <p>A place to discuss PyTorch code, issues, install, research</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/hub">
                  <span class="dropdown-title">Models (Beta)</span>
                  <p>Discover, publish, and reuse pre-trained models</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <a href="https://github.com/pytorch/pytorch">GitHub</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>

<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            
    <div class="version">
      <a href='https://pytorch.org/docs/versions.html'>1.10 &#x25BC</a>
    </div>
    


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          </div>

          


            
            
              
            
            
              <p class="caption"><span class="caption-text">Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="notes/amp_examples.html">Automatic Mixed Precision examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/autograd.html">Autograd mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/broadcasting.html">Broadcasting semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/cpu_threading_torchscript_inference.html">CPU threading and TorchScript inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/cuda.html">CUDA semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/ddp.html">Distributed Data Parallel</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/extending.html">Extending PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/gradcheck.html">Gradcheck mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/hip.html">HIP (ROCm) semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/large_scale_deployments.html">Features for large-scale deployments</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/multiprocessing.html">Multiprocessing best practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/randomness.html">Reproducibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/serialization.html">Serialization semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/windows.html">Windows FAQ</a></li>
</ul>
<p class="caption"><span class="caption-text">Language Bindings</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cpp_index.html">C++</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/javadoc/">Javadoc</a></li>
</ul>
<p class="caption"><span class="caption-text">Python API</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="torch.html">torch</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.html">torch.nn</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.functional.html">torch.nn.functional</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensors.html">torch.Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensor_attributes.html">Tensor Attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensor_view.html">Tensor Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="autograd.html">torch.autograd</a></li>
<li class="toctree-l1"><a class="reference internal" href="cuda.html">torch.cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="amp.html">torch.cuda.amp</a></li>
<li class="toctree-l1"><a class="reference internal" href="backends.html">torch.backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.html">torch.distributed</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.algorithms.join.html">torch.distributed.algorithms.join</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.elastic.html">torch.distributed.elastic</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.optim.html">torch.distributed.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributions.html">torch.distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="fft.html">torch.fft</a></li>
<li class="toctree-l1"><a class="reference internal" href="futures.html">torch.futures</a></li>
<li class="toctree-l1"><a class="reference internal" href="fx.html">torch.fx</a></li>
<li class="toctree-l1"><a class="reference internal" href="hub.html">torch.hub</a></li>
<li class="toctree-l1"><a class="reference internal" href="jit.html">torch.jit</a></li>
<li class="toctree-l1"><a class="reference internal" href="linalg.html">torch.linalg</a></li>
<li class="toctree-l1"><a class="reference internal" href="special.html">torch.special</a></li>
<li class="toctree-l1"><a class="reference internal" href="torch.overrides.html">torch.overrides</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">torch.package</a></li>
<li class="toctree-l1"><a class="reference internal" href="profiler.html">torch.profiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.init.html">torch.nn.init</a></li>
<li class="toctree-l1"><a class="reference internal" href="onnx.html">torch.onnx</a></li>
<li class="toctree-l1"><a class="reference internal" href="optim.html">torch.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="complex_numbers.html">Complex Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="ddp_comm_hooks.html">DDP Communication Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipeline.html">Pipeline Parallelism</a></li>
<li class="toctree-l1"><a class="reference internal" href="quantization.html">Quantization</a></li>
<li class="toctree-l1"><a class="reference internal" href="rpc.html">Distributed RPC Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="random.html">torch.random</a></li>
<li class="toctree-l1"><a class="reference internal" href="sparse.html">torch.sparse</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage.html">torch.Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">torch.testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmark_utils.html">torch.utils.benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="bottleneck.html">torch.utils.bottleneck</a></li>
<li class="toctree-l1"><a class="reference internal" href="checkpoint.html">torch.utils.checkpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpp_extension.html">torch.utils.cpp_extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">torch.utils.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="dlpack.html">torch.utils.dlpack</a></li>
<li class="toctree-l1"><a class="reference internal" href="mobile_optimizer.html">torch.utils.mobile_optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_zoo.html">torch.utils.model_zoo</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensorboard.html">torch.utils.tensorboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="type_info.html">Type Info</a></li>
<li class="toctree-l1"><a class="reference internal" href="named_tensor.html">Named Tensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="name_inference.html">Named Tensors operator coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="__config__.html">torch.__config__</a></li>
</ul>
<p class="caption"><span class="caption-text">Libraries</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/audio/stable">torchaudio</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/text/stable">torchtext</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/vision/stable">torchvision</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/serve">TorchServe</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pytorch.org/xla/">PyTorch on XLA Devices</a></li>
</ul>
<p class="caption"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="community/contribution_guide.html">PyTorch Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="community/governance.html">PyTorch Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="community/persons_of_interest.html">PyTorch Governance | Persons of Interest</a></li>
</ul>

            
          

        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
      <li>torch.package</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
            
            <a href="_sources/package.rst.txt" rel="nofollow"><img src="_static/images/view-page-source-icon.svg"></a>
          
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <div class="section" id="torch-package">
<h1>torch.package<a class="headerlink" href="#torch-package" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">torch.package</span></code> adds support for creating hermetic packages containing arbitrary
PyTorch code. These packages can be saved, shared, used to load and execute models
at a later date or on a different machine, and can even be deployed to production using
<code class="docutils literal notranslate"><span class="pre">torch::deploy</span></code>.</p>
<p>This document contains tutorials, how-to guides, explanations, and an API reference that
will help you learn more about <code class="docutils literal notranslate"><span class="pre">torch.package</span></code> and how to use it.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This module depends on the <code class="docutils literal notranslate"><span class="pre">pickle</span></code> module which is is not secure. Only unpackage data you trust.</p>
<p>It is possible to construct malicious pickle data which will <strong>execute arbitrary code during unpickling</strong>.
Never unpackage data that could have come from an untrusted source, or that could have been tampered with.</p>
<p>For more information, review the <a class="reference external" href="https://docs.python.org/3/library/pickle.html">documentation</a> for the <code class="docutils literal notranslate"><span class="pre">pickle</span></code> module.</p>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#tutorials" id="id1">Tutorials</a></p>
<ul>
<li><p><a class="reference internal" href="#packaging-your-first-model" id="id2">Packaging your first model</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#how-do-i" id="id3">How do I…</a></p>
<ul>
<li><p><a class="reference internal" href="#see-what-is-inside-a-package" id="id4">See what is inside a package?</a></p></li>
<li><p><a class="reference internal" href="#include-arbitrary-resources-with-my-package-and-access-them-later" id="id5">Include arbitrary resources with my package and access them later?</a></p></li>
<li><p><a class="reference internal" href="#customize-how-a-class-is-packaged" id="id6">Customize how a class is packaged?</a></p></li>
<li><p><a class="reference internal" href="#test-in-my-source-code-whether-or-not-it-is-executing-inside-a-package" id="id7">Test in my source code whether or not it is executing inside a package?</a></p></li>
<li><p><a class="reference internal" href="#patch-code-into-a-package" id="id8">Patch code into a package?</a></p></li>
<li><p><a class="reference internal" href="#access-package-contents-from-packaged-code" id="id9">Access package contents from packaged code?</a></p></li>
<li><p><a class="reference internal" href="#distinguish-between-packaged-code-and-non-packaged-code" id="id10">Distinguish between packaged code and non-packaged code?</a></p></li>
<li><p><a class="reference internal" href="#re-export-an-imported-object" id="id11">Re-export an imported object?</a></p></li>
<li><p><a class="reference internal" href="#package-a-torchscript-module" id="id12">Package a TorchScript module?</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#explanation" id="id13">Explanation</a></p>
<ul>
<li><p><a class="reference internal" href="#torch-package-format-overview" id="id14"><code class="docutils literal notranslate"><span class="pre">torch.package</span></code> Format Overview</a></p></li>
<li><p><a class="reference internal" href="#how-torch-package-finds-your-code-s-dependencies" id="id15">How <code class="docutils literal notranslate"><span class="pre">torch.package</span></code> finds your code’s dependencies</a></p></li>
<li><p><a class="reference internal" href="#dependency-management" id="id16">Dependency Management</a></p></li>
<li><p><a class="reference internal" href="#torch-package-sharp-edges" id="id17"><code class="docutils literal notranslate"><span class="pre">torch.package</span></code> sharp edges</a></p></li>
<li><p><a class="reference internal" href="#how-torch-package-keeps-packages-isolated-from-each-other" id="id18">How <code class="docutils literal notranslate"><span class="pre">torch.package</span></code> keeps packages isolated from each other</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#api-reference" id="id19">API Reference</a></p></li>
</ul>
</div>
<div class="section" id="tutorials">
<h2><a class="toc-backref" href="#id1">Tutorials</a><a class="headerlink" href="#tutorials" title="Permalink to this headline">¶</a></h2>
<div class="section" id="packaging-your-first-model">
<h3><a class="toc-backref" href="#id2">Packaging your first model</a><a class="headerlink" href="#packaging-your-first-model" title="Permalink to this headline">¶</a></h3>
<p>A tutorial that guides you through packaging and unpackaging a simple model is available
<a class="reference external" href="https://colab.research.google.com/drive/1lFZkLyViGfXxB-m3jqlyTQuYToo3XLo-">on Colab</a>.
After completing this exercise, you will be familiar with the basic API for creating and using
Torch packages.</p>
</div>
</div>
<div class="section" id="how-do-i">
<h2><a class="toc-backref" href="#id3">How do I…</a><a class="headerlink" href="#how-do-i" title="Permalink to this headline">¶</a></h2>
<div class="section" id="see-what-is-inside-a-package">
<h3><a class="toc-backref" href="#id4">See what is inside a package?</a><a class="headerlink" href="#see-what-is-inside-a-package" title="Permalink to this headline">¶</a></h3>
<div class="section" id="treat-the-package-like-a-zip-archive">
<h4>Treat the package like a ZIP archive<a class="headerlink" href="#treat-the-package-like-a-zip-archive" title="Permalink to this headline">¶</a></h4>
<p>The container format for a <code class="docutils literal notranslate"><span class="pre">torch.package</span></code> is ZIP, so any tools that work with standard ZIP files should
work for exploring the contents. Some common ways to interact with ZIP files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">unzip</span> <span class="pre">my_package.pt</span></code> will unzip the <code class="docutils literal notranslate"><span class="pre">torch.package</span></code> archive to disk, where you can freely inspect its contents.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ unzip my_package.pt &amp;&amp; tree my_package
my_package
├── .data
│   ├── 94304870911616.storage
│   ├── 94304900784016.storage
│   ├── extern_modules
│   └── version
├── models
│   └── model_1.pkl
└── torchvision
    └── models
        ├── resnet.py
        └── utils.py
~ cd my_package &amp;&amp; cat torchvision/models/resnet.py
...
</pre></div>
</div>
<ul class="simple">
<li><p>The Python <code class="docutils literal notranslate"><span class="pre">zipfile</span></code> module provides a standard way to read and write ZIP archive contents.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">zipfile</span> <span class="kn">import</span> <span class="n">ZipFile</span>
<span class="k">with</span> <span class="n">ZipFile</span><span class="p">(</span><span class="s2">&quot;my_package.pt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">myzip</span><span class="p">:</span>
    <span class="n">file_bytes</span> <span class="o">=</span> <span class="n">myzip</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;torchvision/models/resnet.py&quot;</span><span class="p">)</span>
    <span class="c1"># edit file_bytes in some way</span>
    <span class="n">myzip</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s2">&quot;torchvision/models/resnet.py&quot;</span><span class="p">,</span> <span class="n">new_file_bytes</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>vim has the ability to natively read ZIP archives. You can even edit files and :<code class="docutils literal notranslate"><span class="pre">write</span></code> them back into the archive!</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># add this to your .vimrc to treat `*.pt` files as zip files</span>
<span class="n">au</span> <span class="n">BufReadCmd</span> <span class="o">*.</span><span class="n">pt</span> <span class="n">call</span> <span class="nb">zip</span><span class="c1">#Browse(expand(&quot;&lt;amatch&gt;&quot;))</span>

<span class="o">~</span> <span class="n">vi</span> <span class="n">my_package</span><span class="o">.</span><span class="n">pt</span>
</pre></div>
</div>
</div>
<div class="section" id="use-the-file-structure-api">
<h4>Use the <code class="docutils literal notranslate"><span class="pre">file_structure()</span></code> API<a class="headerlink" href="#use-the-file-structure-api" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="#torch.package.PackageImporter" title="torch.package.PackageImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageImporter</span></code></a> and <a class="reference internal" href="#torch.package.PackageExporter" title="torch.package.PackageExporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageExporter</span></code></a> provide a <code class="docutils literal notranslate"><span class="pre">file_structure()</span></code> method, which will return a printable
and queryable <code class="docutils literal notranslate"><span class="pre">Folder</span></code> object. The <code class="docutils literal notranslate"><span class="pre">Folder</span></code> object is a simple directory structure that you can use to explore the
current contents of a <code class="docutils literal notranslate"><span class="pre">torch.package</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Folder</span></code> object itself is directly printable and will print out a file tree representation. To filter what is returned,
use the glob-style <code class="docutils literal notranslate"><span class="pre">include</span></code> and <code class="docutils literal notranslate"><span class="pre">exclude</span></code> filtering arguments.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">PackageExporter</span><span class="p">(</span><span class="s1">&#39;my_package.pt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pe</span><span class="p">:</span>
    <span class="n">pe</span><span class="o">.</span><span class="n">save_pickle</span><span class="p">(</span><span class="s1">&#39;models&#39;</span><span class="p">,</span> <span class="s1">&#39;model_1.pkl&#39;</span><span class="p">,</span> <span class="n">mod</span><span class="p">)</span>
    <span class="c1"># can limit printed items with include/exclude args</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">pe</span><span class="o">.</span><span class="n">file_structure</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;**/utils.py&quot;</span><span class="p">,</span> <span class="s2">&quot;**/*.pkl&quot;</span><span class="p">],</span> <span class="n">exclude</span><span class="o">=</span><span class="s2">&quot;**/*.storages&quot;</span><span class="p">))</span>

<span class="n">importer</span> <span class="o">=</span> <span class="n">PackageImporter</span><span class="p">(</span><span class="s1">&#39;my_package.pt&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">importer</span><span class="o">.</span><span class="n">file_structure</span><span class="p">())</span> <span class="c1"># will print out all files</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># filtered with glob pattern:
#    include=[&quot;**/utils.py&quot;, &quot;**/*.pkl&quot;], exclude=&quot;**/*.storages&quot;
─── my_package.pt
    ├── models
    │   └── model_1.pkl
    └── torchvision
        └── models
            └── utils.py

# all files
─── my_package.pt
    ├── .data
    │   ├── 94304870911616.storage
    │   ├── 94304900784016.storage
    │   ├── extern_modules
    │   └── version
    ├── models
    │   └── model_1.pkl
    └── torchvision
        └── models
            ├── resnet.py
            └── utils.py
</pre></div>
</div>
<p>You can also query <code class="docutils literal notranslate"><span class="pre">Folder</span></code> objects with the <code class="docutils literal notranslate"><span class="pre">has_file()</span></code> method.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">exporter_file_structure</span> <span class="o">=</span> <span class="n">exporter</span><span class="o">.</span><span class="n">file_structure</span><span class="p">()</span>
<span class="n">found</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">exporter_file_structure</span><span class="o">.</span><span class="n">has_file</span><span class="p">(</span><span class="s2">&quot;package_a/subpackage.py&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="include-arbitrary-resources-with-my-package-and-access-them-later">
<h3><a class="toc-backref" href="#id5">Include arbitrary resources with my package and access them later?</a><a class="headerlink" href="#include-arbitrary-resources-with-my-package-and-access-them-later" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="#torch.package.PackageExporter" title="torch.package.PackageExporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageExporter</span></code></a> exposes three methods, <code class="docutils literal notranslate"><span class="pre">save_pickle</span></code>, <code class="docutils literal notranslate"><span class="pre">save_text</span></code> and <code class="docutils literal notranslate"><span class="pre">save_binary</span></code> that allow you to save
Python objects, text, and binary data to a package.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">PackageExporter</span><span class="p">(</span><span class="s2">&quot;package.pt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">exporter</span><span class="p">:</span>
    <span class="c1"># Pickles the object and saves to `my_resources/tens.pkl` in the archive.</span>
    <span class="n">exporter</span><span class="o">.</span><span class="n">save_pickle</span><span class="p">(</span><span class="s2">&quot;my_resources&quot;</span><span class="p">,</span> <span class="s2">&quot;tensor.pkl&quot;</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">exporter</span><span class="o">.</span><span class="n">save_text</span><span class="p">(</span><span class="s2">&quot;config_stuff&quot;</span><span class="p">,</span> <span class="s2">&quot;words.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;a sample string&quot;</span><span class="p">)</span>
    <span class="n">exporter</span><span class="o">.</span><span class="n">save_binary</span><span class="p">(</span><span class="s2">&quot;raw_data&quot;</span><span class="p">,</span> <span class="s2">&quot;binary&quot;</span><span class="p">,</span> <span class="n">my_bytes</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#torch.package.PackageImporter" title="torch.package.PackageImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageImporter</span></code></a> exposes complementary methods named <code class="docutils literal notranslate"><span class="pre">load_pickle</span></code>, <code class="docutils literal notranslate"><span class="pre">load_text</span></code> and <code class="docutils literal notranslate"><span class="pre">load_binary</span></code> that allow you to load
Python objects, text and binary data from a package.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">importer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">PackageImporter</span><span class="p">(</span><span class="s2">&quot;package.pt&quot;</span><span class="p">)</span>
<span class="n">my_tensor</span> <span class="o">=</span> <span class="n">importer</span><span class="o">.</span><span class="n">load_pickle</span><span class="p">(</span><span class="s2">&quot;my_resources&quot;</span><span class="p">,</span> <span class="s2">&quot;tensor.pkl&quot;</span><span class="p">)</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">importer</span><span class="o">.</span><span class="n">load_text</span><span class="p">(</span><span class="s2">&quot;config_stuff&quot;</span><span class="p">,</span> <span class="s2">&quot;words.txt&quot;</span><span class="p">)</span>
<span class="n">binary</span> <span class="o">=</span> <span class="n">importer</span><span class="o">.</span><span class="n">load_binary</span><span class="p">(</span><span class="s2">&quot;raw_data&quot;</span><span class="p">,</span> <span class="s2">&quot;binary&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="customize-how-a-class-is-packaged">
<h3><a class="toc-backref" href="#id6">Customize how a class is packaged?</a><a class="headerlink" href="#customize-how-a-class-is-packaged" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">torch.package</span></code> allows for the customization of how classes are packaged. This behavior is accessed through defining the method
<code class="docutils literal notranslate"><span class="pre">__reduce_package__</span></code> on a class and by defining a corresponding de-packaging function. This is similar to defining <code class="docutils literal notranslate"><span class="pre">__reduce__</span></code> for
Python’s normal pickling process.</p>
<p>Steps:</p>
<ol class="arabic simple">
<li><p>Define the method <code class="docutils literal notranslate"><span class="pre">__reduce_package__(self,</span> <span class="pre">exporter:</span> <span class="pre">PackageExporter)</span></code> on the target class. This method should do the work to save the class instance inside of the package, and should return a tuple of the corresponding de-packaging function with the arguments needed to invoke the de-packaging function. This method is called by the <code class="docutils literal notranslate"><span class="pre">PackageExporter</span></code> when it encounters an instance of the target class.</p></li>
<li><p>Define a de-packaging function for the class. This de-packaging function should do the work to reconstruct and return an instance of the class. The function signature’s first parameter should be a <code class="docutils literal notranslate"><span class="pre">PackageImporter</span></code> instance, and the rest of the parameters are user defined.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># foo.py [Example of customizing how class Foo is packaged]</span>
<span class="kn">from</span> <span class="nn">torch.package</span> <span class="kn">import</span> <span class="n">PackageExporter</span><span class="p">,</span> <span class="n">PackageImporter</span>
<span class="kn">import</span> <span class="nn">time</span>


<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">my_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">my_string</span> <span class="o">=</span> <span class="n">my_string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_imported</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_exported</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__reduce_package__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exporter</span><span class="p">:</span> <span class="n">PackageExporter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called by ``torch.package.PackageExporter``&#39;s Pickler&#39;s ``persistent_id`` when</span>
<span class="sd">        saving an instance of this object. This method should do the work to save this</span>
<span class="sd">        object inside of the ``torch.package`` archive.</span>

<span class="sd">        Returns function w/ arguments to load the object from a</span>
<span class="sd">        ``torch.package.PackageImporter``&#39;s Pickler&#39;s ``persistent_load`` function.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># use this pattern to ensure no naming conflicts with normal dependencies,</span>
        <span class="c1"># anything saved under this module name shouldn&#39;t conflict with other</span>
        <span class="c1"># items in the package</span>
        <span class="n">generated_module_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;foo-generated._</span><span class="si">{</span><span class="n">exporter</span><span class="o">.</span><span class="n">get_unique_id</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">exporter</span><span class="o">.</span><span class="n">save_text</span><span class="p">(</span>
            <span class="n">generated_module_name</span><span class="p">,</span>
            <span class="s2">&quot;foo.txt&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">my_string</span> <span class="o">+</span> <span class="s2">&quot;, with exporter modification!&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">time_exported</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock_gettime</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># returns de-packaging function w/ arguments to invoke with</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">unpackage_foo</span><span class="p">,</span> <span class="p">(</span><span class="n">generated_module_name</span><span class="p">,</span> <span class="n">time_exported</span><span class="p">,))</span>


<span class="k">def</span> <span class="nf">unpackage_foo</span><span class="p">(</span>
    <span class="n">importer</span><span class="p">:</span> <span class="n">PackageImporter</span><span class="p">,</span> <span class="n">generated_module_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">time_exported</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Foo</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Called by ``torch.package.PackageImporter``&#39;s Pickler&#39;s ``persistent_load`` function</span>
<span class="sd">    when depickling a Foo object.</span>
<span class="sd">    Performs work of loading and returning a Foo instance from a ``torch.package`` archive.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">time_imported</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock_gettime</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">foo</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="n">importer</span><span class="o">.</span><span class="n">load_text</span><span class="p">(</span><span class="n">generated_module_name</span><span class="p">,</span> <span class="s2">&quot;foo.txt&quot;</span><span class="p">))</span>
    <span class="n">foo</span><span class="o">.</span><span class="n">time_imported</span> <span class="o">=</span> <span class="n">time_imported</span>
    <span class="n">foo</span><span class="o">.</span><span class="n">time_exported</span> <span class="o">=</span> <span class="n">time_exported</span>
    <span class="k">return</span> <span class="n">foo</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># example of saving instances of class Foo</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.package</span> <span class="kn">import</span> <span class="n">PackageImporter</span><span class="p">,</span> <span class="n">PackageExporter</span>
<span class="kn">import</span> <span class="nn">foo</span>

<span class="n">foo_1</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">Foo</span><span class="p">(</span><span class="s2">&quot;foo_1 initial string&quot;</span><span class="p">)</span>
<span class="n">foo_2</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">Foo</span><span class="p">(</span><span class="s2">&quot;foo_2 initial string&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">PackageExporter</span><span class="p">(</span><span class="s1">&#39;foo_package.pt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pe</span><span class="p">:</span>
    <span class="c1"># save as normal, no extra work necessary</span>
    <span class="n">pe</span><span class="o">.</span><span class="n">save_pickle</span><span class="p">(</span><span class="s1">&#39;foo_collection&#39;</span><span class="p">,</span> <span class="s1">&#39;foo1.pkl&#39;</span><span class="p">,</span> <span class="n">foo_1</span><span class="p">)</span>
    <span class="n">pe</span><span class="o">.</span><span class="n">save_pickle</span><span class="p">(</span><span class="s1">&#39;foo_collection&#39;</span><span class="p">,</span> <span class="s1">&#39;foo2.pkl&#39;</span><span class="p">,</span> <span class="n">foo_2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">pe</span><span class="o">.</span><span class="n">file_structure</span><span class="p">())</span>

<span class="n">pi</span> <span class="o">=</span> <span class="n">PackageImporter</span><span class="p">(</span><span class="s1">&#39;foo_package.pt&#39;</span><span class="p">)</span>
<span class="n">imported_foo</span> <span class="o">=</span> <span class="n">pi</span><span class="o">.</span><span class="n">load_pickle</span><span class="p">(</span><span class="s1">&#39;foo_collection&#39;</span><span class="p">,</span> <span class="s1">&#39;foo1.pkl&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;foo_1 string: &#39;</span><span class="si">{</span><span class="n">imported_foo</span><span class="o">.</span><span class="n">my_string</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;foo_1 export time: </span><span class="si">{</span><span class="n">imported_foo</span><span class="o">.</span><span class="n">time_exported</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;foo_1 import time: </span><span class="si">{</span><span class="n">imported_foo</span><span class="o">.</span><span class="n">time_imported</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># output of running above script
─── foo_package
    ├── foo-generated
    │   ├── _0
    │   │   └── foo.txt
    │   └── _1
    │       └── foo.txt
    ├── foo_collection
    │   ├── foo1.pkl
    │   └── foo2.pkl
    └── foo.py

foo_1 string: &#39;foo_1 initial string, with reduction modification!&#39;
foo_1 export time: 9857706.650140837
foo_1 import time: 9857706.652698385
</pre></div>
</div>
</div>
<div class="section" id="test-in-my-source-code-whether-or-not-it-is-executing-inside-a-package">
<h3><a class="toc-backref" href="#id7">Test in my source code whether or not it is executing inside a package?</a><a class="headerlink" href="#test-in-my-source-code-whether-or-not-it-is-executing-inside-a-package" title="Permalink to this headline">¶</a></h3>
<p>A <a class="reference internal" href="#torch.package.PackageImporter" title="torch.package.PackageImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageImporter</span></code></a> will add the attribute <code class="docutils literal notranslate"><span class="pre">__torch_package__</span></code> to every module that it initializes. Your code can check for the
presence of this attribute to determine whether it is executing in a packaged context or not.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># In foo/bar.py:</span>

<span class="k">if</span> <span class="s2">&quot;__torch_package__&quot;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">():</span>  <span class="c1"># true if the code is being loaded from a package</span>
    <span class="k">def</span> <span class="nf">is_in_package</span><span class="p">():</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="n">UserException</span> <span class="o">=</span> <span class="ne">Exception</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">is_in_package</span><span class="p">():</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">UserException</span> <span class="o">=</span> <span class="n">UnpackageableException</span>
</pre></div>
</div>
<p>Now, the code will behave differently depending on whether it’s imported normally through your Python environment or imported from a
<code class="docutils literal notranslate"><span class="pre">torch.package</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">foo.bar</span> <span class="kn">import</span> <span class="n">is_in_package</span>

<span class="nb">print</span><span class="p">(</span><span class="n">is_in_package</span><span class="p">())</span>  <span class="c1"># False</span>

<span class="n">loaded_module</span> <span class="o">=</span> <span class="n">PackageImporter</span><span class="p">(</span><span class="n">my_pacakge</span><span class="p">)</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s2">&quot;foo.bar&quot;</span><span class="p">)</span>
<span class="n">loaded_module</span><span class="o">.</span><span class="n">is_in_package</span><span class="p">()</span>  <span class="c1"># True</span>
</pre></div>
</div>
<p><strong>Warning</strong>: in general, it’s bad practice to have code that behaves differently depending on whether it’s packaged or not. This can lead to
hard-to-debug issues that are sensitive to how you imported your code. If your package is intended to be heavily used, consider restructuring
your code so that it behaves the same way no matter how it was loaded.</p>
</div>
<div class="section" id="patch-code-into-a-package">
<h3><a class="toc-backref" href="#id8">Patch code into a package?</a><a class="headerlink" href="#patch-code-into-a-package" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="#torch.package.PackageExporter" title="torch.package.PackageExporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageExporter</span></code></a> offers a <code class="docutils literal notranslate"><span class="pre">save_source_string()</span></code> method that allows one to save arbitrary Python source code to a module of your choosing.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">PackageExporter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">as</span> <span class="n">exporter</span><span class="p">:</span>
    <span class="c1"># Save the my_module.foo available in your current Python environment.</span>
    <span class="n">exporter</span><span class="o">.</span><span class="n">save_module</span><span class="p">(</span><span class="s2">&quot;my_module.foo&quot;</span><span class="p">)</span>

    <span class="c1"># This saves the provided string to my_module/foo.py in the package archive.</span>
    <span class="c1"># It will override the my_module.foo that was previously saved.</span>
    <span class="n">exporter</span><span class="o">.</span><span class="n">save_source_string</span><span class="p">(</span><span class="s2">&quot;my_module.foo&quot;</span><span class="p">,</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        def my_function():</span>
<span class="sd">            print(&#39;hello world&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="p">))</span>

    <span class="c1"># If you want to treat my_module.bar as a package</span>
    <span class="c1"># (e.g. save to `my_module/bar/__init__.py` instead of `my_module/bar.py)</span>
    <span class="c1"># pass is_package=True,</span>
    <span class="n">exporter</span><span class="o">.</span><span class="n">save_source_string</span><span class="p">(</span><span class="s2">&quot;my_module.bar&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;def foo(): print(&#39;hello&#39;)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">is_package</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">importer</span> <span class="o">=</span> <span class="n">PackageImporter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">importer</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s2">&quot;my_module.foo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">my_function</span><span class="p">()</span>  <span class="c1"># prints &#39;hello world&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="access-package-contents-from-packaged-code">
<h3><a class="toc-backref" href="#id9">Access package contents from packaged code?</a><a class="headerlink" href="#access-package-contents-from-packaged-code" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="#torch.package.PackageImporter" title="torch.package.PackageImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageImporter</span></code></a> implements the
<a class="reference external" href="https://docs.python.org/3/library/importlib.html#module-importlib.resources">importlib.resources</a>
API for accessing resources from inside a package.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">PackageExporter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">as</span> <span class="n">exporter</span><span class="p">:</span>
    <span class="c1"># saves text to one/a.txt in the archive</span>
    <span class="n">exporter</span><span class="o">.</span><span class="n">save_text</span><span class="p">(</span><span class="s2">&quot;my_resource&quot;</span><span class="p">,</span> <span class="s2">&quot;a.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;hello world!&quot;</span><span class="p">)</span>
    <span class="c1"># saves the tensor to my_pickle/obj.pkl</span>
    <span class="n">exporter</span><span class="o">.</span><span class="n">save_pickle</span><span class="p">(</span><span class="s2">&quot;my_pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;obj.pkl&quot;</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="c1"># see below for module contents</span>
    <span class="n">exporter</span><span class="o">.</span><span class="n">save_module</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
    <span class="n">exporter</span><span class="o">.</span><span class="n">save_module</span><span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">importlib.resources</span></code> API allows access to resources from within packaged code.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># foo.py:</span>
<span class="kn">import</span> <span class="nn">importlib.resources</span>
<span class="kn">import</span> <span class="nn">my_resource</span>

<span class="c1"># returns &quot;hello world!&quot;</span>
<span class="k">def</span> <span class="nf">get_my_resource</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">importlib</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="n">my_resource</span><span class="p">,</span> <span class="s2">&quot;a.txt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">importlib.resources</span></code> is the recommended way to access package contents from within packaged code, since it complies
with the Python standard. However, it is also possible to access the parent <a class="reference internal" href="#torch.package.PackageImporter" title="torch.package.PackageImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageImporter</span></code></a> instance itself from within
packaged code.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># bar.py:</span>
<span class="kn">import</span> <span class="nn">torch_package_importer</span> <span class="c1"># this is the PackageImporter that imported this module.</span>

<span class="c1"># Prints &quot;hello world!&quot;, equivalient to importlib.resources.read_text</span>
<span class="k">def</span> <span class="nf">get_my_resource</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">torch_package_importer</span><span class="o">.</span><span class="n">load_text</span><span class="p">(</span><span class="s2">&quot;my_resource&quot;</span><span class="p">,</span> <span class="s2">&quot;a.txt&quot;</span><span class="p">)</span>

<span class="c1"># You also do things that the importlib.resources API does not support, like loading</span>
<span class="c1"># a pickled object from the package.</span>
<span class="k">def</span> <span class="nf">get_my_pickle</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">torch_package_importer</span><span class="o">.</span><span class="n">load_pickle</span><span class="p">(</span><span class="s2">&quot;my_pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;obj.pkl&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="distinguish-between-packaged-code-and-non-packaged-code">
<h3><a class="toc-backref" href="#id10">Distinguish between packaged code and non-packaged code?</a><a class="headerlink" href="#distinguish-between-packaged-code-and-non-packaged-code" title="Permalink to this headline">¶</a></h3>
<p>To tell if an object’s code is from a <code class="docutils literal notranslate"><span class="pre">torch.package</span></code>, use the <code class="docutils literal notranslate"><span class="pre">torch.package.is_from_package()</span></code> function.
Note: if an object is from a package but its definition is from a module marked <code class="docutils literal notranslate"><span class="pre">extern</span></code> or from <code class="docutils literal notranslate"><span class="pre">stdlib</span></code>,
this check will return <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">importer</span> <span class="o">=</span> <span class="n">PackageImporter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">mod</span> <span class="o">=</span> <span class="n">importer</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">importer</span><span class="o">.</span><span class="n">load_pickle</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;model.pkl&#39;</span><span class="p">)</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">importer</span><span class="o">.</span><span class="n">load_text</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;my_test.txt&#39;</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">is_from_package</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">is_from_package</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">is_from_package</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span> <span class="c1"># str is from stdlib, so this will return False</span>
</pre></div>
</div>
</div>
<div class="section" id="re-export-an-imported-object">
<h3><a class="toc-backref" href="#id11">Re-export an imported object?</a><a class="headerlink" href="#re-export-an-imported-object" title="Permalink to this headline">¶</a></h3>
<p>To re-export an object that was previously imported by a <a class="reference internal" href="#torch.package.PackageImporter" title="torch.package.PackageImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageImporter</span></code></a>, you must make the new <a class="reference internal" href="#torch.package.PackageExporter" title="torch.package.PackageExporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageExporter</span></code></a>
aware of the original <a class="reference internal" href="#torch.package.PackageImporter" title="torch.package.PackageImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageImporter</span></code></a> so that it can find source code for your object’s dependencies.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">importer</span> <span class="o">=</span> <span class="n">PackageImporter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">importer</span><span class="o">.</span><span class="n">load_pickle</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;model.pkl&quot;</span><span class="p">)</span>

<span class="c1"># re-export obj in a new package</span>
<span class="k">with</span> <span class="n">PackageExporter</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="n">importer</span><span class="o">=</span><span class="p">(</span><span class="n">importer</span><span class="p">,</span> <span class="n">sys_importer</span><span class="p">))</span> <span class="k">as</span> <span class="n">exporter</span><span class="p">:</span>
    <span class="n">exporter</span><span class="o">.</span><span class="n">save_pickle</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;model.pkl&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="package-a-torchscript-module">
<h3><a class="toc-backref" href="#id12">Package a TorchScript module?</a><a class="headerlink" href="#package-a-torchscript-module" title="Permalink to this headline">¶</a></h3>
<p>To package a TorchScript model, use the same <code class="docutils literal notranslate"><span class="pre">save_pickle</span></code> and <code class="docutils literal notranslate"><span class="pre">load_pickle</span></code> APIs as you would with any other object.
Saving TorchScript objects that are attributes or submodules is supported as well with no extra work.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># save TorchScript just like any other object</span>
<span class="k">with</span> <span class="n">PackageExporter</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">e</span><span class="o">.</span><span class="n">save_pickle</span><span class="p">(</span><span class="s2">&quot;res&quot;</span><span class="p">,</span> <span class="s2">&quot;script_model.pkl&quot;</span><span class="p">,</span> <span class="n">scripted_model</span><span class="p">)</span>
    <span class="n">e</span><span class="o">.</span><span class="n">save_pickle</span><span class="p">(</span><span class="s2">&quot;res&quot;</span><span class="p">,</span> <span class="s2">&quot;mixed_model.pkl&quot;</span><span class="p">,</span> <span class="n">python_model_with_scripted_submodule</span><span class="p">)</span>
<span class="c1"># load as normal</span>
<span class="n">importer</span> <span class="o">=</span> <span class="n">PackageImporter</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<span class="n">loaded_script</span> <span class="o">=</span> <span class="n">importer</span><span class="o">.</span><span class="n">load_pickle</span><span class="p">(</span><span class="s2">&quot;res&quot;</span><span class="p">,</span> <span class="s2">&quot;script_model.pkl&quot;</span><span class="p">)</span>
<span class="n">loaded_mixed</span> <span class="o">=</span> <span class="n">importer</span><span class="o">.</span><span class="n">load_pickle</span><span class="p">(</span><span class="s2">&quot;res&quot;</span><span class="p">,</span> <span class="s2">&quot;mixed_model.pkl&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="explanation">
<h2><a class="toc-backref" href="#id13">Explanation</a><a class="headerlink" href="#explanation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="torch-package-format-overview">
<h3><a class="toc-backref" href="#id14"><code class="docutils literal notranslate"><span class="pre">torch.package</span></code> Format Overview</a><a class="headerlink" href="#torch-package-format-overview" title="Permalink to this headline">¶</a></h3>
<p>A <code class="docutils literal notranslate"><span class="pre">torch.package</span></code> file is a ZIP archive which conventionally uses the <code class="docutils literal notranslate"><span class="pre">.pt</span></code> extension. Inside the ZIP archive, there are two kinds of files:</p>
<ul class="simple">
<li><p>Framework files, which are placed in the <code class="docutils literal notranslate"><span class="pre">.data/</span></code>.</p></li>
<li><p>User files, which is everything else.</p></li>
</ul>
<p>As an example, this is what a fully packaged ResNet model from <code class="docutils literal notranslate"><span class="pre">torchvision</span></code> looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>resnet
├── .data  # All framework-specific data is stored here.
│   │      # It&#39;s named to avoid conflicts with user-serialized code.
│   ├── 94286146172688.storage  # tensor data
│   ├── 94286146172784.storage
│   ├── extern_modules  # text file with names of extern modules (e.g. &#39;torch&#39;)
│   ├── version         # version metadata
│   ├── ...
├── model  # the pickled model
│   └── model.pkl
└── torchvision  # all code dependencies are captured as source files
    └── models
        ├── resnet.py
        └── utils.py
</pre></div>
</div>
<div class="section" id="framework-files">
<h4>Framework files<a class="headerlink" href="#framework-files" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">.data/</span></code> directory is owned by torch.package, and its contents are considered to be a private implementation detail.
The <code class="docutils literal notranslate"><span class="pre">torch.package</span></code> format makes no guarantees about the contents of <code class="docutils literal notranslate"><span class="pre">.data/</span></code>, but any changes made will be backward compatible
(that is, newer version of PyTorch will always be able to load older <code class="docutils literal notranslate"><span class="pre">torch.packages</span></code>).</p>
<p>Currently, the <code class="docutils literal notranslate"><span class="pre">.data/</span></code> directory contains the following items:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">version</span></code>: a version number for the serialized format, so that the <code class="docutils literal notranslate"><span class="pre">torch.package</span></code> import infrastructures knows how to load this package.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">extern_modules</span></code>: a list of modules that are considered <code class="docutils literal notranslate"><span class="pre">extern:class:`PackageImporter`.</span> <span class="pre">``extern</span></code> modules will be imported using the loading environment’s system importer.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*.storage</span></code>: serialized tensor data.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.data
├── 94286146172688.storage
├── 94286146172784.storage
├── extern_modules
├── version
├── ...
</pre></div>
</div>
</div>
<div class="section" id="user-files">
<h4>User files<a class="headerlink" href="#user-files" title="Permalink to this headline">¶</a></h4>
<p>All other files in the archive were put there by a user. The layout is identical to a Python
<a class="reference external" href="https://docs.python.org/3/reference/import.html#regular-packages">regular package</a>. For a deeper dive in how Python packaging works,
please consult <a class="reference external" href="https://www.python.org/doc/essays/packages/">this essay</a> (it’s slightly out of date, so double-check implementation details
with the <a class="reference external" href="https://docs.python.org/3/library/importlib.html">Python reference documentation</a>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;package root&gt;
├── model  # the pickled model
│   └── model.pkl
├── another_package
│   ├── __init__.py
│   ├── foo.txt         # a resource file , see importlib.resources
│   └── ...
└── torchvision
    └── models
        ├── resnet.py   # torchvision.models.resnet
        └── utils.py    # torchvision.models.utils
</pre></div>
</div>
</div>
</div>
<div class="section" id="how-torch-package-finds-your-code-s-dependencies">
<h3><a class="toc-backref" href="#id15">How <code class="docutils literal notranslate"><span class="pre">torch.package</span></code> finds your code’s dependencies</a><a class="headerlink" href="#how-torch-package-finds-your-code-s-dependencies" title="Permalink to this headline">¶</a></h3>
<div class="section" id="analyzing-an-object-s-dependencies">
<h4>Analyzing an object’s dependencies<a class="headerlink" href="#analyzing-an-object-s-dependencies" title="Permalink to this headline">¶</a></h4>
<p>When you issue a <code class="docutils literal notranslate"><span class="pre">save_pickle(obj,</span> <span class="pre">...)</span></code> call, <a class="reference internal" href="#torch.package.PackageExporter" title="torch.package.PackageExporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageExporter</span></code></a> will pickle the object normally. Then, it uses the
<code class="docutils literal notranslate"><span class="pre">pickletools</span></code> standard library module to parse the pickle bytecode.</p>
<p>In a pickle, an object is saved along with a <code class="docutils literal notranslate"><span class="pre">GLOBAL</span></code> opcode that describes where to find the implementation of the object’s type, like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GLOBAL</span> <span class="s1">&#39;torchvision.models.resnet Resnet`</span>
</pre></div>
</div>
<p>The dependency resolver will gather up all <code class="docutils literal notranslate"><span class="pre">GLOBAL</span></code> ops and mark them as dependencies of your pickled object.
For more information about pickling and the pickle format, please consult <a class="reference external" href="https://docs.python.org/3/library/pickle.html">the Python docs</a>.</p>
</div>
<div class="section" id="analyzing-a-module-s-dependencies">
<h4>Analyzing a module’s dependencies<a class="headerlink" href="#analyzing-a-module-s-dependencies" title="Permalink to this headline">¶</a></h4>
<p>When a Python module is identified as a dependency, <code class="docutils literal notranslate"><span class="pre">torch.package</span></code> walks the module’s python AST representation and looks for import statements with
full support for the standard forms: <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">x</span> <span class="pre">import</span> <span class="pre">y</span></code>, <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">z</span></code>, <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">w</span> <span class="pre">import</span> <span class="pre">v</span> <span class="pre">as</span> <span class="pre">u</span></code>, etc. When one of these import statements are
encountered, <code class="docutils literal notranslate"><span class="pre">torch.package</span></code> registers the imported modules as dependencies that are then themselves parsed in the same AST walking way.</p>
<p><strong>Note</strong>: AST parsing has limited support for the <code class="docutils literal notranslate"><span class="pre">__import__(...)</span></code> syntax and does not support <code class="docutils literal notranslate"><span class="pre">importlib.import_module</span></code> calls. In general, you should
not expect dynamic imports to be detected by <code class="docutils literal notranslate"><span class="pre">torch.package</span></code>.</p>
</div>
</div>
<div class="section" id="dependency-management">
<h3><a class="toc-backref" href="#id16">Dependency Management</a><a class="headerlink" href="#dependency-management" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">torch.package</span></code> automatically finds the Python modules that your code and objects depend on. This process is called dependency resolution.
For each module that the dependency resolver finds, you must specify an <em>action</em> to take.</p>
<p>The allowed actions are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">intern</span></code>: put this module into the package.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">extern</span></code>: declare this module as an external dependency of the package.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mock</span></code>: stub out this module.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">deny</span></code>: depending on this module will raise an error during package export.</p></li>
</ul>
<p>Finally, there is one more important action that is not technically part of <code class="docutils literal notranslate"><span class="pre">torch.package</span></code>:</p>
<ul class="simple">
<li><p>Refactoring: remove or change the dependencies in your code.</p></li>
</ul>
<p>Note that actions are only defined on entire Python modules. There is no way to package “just” a function or class from module and leave the rest out.
This is by design. Python does not offer clean boundaries between objects defined in a module. The only defined unit of dependency organization is a
module, so that’s what <code class="docutils literal notranslate"><span class="pre">torch.package</span></code> uses.</p>
<p>Actions are applied to modules using patterns. Patterns can either be module names (<code class="docutils literal notranslate"><span class="pre">&quot;foo.bar&quot;</span></code>) or globs (like <code class="docutils literal notranslate"><span class="pre">&quot;foo.**&quot;</span></code>). You associate a pattern
with an action using methods on <a class="reference internal" href="#torch.package.PackageImporter" title="torch.package.PackageImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageImporter</span></code></a>, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_exporter</span><span class="o">.</span><span class="n">intern</span><span class="p">(</span><span class="s2">&quot;torchvision.**&quot;</span><span class="p">)</span>
<span class="n">my_exporter</span><span class="o">.</span><span class="n">extern</span><span class="p">(</span><span class="s2">&quot;numpy&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If a module matches a pattern, the corresponding action is applied to it. For a given module, patterns will be checked in the order that they were defined,
and the first action will be taken.</p>
<div class="section" id="intern">
<h4><code class="docutils literal notranslate"><span class="pre">intern</span></code><a class="headerlink" href="#intern" title="Permalink to this headline">¶</a></h4>
<p>If a module is <code class="docutils literal notranslate"><span class="pre">intern</span></code>-ed, it will be placed into the package.</p>
<p>This action is your model code, or any related code you want to package. For example, if you are trying to package a ResNet from <code class="docutils literal notranslate"><span class="pre">torchvision</span></code>,
you will need to <code class="docutils literal notranslate"><span class="pre">intern</span></code> the module torchvision.models.resnet.</p>
<p>On package import, when your packaged code tries to import an <code class="docutils literal notranslate"><span class="pre">intern</span></code>-ed module, PackageImporter will look inside your package for that module.
If it can’t find that module, an error will be raised. This ensures that each <a class="reference internal" href="#torch.package.PackageImporter" title="torch.package.PackageImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageImporter</span></code></a> is isolated from the loading environment—even
if you have <code class="docutils literal notranslate"><span class="pre">my_interned_module</span></code> available in both your package and the loading environment, <a class="reference internal" href="#torch.package.PackageImporter" title="torch.package.PackageImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageImporter</span></code></a> will only use the version in your
package.</p>
<p><strong>Note</strong>: Only Python source modules can be <code class="docutils literal notranslate"><span class="pre">intern</span></code>-ed. Other kinds of modules, like C extension modules and bytecode modules, will raise an error if
you attempt to <code class="docutils literal notranslate"><span class="pre">intern</span></code> them. These kinds of modules need to be <code class="docutils literal notranslate"><span class="pre">mock</span></code>-ed or <code class="docutils literal notranslate"><span class="pre">extern</span></code>-ed.</p>
</div>
<div class="section" id="extern">
<h4><code class="docutils literal notranslate"><span class="pre">extern</span></code><a class="headerlink" href="#extern" title="Permalink to this headline">¶</a></h4>
<p>If a module is <code class="docutils literal notranslate"><span class="pre">extern</span></code>-ed, it will not be packaged. Instead, it will be added to a list of external dependencies for this package. You can find this
list on <code class="docutils literal notranslate"><span class="pre">package_exporter.extern_modules</span></code>.</p>
<p>On package import, when time packaged code tries to import an <code class="docutils literal notranslate"><span class="pre">extern</span></code>-ed module, <a class="reference internal" href="#torch.package.PackageImporter" title="torch.package.PackageImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageImporter</span></code></a> will use the default Python importer to find
that module, as if you did <code class="docutils literal notranslate"><span class="pre">importlib.import_module(&quot;my_externed_module&quot;)</span></code>. If it can’t find that module, an error will be raised.</p>
<p>In this way, you can depend on third-party libraries like <code class="docutils literal notranslate"><span class="pre">numpy</span></code> and <code class="docutils literal notranslate"><span class="pre">scipy</span></code> from within your package without having to package them too.</p>
<p><strong>Warning</strong>: If any external library changes in a backwards-incompatible way, your package may fail to load. If you need long-term reproducibility
for your package, try to limit your use of <code class="docutils literal notranslate"><span class="pre">extern</span></code>.</p>
</div>
<div class="section" id="mock">
<h4><code class="docutils literal notranslate"><span class="pre">mock</span></code><a class="headerlink" href="#mock" title="Permalink to this headline">¶</a></h4>
<p>If a module is <code class="docutils literal notranslate"><span class="pre">mock</span></code>-ed, it will not be packaged. Instead a stub module will be packaged in its place. The stub module will allow you to retrieve
objects from it (so that <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">my_mocked_module</span> <span class="pre">import</span> <span class="pre">foo</span></code> will not error), but any use of that object will raise a <code class="docutils literal notranslate"><span class="pre">NotImplementedError</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">mock</span></code> should be used for code that you “know” will not be needed in the loaded package, but you still want to available for use in non-packaged contents.
For example, initialization/configuration code, or code only used for debugging/training.</p>
<p><strong>Warning</strong>: In general, <code class="docutils literal notranslate"><span class="pre">mock</span></code> should be used as a last resort. It introduces behavioral differences between packaged code and non-packaged code,
which may lead to later confusion. Prefer instead to refactor your code to remove unwanted dependencies.</p>
</div>
<div class="section" id="refactoring">
<h4>Refactoring<a class="headerlink" href="#refactoring" title="Permalink to this headline">¶</a></h4>
<p>The best way to manage dependencies is to not have dependencies at all! Often, code can be refactored to remove unnecessary dependencies. Here are some
guidelines for writing code with clean dependencies (which are also generally good practices!):</p>
<p><strong>Include only what you use</strong>. Do not leave unused imports in our code. The dependency resolver is not smart enough to tell that they are indeed unused,
and will try to process them.</p>
<p><strong>Qualify your imports</strong>. For example, instead of writing import foo and later using <code class="docutils literal notranslate"><span class="pre">foo.bar.baz</span></code>, prefer to write <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">foo.bar</span> <span class="pre">import</span> <span class="pre">baz</span></code>. This more
precisely specifies your real dependency (<code class="docutils literal notranslate"><span class="pre">foo.bar</span></code>) and lets the dependency resolver know you don’t need all of <code class="docutils literal notranslate"><span class="pre">foo</span></code>.</p>
<p><strong>Split up large files with unrelated functionality into smaller ones</strong>. If your <code class="docutils literal notranslate"><span class="pre">utils</span></code> module contains a hodge-podge of unrelated functionality, any module
that depends on <code class="docutils literal notranslate"><span class="pre">utils</span></code> will need to pull in lots of unrelated dependencies, even if you only needed a small part of it. Prefer instead to define
single-purpose modules that can be packaged independently of one another.</p>
</div>
<div class="section" id="patterns">
<h4>Patterns<a class="headerlink" href="#patterns" title="Permalink to this headline">¶</a></h4>
<p>Patterns allow you to specify groups of modules with a convenient syntax. The syntax and behavior of patterns follows the Bazel/Buck
<a class="reference external" href="https://docs.bazel.build/versions/master/be/functions.html#glob">glob()</a>.</p>
<p>A module that we are trying to match against a pattern is called a candidate. A candidate is composed of a list of segments separated by a
separator string, e.g. <code class="docutils literal notranslate"><span class="pre">foo.bar.baz</span></code>.</p>
<p>A pattern contains one or more segments. Segments can be:</p>
<ul class="simple">
<li><p>A literal string (e.g. <code class="docutils literal notranslate"><span class="pre">foo</span></code>), which matches exactly.</p></li>
<li><p>A string containing a wildcard (e.g. <code class="docutils literal notranslate"><span class="pre">torch</span></code>, or <code class="docutils literal notranslate"><span class="pre">foo*baz*</span></code>). The wildcard matches any string, including the empty string.</p></li>
<li><p>A double wildcard (<code class="docutils literal notranslate"><span class="pre">**</span></code>). This matches against zero or more complete segments.</p></li>
</ul>
<p>Examples:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">torch.**</span></code>: matches <code class="docutils literal notranslate"><span class="pre">torch</span></code> and all its submodules, e.g. <code class="docutils literal notranslate"><span class="pre">torch.nn</span></code> and <code class="docutils literal notranslate"><span class="pre">torch.nn.functional</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">torch.*</span></code>: matches <code class="docutils literal notranslate"><span class="pre">torch.nn</span></code> or <code class="docutils literal notranslate"><span class="pre">torch.functional</span></code>, but not <code class="docutils literal notranslate"><span class="pre">torch.nn.functional</span></code> or <code class="docutils literal notranslate"><span class="pre">torch</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">torch*.**</span></code>: matches <code class="docutils literal notranslate"><span class="pre">torch</span></code>, <code class="docutils literal notranslate"><span class="pre">torchvision</span></code>, and all of their submodules</p></li>
</ul>
<p>When specifying actions, you can pass multiple patterns, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">exporter</span><span class="o">.</span><span class="n">intern</span><span class="p">([</span><span class="s2">&quot;torchvision.models.**&quot;</span><span class="p">,</span> <span class="s2">&quot;torchvision.utils.**&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>A module will match against this action if it matches any of the patterns.</p>
<p>You can also specify patterns to exlcude, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">exporter</span><span class="o">.</span><span class="n">mock</span><span class="p">(</span><span class="s2">&quot;**&quot;</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;torchvision.**&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>A module will not match against this action if it matches any of the exclude patterns. In this example, we are mocking all modules except
<code class="docutils literal notranslate"><span class="pre">torchvision</span></code> and its submodules.</p>
<p>When a module could potentially match against multiple actions, the first action defined will be taken.</p>
</div>
</div>
<div class="section" id="torch-package-sharp-edges">
<h3><a class="toc-backref" href="#id17"><code class="docutils literal notranslate"><span class="pre">torch.package</span></code> sharp edges</a><a class="headerlink" href="#torch-package-sharp-edges" title="Permalink to this headline">¶</a></h3>
<div class="section" id="avoid-global-state-in-your-modules">
<h4>Avoid global state in your modules<a class="headerlink" href="#avoid-global-state-in-your-modules" title="Permalink to this headline">¶</a></h4>
<p>Python makes it really easy to bind objects and run code at module-level scope. This is generally fine—after all, functions and classes are bound to
names this way. However, things become more complicated when you define an object at module scope with the intention of mutating it, introducing mutable
global state.</p>
<p>Mutable global state is quite useful—it can reduce boilerplate, allow for open registration into tables, etc. But unless employed very carefully, it can
cause complications when used with <code class="docutils literal notranslate"><span class="pre">torch.package</span></code>.</p>
<p>Every <a class="reference internal" href="#torch.package.PackageImporter" title="torch.package.PackageImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageImporter</span></code></a> creates an independent environment for its contents. This is nice because it means we load multiple packages and ensure
they are isolated from each other, but when modules are written in a way that assumes shared mutable global state, this behavior can create hard-to-debug
errors.</p>
</div>
<div class="section" id="types-are-not-shared-between-packages-and-the-loading-environment">
<h4>Types are not shared between packages and the loading environment<a class="headerlink" href="#types-are-not-shared-between-packages-and-the-loading-environment" title="Permalink to this headline">¶</a></h4>
<p>Any class that you import from a <a class="reference internal" href="#torch.package.PackageImporter" title="torch.package.PackageImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageImporter</span></code></a> will be a version of the class specific to that importer. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">foo</span> <span class="kn">import</span> <span class="n">MyClass</span>

<span class="n">my_class_instance</span> <span class="o">=</span> <span class="n">MyClass</span><span class="p">()</span>

<span class="k">with</span> <span class="n">PackageExporter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">as</span> <span class="n">exporter</span><span class="p">:</span>
    <span class="n">exporter</span><span class="o">.</span><span class="n">save_module</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>

<span class="n">importer</span> <span class="o">=</span> <span class="n">PackageImporter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">imported_MyClass</span> <span class="o">=</span> <span class="n">importer</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">MyClass</span>

<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">my_class_instance</span><span class="p">,</span> <span class="n">MyClass</span><span class="p">)</span>  <span class="c1"># works</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">my_class_instance</span><span class="p">,</span> <span class="n">imported_MyClass</span><span class="p">)</span>  <span class="c1"># ERROR!</span>
</pre></div>
</div>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">MyClass</span></code> and <code class="docutils literal notranslate"><span class="pre">import_MyClass</span></code> are <em>not the same type</em>. In this specific example, <code class="docutils literal notranslate"><span class="pre">MyClass</span></code> and <code class="docutils literal notranslate"><span class="pre">import_MyClass</span></code> have exactly the
same implementation, so you might thing it’s okay to consider them the same class. But consider the situation where <code class="docutils literal notranslate"><span class="pre">import_MyClass</span></code> is coming from an
older package with an entirely different implementation of <code class="docutils literal notranslate"><span class="pre">MyClass</span></code> — in that case, it’s unsafe to consider them the same class.</p>
<p>Under the hood, each importer has a prefix that allows it to uniquely identify classes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">MyClass</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>  <span class="c1"># prints &quot;foo.MyClass&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">imported_MyClass</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>  <span class="c1"># prints &lt;torch_package_0&gt;.foo.MyClass</span>
</pre></div>
</div>
<p>That means you should not expect <code class="docutils literal notranslate"><span class="pre">isinstance</span></code> checks to work when one of the arguments if from a package and the other is not. If you need this
functionality, consider the following options:</p>
<ul class="simple">
<li><p>Doing duck typing (just using the class instead of explicitly checking that it is of a given type).</p></li>
<li><p>Make the typing relationship an explicit part of the class contract. For example, you can add an attribute tag <code class="docutils literal notranslate"><span class="pre">self.handler</span> <span class="pre">=</span> <span class="pre">&quot;handle_me_this_way&quot;</span></code> and have client code check for the value of <code class="docutils literal notranslate"><span class="pre">handler</span></code> instead of checking the type directly.</p></li>
</ul>
</div>
</div>
<div class="section" id="how-torch-package-keeps-packages-isolated-from-each-other">
<h3><a class="toc-backref" href="#id18">How <code class="docutils literal notranslate"><span class="pre">torch.package</span></code> keeps packages isolated from each other</a><a class="headerlink" href="#how-torch-package-keeps-packages-isolated-from-each-other" title="Permalink to this headline">¶</a></h3>
<p>Each <a class="reference internal" href="#torch.package.PackageImporter" title="torch.package.PackageImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageImporter</span></code></a> instance creates an independent, isolated environment for its modules and objects. Modules in a package can only import
other packaged modules, or modules marked <code class="docutils literal notranslate"><span class="pre">extern</span></code>. If you use multiple <a class="reference internal" href="#torch.package.PackageImporter" title="torch.package.PackageImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageImporter</span></code></a> instances to load a single package, you will get
multiple independent environments that do not interact.</p>
<p>This is achieved by extending Python’s import infrastructure with a custom importer. <a class="reference internal" href="#torch.package.PackageImporter" title="torch.package.PackageImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageImporter</span></code></a> provides the same core API as the
<code class="docutils literal notranslate"><span class="pre">importlib</span></code> importer; namely, it implements the <code class="docutils literal notranslate"><span class="pre">import_module</span></code> and <code class="docutils literal notranslate"><span class="pre">__import__</span></code> methods.</p>
<p>When you invoke <a class="reference internal" href="#torch.package.PackageImporter.import_module" title="torch.package.PackageImporter.import_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PackageImporter.import_module()</span></code></a>, <a class="reference internal" href="#torch.package.PackageImporter" title="torch.package.PackageImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageImporter</span></code></a> will construct and return a new module, much as the system importer does.
However, <a class="reference internal" href="#torch.package.PackageImporter" title="torch.package.PackageImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageImporter</span></code></a> patches the returned module to use <code class="docutils literal notranslate"><span class="pre">self</span></code> (i.e. that <a class="reference internal" href="#torch.package.PackageImporter" title="torch.package.PackageImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageImporter</span></code></a> instance) to fulfill future import
requests by looking in the package rather than searching the user’s Python environment.</p>
<div class="section" id="mangling">
<h4>Mangling<a class="headerlink" href="#mangling" title="Permalink to this headline">¶</a></h4>
<p>To avoid confusion (“is this <code class="docutils literal notranslate"><span class="pre">foo.bar</span></code> object the one from my package, or the one from my Python environment?”), <a class="reference internal" href="#torch.package.PackageImporter" title="torch.package.PackageImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageImporter</span></code></a> mangles the
<code class="docutils literal notranslate"><span class="pre">__name__</span></code> and <code class="docutils literal notranslate"><span class="pre">__file__</span></code> of all imported modules, by adding a <em>mangle prefix</em> to them.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">__name__</span></code>, a name like <code class="docutils literal notranslate"><span class="pre">torchvision.models.resnet18</span></code> becomes <code class="docutils literal notranslate"><span class="pre">&lt;torch_package_0&gt;.torchvision.models.resnet18</span></code>.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">__file__</span></code>, a name like <code class="docutils literal notranslate"><span class="pre">torchvision/models/resnet18.py</span></code> becomes <code class="docutils literal notranslate"><span class="pre">&lt;torch_package_0&gt;.torchvision/modules/resnet18.py</span></code>.</p>
<p>Name mangling helps avoid inadvertent punning of module names between different packages, and helps you debug by making stack traces and print
statements more clearly show whether they are referring to packaged code or not. For developer-facing details about mangling, consult
<code class="docutils literal notranslate"><span class="pre">mangling.md</span></code> in <code class="docutils literal notranslate"><span class="pre">torch/package/</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="api-reference">
<h2><a class="toc-backref" href="#id19">API Reference</a><a class="headerlink" href="#api-reference" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="torch.package.PackagingError">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">torch.package.</span></code><code class="sig-name descname"><span class="pre">PackagingError</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dependency_graph</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackagingError"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackagingError" title="Permalink to this definition">¶</a></dt>
<dd><p>This exception is raised when there is an issue with exporting a package.
<code class="docutils literal notranslate"><span class="pre">PackageExporter</span></code> will attempt to gather up all the errors and present
them to you at once.</p>
</dd></dl>

<dl class="py class">
<dt id="torch.package.EmptyMatchError">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">torch.package.</span></code><code class="sig-name descname"><span class="pre">EmptyMatchError</span></code><a class="reference internal" href="_modules/torch/package/package_exporter.html#EmptyMatchError"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.EmptyMatchError" title="Permalink to this definition">¶</a></dt>
<dd><p>This is an exception that is thrown when a mock or extern is marked as
<code class="docutils literal notranslate"><span class="pre">allow_empty=False</span></code>, and is not matched with any module during packaging.</p>
</dd></dl>

<dl class="py class">
<dt id="torch.package.PackageExporter">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">torch.package.</span></code><code class="sig-name descname"><span class="pre">PackageExporter</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="pre">f</span></em>, <em class="sig-param"><span class="pre">importer=&lt;torch.package.importer._SysImporter</span> <span class="pre">object&gt;</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter" title="Permalink to this definition">¶</a></dt>
<dd><p>Exporters allow you to write packages of code, pickled Python data, and
arbitrary binary and text resources into a self-contained package.</p>
<p>Imports can load this code in a hermetic way, such that code is loaded
from the package rather than the normal Python import system. This allows
for the packaging of PyTorch model code and data so that it can be run
on a server or used in the future for transfer learning.</p>
<p>The code contained in packages is copied file-by-file from the original
source when it is created, and the file format is a specially organized
zip file. Future users of the package can unzip the package, and edit the code
in order to perform custom modifications to it.</p>
<p>The importer for packages ensures that code in the module can only be loaded from
within the package, except for modules explicitly listed as external using <a class="reference internal" href="#torch.package.PackageExporter.extern" title="torch.package.PackageExporter.extern"><code class="xref py py-meth docutils literal notranslate"><span class="pre">extern()</span></code></a>.
The file <code class="docutils literal notranslate"><span class="pre">extern_modules</span></code> in the zip archive lists all the modules that a package externally depends on.
This prevents “implicit” dependencies where the package runs locally because it is importing
a locally-installed package, but then fails when the package is copied to another machine.</p>
<p>When source code is added to the package, the exporter can optionally scan it
for further code dependencies (<code class="docutils literal notranslate"><span class="pre">dependencies=True</span></code>). It looks for import statements,
resolves relative references to qualified module names, and performs an action specified by the user
(See: <a class="reference internal" href="#torch.package.PackageExporter.extern" title="torch.package.PackageExporter.extern"><code class="xref py py-meth docutils literal notranslate"><span class="pre">extern()</span></code></a>, <a class="reference internal" href="#torch.package.PackageExporter.mock" title="torch.package.PackageExporter.mock"><code class="xref py py-meth docutils literal notranslate"><span class="pre">mock()</span></code></a>, and <a class="reference internal" href="#torch.package.PackageExporter.intern" title="torch.package.PackageExporter.intern"><code class="xref py py-meth docutils literal notranslate"><span class="pre">intern()</span></code></a>).</p>
<dl class="py method">
<dt id="torch.package.PackageExporter.__init__">
<code class="sig-name descname"><span class="pre">__init__</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="pre">f</span></em>, <em class="sig-param"><span class="pre">importer=&lt;torch.package.importer._SysImporter</span> <span class="pre">object&gt;</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an exporter.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>f</strong> – The location to export to. Can be a  <code class="docutils literal notranslate"><span class="pre">string</span></code>/<code class="docutils literal notranslate"><span class="pre">Path</span></code> object containing a filename
or a binary I/O object.</p></li>
<li><p><strong>importer</strong> – If a single Importer is passed, use that to search for modules.
If a sequence of importers are passsed, an <code class="docutils literal notranslate"><span class="pre">OrderedImporter</span></code> will be constructed out of them.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageExporter.add_dependency">
<code class="sig-name descname"><span class="pre">add_dependency</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">module_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dependencies</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter.add_dependency"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter.add_dependency" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a module, add it to the dependency graph according to patterns
specified by the user.</p>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageExporter.close">
<code class="sig-name descname"><span class="pre">close</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter.close"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Write the package to the filesystem. Any calls after <a class="reference internal" href="#torch.package.PackageExporter.close" title="torch.package.PackageExporter.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">close()</span></code></a> are now invalid.
It is preferable to use resource guard syntax instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">PackageExporter</span><span class="p">(</span><span class="s2">&quot;file.zip&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageExporter.denied_modules">
<code class="sig-name descname"><span class="pre">denied_modules</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter.denied_modules"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter.denied_modules" title="Permalink to this definition">¶</a></dt>
<dd><p>Return all modules that are currently denied.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A list containing the names of modules which will be
denied in this package.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageExporter.deny">
<code class="sig-name descname"><span class="pre">deny</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">include</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter.deny"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter.deny" title="Permalink to this definition">¶</a></dt>
<dd><p>Blocklist modules who names match the given glob patterns from the list of modules the package can import.
If a dependency on any matching packages is found, a <a class="reference internal" href="#torch.package.PackagingError" title="torch.package.PackagingError"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackagingError</span></code></a> is raised.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>include</strong> (<em>Union</em><em>[</em><em>List</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em>) – A string e.g. <code class="docutils literal notranslate"><span class="pre">&quot;my_package.my_subpackage&quot;</span></code>, or list of strings
for the names of the modules to be externed. This can also be a glob-style pattern, as described in <a class="reference internal" href="#torch.package.PackageExporter.mock" title="torch.package.PackageExporter.mock"><code class="xref py py-meth docutils literal notranslate"><span class="pre">mock()</span></code></a>.</p></li>
<li><p><strong>exclude</strong> (<em>Union</em><em>[</em><em>List</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em>) – An optional pattern that excludes some patterns that match the include string.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageExporter.dependency_graph_string">
<code class="sig-name descname"><span class="pre">dependency_graph_string</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter.dependency_graph_string"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter.dependency_graph_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns digraph string representation of dependencies in package.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A string representation of dependencies in package.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageExporter.extern">
<code class="sig-name descname"><span class="pre">extern</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">include</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allow_empty</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter.extern"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter.extern" title="Permalink to this definition">¶</a></dt>
<dd><p>Include <code class="docutils literal notranslate"><span class="pre">module</span></code> in the list of external modules the package can import.
This will prevent dependency discovery from saving
it in the package. The importer will load an external module directly from the standard import system.
Code for extern modules must also exist in the process loading the package.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>include</strong> (<em>Union</em><em>[</em><em>List</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em>) – A string e.g. <code class="docutils literal notranslate"><span class="pre">&quot;my_package.my_subpackage&quot;</span></code>, or list of strings
for the names of the modules to be externed. This can also be a glob-style pattern, as
described in <a class="reference internal" href="#torch.package.PackageExporter.mock" title="torch.package.PackageExporter.mock"><code class="xref py py-meth docutils literal notranslate"><span class="pre">mock()</span></code></a>.</p></li>
<li><p><strong>exclude</strong> (<em>Union</em><em>[</em><em>List</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em>) – An optional pattern that excludes some patterns that match the
include string.</p></li>
<li><p><strong>allow_empty</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – An optional flag that specifies whether the extern modules specified by this call
to the <code class="docutils literal notranslate"><span class="pre">extern</span></code> method must be matched to some module during packaging. If an extern module glob
pattern is added with <code class="docutils literal notranslate"><span class="pre">allow_empty=False</span></code>, and <a class="reference internal" href="#torch.package.PackageExporter.close" title="torch.package.PackageExporter.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">close()</span></code></a> is called (either explicitly or via
<code class="docutils literal notranslate"><span class="pre">__exit__</span></code>) before any modules match that pattern, an exception is thrown. If <code class="docutils literal notranslate"><span class="pre">allow_empty=True</span></code>,
no such exception is thrown.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageExporter.externed_modules">
<code class="sig-name descname"><span class="pre">externed_modules</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter.externed_modules"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter.externed_modules" title="Permalink to this definition">¶</a></dt>
<dd><p>Return all modules that are currently externed.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A list containing the names of modules which will be
externed in this package.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageExporter.get_rdeps">
<code class="sig-name descname"><span class="pre">get_rdeps</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">module_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter.get_rdeps"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter.get_rdeps" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of all modules which depend on the module <code class="docutils literal notranslate"><span class="pre">module_name</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A list containing the names of modules which depend on <code class="docutils literal notranslate"><span class="pre">module_name</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageExporter.get_unique_id">
<code class="sig-name descname"><span class="pre">get_unique_id</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter.get_unique_id"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter.get_unique_id" title="Permalink to this definition">¶</a></dt>
<dd><p>Get an id. This id is guaranteed to only be handed out once for this package.</p>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageExporter.intern">
<code class="sig-name descname"><span class="pre">intern</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">include</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allow_empty</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter.intern"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter.intern" title="Permalink to this definition">¶</a></dt>
<dd><p>Specify modules that should be packaged. A module must match some <code class="docutils literal notranslate"><span class="pre">intern</span></code> pattern in order to be
included in the package and have its dependencies processed recursively.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>include</strong> (<em>Union</em><em>[</em><em>List</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em>) – A string e.g. “my_package.my_subpackage”, or list of strings
for the names of the modules to be externed. This can also be a glob-style pattern, as described in <a class="reference internal" href="#torch.package.PackageExporter.mock" title="torch.package.PackageExporter.mock"><code class="xref py py-meth docutils literal notranslate"><span class="pre">mock()</span></code></a>.</p></li>
<li><p><strong>exclude</strong> (<em>Union</em><em>[</em><em>List</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em>) – An optional pattern that excludes some patterns that match the include string.</p></li>
<li><p><strong>allow_empty</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – An optional flag that specifies whether the intern modules specified by this call
to the <code class="docutils literal notranslate"><span class="pre">intern</span></code> method must be matched to some module during packaging. If an <code class="docutils literal notranslate"><span class="pre">intern</span></code> module glob
pattern is added with <code class="docutils literal notranslate"><span class="pre">allow_empty=False</span></code>, and <a class="reference internal" href="#torch.package.PackageExporter.close" title="torch.package.PackageExporter.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">close()</span></code></a> is called (either explicitly or via <code class="docutils literal notranslate"><span class="pre">__exit__</span></code>)
before any modules match that pattern, an exception is thrown. If <code class="docutils literal notranslate"><span class="pre">allow_empty=True</span></code>, no such exception is thrown.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageExporter.interned_modules">
<code class="sig-name descname"><span class="pre">interned_modules</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter.interned_modules"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter.interned_modules" title="Permalink to this definition">¶</a></dt>
<dd><p>Return all modules that are currently interned.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A list containing the names of modules which will be
interned in this package.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageExporter.mock">
<code class="sig-name descname"><span class="pre">mock</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">include</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allow_empty</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter.mock"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter.mock" title="Permalink to this definition">¶</a></dt>
<dd><p>Replace some required modules with a mock implementation.  Mocked modules will return a fake
object for any attribute accessed from it. Because we copy file-by-file, the dependency resolution will sometimes
find files that are imported by model files but whose functionality is never used
(e.g. custom serialization code or training helpers).
Use this function to mock this functionality out without having to modify the original code.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>include</strong> (<em>Union</em><em>[</em><em>List</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em>) – <p>A string e.g. <code class="docutils literal notranslate"><span class="pre">&quot;my_package.my_subpackage&quot;</span></code>, or list of strings
for the names of the modules to be mocked out. Strings can also be a glob-style pattern
string that may match multiple modules. Any required dependencies that match this pattern
string will be mocked out automatically.</p>
<dl>
<dt>Examples :</dt><dd><p><code class="docutils literal notranslate"><span class="pre">'torch.**'</span></code> – matches <code class="docutils literal notranslate"><span class="pre">torch</span></code> and all submodules of torch, e.g. <code class="docutils literal notranslate"><span class="pre">'torch.nn'</span></code>
and <code class="docutils literal notranslate"><span class="pre">'torch.nn.functional'</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">'torch.*'</span></code> – matches <code class="docutils literal notranslate"><span class="pre">'torch.nn'</span></code> or <code class="docutils literal notranslate"><span class="pre">'torch.functional'</span></code>, but not
<code class="docutils literal notranslate"><span class="pre">'torch.nn.functional'</span></code></p>
</dd>
</dl>
</p></li>
<li><p><strong>exclude</strong> (<em>Union</em><em>[</em><em>List</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em>) – An optional pattern that excludes some patterns that match the include string.
e.g. <code class="docutils literal notranslate"><span class="pre">include='torch.**',</span> <span class="pre">exclude='torch.foo'</span></code> will mock all torch packages except <code class="docutils literal notranslate"><span class="pre">'torch.foo'</span></code>,
Default: is <code class="docutils literal notranslate"><span class="pre">[]</span></code>.</p></li>
<li><p><strong>allow_empty</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – An optional flag that specifies whether the mock implementation(s) specified by this call
to the <a class="reference internal" href="#torch.package.PackageExporter.mock" title="torch.package.PackageExporter.mock"><code class="xref py py-meth docutils literal notranslate"><span class="pre">mock()</span></code></a> method must be matched to some module during packaging. If a mock is added with
<code class="docutils literal notranslate"><span class="pre">allow_empty=False</span></code>, and <a class="reference internal" href="#torch.package.PackageExporter.close" title="torch.package.PackageExporter.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">close()</span></code></a> is called (either explicitly or via <code class="docutils literal notranslate"><span class="pre">__exit__</span></code>) and the mock has
not been matched to a module used by the package being exported, an exception is thrown.
If <code class="docutils literal notranslate"><span class="pre">allow_empty=True</span></code>, no such exception is thrown.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageExporter.mocked_modules">
<code class="sig-name descname"><span class="pre">mocked_modules</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter.mocked_modules"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter.mocked_modules" title="Permalink to this definition">¶</a></dt>
<dd><p>Return all modules that are currently mocked.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A list containing the names of modules which will be
mocked in this package.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageExporter.register_extern_hook">
<code class="sig-name descname"><span class="pre">register_extern_hook</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hook</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter.register_extern_hook"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter.register_extern_hook" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers an extern hook on the exporter.</p>
<p>The hook will be called each time a module matches against an <a class="reference internal" href="#torch.package.PackageExporter.extern" title="torch.package.PackageExporter.extern"><code class="xref py py-meth docutils literal notranslate"><span class="pre">extern()</span></code></a> pattern.
It should have the following signature:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hook</span><span class="p">(</span><span class="n">exporter</span><span class="p">:</span> <span class="n">PackageExporter</span><span class="p">,</span> <span class="n">module_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</pre></div>
</div>
<p>Hooks will be called in order of registration.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A handle that can be used to remove the added hook by calling
<code class="docutils literal notranslate"><span class="pre">handle.remove()</span></code>.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.utils.hooks.RemovableHandle</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageExporter.register_intern_hook">
<code class="sig-name descname"><span class="pre">register_intern_hook</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hook</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter.register_intern_hook"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter.register_intern_hook" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers an intern hook on the exporter.</p>
<p>The hook will be called each time a module matches against an <a class="reference internal" href="#torch.package.PackageExporter.intern" title="torch.package.PackageExporter.intern"><code class="xref py py-meth docutils literal notranslate"><span class="pre">intern()</span></code></a> pattern.
It should have the following signature:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hook</span><span class="p">(</span><span class="n">exporter</span><span class="p">:</span> <span class="n">PackageExporter</span><span class="p">,</span> <span class="n">module_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</pre></div>
</div>
<p>Hooks will be called in order of registration.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A handle that can be used to remove the added hook by calling
<code class="docutils literal notranslate"><span class="pre">handle.remove()</span></code>.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.utils.hooks.RemovableHandle</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageExporter.register_mock_hook">
<code class="sig-name descname"><span class="pre">register_mock_hook</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hook</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter.register_mock_hook"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter.register_mock_hook" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers a mock hook on the exporter.</p>
<p>The hook will be called each time a module matches against a <a class="reference internal" href="#torch.package.PackageExporter.mock" title="torch.package.PackageExporter.mock"><code class="xref py py-meth docutils literal notranslate"><span class="pre">mock()</span></code></a> pattern.
It should have the following signature:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hook</span><span class="p">(</span><span class="n">exporter</span><span class="p">:</span> <span class="n">PackageExporter</span><span class="p">,</span> <span class="n">module_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</pre></div>
</div>
<p>Hooks will be called in order of registration.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A handle that can be used to remove the added hook by calling
<code class="docutils literal notranslate"><span class="pre">handle.remove()</span></code>.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.utils.hooks.RemovableHandle</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageExporter.save_binary">
<code class="sig-name descname"><span class="pre">save_binary</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">package</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resource</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">binary</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter.save_binary"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter.save_binary" title="Permalink to this definition">¶</a></dt>
<dd><p>Save raw bytes to the package.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>package</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – The name of module package this resource should go it (e.g. <code class="docutils literal notranslate"><span class="pre">&quot;my_package.my_subpackage&quot;</span></code>).</p></li>
<li><p><strong>resource</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – A unique name for the resource, used to identify it to load.</p></li>
<li><p><strong>binary</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – The data to save.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageExporter.save_module">
<code class="sig-name descname"><span class="pre">save_module</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">module_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dependencies</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter.save_module"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter.save_module" title="Permalink to this definition">¶</a></dt>
<dd><p>Save the code for <code class="docutils literal notranslate"><span class="pre">module</span></code> into the package. Code for the module is resolved using the <code class="docutils literal notranslate"><span class="pre">importers</span></code> path to find the
module object, and then using its <code class="docutils literal notranslate"><span class="pre">__file__</span></code> attribute to find the source code.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>module_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – e.g. <code class="docutils literal notranslate"><span class="pre">my_package.my_subpackage</span></code>, code will be saved to provide code
for this package.</p></li>
<li><p><strong>dependencies</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a><em>, </em><em>optional</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, we scan the source for dependencies.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageExporter.save_pickle">
<code class="sig-name descname"><span class="pre">save_pickle</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">package</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resource</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dependencies</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter.save_pickle"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter.save_pickle" title="Permalink to this definition">¶</a></dt>
<dd><p>Save a python object to the archive using pickle. Equivalent to <a class="reference internal" href="generated/torch.save.html#torch.save" title="torch.save"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.save()</span></code></a> but saving into
the archive rather than a stand-alone file. Stanard pickle does not save the code, only the objects.
If <code class="docutils literal notranslate"><span class="pre">dependencies</span></code> is true, this method will also scan the pickled objects for which modules are required
to reconstruct them and save the relevant code.</p>
<p>To be able to save an object where <code class="docutils literal notranslate"><span class="pre">type(obj).__name__</span></code> is <code class="docutils literal notranslate"><span class="pre">my_module.MyObject</span></code>,
<code class="docutils literal notranslate"><span class="pre">my_module.MyObject</span></code> must resolve to the class of the object according to the <code class="docutils literal notranslate"><span class="pre">importer</span></code> order. When saving objects that
have previously been packaged, the importer’s <code class="docutils literal notranslate"><span class="pre">import_module</span></code> method will need to be present in the <code class="docutils literal notranslate"><span class="pre">importer</span></code> list
for this to work.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>package</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – The name of module package this resource should go in (e.g. <code class="docutils literal notranslate"><span class="pre">&quot;my_package.my_subpackage&quot;</span></code>).</p></li>
<li><p><strong>resource</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – A unique name for the resource, used to identify it to load.</p></li>
<li><p><strong>obj</strong> (<em>Any</em>) – The object to save, must be picklable.</p></li>
<li><p><strong>dependencies</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a><em>, </em><em>optional</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, we scan the source for dependencies.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageExporter.save_source_file">
<code class="sig-name descname"><span class="pre">save_source_file</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">module_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_or_directory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dependencies</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter.save_source_file"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter.save_source_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds the local file system <code class="docutils literal notranslate"><span class="pre">file_or_directory</span></code> to the source package to provide the code
for <code class="docutils literal notranslate"><span class="pre">module_name</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>module_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – e.g. <code class="docutils literal notranslate"><span class="pre">&quot;my_package.my_subpackage&quot;</span></code>, code will be saved to provide code for this package.</p></li>
<li><p><strong>file_or_directory</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – the path to a file or directory of code. When a directory, all python files in the directory
are recursively copied using <a class="reference internal" href="#torch.package.PackageExporter.save_source_file" title="torch.package.PackageExporter.save_source_file"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save_source_file()</span></code></a>. If a file is named <code class="docutils literal notranslate"><span class="pre">&quot;/__init__.py&quot;</span></code> the code is treated
as a package.</p></li>
<li><p><strong>dependencies</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a><em>, </em><em>optional</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, we scan the source for dependencies.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageExporter.save_source_string">
<code class="sig-name descname"><span class="pre">save_source_string</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">module_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">src</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_package</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dependencies</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter.save_source_string"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter.save_source_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds <code class="docutils literal notranslate"><span class="pre">src</span></code> as the source code for <code class="docutils literal notranslate"><span class="pre">module_name</span></code> in the exported package.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>module_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – e.g. <code class="docutils literal notranslate"><span class="pre">my_package.my_subpackage</span></code>, code will be saved to provide code for this package.</p></li>
<li><p><strong>src</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – The Python source code to save for this package.</p></li>
<li><p><strong>is_package</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a><em>, </em><em>optional</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, this module is treated as a package. Packages are allowed to have submodules
(e.g. <code class="docutils literal notranslate"><span class="pre">my_package.my_subpackage.my_subsubpackage</span></code>), and resources can be saved inside them. Defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><strong>dependencies</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a><em>, </em><em>optional</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, we scan the source for dependencies.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageExporter.save_text">
<code class="sig-name descname"><span class="pre">save_text</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">package</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resource</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">text</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_exporter.html#PackageExporter.save_text"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageExporter.save_text" title="Permalink to this definition">¶</a></dt>
<dd><p>Save text data to the package.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>package</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – The name of module package this resource should go it (e.g. <code class="docutils literal notranslate"><span class="pre">&quot;my_package.my_subpackage&quot;</span></code>).</p></li>
<li><p><strong>resource</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – A unique name for the resource, used to identify it to load.</p></li>
<li><p><strong>text</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – The contents to save.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="torch.package.PackageImporter">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">torch.package.</span></code><code class="sig-name descname"><span class="pre">PackageImporter</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="pre">file_or_buffer</span></em>, <em class="sig-param"><span class="pre">module_allowed=&lt;function</span> <span class="pre">PackageImporter.&lt;lambda&gt;&gt;</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_importer.html#PackageImporter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageImporter" title="Permalink to this definition">¶</a></dt>
<dd><p>Importers allow you to load code written to packages by <a class="reference internal" href="#torch.package.PackageExporter" title="torch.package.PackageExporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageExporter</span></code></a>.
Code is loaded in a hermetic way, using files from the package
rather than the normal python import system. This allows
for the packaging of PyTorch model code and data so that it can be run
on a server or used in the future for transfer learning.</p>
<p>The importer for packages ensures that code in the module can only be loaded from
within the package, except for modules explicitly listed as external during export.
The file <code class="docutils literal notranslate"><span class="pre">extern_modules</span></code> in the zip archive lists all the modules that a package externally depends on.
This prevents “implicit” dependencies where the package runs locally because it is importing
a locally-installed package, but then fails when the package is copied to another machine.</p>
<dl class="py method">
<dt id="torch.package.PackageImporter.__init__">
<code class="sig-name descname"><span class="pre">__init__</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="pre">file_or_buffer</span></em>, <em class="sig-param"><span class="pre">module_allowed=&lt;function</span> <span class="pre">PackageImporter.&lt;lambda&gt;&gt;</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_importer.html#PackageImporter.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageImporter.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Open <code class="docutils literal notranslate"><span class="pre">file_or_buffer</span></code> for importing. This checks that the imported package only requires modules
allowed by <code class="docutils literal notranslate"><span class="pre">module_allowed</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_or_buffer</strong> – a file-like object (has to implement <code class="xref py py-meth docutils literal notranslate"><span class="pre">read()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">readline()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">tell()</span></code>, and <code class="xref py py-meth docutils literal notranslate"><span class="pre">seek()</span></code>),
a string, or an <code class="docutils literal notranslate"><span class="pre">os.PathLike</span></code> object containing a filename.</p></li>
<li><p><strong>module_allowed</strong> (<em>Callable</em><em>[</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a><em>]</em><em>, </em><em>optional</em>) – A method to determine if a externally provided module
should be allowed. Can be used to ensure packages loaded do not depend on modules that the server
does not support. Defaults to allowing anything.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ImportError" title="(in Python v3.10)"><strong>ImportError</strong></a> – If the package will use a disallowed module.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageImporter.file_structure">
<code class="sig-name descname"><span class="pre">file_structure</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'**'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_importer.html#PackageImporter.file_structure"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageImporter.file_structure" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a file structure representation of package’s zipfile.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>include</strong> (<em>Union</em><em>[</em><em>List</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em>) – An optional string e.g. <code class="docutils literal notranslate"><span class="pre">&quot;my_package.my_subpackage&quot;</span></code>, or optional list of strings
for the names of the files to be inluded in the zipfile representation. This can also be
a glob-style pattern, as described in <a class="reference internal" href="#torch.package.PackageExporter.mock" title="torch.package.PackageExporter.mock"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PackageExporter.mock()</span></code></a></p></li>
<li><p><strong>exclude</strong> (<em>Union</em><em>[</em><em>List</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em>) – An optional pattern that excludes files whose name match the pattern.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><a class="reference internal" href="#torch.package.Directory" title="torch.package.Directory"><code class="xref py py-class docutils literal notranslate"><span class="pre">Directory</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageImporter.id">
<code class="sig-name descname"><span class="pre">id</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_importer.html#PackageImporter.id"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageImporter.id" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns internal identifier that torch.package uses to distinguish <a class="reference internal" href="#torch.package.PackageImporter" title="torch.package.PackageImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PackageImporter</span></code></a> instances.
Looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">torch_package_0</span><span class="o">&gt;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageImporter.import_module">
<code class="sig-name descname"><span class="pre">import_module</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">package</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_importer.html#PackageImporter.import_module"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageImporter.import_module" title="Permalink to this definition">¶</a></dt>
<dd><p>Load a module from the package if it hasn’t already been loaded, and then return
the module. Modules are loaded locally
to the importer and will appear in <code class="docutils literal notranslate"><span class="pre">self.modules</span></code> rather than <code class="docutils literal notranslate"><span class="pre">sys.modules</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – Fully qualified name of the module to load.</p></li>
<li><p><strong>package</strong> (<em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#type" title="(in Python v3.10)"><em>type</em></a><em>]</em><em>, </em><em>optional</em>) – Unused, but present to match the signature of importlib.import_module. Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The (possibly already) loaded module.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/types.html#types.ModuleType" title="(in Python v3.10)">types.ModuleType</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageImporter.load_binary">
<code class="sig-name descname"><span class="pre">load_binary</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">package</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resource</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_importer.html#PackageImporter.load_binary"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageImporter.load_binary" title="Permalink to this definition">¶</a></dt>
<dd><p>Load raw bytes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>package</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – The name of module package (e.g. <code class="docutils literal notranslate"><span class="pre">&quot;my_package.my_subpackage&quot;</span></code>).</p></li>
<li><p><strong>resource</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – The unique name for the resource.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The loaded data.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.10)">bytes</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageImporter.load_pickle">
<code class="sig-name descname"><span class="pre">load_pickle</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">package</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resource</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">map_location</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_importer.html#PackageImporter.load_pickle"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageImporter.load_pickle" title="Permalink to this definition">¶</a></dt>
<dd><p>Unpickles the resource from the package, loading any modules that are needed to construct the objects
using <a class="reference internal" href="#torch.package.PackageImporter.import_module" title="torch.package.PackageImporter.import_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">import_module()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>package</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – The name of module package (e.g. <code class="docutils literal notranslate"><span class="pre">&quot;my_package.my_subpackage&quot;</span></code>).</p></li>
<li><p><strong>resource</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – The unique name for the resource.</p></li>
<li><p><strong>map_location</strong> – Passed to <cite>torch.load</cite> to determine how tensors are mapped to devices. Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The unpickled object.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Any</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="torch.package.PackageImporter.load_text">
<code class="sig-name descname"><span class="pre">load_text</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">package</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resource</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encoding</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'utf-8'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">errors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'strict'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/package_importer.html#PackageImporter.load_text"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.PackageImporter.load_text" title="Permalink to this definition">¶</a></dt>
<dd><p>Load a string.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>package</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – The name of module package (e.g. <code class="docutils literal notranslate"><span class="pre">&quot;my_package.my_subpackage&quot;</span></code>).</p></li>
<li><p><strong>resource</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – The unique name for the resource.</p></li>
<li><p><strong>encoding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>, </em><em>optional</em>) – Passed to <code class="docutils literal notranslate"><span class="pre">decode</span></code>. Defaults to <code class="docutils literal notranslate"><span class="pre">'utf-8'</span></code>.</p></li>
<li><p><strong>errors</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>, </em><em>optional</em>) – Passed to <code class="docutils literal notranslate"><span class="pre">decode</span></code>. Defaults to <code class="docutils literal notranslate"><span class="pre">'strict'</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The loaded text.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)">str</a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="torch.package.Directory">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">torch.package.</span></code><code class="sig-name descname"><span class="pre">Directory</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_dir</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/file_structure_representation.html#Directory"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.Directory" title="Permalink to this definition">¶</a></dt>
<dd><p>A file structure representation. Organized as Directory nodes that have lists of
their Directory children. Directories for a package are created by calling
<a class="reference internal" href="#torch.package.PackageImporter.file_structure" title="torch.package.PackageImporter.file_structure"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PackageImporter.file_structure()</span></code></a>.</p>
<dl class="py method">
<dt id="torch.package.Directory.has_file">
<code class="sig-name descname"><span class="pre">has_file</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/package/file_structure_representation.html#Directory.has_file"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.package.Directory.has_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks if a file is present in a <a class="reference internal" href="#torch.package.Directory" title="torch.package.Directory"><code class="xref py py-class docutils literal notranslate"><span class="pre">Directory</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – Path of file to search for.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>If a <a class="reference internal" href="#torch.package.Directory" title="torch.package.Directory"><code class="xref py py-class docutils literal notranslate"><span class="pre">Directory</span></code></a> contains the specified file.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)">bool</a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>


             </article>
             
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="profiler.html" class="btn btn-neutral float-right" title="torch.profiler" accesskey="n" rel="next">Next <img src="_static/images/chevron-right-orange.svg" class="next-page"></a>
      
      
        <a href="torch.overrides.html" class="btn btn-neutral" title="torch.overrides" accesskey="p" rel="prev"><img src="_static/images/chevron-right-orange.svg" class="previous-page"> Previous</a>
      
    </div>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Torch Contributors.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              <ul>
<li><a class="reference internal" href="#">torch.package</a><ul>
<li><a class="reference internal" href="#tutorials">Tutorials</a><ul>
<li><a class="reference internal" href="#packaging-your-first-model">Packaging your first model</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-do-i">How do I…</a><ul>
<li><a class="reference internal" href="#see-what-is-inside-a-package">See what is inside a package?</a><ul>
<li><a class="reference internal" href="#treat-the-package-like-a-zip-archive">Treat the package like a ZIP archive</a></li>
<li><a class="reference internal" href="#use-the-file-structure-api">Use the <code class="docutils literal notranslate"><span class="pre">file_structure()</span></code> API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#include-arbitrary-resources-with-my-package-and-access-them-later">Include arbitrary resources with my package and access them later?</a></li>
<li><a class="reference internal" href="#customize-how-a-class-is-packaged">Customize how a class is packaged?</a></li>
<li><a class="reference internal" href="#test-in-my-source-code-whether-or-not-it-is-executing-inside-a-package">Test in my source code whether or not it is executing inside a package?</a></li>
<li><a class="reference internal" href="#patch-code-into-a-package">Patch code into a package?</a></li>
<li><a class="reference internal" href="#access-package-contents-from-packaged-code">Access package contents from packaged code?</a></li>
<li><a class="reference internal" href="#distinguish-between-packaged-code-and-non-packaged-code">Distinguish between packaged code and non-packaged code?</a></li>
<li><a class="reference internal" href="#re-export-an-imported-object">Re-export an imported object?</a></li>
<li><a class="reference internal" href="#package-a-torchscript-module">Package a TorchScript module?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#explanation">Explanation</a><ul>
<li><a class="reference internal" href="#torch-package-format-overview"><code class="docutils literal notranslate"><span class="pre">torch.package</span></code> Format Overview</a><ul>
<li><a class="reference internal" href="#framework-files">Framework files</a></li>
<li><a class="reference internal" href="#user-files">User files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-torch-package-finds-your-code-s-dependencies">How <code class="docutils literal notranslate"><span class="pre">torch.package</span></code> finds your code’s dependencies</a><ul>
<li><a class="reference internal" href="#analyzing-an-object-s-dependencies">Analyzing an object’s dependencies</a></li>
<li><a class="reference internal" href="#analyzing-a-module-s-dependencies">Analyzing a module’s dependencies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dependency-management">Dependency Management</a><ul>
<li><a class="reference internal" href="#intern"><code class="docutils literal notranslate"><span class="pre">intern</span></code></a></li>
<li><a class="reference internal" href="#extern"><code class="docutils literal notranslate"><span class="pre">extern</span></code></a></li>
<li><a class="reference internal" href="#mock"><code class="docutils literal notranslate"><span class="pre">mock</span></code></a></li>
<li><a class="reference internal" href="#refactoring">Refactoring</a></li>
<li><a class="reference internal" href="#patterns">Patterns</a></li>
</ul>
</li>
<li><a class="reference internal" href="#torch-package-sharp-edges"><code class="docutils literal notranslate"><span class="pre">torch.package</span></code> sharp edges</a><ul>
<li><a class="reference internal" href="#avoid-global-state-in-your-modules">Avoid global state in your modules</a></li>
<li><a class="reference internal" href="#types-are-not-shared-between-packages-and-the-loading-environment">Types are not shared between packages and the loading environment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-torch-package-keeps-packages-isolated-from-each-other">How <code class="docutils literal notranslate"><span class="pre">torch.package</span></code> keeps packages isolated from each other</a><ul>
<li><a class="reference internal" href="#mangling">Mangling</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#api-reference">API Reference</a></li>
</ul>
</li>
</ul>

            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
         <script src="_static/jquery.js"></script>
         <script src="_static/underscore.js"></script>
         <script src="_static/doctools.js"></script>
         <script src="_static/clipboard.min.js"></script>
         <script src="_static/copybutton.js"></script>
     

  

  <script type="text/javascript" src="_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 
<script script type="text/javascript">
  var collapsedSections = ['Notes', 'Language Bindings', 'Libraries', 'Community'];
</script>

<img height="1" width="1" style="border-style:none;" alt="" src="https://www.googleadservices.com/pagead/conversion/795629140/?label=txkmCPmdtosBENSssfsC&amp;guid=ON&amp;script=0"/>


  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access comprehensive developer documentation for PyTorch</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get in-depth tutorials for beginners and advanced developers</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Resources</h2>
          <p>Find development resources and get your questions answered</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">View Resources</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">Get Started</a></li>
            <li><a href="https://pytorch.org/features">Features</a></li>
            <li><a href="https://pytorch.org/ecosystem">Ecosystem</a></li>
            <li><a href="https://pytorch.org/blog/">Blog</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">Contributing</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/resources">Resources</a></li>
            <li><a href="https://pytorch.org/tutorials">Tutorials</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">Docs</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">Discuss</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github Issues</a></li>
            <li><a href="https://pytorch.org/assets/brand-guidelines/PyTorch-Brand-Guidelines.pdf" target="_blank">Brand Guidelines</a></li>
          </ul>
        </div>

        <div class="footer-links-col follow-us-col">
          <ul>
            <li class="list-title">Stay Connected</li>
            <li>
              <div id="mc_embed_signup">
                <form
                  action="https://twitter.us14.list-manage.com/subscribe/post?u=75419c71fe0a935e53dfa4a3f&id=91d0dccd39"
                  method="post"
                  id="mc-embedded-subscribe-form"
                  name="mc-embedded-subscribe-form"
                  class="email-subscribe-form validate"
                  target="_blank"
                  novalidate>
                  <div id="mc_embed_signup_scroll" class="email-subscribe-form-fields-wrapper">
                    <div class="mc-field-group">
                      <label for="mce-EMAIL" style="display:none;">Email Address</label>
                      <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="Email Address">
                    </div>

                    <div id="mce-responses" class="clear">
                      <div class="response" id="mce-error-response" style="display:none"></div>
                      <div class="response" id="mce-success-response" style="display:none"></div>
                    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->

                    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_75419c71fe0a935e53dfa4a3f_91d0dccd39" tabindex="-1" value=""></div>

                    <div class="clear">
                      <input type="submit" value="" name="subscribe" id="mc-embedded-subscribe" class="button email-subscribe-button">
                    </div>
                  </div>
                </form>
              </div>

            </li>
          </ul>

          <div class="footer-social-icons">
            <a href="https://www.facebook.com/pytorch" target="_blank" class="facebook"></a>
            <a href="https://twitter.com/pytorch" target="_blank" class="twitter"></a>
            <a href="https://www.youtube.com/pytorch" target="_blank" class="youtube"></a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebook’s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/hub">PyTorch Hub</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="resources-mobile-menu-title" class="active">
            Docs
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/docs/stable/index.html">PyTorch</a>
            </li>

            <li>
              <a href="https://pytorch.org/audio/stable/index.html">torchaudio</a>
            </li>

            <li>
              <a href="https://pytorch.org/text/stable/index.html">torchtext</a>
            </li>

            <li>
              <a href="https://pytorch.org/vision/stable/index.html">torchvision</a>
            </li>

            <li>
              <a href="https://pytorch.org/elastic/">TorchElastic</a>
            </li>

            <li>
              <a href="https://pytorch.org/serve/">TorchServe</a>
            </li>

            <li>
              <a href="https://pytorch.org/xla">PyTorch on XLA Devices</a>
            </li>
          </ul>

          <li class="resources-mobile-menu-title">
            Resources
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/resources">Developer Resources</a>
            </li>

            <li>
              <a href="https://pytorch.org/features">About</a>
            </li>

            <li>
              <a href="https://pytorch.org/hub">Models (Beta)</a>
            </li>

            <li>
              <a href="https://pytorch.org/#community-module">Community</a>
            </li>

            <li>
              <a href="https://discuss.pytorch.org/">Forums</a>
            </li>
          </ul>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>