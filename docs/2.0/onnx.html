


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>torch.onnx &mdash; PyTorch 2.0 documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://pytorch.org/docs/stable/onnx.html"/>
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/katex-math.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinx-dropdown.css" type="text/css" />
  <link rel="stylesheet" href="_static/panels-bootstrap.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/jit.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="JitScalarType" href="generated/torch.onnx.JitScalarType.html" />
    <link rel="prev" title="torch.nn.init" href="nn.init.html" />


  <!-- Google Analytics -->
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-117752657-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-117752657-2');
    </script>
  
  <!-- End Google Analytics -->
  


  
  <script src="_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="active docs-active">
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-orange-arrow">
                Docs
              </a>
              <div class="resources-dropdown-menu">
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/docs/stable/index.html">
                  <span class="dropdown-title">PyTorch</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/audio/stable/index.html">
                  <span class="dropdown-title">torchaudio</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/text/stable/index.html">
                  <span class="dropdown-title">torchtext</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/vision/stable/index.html">
                  <span class="dropdown-title">torchvision</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/torcharrow">
                  <span class="dropdown-title">torcharrow</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/data">
                  <span class="dropdown-title">TorchData</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/torchrec">
                  <span class="dropdown-title">TorchRec</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/serve/">
                  <span class="dropdown-title">TorchServe</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/torchx/">
                  <span class="dropdown-title">TorchX</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/xla">
                  <span class="dropdown-title">PyTorch on XLA Devices</span>
                  <p></p>
                </a>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-arrow">
                Resources
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/features">
                  <span class="dropdown-title">About</span>
                  <p>Learn about PyTorch’s features and capabilities</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/foundation">
                  <span class="dropdown-title">PyTorch Foundation</span>
                  <p>Learn about the PyTorch foundation</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/#community-module">
                  <span class="dropdown-title">Community</span>
                  <p>Join the PyTorch developer community to contribute, learn, and get your questions answered.</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/community-stories">
                  <span class="dropdown-title">Community Stories</span>
                  <p>Learn how our community solves real, everyday machine learning problems with PyTorch.</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/resources">
                  <span class="dropdown-title">Developer Resources</span>
                  <p>Find resources and get questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/events">
                  <span class="dropdown-title">Events</span>
                  <p>Find events, webinars, and podcasts</p>
                </a>
                <a class="nav-dropdown-item" href="https://discuss.pytorch.org/" target="_blank">
                  <span class="dropdown-title">Forums</span>
                  <p>A place to discuss PyTorch code, issues, install, research</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/hub">
                  <span class="dropdown-title">Models (Beta)</span>
                  <p>Discover, publish, and reuse pre-trained models</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <a href="https://github.com/pytorch/pytorch">GitHub</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>

<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            
    <div class="version">
      <a href='https://pytorch.org/docs/versions.html'>2.0 &#x25BC</a>
    </div>
    


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          </div>

          


            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="community/build_ci_governance.html">PyTorch Governance | Build + CI</a></li>
<li class="toctree-l1"><a class="reference internal" href="community/contribution_guide.html">PyTorch Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="community/design.html">PyTorch Design Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="community/governance.html">PyTorch Governance | Mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="community/persons_of_interest.html">PyTorch Governance | Maintainers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="notes/amp_examples.html">CUDA Automatic Mixed Precision examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/autograd.html">Autograd mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/broadcasting.html">Broadcasting semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/cpu_threading_torchscript_inference.html">CPU threading and TorchScript inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/cuda.html">CUDA semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/ddp.html">Distributed Data Parallel</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/extending.html">Extending PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/extending.func.html">Extending torch.func with autograd.Function</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/gradcheck.html">Gradcheck mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/hip.html">HIP (ROCm) semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/large_scale_deployments.html">Features for large-scale deployments</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/mps.html">MPS backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/multiprocessing.html">Multiprocessing best practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/numerical_accuracy.html">Numerical accuracy</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/randomness.html">Reproducibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/serialization.html">Serialization semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/windows.html">Windows FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">torch.compile</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dynamo/index.html">TorchDynamo Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="dynamo/installation.html">Installing TorchDynamo</a></li>
<li class="toctree-l1"><a class="reference internal" href="dynamo/get-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="dynamo/guards-overview.html">Guards Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="dynamo/custom-backends.html">Custom Backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="dynamo/deep-dive.html">TorchDynamo Deeper Dive</a></li>
<li class="toctree-l1"><a class="reference internal" href="dynamo/troubleshooting.html">TorchDynamo Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="dynamo/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="ir.html">IRs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Language Bindings</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cpp_index.html">C++</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/javadoc/">Javadoc</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy.html">torch::deploy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="torch.html">torch</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.html">torch.nn</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.functional.html">torch.nn.functional</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensors.html">torch.Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensor_attributes.html">Tensor Attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensor_view.html">Tensor Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="amp.html">torch.amp</a></li>
<li class="toctree-l1"><a class="reference internal" href="autograd.html">torch.autograd</a></li>
<li class="toctree-l1"><a class="reference internal" href="library.html">torch.library</a></li>
<li class="toctree-l1"><a class="reference internal" href="cuda.html">torch.cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="mps.html">torch.mps</a></li>
<li class="toctree-l1"><a class="reference internal" href="backends.html">torch.backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.html">torch.distributed</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.algorithms.join.html">torch.distributed.algorithms.join</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.elastic.html">torch.distributed.elastic</a></li>
<li class="toctree-l1"><a class="reference internal" href="fsdp.html">torch.distributed.fsdp</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.optim.html">torch.distributed.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.tensor.parallel.html">torch.distributed.tensor.parallel</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.checkpoint.html">torch.distributed.checkpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributions.html">torch.distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="_dynamo.html">torch._dynamo</a></li>
<li class="toctree-l1"><a class="reference internal" href="fft.html">torch.fft</a></li>
<li class="toctree-l1"><a class="reference internal" href="func.html">torch.func</a></li>
<li class="toctree-l1"><a class="reference internal" href="futures.html">torch.futures</a></li>
<li class="toctree-l1"><a class="reference internal" href="fx.html">torch.fx</a></li>
<li class="toctree-l1"><a class="reference internal" href="hub.html">torch.hub</a></li>
<li class="toctree-l1"><a class="reference internal" href="jit.html">torch.jit</a></li>
<li class="toctree-l1"><a class="reference internal" href="linalg.html">torch.linalg</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitor.html">torch.monitor</a></li>
<li class="toctree-l1"><a class="reference internal" href="signal.html">torch.signal</a></li>
<li class="toctree-l1"><a class="reference internal" href="special.html">torch.special</a></li>
<li class="toctree-l1"><a class="reference internal" href="torch.overrides.html">torch.overrides</a></li>
<li class="toctree-l1"><a class="reference internal" href="package.html">torch.package</a></li>
<li class="toctree-l1"><a class="reference internal" href="profiler.html">torch.profiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.init.html">torch.nn.init</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">torch.onnx</a></li>
<li class="toctree-l1"><a class="reference internal" href="onnx_diagnostics.html">torch.onnx diagnostics</a></li>
<li class="toctree-l1"><a class="reference internal" href="optim.html">torch.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="complex_numbers.html">Complex Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="ddp_comm_hooks.html">DDP Communication Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipeline.html">Pipeline Parallelism</a></li>
<li class="toctree-l1"><a class="reference internal" href="quantization.html">Quantization</a></li>
<li class="toctree-l1"><a class="reference internal" href="rpc.html">Distributed RPC Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="random.html">torch.random</a></li>
<li class="toctree-l1"><a class="reference internal" href="masked.html">torch.masked</a></li>
<li class="toctree-l1"><a class="reference internal" href="nested.html">torch.nested</a></li>
<li class="toctree-l1"><a class="reference internal" href="sparse.html">torch.sparse</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage.html">torch.Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">torch.testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmark_utils.html">torch.utils.benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="bottleneck.html">torch.utils.bottleneck</a></li>
<li class="toctree-l1"><a class="reference internal" href="checkpoint.html">torch.utils.checkpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpp_extension.html">torch.utils.cpp_extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">torch.utils.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="jit_utils.html">torch.utils.jit</a></li>
<li class="toctree-l1"><a class="reference internal" href="dlpack.html">torch.utils.dlpack</a></li>
<li class="toctree-l1"><a class="reference internal" href="mobile_optimizer.html">torch.utils.mobile_optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_zoo.html">torch.utils.model_zoo</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensorboard.html">torch.utils.tensorboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="type_info.html">Type Info</a></li>
<li class="toctree-l1"><a class="reference internal" href="named_tensor.html">Named Tensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="name_inference.html">Named Tensors operator coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="config_mod.html">torch.__config__</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Libraries</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/audio/stable">torchaudio</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/data">TorchData</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/torchrec">TorchRec</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/serve">TorchServe</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/text/stable">torchtext</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/vision/stable">torchvision</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/xla/">PyTorch on XLA Devices</a></li>
</ul>

            
          

        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
      <li>torch.onnx</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
            
            <a href="_sources/onnx.rst.txt" rel="nofollow"><img src="_static/images/view-page-source-icon.svg"></a>
          
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        

          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <section id="torch-onnx">
<h1>torch.onnx<a class="headerlink" href="#torch-onnx" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#example-alexnet-from-pytorch-to-onnx" id="id5">Example: AlexNet from PyTorch to ONNX</a></p></li>
<li><p><a class="reference internal" href="#tracing-vs-scripting" id="id6">Tracing vs Scripting</a></p></li>
<li><p><a class="reference internal" href="#avoiding-pitfalls" id="id7">Avoiding Pitfalls</a></p>
<ul>
<li><p><a class="reference internal" href="#avoid-numpy-and-built-in-python-types" id="id8">Avoid NumPy and built-in Python types</a></p></li>
<li><p><a class="reference internal" href="#avoid-tensor-data" id="id9">Avoid Tensor.data</a></p></li>
<li><p><a class="reference internal" href="#avoid-in-place-operations-when-using-tensor-shape-in-tracing-mode" id="id10">Avoid in-place operations when using tensor.shape in tracing mode</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#limitations" id="id11">Limitations</a></p>
<ul>
<li><p><a class="reference internal" href="#types" id="id12">Types</a></p></li>
<li><p><a class="reference internal" href="#differences-in-operator-implementations" id="id13">Differences in Operator Implementations</a></p></li>
<li><p><a class="reference internal" href="#unsupported-tensor-indexing-patterns" id="id14">Unsupported Tensor Indexing Patterns</a></p>
<ul>
<li><p><a class="reference internal" href="#reads-gets" id="id15">Reads / Gets</a></p></li>
<li><p><a class="reference internal" href="#writes-sets" id="id16">Writes / Sets</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#adding-support-for-operators" id="id17">Adding support for operators</a></p>
<ul>
<li><p><a class="reference internal" href="#onnx-exporter-internals" id="id18">ONNX exporter internals</a></p></li>
<li><p><a class="reference internal" href="#aten-operators" id="id19">ATen operators</a></p>
<ul>
<li><p><a class="reference internal" href="#list-of-supported-operators" id="id20">List of supported operators</a></p></li>
<li><p><a class="reference internal" href="#adding-support-for-an-aten-or-quantized-operator" id="id21">Adding support for an aten or quantized operator</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#torch-autograd-functions" id="id22">torch.autograd.Functions</a></p>
<ul>
<li><p><a class="reference internal" href="#static-symbolic-method" id="id23">Static Symbolic Method</a></p></li>
<li><p><a class="reference internal" href="#inline-autograd-function" id="id24">Inline Autograd Function</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#custom-operators" id="id25">Custom operators</a></p>
<ul>
<li><p><a class="reference internal" href="#onnx-script-functions" id="id26">ONNX-script functions</a></p></li>
<li><p><a class="reference internal" href="#c-operators" id="id27">C++ Operators</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#discovering-all-unconvertible-aten-ops-at-once" id="id28">Discovering all unconvertible ATen ops at once</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#frequently-asked-questions" id="id29">Frequently Asked Questions</a></p></li>
<li><p><a class="reference internal" href="#contributing-developing" id="id30">Contributing / developing</a></p></li>
<li><p><a class="reference internal" href="#functions" id="id31">Functions</a></p></li>
<li><p><a class="reference internal" href="#classes" id="id32">Classes</a></p></li>
</ul>
</nav>
<span class="target" id="module-torch.onnx"></span><p>ONNX exporter.</p>
<p><a class="reference external" href="https://onnx.ai/">Open Neural Network eXchange (ONNX)</a> is an open standard
format for representing machine learning models. The torch.onnx module can export
PyTorch models to ONNX. The model can then be consumed by any of the many
<a class="reference external" href="https://onnx.ai/supported-tools.html#deployModel">runtimes that support ONNX</a>.</p>
<section id="example-alexnet-from-pytorch-to-onnx">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Example: AlexNet from PyTorch to ONNX</a><a class="headerlink" href="#example-alexnet-from-pytorch-to-onnx" title="Permalink to this heading">¶</a></h2>
<p>Here is a simple script which exports a pretrained AlexNet to an ONNX file named <code class="docutils literal notranslate"><span class="pre">alexnet.onnx</span></code>.
The call to <code class="docutils literal notranslate"><span class="pre">torch.onnx.export</span></code> runs the model once to trace its execution and then exports the
traced model to the specified file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torchvision</span>

<span class="n">dummy_input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">torchvision</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">alexnet</span><span class="p">(</span><span class="n">pretrained</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>

<span class="c1"># Providing input and output names sets the display names for values</span>
<span class="c1"># within the model&#39;s graph. Setting these does not change the semantics</span>
<span class="c1"># of the graph; it is only for readability.</span>
<span class="c1">#</span>
<span class="c1"># The inputs to the network consist of the flat list of inputs (i.e.</span>
<span class="c1"># the values you would pass to the forward() method) followed by the</span>
<span class="c1"># flat list of parameters. You can partially specify names, i.e. provide</span>
<span class="c1"># a list here shorter than the number of inputs to the model, and we will</span>
<span class="c1"># only set that subset of names, starting from the beginning.</span>
<span class="n">input_names</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;actual_input_1&quot;</span> <span class="p">]</span> <span class="o">+</span> <span class="p">[</span> <span class="s2">&quot;learned_</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="p">]</span>
<span class="n">output_names</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;output1&quot;</span> <span class="p">]</span>

<span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">dummy_input</span><span class="p">,</span> <span class="s2">&quot;alexnet.onnx&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">input_names</span><span class="o">=</span><span class="n">input_names</span><span class="p">,</span> <span class="n">output_names</span><span class="o">=</span><span class="n">output_names</span><span class="p">)</span>
</pre></div>
</div>
<p>The resulting <code class="docutils literal notranslate"><span class="pre">alexnet.onnx</span></code> file contains a binary <a class="reference external" href="https://developers.google.com/protocol-buffers/">protocol buffer</a>
which contains both the network structure and parameters of the model you exported
(in this case, AlexNet).  The argument <code class="docutils literal notranslate"><span class="pre">verbose=True</span></code> causes the
exporter to print out a human-readable representation of the model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># These are the inputs and parameters to the network, which have taken on</span>
<span class="c1"># the names we specified earlier.</span>
<span class="n">graph</span><span class="p">(</span><span class="o">%</span><span class="n">actual_input_1</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">)</span>
      <span class="o">%</span><span class="n">learned_0</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
      <span class="o">%</span><span class="n">learned_1</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span>
      <span class="o">%</span><span class="n">learned_2</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
      <span class="o">%</span><span class="n">learned_3</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">192</span><span class="p">)</span>
      <span class="c1"># ---- omitted for brevity ----</span>
      <span class="o">%</span><span class="n">learned_14</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">4096</span><span class="p">)</span>
      <span class="o">%</span><span class="n">learned_15</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span> <span class="p">{</span>
  <span class="c1"># Every statement consists of some output tensors (and their types),</span>
  <span class="c1"># the operator to be run (with its attributes, e.g., kernels, strides,</span>
  <span class="c1"># etc.), its input tensors (%actual_input_1, %learned_0, %learned_1)</span>
  <span class="o">%</span><span class="mi">17</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">55</span><span class="p">)</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Conv</span><span class="p">[</span><span class="n">dilations</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">group</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kernel_shape</span><span class="o">=</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">],</span> <span class="n">pads</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">strides</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]](</span><span class="o">%</span><span class="n">actual_input_1</span><span class="p">,</span> <span class="o">%</span><span class="n">learned_0</span><span class="p">,</span> <span class="o">%</span><span class="n">learned_1</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span><span class="o">/</span><span class="n">Sequential</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">/</span><span class="n">Conv2d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="o">%</span><span class="mi">18</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">55</span><span class="p">)</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Relu</span><span class="p">(</span><span class="o">%</span><span class="mi">17</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span><span class="o">/</span><span class="n">Sequential</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">/</span><span class="n">ReLU</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="o">%</span><span class="mi">19</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">27</span><span class="p">)</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">MaxPool</span><span class="p">[</span><span class="n">kernel_shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">pads</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">strides</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]](</span><span class="o">%</span><span class="mi">18</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span><span class="o">/</span><span class="n">Sequential</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">/</span><span class="n">MaxPool2d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
  <span class="c1"># ---- omitted for brevity ----</span>
  <span class="o">%</span><span class="mi">29</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">MaxPool</span><span class="p">[</span><span class="n">kernel_shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">pads</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">strides</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]](</span><span class="o">%</span><span class="mi">28</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span><span class="o">/</span><span class="n">Sequential</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">/</span><span class="n">MaxPool2d</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
  <span class="c1"># Dynamic means that the shape is not known. This may be because of a</span>
  <span class="c1"># limitation of our implementation (which we would like to fix in a</span>
  <span class="c1"># future release) or shapes which are truly dynamic.</span>
  <span class="o">%</span><span class="mi">30</span> <span class="p">:</span> <span class="n">Dynamic</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Shape</span><span class="p">(</span><span class="o">%</span><span class="mi">29</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span>
  <span class="o">%</span><span class="mi">31</span> <span class="p">:</span> <span class="n">Dynamic</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Slice</span><span class="p">[</span><span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ends</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">starts</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]](</span><span class="o">%</span><span class="mi">30</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span>
  <span class="o">%</span><span class="mi">32</span> <span class="p">:</span> <span class="n">Long</span><span class="p">()</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Squeeze</span><span class="p">[</span><span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]](</span><span class="o">%</span><span class="mi">31</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span>
  <span class="o">%</span><span class="mi">33</span> <span class="p">:</span> <span class="n">Long</span><span class="p">()</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="p">{</span><span class="mi">9216</span><span class="p">}](),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span>
  <span class="c1"># ---- omitted for brevity ----</span>
  <span class="o">%</span><span class="n">output1</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Gemm</span><span class="p">[</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">broadcast</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">transB</span><span class="o">=</span><span class="mi">1</span><span class="p">](</span><span class="o">%</span><span class="mi">45</span><span class="p">,</span> <span class="o">%</span><span class="n">learned_14</span><span class="p">,</span> <span class="o">%</span><span class="n">learned_15</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span><span class="o">/</span><span class="n">Sequential</span><span class="p">[</span><span class="n">classifier</span><span class="p">]</span><span class="o">/</span><span class="n">Linear</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
  <span class="k">return</span> <span class="p">(</span><span class="o">%</span><span class="n">output1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can also verify the output using the <a class="reference external" href="https://github.com/onnx/onnx/">ONNX</a> library,
which you can install using <code class="docutils literal notranslate"><span class="pre">pip</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">onnx</span>
</pre></div>
</div>
<p>Then, you can run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">onnx</span>

<span class="c1"># Load the ONNX model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;alexnet.onnx&quot;</span><span class="p">)</span>

<span class="c1"># Check that the model is well formed</span>
<span class="n">onnx</span><span class="o">.</span><span class="n">checker</span><span class="o">.</span><span class="n">check_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="c1"># Print a human readable representation of the graph</span>
<span class="nb">print</span><span class="p">(</span><span class="n">onnx</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">printable_graph</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">graph</span><span class="p">))</span>
</pre></div>
</div>
<p>You can also run the exported model with one of the many
<a class="reference external" href="https://onnx.ai/supported-tools.html#deployModel">runtimes that support ONNX</a>.
For example after installing <a class="reference external" href="https://www.onnxruntime.ai">ONNX Runtime</a>, you can
load and run the model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">onnxruntime</span> <span class="k">as</span> <span class="nn">ort</span>

<span class="n">ort_session</span> <span class="o">=</span> <span class="n">ort</span><span class="o">.</span><span class="n">InferenceSession</span><span class="p">(</span><span class="s2">&quot;alexnet.onnx&quot;</span><span class="p">)</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="n">ort_session</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="kc">None</span><span class="p">,</span>
    <span class="p">{</span><span class="s2">&quot;actual_input_1&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)},</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>Here is a more involved <a class="reference external" href="https://pytorch.org/tutorials/advanced/super_resolution_with_onnxruntime.html">tutorial on exporting a model and running it with ONNX Runtime</a>.</p>
</section>
<section id="tracing-vs-scripting">
<span id="id2"></span><h2><a class="toc-backref" href="#id6" role="doc-backlink">Tracing vs Scripting</a><a class="headerlink" href="#tracing-vs-scripting" title="Permalink to this heading">¶</a></h2>
<p>Internally, <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.onnx.export()</span></code></a> requires a <a class="reference internal" href="generated/torch.jit.ScriptModule.html#torch.jit.ScriptModule" title="torch.jit.ScriptModule"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.jit.ScriptModule</span></code></a> rather than
a <a class="reference internal" href="generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.Module</span></code></a>. If the passed-in model is not already a <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code>,
<code class="docutils literal notranslate"><span class="pre">export()</span></code> will use <em>tracing</em> to convert it to one:</p>
<ul class="simple">
<li><p><strong>Tracing</strong>: If <code class="docutils literal notranslate"><span class="pre">torch.onnx.export()</span></code> is called with a Module that is not already a
<code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code>, it first does the equivalent of <a class="reference internal" href="generated/torch.jit.trace.html#torch.jit.trace" title="torch.jit.trace"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.jit.trace()</span></code></a>, which executes the model
once with the given <code class="docutils literal notranslate"><span class="pre">args</span></code> and records all operations that happen during that execution. This
means that if your model is dynamic, e.g., changes behavior depending on input data, the exported
model will <em>not</em> capture this dynamic behavior.
We recommend examining the exported model and making sure the operators look
reasonable. Tracing will unroll loops and if statements, exporting a static graph that is exactly
the same as the traced run. If you want to export your model with dynamic control flow, you will
need to use <em>scripting</em>.</p></li>
<li><p><strong>Scripting</strong>: Compiling a model via scripting preserves dynamic control flow and is valid for inputs
of different sizes. To use scripting:</p>
<ul>
<li><p>Use <a class="reference internal" href="generated/torch.jit.script.html#torch.jit.script" title="torch.jit.script"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.jit.script()</span></code></a> to produce a <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code>.</p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">torch.onnx.export()</span></code> with the <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code> as the model. The <code class="docutils literal notranslate"><span class="pre">args</span></code> are still required,
but they will be used internally only to produce example outputs, so that the types and shapes of the
outputs can be captured. No tracing will be performed.</p></li>
</ul>
</li>
</ul>
<p>See <a class="reference external" href="https://pytorch.org/tutorials/beginner/Intro_to_TorchScript_tutorial.html">Introduction to TorchScript</a>
and <a class="reference external" href="jit.html">TorchScript</a> for more details, including how to compose tracing and scripting to suit the
particular requirements of different models.</p>
</section>
<section id="avoiding-pitfalls">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Avoiding Pitfalls</a><a class="headerlink" href="#avoiding-pitfalls" title="Permalink to this heading">¶</a></h2>
<section id="avoid-numpy-and-built-in-python-types">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Avoid NumPy and built-in Python types</a><a class="headerlink" href="#avoid-numpy-and-built-in-python-types" title="Permalink to this heading">¶</a></h3>
<p>PyTorch models can be written using NumPy or Python types and functions, but
during <a class="reference internal" href="#tracing-vs-scripting"><span class="std std-ref">tracing</span></a>, any variables of NumPy or Python
types (rather than torch.Tensor) are converted to constants, which will produce
the wrong result if those values should change depending on the inputs.</p>
<p>For example, rather than using numpy functions on numpy.ndarrays:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Bad! Will be replaced with constants during tracing.</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Use torch operators on torch.Tensors:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Good! Tensor operations will be captured during tracing.</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>And rather than use <a class="reference internal" href="generated/torch.Tensor.item.html#torch.Tensor.item" title="torch.Tensor.item"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.Tensor.item()</span></code></a> (which converts a Tensor to a Python
built-in number):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Bad! y.item() will be replaced with a constant during tracing.</span>
<span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Use torch’s support for implicit casting of single-element tensors:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Good! y will be preserved as a variable during tracing.</span>
<span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="avoid-tensor-data">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Avoid Tensor.data</a><a class="headerlink" href="#avoid-tensor-data" title="Permalink to this heading">¶</a></h3>
<p>Using the Tensor.data field can produce an incorrect trace and therefore an incorrect ONNX graph.
Use <a class="reference internal" href="generated/torch.Tensor.detach.html#torch.Tensor.detach" title="torch.Tensor.detach"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.Tensor.detach()</span></code></a> instead. (Work is ongoing to
<a class="reference external" href="https://github.com/pytorch/pytorch/issues/30987">remove Tensor.data entirely</a>).</p>
</section>
<section id="avoid-in-place-operations-when-using-tensor-shape-in-tracing-mode">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Avoid in-place operations when using tensor.shape in tracing mode</a><a class="headerlink" href="#avoid-in-place-operations-when-using-tensor-shape-in-tracing-mode" title="Permalink to this heading">¶</a></h3>
<p>In tracing mode, shapes obtained from <code class="docutils literal notranslate"><span class="pre">tensor.shape</span></code> are traced as tensors,
and share the same memory. This might cause a mismatch the final output values.
As a workaround, avoid the use of inplace operations in these scenarios.
For example, in the model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">states</span><span class="p">):</span>
      <span class="n">batch_size</span><span class="p">,</span> <span class="n">seq_length</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
      <span class="n">real_seq_length</span> <span class="o">=</span> <span class="n">seq_length</span>
      <span class="n">real_seq_length</span> <span class="o">+=</span> <span class="mi">2</span>
      <span class="k">return</span> <span class="n">real_seq_length</span> <span class="o">+</span> <span class="n">seq_length</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">real_seq_length</span></code> and <code class="docutils literal notranslate"><span class="pre">seq_length</span></code> share the same memory in tracing mode.
This could be avoided by rewriting the inplace operation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">real_seq_length</span> <span class="o">=</span> <span class="n">real_seq_length</span> <span class="o">+</span> <span class="mi">2</span>
</pre></div>
</div>
</section>
</section>
<section id="limitations">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">Limitations</a><a class="headerlink" href="#limitations" title="Permalink to this heading">¶</a></h2>
<section id="types">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Types</a><a class="headerlink" href="#types" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Only <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.Tensors</span></code>, numeric types that can be trivially converted to torch.Tensors (e.g. float, int),
and tuples and lists of those types are supported as model inputs or outputs. Dict and str inputs and
outputs are accepted in <a class="reference internal" href="#tracing-vs-scripting"><span class="std std-ref">tracing</span></a> mode, but:</p>
<ul>
<li><p>Any computation that depends on the value of a dict or a str input <strong>will be replaced with the
constant value</strong> seen during the one traced execution.</p></li>
<li><p>Any output that is a dict will be silently replaced with a <strong>flattened sequence of its values
(keys will be removed)</strong>. E.g. <code class="docutils literal notranslate"><span class="pre">{&quot;foo&quot;:</span> <span class="pre">1,</span> <span class="pre">&quot;bar&quot;:</span> <span class="pre">2}</span></code> becomes <code class="docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">2)</span></code>.</p></li>
<li><p>Any output that is a str will be silently removed.</p></li>
</ul>
</li>
<li><p>Certain operations involving tuples and lists are not supported in
<a class="reference internal" href="#tracing-vs-scripting"><span class="std std-ref">scripting</span></a> mode due to limited support in ONNX for nested sequences.
In particular appending a tuple to a list is not supported. In tracing mode, the nested sequences
will be flattened automatically during the tracing.</p></li>
</ul>
</section>
<section id="differences-in-operator-implementations">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Differences in Operator Implementations</a><a class="headerlink" href="#differences-in-operator-implementations" title="Permalink to this heading">¶</a></h3>
<p>Due to differences in implementations of operators, running the exported model on different runtimes
may produce different results from each other or from PyTorch. Normally these differences are
numerically small, so this should only be a concern if your application is sensitive to these
small differences.</p>
</section>
<section id="unsupported-tensor-indexing-patterns">
<span id="tensor-indexing"></span><h3><a class="toc-backref" href="#id14" role="doc-backlink">Unsupported Tensor Indexing Patterns</a><a class="headerlink" href="#unsupported-tensor-indexing-patterns" title="Permalink to this heading">¶</a></h3>
<p>Tensor indexing patterns that cannot be exported are listed below.
If you are experiencing issues exporting a model that does not include any of
the unsupported patterns below, please double check that you are exporting with
the latest <code class="docutils literal notranslate"><span class="pre">opset_version</span></code>.</p>
<section id="reads-gets">
<h4><a class="toc-backref" href="#id15" role="doc-backlink">Reads / Gets</a><a class="headerlink" href="#reads-gets" title="Permalink to this heading">¶</a></h4>
<p>When indexing into a tensor for reading, the following patterns are not supported:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tensor indices that includes negative values.</span>
<span class="n">data</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">]]),</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])]</span>
<span class="c1"># Workarounds: use positive index values.</span>
</pre></div>
</div>
</section>
<section id="writes-sets">
<h4><a class="toc-backref" href="#id16" role="doc-backlink">Writes / Sets</a><a class="headerlink" href="#writes-sets" title="Permalink to this heading">¶</a></h4>
<p>When indexing into a Tensor for writing, the following patterns are not supported:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Multiple tensor indices if any has rank &gt;= 2</span>
<span class="n">data</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]),</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])]</span> <span class="o">=</span> <span class="n">new_data</span>
<span class="c1"># Workarounds: use single tensor index with rank &gt;= 2,</span>
<span class="c1">#              or multiple consecutive tensor indices with rank == 1.</span>

<span class="c1"># Multiple tensor indices that are not consecutive</span>
<span class="n">data</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="p">:,</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])]</span> <span class="o">=</span> <span class="n">new_data</span>
<span class="c1"># Workarounds: transpose `data` such that tensor indices are consecutive.</span>

<span class="c1"># Tensor indices that includes negative values.</span>
<span class="n">data</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])]</span> <span class="o">=</span> <span class="n">new_data</span>
<span class="c1"># Workarounds: use positive index values.</span>

<span class="c1"># Implicit broadcasting required for new_data.</span>
<span class="n">data</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_data</span>
<span class="c1"># Workarounds: expand new_data explicitly.</span>
<span class="c1"># Example:</span>
<span class="c1">#   data shape: [3, 4, 5]</span>
<span class="c1">#   new_data shape: [5]</span>
<span class="c1">#   expected new_data shape after broadcasting: [2, 2, 2, 5]</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="adding-support-for-operators">
<h2><a class="toc-backref" href="#id17" role="doc-backlink">Adding support for operators</a><a class="headerlink" href="#adding-support-for-operators" title="Permalink to this heading">¶</a></h2>
<p>When exporting a model that includes unsupported operators, you’ll see an error message like:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>RuntimeError: ONNX export failed: Couldn&#39;t export operator foo
</pre></div>
</div>
<p>When that happens, there are a few things you can do:</p>
<ol class="arabic simple">
<li><p>Change the model to not use that operator.</p></li>
<li><p>Create a symbolic function to convert the operator and register it as a custom symbolic function.</p></li>
<li><p>Contribute to PyTorch to add the same symbolic function to <a class="reference internal" href="#module-torch.onnx" title="torch.onnx"><code class="xref py py-mod docutils literal notranslate"><span class="pre">torch.onnx</span></code></a> itself.</p></li>
</ol>
<p>If you decided to implement a symbolic function (we hope you will contribute it back to PyTorch!), here is how you can get started:</p>
<section id="onnx-exporter-internals">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">ONNX exporter internals</a><a class="headerlink" href="#onnx-exporter-internals" title="Permalink to this heading">¶</a></h3>
<p>A “symbolic function” is a function that decomposes a PyTorch operator into a
composition of a series of ONNX operators.</p>
<p>During export, each node (which contains a PyTorch operator) in the TorchScript
graph is visited by the exporter in topological order.
Upon visiting a node, the exporter looks for a registered symbolic functions for
that operator. Symbolic functions are implemented in Python. A symbolic function for
an op named <code class="docutils literal notranslate"><span class="pre">foo</span></code> would look something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span>
  <span class="n">g</span><span class="p">,</span>
  <span class="n">input_0</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">Value</span><span class="p">,</span>
  <span class="n">input_1</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">Value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">Value</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">Value</span><span class="p">]]:</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Adds the ONNX operations representing this PyTorch function by updating the</span>
<span class="sd">  graph g with `g.op()` calls.</span>

<span class="sd">  Args:</span>
<span class="sd">    g (Graph): graph to write the ONNX representation into.</span>
<span class="sd">    input_0 (Value): value representing the variables which contain</span>
<span class="sd">        the first input for this operator.</span>
<span class="sd">    input_1 (Value): value representing the variables which contain</span>
<span class="sd">        the second input for this operator.</span>

<span class="sd">  Returns:</span>
<span class="sd">    A Value or List of Values specifying the ONNX nodes that compute something</span>
<span class="sd">    equivalent to the original PyTorch operator with the given inputs.</span>

<span class="sd">    None if it cannot be converted to ONNX.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">torch._C</span></code> types are Python wrappers around the types defined in C++ in
<a class="reference external" href="https://github.com/pytorch/pytorch/blob/master/torch/csrc/jit/ir/ir.h">ir.h</a>.</p>
<p>The process for adding a symbolic function depends on the type of operator.</p>
</section>
<section id="aten-operators">
<span id="adding-support-aten"></span><h3><a class="toc-backref" href="#id19" role="doc-backlink">ATen operators</a><a class="headerlink" href="#aten-operators" title="Permalink to this heading">¶</a></h3>
<p><a class="reference external" href="https://pytorch.org/cppdocs/#aten">ATen</a> is PyTorch’s built-in tensor library.
If the operator is an ATen operator (shows up in the TorchScript graph with the prefix
<code class="docutils literal notranslate"><span class="pre">aten::</span></code>), make sure it is not supported already.</p>
<section id="list-of-supported-operators">
<h4><a class="toc-backref" href="#id20" role="doc-backlink">List of supported operators</a><a class="headerlink" href="#list-of-supported-operators" title="Permalink to this heading">¶</a></h4>
<p>Visit the auto generated <a class="reference internal" href="onnx_supported_aten_ops.html"><span class="doc">list of supported TorchScript operators</span></a>
for details on which operator are supported in each <code class="docutils literal notranslate"><span class="pre">opset_version</span></code>.</p>
</section>
<section id="adding-support-for-an-aten-or-quantized-operator">
<h4><a class="toc-backref" href="#id21" role="doc-backlink">Adding support for an aten or quantized operator</a><a class="headerlink" href="#adding-support-for-an-aten-or-quantized-operator" title="Permalink to this heading">¶</a></h4>
<p>If the operator is not in the list above:</p>
<ul class="simple">
<li><p>Define the symbolic function in <code class="docutils literal notranslate"><span class="pre">torch/onnx/symbolic_opset&lt;version&gt;.py</span></code>, for example
<a class="reference external" href="https://github.com/pytorch/pytorch/blob/master/torch/onnx/symbolic_opset9.py">torch/onnx/symbolic_opset9.py</a>.
Make sure the function has the same name as the ATen function, which may be declared in
<code class="docutils literal notranslate"><span class="pre">torch/_C/_VariableFunctions.pyi</span></code> or <code class="docutils literal notranslate"><span class="pre">torch/nn/functional.pyi</span></code> (these files are generated at
build time, so will not appear in your checkout until you build PyTorch).</p></li>
<li><p>By default, the first arg is the ONNX graph.
Other arg names must EXACTLY match the names in the <code class="docutils literal notranslate"><span class="pre">.pyi</span></code> file,
because dispatch is done with keyword arguments.</p></li>
<li><p>In the symbolic function, if the operator is in the
<a class="reference external" href="https://github.com/onnx/onnx/blob/master/docs/Operators.md">ONNX standard operator set</a>,
we only need to create a node to represent the ONNX operator in the graph.
If not, we can compose several standard operators that have the
equivalent semantics to the ATen operator.</p></li>
</ul>
<p>Here is an example of handling missing symbolic function for the <code class="docutils literal notranslate"><span class="pre">ELU</span></code> operator.</p>
<p>If we run the following code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ELU</span><span class="p">(),</span> <span class="c1"># module</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># example input</span>
    <span class="p">)</span><span class="o">.</span><span class="n">graph</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We see something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="p">(</span><span class="o">%</span><span class="bp">self</span> <span class="p">:</span> <span class="n">__torch__</span><span class="o">.</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">activation</span><span class="o">.</span><span class="n">___torch_mangle_0</span><span class="o">.</span><span class="n">ELU</span><span class="p">,</span>
      <span class="o">%</span><span class="nb">input</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">requires_grad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">cpu</span><span class="p">)):</span>
  <span class="o">%</span><span class="mi">4</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="mf">1.</span><span class="p">]()</span>
  <span class="o">%</span><span class="mi">5</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">]()</span>
  <span class="o">%</span><span class="mi">6</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">]()</span>
  <span class="o">%</span><span class="mi">7</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">requires_grad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">cpu</span><span class="p">)</span> <span class="o">=</span> <span class="n">aten</span><span class="p">::</span><span class="n">elu</span><span class="p">(</span><span class="o">%</span><span class="nb">input</span><span class="p">,</span> <span class="o">%</span><span class="mi">4</span><span class="p">,</span> <span class="o">%</span><span class="mi">5</span><span class="p">,</span> <span class="o">%</span><span class="mi">6</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span><span class="o">%</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
<p>Since we see <code class="docutils literal notranslate"><span class="pre">aten::elu</span></code> in the graph, we know this is an ATen operator.</p>
<p>We check the <a class="reference external" href="https://github.com/onnx/onnx/blob/master/docs/Operators.md">ONNX operator list</a>,
and confirm that <code class="docutils literal notranslate"><span class="pre">Elu</span></code> is standardized in ONNX.</p>
<p>We find a signature for <code class="docutils literal notranslate"><span class="pre">elu</span></code> in <code class="docutils literal notranslate"><span class="pre">torch/nn/functional.pyi</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">elu</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span> <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span> <span class="o">...</span>
</pre></div>
</div>
<p>We add the following lines to <code class="docutils literal notranslate"><span class="pre">symbolic_opset9.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">elu</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Value</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Value</span><span class="p">,</span> <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="s2">&quot;Elu&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">alpha_f</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
</pre></div>
</div>
<p>Now PyTorch is able to export models containing the <code class="docutils literal notranslate"><span class="pre">aten::elu</span></code> operator!</p>
<p>See the <code class="docutils literal notranslate"><span class="pre">torch/onnx/symbolic_opset*.py</span></code> files for more examples.</p>
</section>
</section>
<section id="torch-autograd-functions">
<h3><a class="toc-backref" href="#id22" role="doc-backlink">torch.autograd.Functions</a><a class="headerlink" href="#torch-autograd-functions" title="Permalink to this heading">¶</a></h3>
<p>If the operator is a sub-class of <a class="reference internal" href="autograd.html#torch.autograd.Function" title="torch.autograd.Function"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.autograd.Function</span></code></a>, there are three ways
to export it.</p>
<section id="static-symbolic-method">
<h4><a class="toc-backref" href="#id23" role="doc-backlink">Static Symbolic Method</a><a class="headerlink" href="#static-symbolic-method" title="Permalink to this heading">¶</a></h4>
<p>You can add a static method named <code class="docutils literal notranslate"><span class="pre">symbolic</span></code> to your function class. It should return
ONNX operators that represent the function’s behavior in ONNX. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyRelu</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Function</span><span class="p">):</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">save_for_backward</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">input</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">symbolic</span><span class="p">(</span><span class="n">g</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Value</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="s2">&quot;Clip&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="s2">&quot;Constant&quot;</span><span class="p">,</span> <span class="n">value_t</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)))</span>
</pre></div>
</div>
</section>
<section id="inline-autograd-function">
<h4><a class="toc-backref" href="#id24" role="doc-backlink">Inline Autograd Function</a><a class="headerlink" href="#inline-autograd-function" title="Permalink to this heading">¶</a></h4>
<p>In cases where a static symbolic method is not provided for its subsequent <a class="reference internal" href="autograd.html#torch.autograd.Function" title="torch.autograd.Function"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.autograd.Function</span></code></a> or
where a function to register <code class="docutils literal notranslate"><span class="pre">prim::PythonOp</span></code> as custom symbolic functions is not provided,
<a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.onnx.export()</span></code></a> tries to inline the graph that corresponds to that <a class="reference internal" href="autograd.html#torch.autograd.Function" title="torch.autograd.Function"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.autograd.Function</span></code></a> such that
this function is broken down into individual operators that were used within the function.
The export should be successful as long as these individual operators are supported. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyLogExp</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Function</span><span class="p">):</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">save_for_backward</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">h</span><span class="o">.</span><span class="n">log</span><span class="p">()</span><span class="o">.</span><span class="n">log</span><span class="p">()</span>
</pre></div>
</div>
<p>There is no static symbolic method present for this model, yet it is exported as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="p">(</span><span class="o">%</span><span class="nb">input</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">requires_grad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">cpu</span><span class="p">)):</span>
    <span class="o">%</span><span class="mi">1</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Exp</span><span class="p">[](</span><span class="o">%</span><span class="nb">input</span><span class="p">)</span>
    <span class="o">%</span><span class="mi">2</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Log</span><span class="p">[](</span><span class="o">%</span><span class="mi">1</span><span class="p">)</span>
    <span class="o">%</span><span class="mi">3</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Log</span><span class="p">[](</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="o">%</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>If you need to avoid inlining of <a class="reference internal" href="autograd.html#torch.autograd.Function" title="torch.autograd.Function"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.autograd.Function</span></code></a>, you should export models with
<code class="docutils literal notranslate"><span class="pre">operator_export_type</span></code> set to <code class="docutils literal notranslate"><span class="pre">ONNX_FALLTHROUGH</span></code> or <code class="docutils literal notranslate"><span class="pre">ONNX_ATEN_FALLBACK</span></code>.</p>
</section>
</section>
<section id="custom-operators">
<h3><a class="toc-backref" href="#id25" role="doc-backlink">Custom operators</a><a class="headerlink" href="#custom-operators" title="Permalink to this heading">¶</a></h3>
<p>You can export your model with custom operators that includes a combination of many standard ONNX ops,
or are driven by self-defined C++ backend.</p>
<section id="onnx-script-functions">
<h4><a class="toc-backref" href="#id26" role="doc-backlink">ONNX-script functions</a><a class="headerlink" href="#onnx-script-functions" title="Permalink to this heading">¶</a></h4>
<p>If an operator is not a standard ONNX op, but can be composed of multiple existing ONNX ops, you can utilize
<a class="reference external" href="https://github.com/microsoft/onnx-script">ONNX-script</a> to create an external ONNX function to support the operator.
You can export it by following this example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">onnxscript</span>
<span class="c1"># There are three opset version needed to be aligned</span>
<span class="c1"># This is (1) the opset version in ONNX function</span>
<span class="kn">from</span> <span class="nn">onnxscript.onnx_opset</span> <span class="kn">import</span> <span class="n">opset15</span> <span class="k">as</span> <span class="n">op</span>
<span class="n">opset_version</span> <span class="o">=</span> <span class="mi">15</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">SELU</span><span class="p">()</span>

<span class="n">custom_opset</span> <span class="o">=</span> <span class="n">onnxscript</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">Opset</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="s2">&quot;onnx-script&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="nd">@onnxscript</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">custom_opset</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">Selu</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.67326</span>  <span class="c1"># auto wrapped as Constants</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="mf">1.0507</span>
    <span class="n">alphaX</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">CastLike</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
    <span class="n">gammaX</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">CastLike</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
    <span class="n">neg</span> <span class="o">=</span> <span class="n">gammaX</span> <span class="o">*</span> <span class="p">(</span><span class="n">alphaX</span> <span class="o">*</span> <span class="n">op</span><span class="o">.</span><span class="n">Exp</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">-</span> <span class="n">alphaX</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">gammaX</span> <span class="o">*</span> <span class="n">X</span>
    <span class="n">zero</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">CastLike</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">op</span><span class="o">.</span><span class="n">Where</span><span class="p">(</span><span class="n">X</span> <span class="o">&lt;=</span> <span class="n">zero</span><span class="p">,</span> <span class="n">neg</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>

<span class="c1"># setType API provides shape/type to ONNX shape/type inference</span>
<span class="k">def</span> <span class="nf">custom_selu</span><span class="p">(</span><span class="n">g</span><span class="p">:</span> <span class="n">jit_utils</span><span class="o">.</span><span class="n">GraphContext</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">onnxscript_op</span><span class="p">(</span><span class="n">Selu</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">type</span><span class="p">())</span>

<span class="c1"># Register custom symbolic function</span>
<span class="c1"># There are three opset version needed to be aligned</span>
<span class="c1"># This is (2) the opset version in registry</span>
<span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">register_custom_op_symbolic</span><span class="p">(</span>
    <span class="n">symbolic_name</span><span class="o">=</span><span class="s2">&quot;aten::selu&quot;</span><span class="p">,</span>
    <span class="n">symbolic_fn</span><span class="o">=</span><span class="n">custom_selu</span><span class="p">,</span>
    <span class="n">opset_version</span><span class="o">=</span><span class="n">opset_version</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># There are three opset version needed to be aligned</span>
<span class="c1"># This is (2) the opset version in exporter</span>
<span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">export</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="s2">&quot;model.onnx&quot;</span><span class="p">,</span>
    <span class="n">opset_version</span><span class="o">=</span><span class="n">opset_version</span><span class="p">,</span>
    <span class="c1"># only needed if you want to specify an opset version &gt; 1.</span>
    <span class="n">custom_opsets</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;onnx-script&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The example above exports it as a custom operator in the “onnx-script” opset.
When exporting a custom operator, you can specify the custom domain version using the
<code class="docutils literal notranslate"><span class="pre">custom_opsets</span></code> dictionary at export. If not specified, the custom opset version defaults to 1.</p>
<p>NOTE: Be careful to align the opset version mentioned in the above example, and make sure they are consumed in exporter step.
The example usage of how to write a onnx-script function is a beta version in terms of the active development on onnx-script.
Please follow the latest <a class="reference external" href="https://github.com/microsoft/onnx-script">ONNX-script</a></p>
</section>
<section id="c-operators">
<h4><a class="toc-backref" href="#id27" role="doc-backlink">C++ Operators</a><a class="headerlink" href="#c-operators" title="Permalink to this heading">¶</a></h4>
<p>If a model uses a custom operator implemented in C++ as described in
<a class="reference external" href="https://pytorch.org/tutorials/advanced/torch_script_custom_ops.html">Extending TorchScript with Custom C++ Operators</a>,
you can export it by following this example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">torch.onnx</span> <span class="kn">import</span> <span class="n">symbolic_helper</span>


<span class="c1"># Define custom symbolic function</span>
<span class="nd">@symbolic_helper</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">symbolic_foo_forward</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">input1</span><span class="p">,</span> <span class="n">input2</span><span class="p">,</span> <span class="n">attr1</span><span class="p">,</span> <span class="n">attr2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="s2">&quot;custom_domain::Foo&quot;</span><span class="p">,</span> <span class="n">input1</span><span class="p">,</span> <span class="n">input2</span><span class="p">,</span> <span class="n">attr1_f</span><span class="o">=</span><span class="n">attr1</span><span class="p">,</span> <span class="n">attr2_i</span><span class="o">=</span><span class="n">attr2</span><span class="p">)</span>


<span class="c1"># Register custom symbolic function</span>
<span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">register_custom_op_symbolic</span><span class="p">(</span><span class="s2">&quot;custom_ops::foo_forward&quot;</span><span class="p">,</span> <span class="n">symbolic_foo_forward</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FooModel</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr1</span><span class="p">,</span> <span class="n">attr2</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr1</span> <span class="o">=</span> <span class="n">attr1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr2</span> <span class="o">=</span> <span class="n">attr2</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input1</span><span class="p">,</span> <span class="n">input2</span><span class="p">):</span>
        <span class="c1"># Calling custom op</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">custom_ops</span><span class="o">.</span><span class="n">foo_forward</span><span class="p">(</span><span class="n">input1</span><span class="p">,</span> <span class="n">input2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr2</span><span class="p">)</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">FooModel</span><span class="p">(</span><span class="n">attr1</span><span class="p">,</span> <span class="n">attr2</span><span class="p">)</span>
<span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">export</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="p">(</span><span class="n">example_input1</span><span class="p">,</span> <span class="n">example_input1</span><span class="p">),</span>
    <span class="s2">&quot;model.onnx&quot;</span><span class="p">,</span>
    <span class="c1"># only needed if you want to specify an opset version &gt; 1.</span>
    <span class="n">custom_opsets</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;custom_domain&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The example above exports it as a custom operator in the “custom_domain” opset.
When exporting a custom operator, you can specify the custom domain version using the
<code class="docutils literal notranslate"><span class="pre">custom_opsets</span></code> dictionary at export. If not specified, the custom opset version defaults to 1.</p>
<p>The runtime that consumes the model needs to support the custom op. See
<a class="reference external" href="https://caffe2.ai/docs/custom-operators.html">Caffe2 custom ops</a>,
<a class="reference external" href="https://onnxruntime.ai/docs/reference/operators/add-custom-op.html">ONNX Runtime custom ops</a>,
or your runtime of choice’s documentation.</p>
</section>
</section>
<section id="discovering-all-unconvertible-aten-ops-at-once">
<h3><a class="toc-backref" href="#id28" role="doc-backlink">Discovering all unconvertible ATen ops at once</a><a class="headerlink" href="#discovering-all-unconvertible-aten-ops-at-once" title="Permalink to this heading">¶</a></h3>
<p>When export fails due to an unconvertible ATen op, there may in fact be more
than one such op but the error message only mentions the first. To discover
all of the unconvertible ops in one go you can:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># prepare model, args, opset_version</span>
<span class="o">...</span>

<span class="n">torch_script_graph</span><span class="p">,</span> <span class="n">unconvertible_ops</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">unconvertible_ops</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">opset_version</span><span class="o">=</span><span class="n">opset_version</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">unconvertible_ops</span><span class="p">))</span>
</pre></div>
</div>
<p>The set is approximated because some ops may be removed during the conversion
process and don’t need to be converted. Some other ops may have partial support
that will fail conversion with particular inputs, but this should give you a
general idea of what ops are not supported. Please feel free to open GitHub Issues
for op support requests.</p>
</section>
</section>
<section id="frequently-asked-questions">
<h2><a class="toc-backref" href="#id29" role="doc-backlink">Frequently Asked Questions</a><a class="headerlink" href="#frequently-asked-questions" title="Permalink to this heading">¶</a></h2>
<p>Q: I have exported my LSTM model, but its input size seems to be fixed?</p>
<blockquote>
<div><p>The tracer records the shapes of the example inputs. If the model should accept
inputs of dynamic shapes, set <code class="docutils literal notranslate"><span class="pre">dynamic_axes</span></code> when calling <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.onnx.export()</span></code></a>.</p>
</div></blockquote>
<p>Q: How to export models containing loops?</p>
<blockquote>
<div><p>See <a class="reference internal" href="#id2">Tracing vs Scripting</a>.</p>
</div></blockquote>
<p>Q: How to export models with primitive type inputs (e.g. int, float)?</p>
<blockquote>
<div><p>Support for primitive numeric type inputs was added in PyTorch 1.9.
However, the exporter does not support models with str inputs.</p>
</div></blockquote>
<p>Q: Does ONNX support implicit scalar datatype casting?</p>
<blockquote>
<div><p>The ONNX standard does not, but the exporter will try to handle that part.
Scalars are exported as constant tensors.
The exporter will figure out the right data type for scalars. In rare cases when it is unable
to do so, you will need to manually specify the datatype with e.g. <cite>dtype=torch.float32</cite>.
If you see any errors, please [create a GitHub issue](<a class="reference external" href="https://github.com/pytorch/pytorch/issues">https://github.com/pytorch/pytorch/issues</a>).</p>
</div></blockquote>
<p>Q: Are lists of Tensors exportable to ONNX?</p>
<blockquote>
<div><p>Yes, for <code class="docutils literal notranslate"><span class="pre">opset_version</span></code> &gt;= 11, since ONNX introduced the Sequence type in opset 11.</p>
</div></blockquote>
</section>
<section id="contributing-developing">
<h2><a class="toc-backref" href="#id30" role="doc-backlink">Contributing / developing</a><a class="headerlink" href="#contributing-developing" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="https://github.com/pytorch/pytorch/wiki/PyTorch-ONNX-exporter">Developer docs</a>.</p>
</section>
<section id="functions">
<h2><a class="toc-backref" href="#id31" role="doc-backlink">Functions</a><a class="headerlink" href="#functions" title="Permalink to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="torch.onnx.export">
<span class="sig-prename descclassname"><span class="pre">torch.onnx.</span></span><span class="sig-name descname"><span class="pre">export</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">f</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">export_params=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">training=&lt;TrainingMode.EVAL:</span> <span class="pre">0&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_names=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_names=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">operator_export_type=&lt;OperatorExportTypes.ONNX:</span> <span class="pre">0&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opset_version=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_constant_folding=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dynamic_axes=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep_initializers_as_inputs=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_opsets=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">export_modules_as_functions=False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/onnx/utils.html#export"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.onnx.export" title="Permalink to this definition">¶</a></dt>
<dd><p>Exports a model into ONNX format.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">model</span></code> is not a <a class="reference internal" href="generated/torch.jit.ScriptModule.html#torch.jit.ScriptModule" title="torch.jit.ScriptModule"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.jit.ScriptModule</span></code></a> nor a
<a class="reference internal" href="generated/torch.jit.ScriptFunction.html#torch.jit.ScriptFunction" title="torch.jit.ScriptFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.jit.ScriptFunction</span></code></a>, this runs
<code class="docutils literal notranslate"><span class="pre">model</span></code> once in order to convert it to a TorchScript graph to be exported
(the equivalent of <a class="reference internal" href="generated/torch.jit.trace.html#torch.jit.trace" title="torch.jit.trace"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.jit.trace()</span></code></a>). Thus this has the same limited support
for dynamic control flow as <a class="reference internal" href="generated/torch.jit.trace.html#torch.jit.trace" title="torch.jit.trace"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.jit.trace()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<a class="reference internal" href="generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.Module</span></code></a>, <a class="reference internal" href="generated/torch.jit.ScriptModule.html#torch.jit.ScriptModule" title="torch.jit.ScriptModule"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.jit.ScriptModule</span></code></a> or <a class="reference internal" href="generated/torch.jit.ScriptFunction.html#torch.jit.ScriptFunction" title="torch.jit.ScriptFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.jit.ScriptFunction</span></code></a>) – the model to be exported.</p></li>
<li><p><strong>args</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.11)"><em>tuple</em></a><em> or </em><a class="reference internal" href="tensors.html#torch.Tensor" title="torch.Tensor"><em>torch.Tensor</em></a>) – <p>args can be structured either as:</p>
<ol class="arabic">
<li><p>ONLY A TUPLE OF ARGUMENTS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<p>The tuple should contain model inputs such that <code class="docutils literal notranslate"><span class="pre">model(*args)</span></code> is a valid
invocation of the model. Any non-Tensor arguments will be hard-coded into the
exported model; any Tensor arguments will become inputs of the exported model,
in the order they occur in the tuple.</p>
<ol class="arabic" start="2">
<li><p>A TENSOR:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">args</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</li>
</ol>
<p>This is equivalent to a 1-ary tuple of that Tensor.</p>
<ol class="arabic" start="3">
<li><p>A TUPLE OF ARGUMENTS ENDING WITH A DICTIONARY OF NAMED ARGUMENTS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">input_y</span><span class="p">,</span>
        <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">input_z</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<p>All but the last element of the tuple will be passed as non-keyword arguments,
and named arguments will be set from the last element. If a named argument is
not present in the dictionary, it is assigned the default value, or None if a
default value is not provided.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a dictionary is the last element of the args tuple, it will be
interpreted as containing named arguments. In order to pass a dict as the
last non-keyword arg, provide an empty dict as the last element of the args
tuple. For example, instead of:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">export</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="p">(</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="c1"># WRONG: will be interpreted as named arguments</span>
        <span class="p">{</span><span class="n">y</span><span class="p">:</span> <span class="n">z</span><span class="p">}</span>
    <span class="p">),</span>
    <span class="s2">&quot;test.onnx.pb&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Write:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">export</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="p">(</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="p">{</span><span class="n">y</span><span class="p">:</span> <span class="n">z</span><span class="p">},</span>
        <span class="p">{}</span>
    <span class="p">),</span>
    <span class="s2">&quot;test.onnx.pb&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</p></li>
<li><p><strong>f</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.11)"><em>Union</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><em>str</em></a><em>, </em><em>BytesIO</em><em>]</em>) – a file-like object (such that <code class="docutils literal notranslate"><span class="pre">f.fileno()</span></code> returns a file descriptor)
or a string containing a file name.  A binary protocol buffer will be written
to this file.</p></li>
<li><p><strong>export_params</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><em>bool</em></a><em>, </em><em>default True</em>) – if True, all parameters will
be exported. Set this to False if you want to export an untrained model.
In this case, the exported model will first take all of its parameters
as arguments, with the ordering as specified by <code class="docutils literal notranslate"><span class="pre">model.state_dict().values()</span></code></p></li>
<li><p><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><em>bool</em></a><em>, </em><em>default False</em>) – if True, prints a description of the
model being exported to stdout. In addition, the final ONNX graph will include the
field <code class="docutils literal notranslate"><span class="pre">doc_string`</span></code> from the exported model which mentions the source code locations
for <code class="docutils literal notranslate"><span class="pre">model</span></code>. If True, ONNX exporter logging will be turned on.</p></li>
<li><p><strong>training</strong> (<em>enum</em><em>, </em><em>default TrainingMode.EVAL</em>) – <ul>
<li><p><code class="docutils literal notranslate"><span class="pre">TrainingMode.EVAL</span></code>: export the model in inference mode.</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">TrainingMode.PRESERVE</span></code>: export the model in inference mode if model.training is</dt><dd><p>False and in training mode if model.training is True.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">TrainingMode.TRAINING</span></code>: export the model in training mode. Disables optimizations</dt><dd><p>which might interfere with training.</p>
</dd>
</dl>
</li>
</ul>
</p></li>
<li><p><strong>input_names</strong> (<em>list of str</em><em>, </em><em>default empty list</em>) – names to assign to the
input nodes of the graph, in order.</p></li>
<li><p><strong>output_names</strong> (<em>list of str</em><em>, </em><em>default empty list</em>) – names to assign to the
output nodes of the graph, in order.</p></li>
<li><p><strong>operator_export_type</strong> (<em>enum</em><em>, </em><em>default OperatorExportTypes.ONNX</em>) – <ul>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">OperatorExportTypes.ONNX</span></code>: Export all ops as regular ONNX ops</dt><dd><p>(in the default opset domain).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">OperatorExportTypes.ONNX_FALLTHROUGH</span></code>: Try to convert all ops</dt><dd><p>to standard ONNX ops in the default opset domain. If unable to do so
(e.g. because support has not been added to convert a particular torch op to ONNX),
fall back to exporting the op into a custom opset domain without conversion. Applies
to <a class="reference external" href="https://pytorch.org/tutorials/advanced/torch_script_custom_ops.html">custom ops</a>
as well as ATen ops. For the exported model to be usable, the runtime must support
these non-standard ops.</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">OperatorExportTypes.ONNX_ATEN</span></code>: All ATen ops (in the TorchScript namespace “aten”)</dt><dd><p>are exported as ATen ops (in opset domain “org.pytorch.aten”).
<a class="reference external" href="https://pytorch.org/cppdocs/#aten">ATen</a> is PyTorch’s built-in tensor library, so
this instructs the runtime to use PyTorch’s implementation of these ops.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Models exported this way are probably runnable only by Caffe2.</p>
<p>This may be useful if the numeric differences in implementations of operators are
causing large differences in behavior between PyTorch and Caffe2 (which is more
common on untrained models).</p>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">OperatorExportTypes.ONNX_ATEN_FALLBACK</span></code>: Try to export each ATen op</dt><dd><p>(in the TorchScript namespace “aten”) as a regular ONNX op. If we are unable to do so
(e.g. because support has not been added to convert a particular torch op to ONNX),
fall back to exporting an ATen op. See documentation on OperatorExportTypes.ONNX_ATEN for
context.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="p">(</span><span class="o">%</span><span class="mi">0</span> <span class="p">:</span> <span class="n">Float</span><span class="p">):</span>
<span class="o">%</span><span class="mi">3</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">]()</span>
<span class="c1"># conversion unsupported</span>
<span class="o">%</span><span class="mi">4</span> <span class="p">:</span> <span class="n">Float</span> <span class="o">=</span> <span class="n">aten</span><span class="p">::</span><span class="n">triu</span><span class="p">(</span><span class="o">%</span><span class="mi">0</span><span class="p">,</span> <span class="o">%</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># conversion supported</span>
<span class="o">%</span><span class="mi">5</span> <span class="p">:</span> <span class="n">Float</span> <span class="o">=</span> <span class="n">aten</span><span class="p">::</span><span class="n">mul</span><span class="p">(</span><span class="o">%</span><span class="mi">4</span><span class="p">,</span> <span class="o">%</span><span class="mi">0</span><span class="p">)</span>
<span class="k">return</span> <span class="p">(</span><span class="o">%</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>Assuming <code class="docutils literal notranslate"><span class="pre">aten::triu</span></code> is not supported in ONNX, this will be exported as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="p">(</span><span class="o">%</span><span class="mi">0</span> <span class="p">:</span> <span class="n">Float</span><span class="p">):</span>
<span class="o">%</span><span class="mi">1</span> <span class="p">:</span> <span class="n">Long</span><span class="p">()</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">}]()</span>
<span class="c1"># not converted</span>
<span class="o">%</span><span class="mi">2</span> <span class="p">:</span> <span class="n">Float</span> <span class="o">=</span> <span class="n">aten</span><span class="p">::</span><span class="n">ATen</span><span class="p">[</span><span class="n">operator</span><span class="o">=</span><span class="s2">&quot;triu&quot;</span><span class="p">](</span><span class="o">%</span><span class="mi">0</span><span class="p">,</span> <span class="o">%</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># converted</span>
<span class="o">%</span><span class="mi">3</span> <span class="p">:</span> <span class="n">Float</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Mul</span><span class="p">(</span><span class="o">%</span><span class="mi">2</span><span class="p">,</span> <span class="o">%</span><span class="mi">0</span><span class="p">)</span>
<span class="k">return</span> <span class="p">(</span><span class="o">%</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>If PyTorch was built with Caffe2 (i.e. with <code class="docutils literal notranslate"><span class="pre">BUILD_CAFFE2=1</span></code>), then
Caffe2-specific behavior will be enabled, including special support
for ops are produced by the modules described in
<a class="reference external" href="https://pytorch.org/docs/stable/quantization.html">Quantization</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Models exported this way are probably runnable only by Caffe2.</p>
</div>
</dd>
</dl>
</li>
</ul>
</p></li>
<li><p><strong>opset_version</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><em>int</em></a><em>, </em><em>default 14</em>) – The version of the
<a class="reference external" href="https://github.com/onnx/onnx/blob/master/docs/Operators.md">default (ai.onnx) opset</a>
to target. Must be &gt;= 7 and &lt;= 16.</p></li>
<li><p><strong>do_constant_folding</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><em>bool</em></a><em>, </em><em>default True</em>) – Apply the constant-folding optimization.
Constant-folding will replace some of the ops that have all constant inputs
with pre-computed constant nodes.</p></li>
<li><p><strong>dynamic_axes</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)"><em>dict</em></a><em>[</em><em>string</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)"><em>dict</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><em>int</em></a><em>, </em><em>string</em><em>]</em><em>] or </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)"><em>dict</em></a><em>[</em><em>string</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.11)"><em>list</em></a><em>(</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><em>int</em></a><em>)</em><em>]</em><em>, </em><em>default empty dict</em>) – <p>By default the exported model will have the shapes of all input and output tensors
set to exactly match those given in <code class="docutils literal notranslate"><span class="pre">args</span></code>. To specify axes of tensors as
dynamic (i.e. known only at run-time), set <code class="docutils literal notranslate"><span class="pre">dynamic_axes</span></code> to a dict with schema:</p>
<ul>
<li><dl class="simple">
<dt>KEY (str): an input or output name. Each name must also be provided in <code class="docutils literal notranslate"><span class="pre">input_names</span></code> or</dt><dd><p><code class="docutils literal notranslate"><span class="pre">output_names</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>VALUE (dict or list): If a dict, keys are axis indices and values are axis names. If a</dt><dd><p>list, each element is an axis index.</p>
</dd>
</dl>
</li>
</ul>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SumModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">export</span><span class="p">(</span>
    <span class="n">SumModule</span><span class="p">(),</span>
    <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),),</span>
    <span class="s2">&quot;onnx.pb&quot;</span><span class="p">,</span>
    <span class="n">input_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
    <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sum&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Produces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">input</span> <span class="p">{</span>
  <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;x&quot;</span>
  <span class="o">...</span>
      <span class="n">shape</span> <span class="p">{</span>
        <span class="n">dim</span> <span class="p">{</span>
          <span class="n">dim_value</span><span class="p">:</span> <span class="mi">2</span>  <span class="c1"># axis 0</span>
        <span class="p">}</span>
        <span class="n">dim</span> <span class="p">{</span>
          <span class="n">dim_value</span><span class="p">:</span> <span class="mi">2</span>  <span class="c1"># axis 1</span>
<span class="o">...</span>
<span class="n">output</span> <span class="p">{</span>
  <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span>
  <span class="o">...</span>
      <span class="n">shape</span> <span class="p">{</span>
        <span class="n">dim</span> <span class="p">{</span>
          <span class="n">dim_value</span><span class="p">:</span> <span class="mi">2</span>  <span class="c1"># axis 0</span>
<span class="o">...</span>
</pre></div>
</div>
<p>While:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">export</span><span class="p">(</span>
    <span class="n">SumModule</span><span class="p">(),</span>
    <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),),</span>
    <span class="s2">&quot;onnx.pb&quot;</span><span class="p">,</span>
    <span class="n">input_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
    <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sum&quot;</span><span class="p">],</span>
    <span class="n">dynamic_axes</span><span class="o">=</span><span class="p">{</span>
        <span class="c1"># dict value: manually named axes</span>
        <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;my_custom_axis_name&quot;</span><span class="p">},</span>
        <span class="c1"># list value: automatic names</span>
        <span class="s2">&quot;sum&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Produces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">input</span> <span class="p">{</span>
  <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;x&quot;</span>
  <span class="o">...</span>
      <span class="n">shape</span> <span class="p">{</span>
        <span class="n">dim</span> <span class="p">{</span>
          <span class="n">dim_param</span><span class="p">:</span> <span class="s2">&quot;my_custom_axis_name&quot;</span>  <span class="c1"># axis 0</span>
        <span class="p">}</span>
        <span class="n">dim</span> <span class="p">{</span>
          <span class="n">dim_value</span><span class="p">:</span> <span class="mi">2</span>  <span class="c1"># axis 1</span>
<span class="o">...</span>
<span class="n">output</span> <span class="p">{</span>
  <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span>
  <span class="o">...</span>
      <span class="n">shape</span> <span class="p">{</span>
        <span class="n">dim</span> <span class="p">{</span>
          <span class="n">dim_param</span><span class="p">:</span> <span class="s2">&quot;sum_dynamic_axes_1&quot;</span>  <span class="c1"># axis 0</span>
<span class="o">...</span>
</pre></div>
</div>
</p></li>
<li><p><strong>keep_initializers_as_inputs</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><em>bool</em></a><em>, </em><em>default None</em>) – <p>If True, all the
initializers (typically corresponding to parameters) in the
exported graph will also be added as inputs to the graph. If False,
then initializers are not added as inputs to the graph, and only
the non-parameter inputs are added as inputs.
This may allow for better optimizations (e.g. constant folding) by
backends/runtimes.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">opset_version</span> <span class="pre">&lt;</span> <span class="pre">9</span></code>, initializers MUST be part of graph
inputs and this argument will be ignored and the behavior will be
equivalent to setting this argument to True.</p>
<p>If None, then the behavior is chosen automatically as follows:</p>
<ul>
<li><dl class="simple">
<dt>If <code class="docutils literal notranslate"><span class="pre">operator_export_type=OperatorExportTypes.ONNX</span></code>, the behavior is equivalent</dt><dd><p>to setting this argument to False.</p>
</dd>
</dl>
</li>
<li><p>Else, the behavior is equivalent to setting this argument to True.</p></li>
</ul>
</p></li>
<li><p><strong>custom_opsets</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)"><em>dict</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><em>str</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><em>int</em></a><em>]</em><em>, </em><em>default empty dict</em>) – <p>A dict with schema:</p>
<ul>
<li><p>KEY (str): opset domain name</p></li>
<li><p>VALUE (int): opset version</p></li>
</ul>
<p>If a custom opset is referenced by <code class="docutils literal notranslate"><span class="pre">model</span></code> but not mentioned in this dictionary,
the opset version is set to 1. Only custom opset domain name and version should be
indicated through this argument.</p>
</p></li>
<li><p><strong>export_modules_as_functions</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><em>bool</em></a><em> or </em><em>set of python:type of nn.Module</em><em>, </em><em>default False</em>) – <p>Flag to enable
exporting all <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code> forward calls as local functions in ONNX. Or a set to indicate the
particular types of modules to export as local functions in ONNX.
This feature requires <code class="docutils literal notranslate"><span class="pre">opset_version</span></code> &gt;= 15, otherwise the export will fail. This is because
<code class="docutils literal notranslate"><span class="pre">opset_version</span></code> &lt; 15 implies IR version &lt; 8, which means no local function support.
Module variables will be exported as function attributes. There are two categories of function
attributes.</p>
<p>1. Annotated attributes: class variables that have type annotations via
<a class="reference external" href="https://www.python.org/dev/peps/pep-0526/#class-and-instance-variable-annotations">PEP 526-style</a>
will be exported as attributes.
Annotated attributes are not used inside the subgraph of ONNX local function because
they are not created by PyTorch JIT tracing, but they may be used by consumers
to determine whether or not to replace the function with a particular fused kernel.</p>
<p>2. Inferred attributes: variables that are used by operators inside the module. Attribute names
will have prefix “inferred::”. This is to differentiate from predefined attributes retrieved from
python module annotations. Inferred attributes are used inside the subgraph of ONNX local function.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">False</span></code> (default): export <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code> forward calls as fine grained nodes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">True</span></code>: export all <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code> forward calls as local function nodes.</p></li>
<li><dl class="simple">
<dt>Set of type of nn.Module: export <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code> forward calls as local function nodes,</dt><dd><p>only if the type of the <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code> is found in the set.</p>
</dd>
</dl>
</li>
</ul>
</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>torch.onnx.errors.CheckerError</strong> – If the ONNX checker detects an invalid ONNX graph.</p></li>
<li><p><strong>torch.onnx.errors.UnsupportedOperatorError</strong> – If the ONNX graph cannot be exported because it
    uses an operator that is not supported by the exporter.</p></li>
<li><p><strong>torch.onnx.errors.OnnxExporterError</strong> – Other errors that can occur during export.
    All errors are subclasses of <code class="xref py py-class docutils literal notranslate"><span class="pre">errors.OnnxExporterError</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="torch.onnx.export_to_pretty_string">
<span class="sig-prename descclassname"><span class="pre">torch.onnx.</span></span><span class="sig-name descname"><span class="pre">export_to_pretty_string</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">export_params=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">training=&lt;TrainingMode.EVAL:</span> <span class="pre">0&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_names=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_names=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">operator_export_type=&lt;OperatorExportTypes.ONNX:</span> <span class="pre">0&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">export_type=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">google_printer=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opset_version=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep_initializers_as_inputs=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_opsets=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">add_node_names=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_constant_folding=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dynamic_axes=None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/onnx/utils.html#export_to_pretty_string"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.onnx.export_to_pretty_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Similar to <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">export()</span></code></a>, but returns a text representation of the ONNX
model. Only differences in args listed below. All other args are the same
as <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">export()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>add_node_names</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><em>bool</em></a><em>, </em><em>default True</em>) – Whether or not to set
NodeProto.name. This makes no difference unless
<code class="docutils literal notranslate"><span class="pre">google_printer=True</span></code>.</p></li>
<li><p><strong>google_printer</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><em>bool</em></a><em>, </em><em>default False</em>) – If False, will return a custom,
compact representation of the model. If True will return the
protobuf’s <cite>Message::DebugString()</cite>, which is more verbose.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A UTF-8 str containing a human-readable representation of the ONNX model.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="torch.onnx.register_custom_op_symbolic">
<span class="sig-prename descclassname"><span class="pre">torch.onnx.</span></span><span class="sig-name descname"><span class="pre">register_custom_op_symbolic</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbolic_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">symbolic_fn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opset_version</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/onnx/utils.html#register_custom_op_symbolic"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.onnx.register_custom_op_symbolic" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers a symbolic function for a custom operator.</p>
<p>When the user registers symbolic for custom/contrib ops,
it is highly recommended to add shape inference for that operator via setType API,
otherwise the exported graph may have incorrect shape inference in some extreme cases.
An example of setType is <cite>test_aten_embedding_2</cite> in <cite>test_operators.py</cite>.</p>
<p>See “Custom Operators” in the module documentation for an example usage.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>symbolic_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><em>str</em></a>) – The name of the custom operator in “&lt;domain&gt;::&lt;op&gt;”
format.</p></li>
<li><p><strong>symbolic_fn</strong> (<em>Callable</em>) – A function that takes in the ONNX graph and
the input arguments to the current operator, and returns new
operator nodes to add to the graph.</p></li>
<li><p><strong>opset_version</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><em>int</em></a>) – The ONNX opset version in which to register.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="torch.onnx.unregister_custom_op_symbolic">
<span class="sig-prename descclassname"><span class="pre">torch.onnx.</span></span><span class="sig-name descname"><span class="pre">unregister_custom_op_symbolic</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbolic_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opset_version</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/onnx/utils.html#unregister_custom_op_symbolic"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.onnx.unregister_custom_op_symbolic" title="Permalink to this definition">¶</a></dt>
<dd><p>Unregisters <code class="docutils literal notranslate"><span class="pre">symbolic_name</span></code>.</p>
<p>See “Custom Operators” in the module documentation for an example usage.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>symbolic_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><em>str</em></a>) – The name of the custom operator in “&lt;domain&gt;::&lt;op&gt;”
format.</p></li>
<li><p><strong>opset_version</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><em>int</em></a>) – The ONNX opset version in which to unregister.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="torch.onnx.select_model_mode_for_export">
<span class="sig-prename descclassname"><span class="pre">torch.onnx.</span></span><span class="sig-name descname"><span class="pre">select_model_mode_for_export</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/onnx/utils.html#select_model_mode_for_export"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.onnx.select_model_mode_for_export" title="Permalink to this definition">¶</a></dt>
<dd><p>A context manager to temporarily set the training mode of <code class="docutils literal notranslate"><span class="pre">model</span></code>
to <code class="docutils literal notranslate"><span class="pre">mode</span></code>, resetting it when we exit the with-block.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> – Same type and meaning as <code class="docutils literal notranslate"><span class="pre">model</span></code> arg to <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">export()</span></code></a>.</p></li>
<li><p><strong>mode</strong> (<em>TrainingMode</em>) – Same type and meaning as <code class="docutils literal notranslate"><span class="pre">training</span></code> arg to <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">export()</span></code></a>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="torch.onnx.is_in_onnx_export">
<span class="sig-prename descclassname"><span class="pre">torch.onnx.</span></span><span class="sig-name descname"><span class="pre">is_in_onnx_export</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/onnx/utils.html#is_in_onnx_export"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.onnx.is_in_onnx_export" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns whether it is in the middle of ONNX export.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)">bool</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="torch.onnx.enable_log">
<span class="sig-prename descclassname"><span class="pre">torch.onnx.</span></span><span class="sig-name descname"><span class="pre">enable_log</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/onnx.html#enable_log"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.onnx.enable_log" title="Permalink to this definition">¶</a></dt>
<dd><p>Enables ONNX logging.</p>
<dl class="field-list simple">
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="torch.onnx.disable_log">
<span class="sig-prename descclassname"><span class="pre">torch.onnx.</span></span><span class="sig-name descname"><span class="pre">disable_log</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/onnx.html#disable_log"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.onnx.disable_log" title="Permalink to this definition">¶</a></dt>
<dd><p>Disables ONNX logging.</p>
<dl class="field-list simple">
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="torch.onnx.verification.find_mismatch">
<span class="sig-prename descclassname"><span class="pre">torch.onnx.verification.</span></span><span class="sig-name descname"><span class="pre">find_mismatch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_constant_folding=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">training=&lt;TrainingMode.EVAL:</span> <span class="pre">0&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opset_version=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep_initializers_as_inputs=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">options=None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/onnx/verification.html#find_mismatch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torch.onnx.verification.find_mismatch" title="Permalink to this definition">¶</a></dt>
<dd><p>Find all mismatches between the original model and the exported model.</p>
<p>Experimental. The API is subject to change.</p>
<p>This tool helps debug the mismatch between the original PyTorch model and exported
ONNX model. It binary searches the model graph to find the minimal subgraph that
exhibits the mismatch.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.11)"><em>Union</em></a><em>[</em><a class="reference internal" href="generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.modules.module.Module"><em>Module</em></a><em>, </em><a class="reference internal" href="generated/torch.jit.ScriptModule.html#torch.jit.ScriptModule" title="torch.jit._script.ScriptModule"><em>ScriptModule</em></a><em>]</em>) – The model to be exported.</p></li>
<li><p><strong>input_args</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.11)"><em>Tuple</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.11)"><em>Any</em></a><em>, </em><em>...</em><em>]</em>) – The input arguments to the model.</p></li>
<li><p><strong>do_constant_folding</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><em>bool</em></a>) – Same as <cite>do_constant_folding</cite> in <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.onnx.export()</span></code></a>.</p></li>
<li><p><strong>training</strong> (<em>TrainingMode</em>) – Same as <cite>training</cite> in <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.onnx.export()</span></code></a>.</p></li>
<li><p><strong>opset_version</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.11)"><em>Optional</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><em>int</em></a><em>]</em>) – Same as <cite>opset_version</cite> in <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.onnx.export()</span></code></a>.</p></li>
<li><p><strong>keep_initializers_as_inputs</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><em>bool</em></a>) – Same as <cite>keep_initializers_as_inputs</cite> in <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.onnx.export()</span></code></a>.</p></li>
<li><p><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><em>bool</em></a>) – Same as <cite>verbose</cite> in <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.onnx.export()</span></code></a>.</p></li>
<li><p><strong>options</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.11)"><em>Optional</em></a><em>[</em><a class="reference internal" href="generated/torch.onnx.verification.VerificationOptions.html#torch.onnx.verification.VerificationOptions" title="torch.onnx.verification.VerificationOptions"><em>VerificationOptions</em></a><em>]</em>) – The options for the mismatch verification.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A GraphInfo object that contains the mismatch information.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><p id="torch.onnx.verification.GraphInfo"/><a class="reference internal" href="generated/torch.onnx.verification.GraphInfo.html#torch.onnx.verification.GraphInfo" title="torch.onnx.verification.GraphInfo"><em>GraphInfo</em></a></p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">torch</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">torch.onnx.verification</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">opset_version</span> <span class="o">=</span> <span class="mi">15</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define a custom symbolic function for aten::relu.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># The custom symbolic function is incorrect, which will result in mismatches.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">incorrect_relu_symbolic_function</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="bp">self</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">register_custom_op_symbolic</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s2">&quot;aten::relu&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">incorrect_relu_symbolic_function</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">opset_version</span><span class="o">=</span><span class="n">opset_version</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
<span class="gp">... </span>            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
<span class="gp">... </span>            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">)</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">graph_info</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">verification</span><span class="o">.</span><span class="n">find_mismatch</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">Model</span><span class="p">(),</span>
<span class="gp">... </span>    <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),),</span>
<span class="gp">... </span>    <span class="n">opset_version</span><span class="o">=</span><span class="n">opset_version</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">===================== Mismatch info for graph partition : ======================</span>
<span class="go">================================ Mismatch error ================================</span>
<span class="go">Tensor-likes are not close!</span>
<span class="go">Mismatched elements: 12 / 12 (100.0%)</span>
<span class="go">Greatest absolute difference: 0.2328854203224182 at index (1, 2) (up to 1e-07 allowed)</span>
<span class="go">Greatest relative difference: 0.699536174352349 at index (1, 3) (up to 0.001 allowed)</span>
<span class="go">==================================== Tree: =====================================</span>
<span class="go">5 X   __2 X    __1 ✓</span>
<span class="go">id:  |  id: 0 |  id: 00</span>
<span class="go">     |        |</span>
<span class="go">     |        |__1 X (aten::relu)</span>
<span class="go">     |           id: 01</span>
<span class="go">     |</span>
<span class="go">     |__3 X    __1 ✓</span>
<span class="go">        id: 1 |  id: 10</span>
<span class="go">              |</span>
<span class="go">              |__2 X     __1 X (aten::relu)</span>
<span class="go">                 id: 11 |  id: 110</span>
<span class="go">                        |</span>
<span class="go">                        |__1 ✓</span>
<span class="go">                           id: 111</span>
<span class="go">=========================== Mismatch leaf subgraphs: ===========================</span>
<span class="go">[&#39;01&#39;, &#39;110&#39;]</span>
<span class="go">============================= Mismatch node kinds: =============================</span>
<span class="go">{&#39;aten::relu&#39;: 2}</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="classes">
<h2><a class="toc-backref" href="#id32" role="doc-backlink">Classes</a><a class="headerlink" href="#classes" title="Permalink to this heading">¶</a></h2>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><p id="torch.onnx.JitScalarType"/><a class="reference internal" href="generated/torch.onnx.JitScalarType.html#torch.onnx.JitScalarType" title="torch.onnx.JitScalarType"><code class="xref py py-obj docutils literal notranslate"><span class="pre">JitScalarType</span></code></a></p></td>
<td><p>Scalar types defined in torch.</p></td>
</tr>
<tr class="row-even"><td><p><p id="torch.onnx.verification.GraphInfo"/><a class="reference internal" href="generated/torch.onnx.verification.GraphInfo.html#torch.onnx.verification.GraphInfo" title="torch.onnx.verification.GraphInfo"><code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.onnx.verification.GraphInfo</span></code></a></p></td>
<td><p>GraphInfo contains validation information of a TorchScript graph and its converted ONNX graph.</p></td>
</tr>
<tr class="row-odd"><td><p><p id="torch.onnx.verification.VerificationOptions"/><a class="reference internal" href="generated/torch.onnx.verification.VerificationOptions.html#torch.onnx.verification.VerificationOptions" title="torch.onnx.verification.VerificationOptions"><code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.onnx.verification.VerificationOptions</span></code></a></p></td>
<td><p>Options for ONNX export verification.</p></td>
</tr>
</tbody>
</table>
</section>
</section>


             </article>
             
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="generated/torch.onnx.JitScalarType.html" class="btn btn-neutral float-right" title="JitScalarType" accesskey="n" rel="next">Next <img src="_static/images/chevron-right-orange.svg" class="next-page"></a>
      
      
        <a href="nn.init.html" class="btn btn-neutral" title="torch.nn.init" accesskey="p" rel="prev"><img src="_static/images/chevron-right-orange.svg" class="previous-page"> Previous</a>
      
    </div>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2023, PyTorch Contributors.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>
<script>

var match = window.location.href.match(/\/_[a-zA-Z0-9_]*.html|_dynamo/gi);
var url = window.location.href.lastIndexOf(match[match.length-1]);

if (url)
  {
    var div = '<div class="admonition note"><p class="admonition-title">Note</p><p><i class="fa fa-exclamation-circle" aria-hidden="true">&nbsp</i> This page describes an internal API which is not intended to be used outside of the PyTorch codebase and can be modified or removed without notice.</p></div>'
    document.getElementById("pytorch-article").insertAdjacentHTML('afterBegin', div)
  }
</script>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              <ul>
<li><a class="reference internal" href="#">torch.onnx</a><ul>
<li><a class="reference internal" href="#example-alexnet-from-pytorch-to-onnx">Example: AlexNet from PyTorch to ONNX</a></li>
<li><a class="reference internal" href="#tracing-vs-scripting">Tracing vs Scripting</a></li>
<li><a class="reference internal" href="#avoiding-pitfalls">Avoiding Pitfalls</a><ul>
<li><a class="reference internal" href="#avoid-numpy-and-built-in-python-types">Avoid NumPy and built-in Python types</a></li>
<li><a class="reference internal" href="#avoid-tensor-data">Avoid Tensor.data</a></li>
<li><a class="reference internal" href="#avoid-in-place-operations-when-using-tensor-shape-in-tracing-mode">Avoid in-place operations when using tensor.shape in tracing mode</a></li>
</ul>
</li>
<li><a class="reference internal" href="#limitations">Limitations</a><ul>
<li><a class="reference internal" href="#types">Types</a></li>
<li><a class="reference internal" href="#differences-in-operator-implementations">Differences in Operator Implementations</a></li>
<li><a class="reference internal" href="#unsupported-tensor-indexing-patterns">Unsupported Tensor Indexing Patterns</a><ul>
<li><a class="reference internal" href="#reads-gets">Reads / Gets</a></li>
<li><a class="reference internal" href="#writes-sets">Writes / Sets</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#adding-support-for-operators">Adding support for operators</a><ul>
<li><a class="reference internal" href="#onnx-exporter-internals">ONNX exporter internals</a></li>
<li><a class="reference internal" href="#aten-operators">ATen operators</a><ul>
<li><a class="reference internal" href="#list-of-supported-operators">List of supported operators</a></li>
<li><a class="reference internal" href="#adding-support-for-an-aten-or-quantized-operator">Adding support for an aten or quantized operator</a></li>
</ul>
</li>
<li><a class="reference internal" href="#torch-autograd-functions">torch.autograd.Functions</a><ul>
<li><a class="reference internal" href="#static-symbolic-method">Static Symbolic Method</a></li>
<li><a class="reference internal" href="#inline-autograd-function">Inline Autograd Function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#custom-operators">Custom operators</a><ul>
<li><a class="reference internal" href="#onnx-script-functions">ONNX-script functions</a></li>
<li><a class="reference internal" href="#c-operators">C++ Operators</a></li>
</ul>
</li>
<li><a class="reference internal" href="#discovering-all-unconvertible-aten-ops-at-once">Discovering all unconvertible ATen ops at once</a></li>
</ul>
</li>
<li><a class="reference internal" href="#frequently-asked-questions">Frequently Asked Questions</a></li>
<li><a class="reference internal" href="#contributing-developing">Contributing / developing</a></li>
<li><a class="reference internal" href="#functions">Functions</a></li>
<li><a class="reference internal" href="#classes">Classes</a></li>
</ul>
</li>
</ul>

            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
         <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
         <script src="_static/jquery.js"></script>
         <script src="_static/underscore.js"></script>
         <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
         <script src="_static/doctools.js"></script>
         <script src="_static/clipboard.min.js"></script>
         <script src="_static/copybutton.js"></script>
     

  

  <script type="text/javascript" src="_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 
<script script type="text/javascript">
  var collapsedSections = ['Developer Notes', 'Language Bindings', 'Libraries', 'Community'];
</script>

<img height="1" width="1" style="border-style:none;" alt="" src="https://www.googleadservices.com/pagead/conversion/795629140/?label=txkmCPmdtosBENSssfsC&amp;guid=ON&amp;script=0"/>


  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access comprehensive developer documentation for PyTorch</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get in-depth tutorials for beginners and advanced developers</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Resources</h2>
          <p>Find development resources and get your questions answered</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">View Resources</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">Get Started</a></li>
            <li><a href="https://pytorch.org/features">Features</a></li>
            <li><a href="https://pytorch.org/ecosystem">Ecosystem</a></li>
            <li><a href="https://pytorch.org/blog/">Blog</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">Contributing</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/resources">Resources</a></li>
            <li><a href="https://pytorch.org/tutorials">Tutorials</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">Docs</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">Discuss</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github Issues</a></li>
            <li><a href="https://pytorch.org/assets/brand-guidelines/PyTorch-Brand-Guidelines.pdf" target="_blank">Brand Guidelines</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title">Stay up to date</li>
            <li><a href="https://www.facebook.com/pytorch" target="_blank">Facebook</a></li>
            <li><a href="https://twitter.com/pytorch" target="_blank">Twitter</a></li>
            <li><a href="https://www.youtube.com/pytorch" target="_blank">YouTube</a></li>
            <li><a href="https://www.linkedin.com/company/pytorch" target="_blank">LinkedIn</a></li>
          </ul>  
          </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title">PyTorch Podcasts</li>
            <li><a href="https://open.spotify.com/show/6UzHKeiy368jKfQMKKvJY5" target="_blank">Spotify</a></li>
            <li><a href="https://podcasts.apple.com/us/podcast/pytorch-developer-podcast/id1566080008" target="_blank">Apple</a></li>
            <li><a href="https://www.google.com/podcasts?feed=aHR0cHM6Ly9mZWVkcy5zaW1wbGVjYXN0LmNvbS9PQjVGa0lsOA%3D%3D" target="_blank">Google</a></li>
            <li><a href="https://music.amazon.com/podcasts/7a4e6f0e-26c2-49e9-a478-41bd244197d0/PyTorch-Developer-Podcast?" target="_blank">Amazon</a></li>
          </ul>
         </div>
        </div>
        
        <div class="privacy-policy">
          <ul>
            <li class="privacy-policy-links"><a href="https://www.linuxfoundation.org/terms/" target="_blank">Terms</a></li>
            <li class="privacy-policy-links">|</li>
            <li class="privacy-policy-links"><a href="https://www.linuxfoundation.org/privacy-policy/" target="_blank">Privacy</a></li>
          </ul>
        </div>
        <div class="copyright">
        <p>© Copyright The Linux Foundation. The PyTorch Foundation is a project of The Linux Foundation.
          For web site terms of use, trademark policy and other policies applicable to The PyTorch Foundation please see
          <a href="www.linuxfoundation.org/policies/">www.linuxfoundation.org/policies/</a>. The PyTorch Foundation supports the PyTorch open source
          project, which has been established as PyTorch Project a Series of LF Projects, LLC. For policies applicable to the PyTorch Project a Series of LF Projects, LLC,
          please see <a href="www.lfprojects.org/policies/">www.lfprojects.org/policies/</a>.</p>
      </div>
     </div>

  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebook’s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>
            
          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="resources-mobile-menu-title" class="active">
            Docs
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/docs/stable/index.html">PyTorch</a>
            </li>

            <li>
              <a href="https://pytorch.org/audio/stable/index.html">torchaudio</a>
            </li>

            <li>
              <a href="https://pytorch.org/text/stable/index.html">torchtext</a>
            </li>

            <li>
              <a href="https://pytorch.org/vision/stable/index.html">torchvision</a>
            </li>

            <li>
              <a href="https://pytorch.org/torcharrow">torcharrow</a>
            </li>

            <li>
              <a href="https://pytorch.org/data">TorchData</a>
            </li>

            <li>
              <a href="https://pytorch.org/torchrec">TorchRec</a>
            </li>

            <li>
              <a href="https://pytorch.org/serve/">TorchServe</a>
            </li>

            <li>
              <a href="https://pytorch.org/torchx/">TorchX</a>
            </li>

            <li>
              <a href="https://pytorch.org/xla">PyTorch on XLA Devices</a>
            </li>
          </ul>

          <li class="resources-mobile-menu-title">
            Resources
          </li>
            
           <ul class="resources-mobile-menu-items">

            <li>
              <a href="https://pytorch.org/features">About</a>
            </li>

            <li>
              <a href="https://pytorch.org/foundation">PyTorch Foundation</a>
            </li>

            <li>
              <a href="https://pytorch.org/#community-module">Community</a>
            </li>

            <li>
              <a href="https://pytorch.org/community-stories">Community Stories</a>
            </li>

            <li>
              <a href="https://pytorch.org/resources">Developer Resources</a>
            </li>

            <li>
              <a href="https://pytorch.org/events">Events</a>
            </li>

            <li>
              <a href="https://discuss.pytorch.org/">Forums</a>
            </li>

            <li>
              <a href="https://pytorch.org/hub">Models (Beta)</a>
            </li>
          </ul>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>