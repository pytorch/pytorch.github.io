


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta name="robots" content="noindex">
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TorchScript &mdash; PyTorch master documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://pytorch.org/docs/stable/jit.html"/>
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/katex-math.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Multiprocessing package - torch.multiprocessing" href="multiprocessing.html" />
    <link rel="prev" title="torch.hub" href="hub.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/features">Features</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="active">
            <a href="https://pytorch.org/docs/stable/index.html">Docs</a>
          </li>

          <li>
            <a href="https://pytorch.org/resources">Resources</a>
          </li>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>

  </div>
</div>


<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            

            
              
              
                <div class="version">
                  <a href='http://pytorch.org/docs/versions.html'>1.2.0 &#x25BC</a>
                </div>
              
            

            


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

            
          </div>

          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="notes/autograd.html">Autograd mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/broadcasting.html">Broadcasting semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/cpu_threading_torchscript_inference.html">CPU threading and TorchScript inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/cuda.html">CUDA semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/extending.html">Extending PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/large_scale_deployments.html">Features for large-scale deployments</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/multiprocessing.html">Multiprocessing best practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/randomness.html">Reproducibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/serialization.html">Serialization semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/windows.html">Windows FAQ</a></li>
</ul>
<p class="caption"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="community/contribution_guide.html">PyTorch Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="community/governance.html">PyTorch Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="community/persons_of_interest.html">PyTorch Governance | Persons of Interest</a></li>
</ul>
<p class="caption"><span class="caption-text">Package Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="torch.html">torch</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensors.html">torch.Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensor_attributes.html">Tensor Attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="type_info.html">Type Info</a></li>
<li class="toctree-l1"><a class="reference internal" href="sparse.html">torch.sparse</a></li>
<li class="toctree-l1"><a class="reference internal" href="cuda.html">torch.cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage.html">torch.Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.html">torch.nn</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.functional.html">torch.nn.functional</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.init.html">torch.nn.init</a></li>
<li class="toctree-l1"><a class="reference internal" href="optim.html">torch.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="autograd.html">torch.autograd</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.html">torch.distributed</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributions.html">torch.distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="hub.html">torch.hub</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">torch.jit</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiprocessing.html">torch.multiprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="random.html">torch.random</a></li>
<li class="toctree-l1"><a class="reference internal" href="bottleneck.html">torch.utils.bottleneck</a></li>
<li class="toctree-l1"><a class="reference internal" href="checkpoint.html">torch.utils.checkpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpp_extension.html">torch.utils.cpp_extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">torch.utils.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="dlpack.html">torch.utils.dlpack</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_zoo.html">torch.utils.model_zoo</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensorboard.html">torch.utils.tensorboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="onnx.html">torch.onnx</a></li>
<li class="toctree-l1"><a class="reference internal" href="__config__.html">torch.__config__</a></li>
</ul>
<p class="caption"><span class="caption-text">torchvision Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="torchvision/index.html">torchvision</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
      <li>TorchScript</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
            
            <a href="_sources/jit.rst.txt" rel="nofollow"><img src="_static/images/view-page-source-icon.svg"></a>
          
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <div class="section" id="torchscript">
<h1>TorchScript<a class="headerlink" href="#torchscript" title="Permalink to this headline">Â¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#creating-torchscript-code" id="id1">Creating TorchScript Code</a></p></li>
<li><p><a class="reference internal" href="#mixing-tracing-and-scripting" id="id2">Mixing Tracing and Scripting</a></p></li>
<li><p><a class="reference internal" href="#torchscript-language-reference" id="id3">TorchScript Language Reference</a></p>
<ul>
<li><p><a class="reference internal" href="#types" id="id4">Types</a></p>
<ul>
<li><p><a class="reference internal" href="#default-types" id="id5">Default Types</a></p></li>
<li><p><a class="reference internal" href="#optional-type-refinement" id="id6">Optional Type Refinement</a></p></li>
<li><p><a class="reference internal" href="#user-defined-types" id="id7">User Defined Types</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#expressions" id="id8">Expressions</a></p>
<ul>
<li><p><a class="reference internal" href="#literals" id="id9">Literals</a></p>
<ul>
<li><p><a class="reference internal" href="#list-construction" id="id10">List Construction</a></p></li>
<li><p><a class="reference internal" href="#tuple-construction" id="id11">Tuple Construction</a></p></li>
<li><p><a class="reference internal" href="#dict-construction" id="id12">Dict Construction</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#variables" id="id13">Variables</a></p></li>
<li><p><a class="reference internal" href="#arithmetic-operators" id="id14">Arithmetic Operators</a></p></li>
<li><p><a class="reference internal" href="#comparison-operators" id="id15">Comparison Operators</a></p></li>
<li><p><a class="reference internal" href="#logical-operators" id="id16">Logical Operators</a></p></li>
<li><p><a class="reference internal" href="#subscripts" id="id17">Subscripts</a></p></li>
<li><p><a class="reference internal" href="#function-calls" id="id18">Function Calls</a></p></li>
<li><p><a class="reference internal" href="#method-calls" id="id19">Method Calls</a></p></li>
<li><p><a class="reference internal" href="#ternary-expressions" id="id20">Ternary Expressions</a></p></li>
<li><p><a class="reference internal" href="#casts" id="id21">Casts</a></p></li>
<li><p><a class="reference internal" href="#accessing-module-parameters" id="id22">Accessing Module Parameters</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#statements" id="id23">Statements</a></p></li>
<li><p><a class="reference internal" href="#variable-resolution" id="id24">Variable Resolution</a></p></li>
<li><p><a class="reference internal" href="#use-of-python-values" id="id25">Use of Python Values</a></p>
<ul>
<li><p><a class="reference internal" href="#functions" id="id26">Functions</a></p></li>
<li><p><a class="reference internal" href="#attribute-lookup-on-python-modules" id="id27">Attribute Lookup On Python Modules</a></p></li>
<li><p><a class="reference internal" href="#python-defined-constants" id="id28">Python-defined Constants</a></p></li>
<li><p><a class="reference internal" href="#module-attributes" id="id29">Module Attributes</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#debugging" id="id30">Debugging</a></p>
<ul>
<li><p><a class="reference internal" href="#disable-jit-for-debugging" id="id31">Disable JIT for Debugging</a></p></li>
<li><p><a class="reference internal" href="#inspecting-code" id="id32">Inspecting Code</a></p></li>
<li><p><a class="reference internal" href="#interpreting-graphs" id="id33">Interpreting Graphs</a></p></li>
<li><p><a class="reference internal" href="#tracing-edge-cases" id="id34">Tracing Edge Cases</a></p></li>
<li><p><a class="reference internal" href="#automatic-trace-checking" id="id35">Automatic Trace Checking</a></p></li>
<li><p><a class="reference internal" href="#tracer-warnings" id="id36">Tracer Warnings</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#frequently-asked-questions" id="id37">Frequently Asked Questions</a></p>
<ul>
<li><p><a class="reference internal" href="#builtin-functions" id="id38">Builtin Functions</a></p></li>
</ul>
</li>
</ul>
</div>
<span class="target" id="module-torch.jit"></span><p>TorchScript is a way to create serializable and optimizable models from PyTorch code.
Any TorchScript program can be saved from a Python
process and loaded in a process where there is no Python dependency.</p>
<p>We provide tools to incrementally transition a model from a pure Python program
to a TorchScript program that can be run independently from Python, such as in a standalone C++ program.
This makes it possible to train models in PyTorch using familiar tools in Python and then export
the model via TorchScript to a production environment where Python programs may be disadvantageous.
for performance and multi-threading reasons.</p>
<div class="section" id="creating-torchscript-code">
<h2><a class="toc-backref" href="#id1">Creating TorchScript Code</a><a class="headerlink" href="#creating-torchscript-code" title="Permalink to this headline">Â¶</a></h2>
<dl class="function">
<dt id="torch.jit.script">
<code class="sig-prename descclassname">torch.jit.</code><code class="sig-name descname">script</code><span class="sig-paren">(</span><em class="sig-param">obj</em>, <em class="sig-param">optimize=None</em>, <em class="sig-param">_frames_up=0</em>, <em class="sig-param">_rcb=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/jit.html#script"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#torch.jit.script" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Scripting a function or <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code> will inspect the source code, compile
it as TorchScript code using the TorchScript compiler, and return a <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code> or
<code class="docutils literal notranslate"><span class="pre">torch._C.Function</span></code>.</p>
<dl>
<dt><strong>Scripting a function</strong></dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">&#64;torch.jit.script</span></code> decorator will construct a <code class="docutils literal notranslate"><span class="pre">torch._C.Function</span></code>.</p>
<p>Example (scripting a function):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">y</span>
    <span class="k">return</span> <span class="n">r</span>
</pre></div>
</div>
</dd>
<dt><strong>Scripting an nn.Module</strong></dt><dd><p>Scripting an <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code> by default will compile the <code class="docutils literal notranslate"><span class="pre">forward</span></code> method and recursively
compile any methods, submodules, and functions called by <code class="docutils literal notranslate"><span class="pre">forward</span></code>. If a <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code> only uses
features supported in TorchScript, no changes to the original module code should be necessary.</p>
<p>Example (scripting a simple module with a Parameter):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="k">class</span> <span class="nc">MyModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyModule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># This parameter will be copied to the new ScriptModule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">))</span>

        <span class="c1"># When this submodule is used, it will be compiled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">mv</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>

        <span class="c1"># This calls the `forward` method of the `nn.Linear` module, which will</span>
        <span class="c1"># cause the `self.linear` submodule to be compiled to a `ScriptModule` here</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span>

<span class="n">scripted_module</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">MyModule</span><span class="p">())</span>
</pre></div>
</div>
<p>Example (scripting a module with traced submodules):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>

<span class="k">class</span> <span class="nc">MyModule</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyModule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># torch.jit.trace produces a ScriptModule&#39;s conv1 and conv2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
      <span class="nb">input</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="nb">input</span><span class="p">))</span>
      <span class="nb">input</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv2</span><span class="p">(</span><span class="nb">input</span><span class="p">))</span>
      <span class="k">return</span> <span class="nb">input</span>

<span class="n">scripted_module</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">MyModule</span><span class="p">())</span>
</pre></div>
</div>
<p>To compile a method other than <code class="docutils literal notranslate"><span class="pre">forward</span></code> (and recursively compile anything it calls), add
the <code class="docutils literal notranslate"><span class="pre">&#64;torch.jit.export</span></code> decorator to the method.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="torch.jit.trace">
<code class="sig-prename descclassname">torch.jit.</code><code class="sig-name descname">trace</code><span class="sig-paren">(</span><em class="sig-param">func</em>, <em class="sig-param">example_inputs</em>, <em class="sig-param">optimize=None</em>, <em class="sig-param">check_trace=True</em>, <em class="sig-param">check_inputs=None</em>, <em class="sig-param">check_tolerance=1e-05</em>, <em class="sig-param">_force_outplace=False</em>, <em class="sig-param">_module_class=None</em>, <em class="sig-param">_compilation_unit=&lt;torch._C.CompilationUnit object&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/jit.html#trace"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#torch.jit.trace" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Trace a function and return an executable <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code> or <code class="docutils literal notranslate"><span class="pre">torch.jit._C.Function</span></code>
that will be optimized using just-in-time compilation.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Tracing only correctly records functions and modules which are not data
dependent (e.g., do not have conditionals on data in tensors) and do not have
any untracked external dependencies (e.g., perform input/output or
access global variables). If you trace such models, you may silently get
incorrect results on subsequent invocations of the model. The tracer
will try to emit warnings when doing something that may cause an
incorrect trace to be produced.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> (<em>callable</em><em> or </em><a class="reference internal" href="nn.html#torch.nn.Module" title="torch.nn.Module"><em>torch.nn.Module</em></a>) â a Python function or <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>
that will be run with <code class="docutils literal notranslate"><span class="pre">example_inputs</span></code>.
arguments and returns to <code class="docutils literal notranslate"><span class="pre">func</span></code> must be tensors
or (possibly nested) tuples that
contain tensors.</p></li>
<li><p><strong>example_inputs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)"><em>tuple</em></a>) â a tuple of example inputs that will be passed to the function
while tracing. The resulting trace can be run with
inputs of different types and shapes assuming the traced operations
support those types and shapes. <code class="docutils literal notranslate"><span class="pre">example_inputs</span></code> may also be a single
Tensor in which case it is automatically wrapped in a tuple</p></li>
</ul>
</dd>
<dt class="field-even">Keyword Arguments</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>check_trace</strong> (<a class="reference internal" href="storage.html#torch.FloatStorage.bool" title="torch.FloatStorage.bool"><em>bool</em></a><em>, </em><em>optional</em>) â check if the same inputs run through
traced code produce the same outputs. Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>. You might want
to disable this if, for example, your network contains non-
deterministic ops or if you are sure that the network is correct despite
a checker failure.</p></li>
<li><p><strong>check_inputs</strong> (<em>list of tuples</em><em>, </em><em>optional</em>) â A list of tuples of input arguments that should be used
to check the trace against what is expected. Each tuple
is equivalent to a set of input arguments that would
be specified in <code class="docutils literal notranslate"><span class="pre">example_inputs</span></code>. For best results, pass in a
set of checking inputs representative of the space of
shapes and types of inputs you expect the network to see.
If not specified, the original <code class="docutils literal notranslate"><span class="pre">example_inputs</span></code> are used for checking</p></li>
<li><p><strong>check_tolerance</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><em>optional</em>) â Floating-point comparison tolerance to use in the checker procedure.
This can be used to relax the checker strictness in the event that
results diverge numerically for a known reason, such as operator fusion.</p></li>
</ul>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>if <code class="docutils literal notranslate"><span class="pre">callable</span></code> is <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code> or <code class="docutils literal notranslate"><span class="pre">forward()</span></code> of <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code>, <code class="docutils literal notranslate"><span class="pre">trace</span></code> returns
a <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code> object with a single <code class="docutils literal notranslate"><span class="pre">forward()</span></code> method containing the traced code.
The returned <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code> will have the same set of sub-modules and parameters as the
original <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code>.
If <code class="docutils literal notranslate"><span class="pre">callable</span></code> is a standalone function, <code class="docutils literal notranslate"><span class="pre">trace</span></code> returns <code class="docutils literal notranslate"><span class="pre">torch.jit._C.Function</span></code></p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">weighted_kernel_sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">weight</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv</span><span class="o">.</span><span class="n">weight</span>

<span class="n">example_weight</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">example_forward_input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="c1"># the following two calls are equivalent</span>
<span class="n">module</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace_module</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">example_forward_input</span><span class="p">)</span>
<span class="n">module</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace_module</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">forward</span><span class="p">,</span> <span class="n">example_forward_input</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="torch.jit.ScriptModule">
<em class="property">class </em><code class="sig-prename descclassname">torch.jit.</code><code class="sig-name descname">ScriptModule</code><span class="sig-paren">(</span><em class="sig-param">optimize=None</em>, <em class="sig-param">_qualified_name=None</em>, <em class="sig-param">_compilation_unit=None</em>, <em class="sig-param">_cpp_module=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/jit.html#ScriptModule"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#torch.jit.ScriptModule" title="Permalink to this definition">Â¶</a></dt>
<dd><p>The core data structure in TorchScript is the <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code>. It is an
analogue of torchâs <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code> and represents an entire model as a tree of
submodules. Like normal modules, each individual module in a <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code> can
have submodules, parameters, and methods. In <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code>s methods are implemented
as Python functions, but in <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code>s methods are implemented as
TorchScript functions,  a statically-typed subset of Python that contains all
of PyTorchâs built-in Tensor operations. This difference allows your
ScriptModules code to run without the need for a Python interpreter.</p>
<p><code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code>s be created in two ways:</p>
<p><strong>Tracing:</strong></p>
<blockquote>
<div><p>Using <code class="docutils literal notranslate"><span class="pre">torch.jit.trace</span></code> and <code class="docutils literal notranslate"><span class="pre">torch.jit.trace_module</span></code>, you can turn an existing module or Python
function into a TorchScript <code class="docutils literal notranslate"><span class="pre">torch._C.Function</span></code> or <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code>. You must provide example inputs,
and we run the function, recording the operations performed on all the tensors.
* The resulting recording of a standalone function produces <code class="docutils literal notranslate"><span class="pre">torch._C.Function</span></code>.
* The resulting recording of <code class="docutils literal notranslate"><span class="pre">forward</span></code> function of <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code> or <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code> produces <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code>.
This module also contains any parameters that the original
module had as well.</p>
<p>Example (tracing a function):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="n">traced_foo</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Tracing a standalone function will construct a <code class="docutils literal notranslate"><span class="pre">torch._C.Function</span></code>
Tracing <code class="docutils literal notranslate"><span class="pre">nn.Module``s</span> <span class="pre">``forward</span></code> will construct a <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code></p>
</div>
<p>Example (tracing an existing module):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">weighted_kernel_sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">weight</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv</span><span class="o">.</span><span class="n">weight</span>


<span class="n">n</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">example_weight</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">example_forward_input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># all three trace calls below are equivalent</span>
<span class="c1"># and construct `ScriptModule` with a single `forward` method</span>
<span class="n">module</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">forward</span><span class="p">,</span> <span class="n">example_forward_input</span><span class="p">)</span> <span class="c1"># produces ScriptModule with `forward`</span>
<span class="n">module</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">example_forward_input</span><span class="p">)</span> <span class="c1"># produces ScriptModule with `forward`</span>
<span class="n">module</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace_module</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">inputs</span><span class="p">)</span> <span class="c1"># produces ScriptModule with `forward`</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;forward&#39;</span> <span class="p">:</span> <span class="n">example_forward_input</span><span class="p">,</span> <span class="s1">&#39;weighted_kernel_sum&#39;</span> <span class="p">:</span> <span class="n">example_weight</span><span class="p">}</span>
<span class="c1"># trace_module produces `ScriptModule` with two methods:</span>
<span class="c1"># `forward` and `weighted_kernel_sum`</span>
<span class="n">module</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace_module</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The first three trace/trace_module calls are equivalent and return <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code></p></li>
</ul>
<p>with a single <code class="docutils literal notranslate"><span class="pre">forward</span></code> method.
* The last <code class="docutils literal notranslate"><span class="pre">trace_module</span></code> call produces a <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code> with two methods.
Tracing only records operations done when the given function is run on the given
tensors. Therefore, the returned <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code> will always run the same traced
graph on any input. This has some important implications when your module is
expected to run different sets of operations, depending on the input and/or the
module state. For example,</p>
<blockquote>
<div><ul class="simple">
<li><p>Tracing will not record any control-flow like if-statements or loops. When
this control-flow is constant across your module, this is fine and it often
inlines the control-flow decisions. But sometimes the control-flow is
actually part of the model itself. For instance, a recurrent network is
a loop over the (possibly dynamic) length of an input sequence.</p></li>
<li><p>In the returned <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code>, operations that have different behaviors
in <code class="docutils literal notranslate"><span class="pre">training</span></code> and <code class="docutils literal notranslate"><span class="pre">eval</span></code> modes will always behave as if it is in the
mode it was in during tracing, no matter which mode the <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code>
is in.</p></li>
</ul>
</div></blockquote>
<p>In cases like these, tracing would not be appropriate and scripting is a better
choice.</p>
</div>
</div></blockquote>
<p><strong>Scripting:</strong></p>
<blockquote>
<div><p>You can write TorchScript code directly using Python syntax. You do this
using the <code class="docutils literal notranslate"><span class="pre">&#64;torch.jit.script</span></code> decorator for functions and modules. You can
also call <code class="docutils literal notranslate"><span class="pre">torch.jit.script</span></code> directly with the function or module you wish to
compile. On functions, the body of the function is compiled to TorchScript. If
applied to an <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code>, by default the <code class="docutils literal notranslate"><span class="pre">forward</span></code> method and any methods it
calls are compiled, and all buffer and Parameters of the original module are copied
to a new <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code>. You should not need to construct a <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code> manually.
TorchScript itself is a subset of the Python language, so not all
features in Python work, but we provide enough functionality to compute on
tensors and do control-dependent operations.</p>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="torch.jit.save">
<code class="sig-prename descclassname">torch.jit.</code><code class="sig-name descname">save</code><span class="sig-paren">(</span><em class="sig-param">m</em>, <em class="sig-param">f</em>, <em class="sig-param">_extra_files=ExtraFilesMap{}</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/jit.html#save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#torch.jit.save" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Save an offline version of this module for use in a separate process. The saved
module serializes all of the methods, submodules, parameters, and attributes of this
module. It can be loaded into the C++ API using <code class="docutils literal notranslate"><span class="pre">torch::jit::load(filename)</span></code> or into the Python
API with <a class="reference internal" href="#torch.jit.load" title="torch.jit.load"><code class="xref py py-func docutils literal notranslate"><span class="pre">load</span></code></a>.</p>
<p>To be able to save a module, it must not make any calls to native Python functions.
This means that all submodules must be subclasses of <code class="docutils literal notranslate"><span class="pre">torch.jit.ScriptModule</span></code> as well.</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>All modules, no matter their device, are always loaded onto the CPU during loading.
This is different from <a class="reference internal" href="#torch.jit.load" title="torch.jit.load"><code class="xref py py-func docutils literal notranslate"><span class="pre">load</span></code></a>âs semantics and may change in the future.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>m</strong> â a ScriptModule to save</p></li>
<li><p><strong>f</strong> â a file-like object (has to implement write and flush) or a string
containing a file name</p></li>
<li><p><strong>_extra_files</strong> â Map from filename to contents which will be stored as part of âfâ</p></li>
</ul>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you are using Python 2, <code class="docutils literal notranslate"><span class="pre">torch.save</span></code> does NOT support <code class="docutils literal notranslate"><span class="pre">StringIO.StringIO</span></code>
as a valid file-like object. This is because the write method should return
the number of bytes written; <code class="docutils literal notranslate"><span class="pre">StringIO.write()</span></code> does not do this.</p>
<p>Please use something like <code class="docutils literal notranslate"><span class="pre">io.BytesIO</span></code> instead.</p>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">io</span>


<span class="k">class</span> <span class="nc">MyModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">10</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">MyModule</span><span class="p">())</span>

<span class="c1"># Save to file</span>
<span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s1">&#39;scriptmodule.pt&#39;</span><span class="p">)</span>

<span class="c1"># Save to io.BytesIO buffer</span>
<span class="n">buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
<span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">buffer</span><span class="p">)</span>

<span class="c1"># Save with extra files</span>
<span class="n">extra_files</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">ExtraFilesMap</span><span class="p">()</span>
<span class="n">extra_files</span><span class="p">[</span><span class="s1">&#39;foo.txt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>
<span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s1">&#39;scriptmodule.pt&#39;</span><span class="p">,</span> <span class="n">_extra_files</span><span class="o">=</span><span class="n">extra_files</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="torch.jit.load">
<code class="sig-prename descclassname">torch.jit.</code><code class="sig-name descname">load</code><span class="sig-paren">(</span><em class="sig-param">f</em>, <em class="sig-param">map_location=None</em>, <em class="sig-param">_extra_files=ExtraFilesMap{}</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torch/jit.html#load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#torch.jit.load" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Load a <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code> previously saved with <a class="reference internal" href="#torch.jit.save" title="torch.jit.save"><code class="xref py py-func docutils literal notranslate"><span class="pre">save</span></code></a></p>
<p>All previously saved modules, no matter their device, are first loaded onto CPU,
and then are moved to the devices they were saved from. If this fails (e.g. because
the run time system doesnât have certain devices), an exception is raised.
However, storages can be dynamically remapped to an alternative set of devices
using the <cite>map_location</cite> argument. Comparing to <a class="reference internal" href="torch.html#torch.load" title="torch.load"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.load()</span></code></a>, <cite>map_location</cite>
in this function is simplified, which only accepts a string (e.g., âcpuâ, âcuda:0â),
or torch.device (e.g., torch.device(âcpuâ))</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>f</strong> â a file-like object (has to implement read, readline, tell, and seek),
or a string containing a file name</p></li>
<li><p><strong>map_location</strong> â can a string (e.g., âcpuâ, âcuda:0â), a device (e.g.,
torch.device(âcpuâ))</p></li>
<li><p><strong>_extra_files</strong> â map from filename to content. The extra
filenames given in the map would be loaded and their content
would be stored in the provided map.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code> object.</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;scriptmodule.pt&#39;</span><span class="p">)</span>

<span class="c1"># Load ScriptModule from io.BytesIO object</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;scriptmodule.pt&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="c1"># Load all tensors to the original device</span>
<span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>

<span class="c1"># Load all tensors onto CPU, using a device</span>
<span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">))</span>

<span class="c1"># Load all tensors onto CPU, using a string</span>
<span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>

<span class="c1"># Load with extra files.</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;metadata.json&#39;</span> <span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;scriptmodule.pt&#39;</span><span class="p">,</span> <span class="n">_extra_files</span> <span class="o">=</span> <span class="n">files</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;metadata.json&#39;</span><span class="p">])</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="mixing-tracing-and-scripting">
<h2><a class="toc-backref" href="#id2">Mixing Tracing and Scripting</a><a class="headerlink" href="#mixing-tracing-and-scripting" title="Permalink to this headline">Â¶</a></h2>
<p>In many cases either tracing or scripting is an easier approach for converting a model to TorchScript.
Tracing and scripting can be composed to suit the particular requirements
of a part of a model.</p>
<p>Scripted functions can call traced functions. This is particularly useful when you need
to use control-flow around a simple feed-forward model. For instance the beam search
of a sequence to sequence model will typically be written in script but can call an
encoder module generated using tracing.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="n">traced_foo</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">traced_foo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>Traced functions can call script functions. This is useful when a small part of
a model requires some control-flow even though most of the model is just a feed-forward
network. Control-flow inside of a script function called by a traced function is
preserved correctly:</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">y</span>
    <span class="k">return</span> <span class="n">r</span>


<span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">foo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">z</span>

<span class="n">traced_bar</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">bar</span><span class="p">,</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</pre></div>
</div>
<p>This composition also works for <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code>s as well, where it can be used to generate
a submodule using tracing that can be called from the methods of a script module:</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torchvision</span>

<span class="k">class</span> <span class="nc">MyScriptModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyScriptModule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">means</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">103.939</span><span class="p">,</span> <span class="mf">116.779</span><span class="p">,</span> <span class="mf">123.68</span><span class="p">])</span>
                                        <span class="o">.</span><span class="n">resize_</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resnet</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">torchvision</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">resnet18</span><span class="p">(),</span>
                                      <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resnet</span><span class="p">(</span><span class="nb">input</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">means</span><span class="p">)</span>

<span class="n">my_script_module</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">MyScriptModule</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="torchscript-language-reference">
<h2><a class="toc-backref" href="#id3">TorchScript Language Reference</a><a class="headerlink" href="#torchscript-language-reference" title="Permalink to this headline">Â¶</a></h2>
<p>TorchScript is a statically typed subset of Python that can either be written directly (using
the <code class="docutils literal notranslate"><span class="pre">&#64;torch.jit.script</span></code> decorator) or generated automatically from Python code via
tracing. When using tracing, code is automatically converted into this subset of
Python by recording only the actual operators on tensors and simply executing and
discarding the other surrounding Python code.</p>
<p>When writing TorchScript directly using <code class="docutils literal notranslate"><span class="pre">&#64;torch.jit.script</span></code> decorator, the programmer must
only use the subset of Python supported in TorchScript. This section documents
what is supported in TorchScript as if it were a language reference for a stand
alone language. Any features of Python not mentioned in this reference are not
part of TorchScript.</p>
<p>As a subset of Python any valid TorchScript function is also a valid Python
function. This makes it possible to remove the <code class="docutils literal notranslate"><span class="pre">&#64;torch.jit.script</span></code> decorator and debug the
function using standard Python tools like <code class="docutils literal notranslate"><span class="pre">pdb</span></code>. The reverse is not true: there
are many valid python programs that are not valid TorchScript programs.
Instead, TorchScript focuses specifically on the features of Python that are
needed to represent neural network models in Torch.</p>
<dl class="envvar">
<dt id="envvar-PYTORCH_JIT=1">
<code class="sig-name descname">PYTORCH_JIT=1</code><a class="headerlink" href="#envvar-PYTORCH_JIT=1" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Setting the environment variable <code class="docutils literal notranslate"><span class="pre">PYTORCH_JIT=0</span></code> will disable all script
and tracing annotations. If there is hard-to-debug error in one of your
ScriptModules, you can use this flag to force everything to run using native
Python. This allows the use of tools like <code class="docutils literal notranslate"><span class="pre">pdb</span></code> to debug code.</p>
</dd></dl>

<div class="section" id="types">
<h3><a class="toc-backref" href="#id4">Types</a><a class="headerlink" href="#types" title="Permalink to this headline">Â¶</a></h3>
<p>The largest difference between TorchScript and the full Python language is that
TorchScript only supports a small set of types that are needed to express neural
net models. In particular, TorchScript supports:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Tensor</span></code></p></td>
<td><p>A PyTorch tensor of any dtype, dimension, or backend</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Tuple[T0,</span> <span class="pre">T1,</span> <span class="pre">...]</span></code></p></td>
<td><p>A tuple containing subtypes <code class="docutils literal notranslate"><span class="pre">T0</span></code>, <code class="docutils literal notranslate"><span class="pre">T1</span></code>, etc. (e.g. <code class="docutils literal notranslate"><span class="pre">Tuple[Tensor,</span> <span class="pre">Tensor]</span></code>)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">bool</span></code></p></td>
<td><p>A boolean value</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p>A scalar integer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">float</span></code></p></td>
<td><p>A scalar floating point number</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">List[T]</span></code></p></td>
<td><p>A list of which all members are type <code class="docutils literal notranslate"><span class="pre">T</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Optional[T]</span></code></p></td>
<td><p>A value which is either None or type <code class="docutils literal notranslate"><span class="pre">T</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Dict[K,</span> <span class="pre">V]</span></code></p></td>
<td><p>A dict with key type <code class="docutils literal notranslate"><span class="pre">K</span></code> and value type <code class="docutils literal notranslate"><span class="pre">V</span></code>. Only <code class="docutils literal notranslate"><span class="pre">str</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code>, and <code class="docutils literal notranslate"><span class="pre">float</span></code> are allowed as key types.</p></td>
</tr>
</tbody>
</table>
<p>Unlike Python, each variable in TorchScript function must have a single static type.
This makes it easier to optimize TorchScript functions.</p>
<p>Example (a type mismatch):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">def</span> <span class="nf">an_error</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">return</span> <span class="n">r</span> <span class="c1"># Type mismatch: r is set to type Tensor in the true branch</span>
             <span class="c1"># and type int in the false branch</span>
</pre></div>
</div>
<div class="section" id="default-types">
<h4><a class="toc-backref" href="#id5">Default Types</a><a class="headerlink" href="#default-types" title="Permalink to this headline">Â¶</a></h4>
<p>By default, all parameters to a TorchScript function are assumed to be Tensor.
To specify that an argument to a TorchScript function is another type, it is possible to use
MyPy-style type annotations using the types listed above:</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tup</span><span class="p">):</span>
    <span class="c1"># type: (int, Tuple[Tensor, Tensor]) -&gt; Tensor</span>
    <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="o">=</span> <span class="n">tup</span>
    <span class="k">return</span> <span class="n">t0</span> <span class="o">+</span> <span class="n">t1</span> <span class="o">+</span> <span class="n">x</span>

<span class="nb">print</span><span class="p">(</span><span class="n">foo</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">))))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is also possible to annotate types with Python 3 type annotations.
In our examples, we use comment-based annotations to ensure Python 2
compatibility as well.</p>
</div>
<p>An empty list is assumed to be <code class="docutils literal notranslate"><span class="pre">List[Tensor]</span></code> and empty dicts
<code class="docutils literal notranslate"><span class="pre">Dict[str,</span> <span class="pre">Tensor]</span></code>. To instantiate an empty list or dict of other types,
use <code class="docutils literal notranslate"><span class="pre">torch.jit.annotate</span></code>.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.jit</span> <span class="k">import</span> <span class="n">Tensor</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="k">class</span> <span class="nc">EmptyDataStructures</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">ScriptModule</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EmptyDataStructures</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script_method</span>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># type: (Tensor) -&gt; Tuple[List[Tuple[int, float]], Dict[str, int]]</span>

        <span class="c1"># This annotates the list to be a `List[Tuple[int, float]]`</span>
        <span class="n">my_list</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">my_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>

        <span class="n">my_dict</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="p">{})</span>
        <span class="k">return</span> <span class="n">my_list</span><span class="p">,</span> <span class="n">my_dict</span>
</pre></div>
</div>
</div>
<div class="section" id="optional-type-refinement">
<h4><a class="toc-backref" href="#id6">Optional Type Refinement</a><a class="headerlink" href="#optional-type-refinement" title="Permalink to this headline">Â¶</a></h4>
<p>TorchScript will refine the type of a variable of type <code class="docutils literal notranslate"><span class="pre">Optional[T]</span></code> when
a comparison to <code class="docutils literal notranslate"><span class="pre">None</span></code> is made inside the conditional of an if-statement.
The compiler can reason about multiple <code class="docutils literal notranslate"><span class="pre">None</span></code> checks that are combined with
<code class="docutils literal notranslate"><span class="pre">and</span></code>, <code class="docutils literal notranslate"><span class="pre">or</span></code>, and <code class="docutils literal notranslate"><span class="pre">not</span></code>. Refinement will also occur for else blocks of if-statements
that are not explicitly written.</p>
<p>The expression must be emitted within the conditional; assigning
a <code class="docutils literal notranslate"><span class="pre">None</span></code> check to a variable and using it in the conditional will not refine types.
An attribute like <cite>self.x</cite> will not be refined, but assigning <cite>self.x</cite> to a local
variable first will work.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script_method</span>
<span class="k">def</span> <span class="nf">optional_unwrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
  <span class="c1"># type: (Optional[int], Optional[int]) -&gt; int</span>
  <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>

  <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
  <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">z</span>
  <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
</div>
<div class="section" id="user-defined-types">
<h4><a class="toc-backref" href="#id7">User Defined Types</a><a class="headerlink" href="#user-defined-types" title="Permalink to this headline">Â¶</a></h4>
<p>Python classes can be used in TorchScript if they are annotated with <code class="docutils literal notranslate"><span class="pre">&#64;torch.jit.script</span></code>,
similar to how you would declare a TorchScript function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>

  <span class="k">def</span> <span class="nf">aug_add_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inc</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">inc</span>
</pre></div>
</div>
<p>This subset is restricted:</p>
<ul>
<li><p>All functions must be valid TorchScript functions (including <code class="docutils literal notranslate"><span class="pre">__init__()</span></code>)</p></li>
<li><p>Classes must be new-style classes, as we use <code class="docutils literal notranslate"><span class="pre">__new__()</span></code> to construct them with pybind11</p></li>
<li><p>TorchScript classes are statically typed. Members are declared by assigning to
self in the <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> method</p>
<blockquote>
<div><p>For example, assigning outside of the <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">assign_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Will result in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>RuntimeError:
Tried to set nonexistent attribute: x. Did you forget to initialize it in __init__()?:
def assign_x(self):
  self.x = torch.rand(2, 3)
  ~~~~~~~~~~~~~~~~~~~~~~~~ &lt;--- HERE
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>No expressions except method definitions are allowed in the body of the class</p></li>
<li><p>No support for inheritance or any other polymorphism strategy, except for inheriting
from object to specify a new-style class</p></li>
</ul>
<p>After a class is defined, it can be used in both TorchScript and Python interchangeably
like any other TorchScript type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">class</span> <span class="nc">Pair</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">first</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="n">second</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">def</span> <span class="nf">sum_pair</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
  <span class="c1"># type: (Pair) -&gt; Tensor</span>
  <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">first</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">second</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">Pair</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sum_pair</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="expressions">
<h3><a class="toc-backref" href="#id8">Expressions</a><a class="headerlink" href="#expressions" title="Permalink to this headline">Â¶</a></h3>
<p>The following Python Expressions are supported</p>
<div class="section" id="literals">
<h4><a class="toc-backref" href="#id9">Literals</a><a class="headerlink" href="#literals" title="Permalink to this headline">Â¶</a></h4>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">True</span></code>, <code class="docutils literal notranslate"><span class="pre">False</span></code>, <code class="docutils literal notranslate"><span class="pre">None</span></code>, <code class="docutils literal notranslate"><span class="pre">'string</span> <span class="pre">literals'</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;string</span> <span class="pre">literals&quot;</span></code>,
number literals <code class="docutils literal notranslate"><span class="pre">3</span></code> (interpreted as int) <code class="docutils literal notranslate"><span class="pre">3.4</span></code> (interpreted as a float)</p>
</div></blockquote>
<div class="section" id="list-construction">
<h5><a class="toc-backref" href="#id10">List Construction</a><a class="headerlink" href="#list-construction" title="Permalink to this headline">Â¶</a></h5>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">[3,</span> <span class="pre">4]</span></code>, <code class="docutils literal notranslate"><span class="pre">[]</span></code>, <code class="docutils literal notranslate"><span class="pre">[torch.rand(3),</span> <span class="pre">torch.rand(4)]</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An empty list is assumed have type <code class="docutils literal notranslate"><span class="pre">List[Tensor]</span></code>.
The types of other list literals are derived from the type of the members.
To denote an empty list of another type, use <code class="docutils literal notranslate"><span class="pre">torch.jit.annotate</span></code>.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="tuple-construction">
<h5><a class="toc-backref" href="#id11">Tuple Construction</a><a class="headerlink" href="#tuple-construction" title="Permalink to this headline">Â¶</a></h5>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">(3,</span> <span class="pre">4)</span></code>, <code class="docutils literal notranslate"><span class="pre">(3,)</span></code></p>
</div></blockquote>
</div>
<div class="section" id="dict-construction">
<h5><a class="toc-backref" href="#id12">Dict Construction</a><a class="headerlink" href="#dict-construction" title="Permalink to this headline">Â¶</a></h5>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">{'hello':</span> <span class="pre">3}</span></code>, <code class="docutils literal notranslate"><span class="pre">{}</span></code>, <code class="docutils literal notranslate"><span class="pre">{'a':</span> <span class="pre">torch.rand(3),</span> <span class="pre">'b':</span> <span class="pre">torch.rand(4)}</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An empty dict is assumed have type <code class="docutils literal notranslate"><span class="pre">Dict[str,</span> <span class="pre">Tensor]</span></code>.
The types of other dict literals are derived from the type of the members.
To denote an empty dict of another type, use <code class="docutils literal notranslate"><span class="pre">torch.jit.annotate</span></code>.</p>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="variables">
<h4><a class="toc-backref" href="#id13">Variables</a><a class="headerlink" href="#variables" title="Permalink to this headline">Â¶</a></h4>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">my_variable_name</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See <a class="reference internal" href="#variable-resolution">Variable Resolution</a> for how variables are resolved.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="arithmetic-operators">
<h4><a class="toc-backref" href="#id14">Arithmetic Operators</a><a class="headerlink" href="#arithmetic-operators" title="Permalink to this headline">Â¶</a></h4>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">+</span> <span class="pre">b</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">-</span> <span class="pre">b</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">*</span> <span class="pre">b</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">/</span> <span class="pre">b</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">^</span> <span class="pre">b</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&#64;</span> <span class="pre">b</span></code></p>
</div></blockquote>
</div>
<div class="section" id="comparison-operators">
<h4><a class="toc-backref" href="#id15">Comparison Operators</a><a class="headerlink" href="#comparison-operators" title="Permalink to this headline">Â¶</a></h4>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">==</span> <span class="pre">b</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">!=</span> <span class="pre">b</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&lt;</span> <span class="pre">b</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&gt;</span> <span class="pre">b</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&lt;=</span> <span class="pre">b</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&gt;=</span> <span class="pre">b</span></code></p>
</div></blockquote>
</div>
<div class="section" id="logical-operators">
<h4><a class="toc-backref" href="#id16">Logical Operators</a><a class="headerlink" href="#logical-operators" title="Permalink to this headline">Â¶</a></h4>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">and</span> <span class="pre">b</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">or</span> <span class="pre">b</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">b</span></code></p>
</div></blockquote>
</div>
<div class="section" id="subscripts">
<h4><a class="toc-backref" href="#id17">Subscripts</a><a class="headerlink" href="#subscripts" title="Permalink to this headline">Â¶</a></h4>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">t[0]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">t[-1]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">t[0:2]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">t[1:]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">t[:1]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">t[:]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">t[0,</span> <span class="pre">1]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">t[0,</span> <span class="pre">1:2]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">t[0,</span> <span class="pre">:1]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">t[-1,</span> <span class="pre">1:,</span> <span class="pre">0]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">t[1:,</span> <span class="pre">-1,</span> <span class="pre">0]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">t[i:j,</span> <span class="pre">i]</span></code></p>
</div></blockquote>
</div>
<div class="section" id="function-calls">
<h4><a class="toc-backref" href="#id18">Function Calls</a><a class="headerlink" href="#function-calls" title="Permalink to this headline">Â¶</a></h4>
<blockquote>
<div><p>Calls to built-in functions: <code class="docutils literal notranslate"><span class="pre">torch.rand(3,</span> <span class="pre">dtype=torch.int)</span></code></p>
<p>Calls to other script functions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">foo</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="method-calls">
<h4><a class="toc-backref" href="#id19">Method Calls</a><a class="headerlink" href="#method-calls" title="Permalink to this headline">Â¶</a></h4>
<blockquote>
<div><p>Calls to methods of builtin types like tensor: <code class="docutils literal notranslate"><span class="pre">x.mm(y)</span></code></p>
<p>When defining a Script method inside of a ScriptModule, the <code class="docutils literal notranslate"><span class="pre">&#64;script_method</span></code>
annotation is used. Inside of these methods it is possible to call other methods
of this class or access methods on the submodules.</p>
<p>Calling a submodule directly (e.g. <code class="docutils literal notranslate"><span class="pre">self.resnet(input)</span></code>) is equivalent to
calling its <code class="docutils literal notranslate"><span class="pre">forward</span></code> method (e.g. <code class="docutils literal notranslate"><span class="pre">self.resnet.forward(input)</span></code>)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="k">class</span> <span class="nc">MyScriptModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">ScriptModule</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyScriptModule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">means</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">103.939</span><span class="p">,</span> <span class="mf">116.779</span><span class="p">,</span> <span class="mf">123.68</span><span class="p">])</span>
                                        <span class="o">.</span><span class="n">resize_</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resnet</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">torchvision</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">resnet18</span><span class="p">(),</span>
                                      <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">))</span>

    <span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script_method</span>
    <span class="k">def</span> <span class="nf">helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resnet</span><span class="p">(</span><span class="nb">input</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">means</span><span class="p">)</span>

    <span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script_method</span>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="ternary-expressions">
<h4><a class="toc-backref" href="#id20">Ternary Expressions</a><a class="headerlink" href="#ternary-expressions" title="Permalink to this headline">Â¶</a></h4>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">if</span> <span class="pre">x</span> <span class="pre">&gt;</span> <span class="pre">y</span> <span class="pre">else</span> <span class="pre">y</span></code></p>
</div></blockquote>
</div>
<div class="section" id="casts">
<h4><a class="toc-backref" href="#id21">Casts</a><a class="headerlink" href="#casts" title="Permalink to this headline">Â¶</a></h4>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">float(ten)</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">int(3.5)</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">bool(ten)</span></code></p>
</div></blockquote>
</div>
<div class="section" id="accessing-module-parameters">
<h4><a class="toc-backref" href="#id22">Accessing Module Parameters</a><a class="headerlink" href="#accessing-module-parameters" title="Permalink to this headline">Â¶</a></h4>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">self.my_parameter</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">self.my_submodule.my_parameter</span></code></p>
</div></blockquote>
</div>
</div>
<div class="section" id="statements">
<h3><a class="toc-backref" href="#id23">Statements</a><a class="headerlink" href="#statements" title="Permalink to this headline">Â¶</a></h3>
<p>TorchScript supports the following types of statements:</p>
<dl>
<dt>Simple Assignments</dt><dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">b</span>
<span class="n">a</span> <span class="o">+=</span> <span class="n">b</span> <span class="c1"># short-hand for a = a + b, does not operate in-place on a</span>
<span class="n">a</span> <span class="o">-=</span> <span class="n">b</span>
</pre></div>
</div>
</dd>
<dt>Pattern Matching Assignments</dt><dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">tuple_or_list</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="n">c</span> <span class="o">=</span> <span class="n">a_tuple</span>
</pre></div>
</div>
</dd>
</dl>
<p>Print Statements</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">print(&quot;the</span> <span class="pre">result</span> <span class="pre">of</span> <span class="pre">an</span> <span class="pre">add:&quot;,</span> <span class="pre">a</span> <span class="pre">+</span> <span class="pre">b)</span></code></p>
</div></blockquote>
<p>If Statements</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="o">-</span><span class="n">a</span>
<span class="k">elif</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">a</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">a</span>
</pre></div>
</div>
</div></blockquote>
<p>In addition to bools, floats, ints, and Tensors can be used in a conditional
and will be implicitly casted to a boolean.</p>
<p>While Loops</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div></blockquote>
<p>For loops with <code class="docutils literal notranslate"><span class="pre">range</span></code></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">*=</span> <span class="n">i</span>
</pre></div>
</div>
</div></blockquote>
<p>For loops over tuples:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tup</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tup</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>for loops over tuples will unroll the loop, generating a body for
each member of the tuple. The body must type-check correctly for each member.</p>
</div>
</div></blockquote>
<p>For loops over constant <code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleList</span></code></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SubModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">ScriptModule</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Sub</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

    <span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script_method</span>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">+</span> <span class="nb">input</span>

<span class="k">class</span> <span class="nc">MyModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">ScriptModule</span><span class="p">):</span>
    <span class="n">__constants__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mods&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyModule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mods</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">([</span><span class="n">SubModule</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>

    <span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script_method</span>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mods</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To use a <code class="docutils literal notranslate"><span class="pre">nn.ModuleList</span></code> inside a <code class="docutils literal notranslate"><span class="pre">&#64;script_method</span></code> it must be marked
constant by adding the name of the attribute to the <code class="docutils literal notranslate"><span class="pre">__constants__</span></code>
list for the type. For loops over a <code class="docutils literal notranslate"><span class="pre">nn.ModuleList</span></code> will unroll the body of the
loop at compile time, with each member of the constant module list.</p>
</div>
</div></blockquote>
<p>Break and Continue</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">continue</span>
  <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="k">break</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<dl>
<dt>Return</dt><dd><p><code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">a,</span> <span class="pre">b</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<dl class="simple">
<dt>TorchScript allows returns in the following circumstances:</dt><dd><ol class="arabic simple">
<li><p>At the end of a function</p></li>
<li><p>In an if-statement where &lt;true&gt; and &lt;false&gt; both return</p></li>
<li><p>In an if-statement where &lt;true&gt; returns and &lt;false&gt; is empty (an early return)</p></li>
</ol>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="section" id="variable-resolution">
<h3><a class="toc-backref" href="#id24">Variable Resolution</a><a class="headerlink" href="#variable-resolution" title="Permalink to this headline">Â¶</a></h3>
<p>TorchScript supports a subset of Pythonâs variable resolution (i.e. scoping)
rules. Local variables behave the same as in Python, except for the restriction
that a variable must have the same type along all paths through a function.
If a variable has a different type on different sides of an if statement, it
is an error to use it after the end of the if statement.</p>
<p>Similarly, a variable is not allowed to be used if it is only <em>defined</em> along some
paths through the function.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="c1"># Error: undefined value y</span>
</pre></div>
</div>
<p>Non-local variables are resolved to Python values at compile time when the
function is defined. These values are then converted into TorchScript values using
the rules described in <a class="reference internal" href="#use-of-python-values">Use of Python Values</a>.</p>
</div>
<div class="section" id="use-of-python-values">
<h3><a class="toc-backref" href="#id25">Use of Python Values</a><a class="headerlink" href="#use-of-python-values" title="Permalink to this headline">Â¶</a></h3>
<p>To make writing TorchScript more convenient, we allow script code to refer
to Python values in the surrounding scope. For instance, any time there is a
reference to <code class="docutils literal notranslate"><span class="pre">torch</span></code>, the TorchScript compiler is actually resolving it to the
<code class="docutils literal notranslate"><span class="pre">torch</span></code> Python module when the function is declared.  These Python values are
not a first class part of TorchScript. Instead they are de-sugared at compile-time
into the primitive types that TorchScript supports. This depends
on the dynamic type of the Python valued referenced when compilation occurs.
This section describes the rules that are used when accessing Python values in TorchScript.</p>
<div class="section" id="functions">
<h4><a class="toc-backref" href="#id26">Functions</a><a class="headerlink" href="#functions" title="Permalink to this headline">Â¶</a></h4>
<blockquote>
<div><p>TorchScript can call Python functions. This functionality is very useful when
incrementally converting a model to TorchScript. The model can be moved function-by-function
to TorchScript, leaving calls to Python functions in place. This way you can incrementally
check the correctness of the model as you go.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I am called with </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
  <span class="kn">import</span> <span class="nn">pdb</span><span class="p">;</span> <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
  <span class="k">return</span> <span class="n">x</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">foo</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Attempting to call <code class="docutils literal notranslate"><span class="pre">save</span></code> on a ScriptModule that contains calls to Python
functions will fail. The intention is that this pathway is used for debugging
and the calls removed or turned into script functions before saving. If you
want to export a module with a Python function, add the <code class="docutils literal notranslate"><span class="pre">&#64;torch.jit.ignore</span></code>
decorator to the function which will replace these function calls with an
exception when the model is saved:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">M</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">ScriptModule</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

  <span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script_method</span>
  <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ignored_code</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">2</span>

  <span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">ignore</span>
  <span class="k">def</span> <span class="nf">ignored_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="c1"># non-TorchScript code</span>
    <span class="kn">import</span> <span class="nn">pdb</span><span class="p">;</span> <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">M</span><span class="p">()</span>
<span class="c1"># Runs, makes upcall to Python to run `ignored_code`</span>
<span class="n">m</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># Replaces all calls to `ignored_code` with a `raise`</span>
<span class="n">m</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;m.pt&quot;</span><span class="p">)</span>
<span class="n">loaded</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;m.pt&quot;</span><span class="p">)</span>

<span class="c1"># This runs `ignored_code` after saving which will raise an Exception!</span>
<span class="n">loaded</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="attribute-lookup-on-python-modules">
<h4><a class="toc-backref" href="#id27">Attribute Lookup On Python Modules</a><a class="headerlink" href="#attribute-lookup-on-python-modules" title="Permalink to this headline">Â¶</a></h4>
<blockquote>
<div><p>TorchScript can lookup attributes on modules. Builtin functions like <code class="docutils literal notranslate"><span class="pre">torch.add</span></code>
are accessed this way. This allows TorchScript to call functions defined in
other modules.</p>
</div></blockquote>
</div>
<div class="section" id="python-defined-constants">
<h4><a class="toc-backref" href="#id28">Python-defined Constants</a><a class="headerlink" href="#python-defined-constants" title="Permalink to this headline">Â¶</a></h4>
<blockquote>
<div><p>TorchScript also provides a way to use constants that are defined in Python.
These can be used to hard-code hyper-parameters into the function, or to
define universal constants. There are two ways of specifying that a Python
value should be treated as a constant.</p>
<ol class="arabic">
<li><p>Values looked up as attributes of a module are assumed to be constant.
Example: <code class="docutils literal notranslate"><span class="pre">math.pi</span></code></p></li>
<li><p>Attributes of a ScriptModule can be marked constant by listing them
as a member of the <code class="docutils literal notranslate"><span class="pre">__constants__</span></code> property of the class:</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">ScriptModule</span><span class="p">):</span>
    <span class="n">__constants__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">4</span>

   <span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script_method</span>
   <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="nb">input</span>
</pre></div>
</div>
</li>
</ol>
<p>Supported constant Python Values are</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">float</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bool</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">torch.device</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">torch.layout</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">torch.dtype</span></code></p></li>
<li><p>tuples containing supported types</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleList</span></code> which can be used in a TorchScript for loop</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="module-attributes">
<h4><a class="toc-backref" href="#id29">Module Attributes</a><a class="headerlink" href="#module-attributes" title="Permalink to this headline">Â¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> wrapper and <code class="docutils literal notranslate"><span class="pre">register_buffer</span></code> can be used to assign
tensors to a <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code>. In a similar vein, attributes of any type can be
assign on a <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code> by wrapping them with <code class="docutils literal notranslate"><span class="pre">torch.jit.Attribute</span></code> and
specifying the type. All types available in TorchScript are supported. These
attributes are mutable and are saved in a separate archive in the serialized
model binary. Tensor attributes are semantically the same as buffers.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">ScriptModule</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_dict</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">words</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">Attribute</span><span class="p">([],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">some_dict</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">Attribute</span><span class="p">(</span><span class="n">a_dict</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span>

  <span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script_method</span>
  <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
    <span class="c1"># type: (str) -&gt; int</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">some_dict</span><span class="p">[</span><span class="nb">input</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="debugging">
<h3><a class="toc-backref" href="#id30">Debugging</a><a class="headerlink" href="#debugging" title="Permalink to this headline">Â¶</a></h3>
<div class="section" id="disable-jit-for-debugging">
<h4><a class="toc-backref" href="#id31">Disable JIT for Debugging</a><a class="headerlink" href="#disable-jit-for-debugging" title="Permalink to this headline">Â¶</a></h4>
<blockquote>
<div><p>If you want to disable all JIT modes (tracing and scripting) so you can
debug your program in raw Python, you can use the <code class="docutils literal notranslate"><span class="pre">PYTORCH_JIT</span></code> environment
variable. <code class="docutils literal notranslate"><span class="pre">PYTORCH_JIT</span></code> can be used to globally disable the
JIT by setting its value to <code class="docutils literal notranslate"><span class="pre">0</span></code>. Given an example script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">def</span> <span class="nf">scripted_fn</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x</span>
    <span class="k">return</span> <span class="n">x</span>


<span class="k">def</span> <span class="nf">fn</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">neg</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">pdb</span><span class="p">;</span> <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">scripted_fn</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">traced_fn</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),))</span>

<span class="n">traced_fn</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
<p>Debugging this script with PDB works except for when we invoke the <code class="docutils literal notranslate"><span class="pre">&#64;torch.jit.script</span></code>
function. We can globally disable JIT, so that we can call the <code class="docutils literal notranslate"><span class="pre">&#64;torch.jit.script</span></code>
function as a normal python function and not compile it. If the above script
is called <code class="docutils literal notranslate"><span class="pre">disable_jit_example.py</span></code>, we can invoke it like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ PYTORCH_JIT=0 python disable_jit_example.py
</pre></div>
</div>
<p>and we will be able to step into the <code class="docutils literal notranslate"><span class="pre">&#64;torch.jit.script</span></code> function as a normal Python
function.</p>
</div></blockquote>
</div>
<div class="section" id="inspecting-code">
<h4><a class="toc-backref" href="#id32">Inspecting Code</a><a class="headerlink" href="#inspecting-code" title="Permalink to this headline">Â¶</a></h4>
<blockquote>
<div><p>TorchScript provides a code pretty-printer for all <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code> instances. This
pretty-printer gives an interpretation of the script methodâs code as valid
Python syntax. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="nb">len</span><span class="p">):</span>
    <span class="c1"># type: (int) -&gt; torch.Tensor</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">rv</span> <span class="o">=</span> <span class="n">rv</span> <span class="o">-</span> <span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rv</span> <span class="o">=</span> <span class="n">rv</span> <span class="o">+</span> <span class="mf">1.0</span>
        <span class="k">return</span> <span class="n">rv</span>

<span class="nb">print</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code> with a single <code class="docutils literal notranslate"><span class="pre">forward</span></code> method will have an attribute
<code class="docutils literal notranslate"><span class="pre">code</span></code>, which you can use to inspect the <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code>âs code.
If the <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code> has more than one method, you will need to access
<code class="docutils literal notranslate"><span class="pre">.code</span></code> on the method itself and not the module. We can inspect the
code of a method named <code class="docutils literal notranslate"><span class="pre">bar</span></code> on a ScriptModule by accessing <code class="docutils literal notranslate"><span class="pre">.bar.code</span></code>.</p>
<p>The example script above produces the code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">rv0</span> <span class="o">=</span> <span class="n">rv</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
            <span class="n">rv1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">rv0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rv1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rv0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">rv0</span> <span class="o">=</span> <span class="n">rv1</span>
    <span class="k">return</span> <span class="n">rv0</span>
</pre></div>
</div>
<p>This is TorchScriptâs compilation of the code for the <code class="docutils literal notranslate"><span class="pre">forward</span></code> method.
You can use this to ensure TorchScript (tracing or scripting) has captured
your model code correctly.</p>
</div></blockquote>
</div>
<div class="section" id="interpreting-graphs">
<h4><a class="toc-backref" href="#id33">Interpreting Graphs</a><a class="headerlink" href="#interpreting-graphs" title="Permalink to this headline">Â¶</a></h4>
<blockquote>
<div><p>TorchScript also has a representation at a lower level than the code pretty-
printer, in the form of IR graphs.</p>
<p>TorchScript uses a static single assignment (SSA) intermediate representation
(IR) to represent computation. The instructions in this format consist of
ATen (the C++ backend of PyTorch) operators and other primitive operators,
including control flow operators for loops and conditionals. As an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="nb">len</span><span class="p">):</span>
  <span class="c1"># type: (int) -&gt; torch.Tensor</span>
  <span class="n">rv</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="n">rv</span> <span class="o">-</span> <span class="mf">1.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="n">rv</span> <span class="o">+</span> <span class="mf">1.0</span>
  <span class="k">return</span> <span class="n">rv</span>

<span class="nb">print</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">.graph</span></code> follows the same rules described in the <a class="reference internal" href="#inspecting-code">Inspecting Code</a> section
with regard to <code class="docutils literal notranslate"><span class="pre">forward</span></code> method lookup.</p>
<p>The example script above produces the graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="p">(</span><span class="o">%</span><span class="nb">len</span> <span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">%</span><span class="mi">15</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">]()</span>
  <span class="o">%</span><span class="mi">9</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">]()</span>
  <span class="o">%</span><span class="mi">7</span> <span class="p">:</span> <span class="n">Device</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">]()</span>
  <span class="o">%</span><span class="mi">6</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">]()</span>
  <span class="o">%</span><span class="mi">5</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="mi">6</span><span class="p">]()</span>
  <span class="o">%</span><span class="mi">1</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">]()</span>
  <span class="o">%</span><span class="mi">2</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">]()</span>
  <span class="o">%</span><span class="mi">11</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="mi">10</span><span class="p">]()</span>
  <span class="o">%</span><span class="mi">14</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">]()</span>
  <span class="o">%</span><span class="mi">4</span> <span class="p">:</span> <span class="nb">int</span><span class="p">[]</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">ListConstruct</span><span class="p">(</span><span class="o">%</span><span class="mi">1</span><span class="p">,</span> <span class="o">%</span><span class="mi">2</span><span class="p">)</span>
  <span class="o">%</span><span class="n">rv</span><span class="o">.</span><span class="mi">1</span> <span class="p">:</span> <span class="n">Tensor</span> <span class="o">=</span> <span class="n">aten</span><span class="p">::</span><span class="n">zeros</span><span class="p">(</span><span class="o">%</span><span class="mi">4</span><span class="p">,</span> <span class="o">%</span><span class="mi">5</span><span class="p">,</span> <span class="o">%</span><span class="mi">6</span><span class="p">,</span> <span class="o">%</span><span class="mi">7</span><span class="p">)</span>
  <span class="o">%</span><span class="n">rv</span> <span class="p">:</span> <span class="n">Tensor</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Loop</span><span class="p">(</span><span class="o">%</span><span class="nb">len</span><span class="p">,</span> <span class="o">%</span><span class="mi">9</span><span class="p">,</span> <span class="o">%</span><span class="n">rv</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">block0</span><span class="p">(</span><span class="o">%</span><span class="n">i</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">%</span><span class="mi">13</span> <span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="p">{</span>
      <span class="o">%</span><span class="mi">12</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">aten</span><span class="p">::</span><span class="n">lt</span><span class="p">(</span><span class="o">%</span><span class="n">i</span><span class="p">,</span> <span class="o">%</span><span class="mi">11</span><span class="p">)</span>
      <span class="o">%</span><span class="n">rv</span><span class="o">.</span><span class="mi">4</span> <span class="p">:</span> <span class="n">Tensor</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">If</span><span class="p">(</span><span class="o">%</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">block0</span><span class="p">()</span> <span class="p">{</span>
          <span class="o">%</span><span class="n">rv</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span> <span class="n">Tensor</span> <span class="o">=</span> <span class="n">aten</span><span class="p">::</span><span class="n">sub</span><span class="p">(</span><span class="o">%</span><span class="mi">13</span><span class="p">,</span> <span class="o">%</span><span class="mi">14</span><span class="p">,</span> <span class="o">%</span><span class="mi">15</span><span class="p">)</span>
          <span class="o">-&gt;</span> <span class="p">(</span><span class="o">%</span><span class="n">rv</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">block1</span><span class="p">()</span> <span class="p">{</span>
          <span class="o">%</span><span class="n">rv</span><span class="o">.</span><span class="mi">3</span> <span class="p">:</span> <span class="n">Tensor</span> <span class="o">=</span> <span class="n">aten</span><span class="p">::</span><span class="n">add</span><span class="p">(</span><span class="o">%</span><span class="mi">13</span><span class="p">,</span> <span class="o">%</span><span class="mi">14</span><span class="p">,</span> <span class="o">%</span><span class="mi">15</span><span class="p">)</span>
          <span class="o">-&gt;</span> <span class="p">(</span><span class="o">%</span><span class="n">rv</span><span class="o">.</span><span class="mi">3</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="o">-&gt;</span> <span class="p">(</span><span class="o">%</span><span class="mi">9</span><span class="p">,</span> <span class="o">%</span><span class="n">rv</span><span class="o">.</span><span class="mi">4</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="p">(</span><span class="o">%</span><span class="n">rv</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Take the instruction <code class="docutils literal notranslate"><span class="pre">%rv.1</span> <span class="pre">:</span> <span class="pre">Dynamic</span> <span class="pre">=</span> <span class="pre">aten::zeros(%3,</span> <span class="pre">%4,</span> <span class="pre">%5,</span> <span class="pre">%6)</span></code> for
example. <code class="docutils literal notranslate"><span class="pre">%rv.1</span> <span class="pre">:</span> <span class="pre">Dynamic</span></code> means we assign the output to a (unique)
value named <code class="docutils literal notranslate"><span class="pre">rv.1</span></code>, and that value is of <code class="docutils literal notranslate"><span class="pre">Dynamic</span></code> type, i.e. we do
not know its concrete shape. <code class="docutils literal notranslate"><span class="pre">aten::zeros</span></code> is the operator (equivalent
to <code class="docutils literal notranslate"><span class="pre">torch.zeros</span></code>) and the input list <code class="docutils literal notranslate"><span class="pre">(%3,</span> <span class="pre">%4,</span> <span class="pre">%5,</span> <span class="pre">%6)</span></code> specifies which
values in scope should be passed as inputs. The schema for built-in functions
like <code class="docutils literal notranslate"><span class="pre">aten::zeros</span></code> can be found at <a class="reference internal" href="#builtin-functions">Builtin Functions</a>.</p>
<p>Notice that operators can also have associated <code class="docutils literal notranslate"><span class="pre">blocks</span></code>, namely the
<code class="docutils literal notranslate"><span class="pre">prim::Loop</span></code> and <code class="docutils literal notranslate"><span class="pre">prim::If</span></code> operators. In the graph print-out, these
operators are formatted to reflect their equivalent source code forms
to facilitate easy debugging.</p>
<p>Graphs can be inspected as shown to confirm that the computation described
by a <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code> is correct, in both automated and manual fashion, as
described below.</p>
</div></blockquote>
</div>
<div class="section" id="tracing-edge-cases">
<h4><a class="toc-backref" href="#id34">Tracing Edge Cases</a><a class="headerlink" href="#tracing-edge-cases" title="Permalink to this headline">Â¶</a></h4>
<blockquote>
<div><p>There are some edge cases that exist where the trace of a given Python
function/module will not be representative of the underlying code. These
cases can include:</p>
<ul class="simple">
<li><p>Tracing of control flow that is dependent on inputs (e.g. tensor shapes)</p></li>
<li><p>Tracing of in-place operations of tensor views (e.g. indexing on the
left-hand side of an assignment)</p></li>
</ul>
<p>Note that these cases may in fact be traceable in the future.</p>
</div></blockquote>
</div>
<div class="section" id="automatic-trace-checking">
<h4><a class="toc-backref" href="#id35">Automatic Trace Checking</a><a class="headerlink" href="#automatic-trace-checking" title="Permalink to this headline">Â¶</a></h4>
<blockquote>
<div><p>One way to automatically catch many errors in traces is by using <code class="docutils literal notranslate"><span class="pre">check_inputs</span></code>
on the <code class="docutils literal notranslate"><span class="pre">torch.jit.trace()</span></code> API. <code class="docutils literal notranslate"><span class="pre">check_inputs</span></code> takes a list of tuples
of inputs that will be used to re-trace the computation and verify the
results. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">loop_in_traced_fn</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),)</span>
<span class="n">check_inputs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),),</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),)]</span>

<span class="n">traced</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">loop_in_traced_fn</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">check_inputs</span><span class="o">=</span><span class="n">check_inputs</span><span class="p">)</span>
</pre></div>
</div>
<dl>
<dt>Gives us the following diagnostic information::</dt><dd><p>ERROR: Graphs differed across invocations!
Graph diff:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  graph(%x : Tensor) {
    %1 : int = prim::Constant[value=0]()
    %2 : int = prim::Constant[value=0]()
    %result.1 : Tensor = aten::select(%x, %1, %2)
    %4 : int = prim::Constant[value=0]()
    %5 : int = prim::Constant[value=0]()
    %6 : Tensor = aten::select(%x, %4, %5)
    %result.2 : Tensor = aten::mul(%result.1, %6)
    %8 : int = prim::Constant[value=0]()
    %9 : int = prim::Constant[value=1]()
    %10 : Tensor = aten::select(%x, %8, %9)
-   %result : Tensor = aten::mul(%result.2, %10)
+   %result.3 : Tensor = aten::mul(%result.2, %10)
?          ++
    %12 : int = prim::Constant[value=0]()
    %13 : int = prim::Constant[value=2]()
    %14 : Tensor = aten::select(%x, %12, %13)
+   %result : Tensor = aten::mul(%result.3, %14)
+   %16 : int = prim::Constant[value=0]()
+   %17 : int = prim::Constant[value=3]()
+   %18 : Tensor = aten::select(%x, %16, %17)
-   %15 : Tensor = aten::mul(%result, %14)
?     ^                                 ^
+   %19 : Tensor = aten::mul(%result, %18)
?     ^                                 ^
-   return (%15);
?             ^
+   return (%19);
?             ^
  }
</pre></div>
</div>
</dd>
</dl>
<p>This message indicates to us that the computation differed between when
we first traced it and when we traced it with the <code class="docutils literal notranslate"><span class="pre">check_inputs</span></code>. Indeed,
the loop within the body of <code class="docutils literal notranslate"><span class="pre">loop_in_traced_fn</span></code> depends on the shape
of the input <code class="docutils literal notranslate"><span class="pre">x</span></code>, and thus when we try another <code class="docutils literal notranslate"><span class="pre">x</span></code> with a different
shape, the trace differs.</p>
<p>In this case, data-dependent control flow like this can be captured using
script instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fn</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),)</span>
<span class="n">check_inputs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),),</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),)]</span>

<span class="n">scripted_fn</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">scripted_fn</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>

<span class="k">for</span> <span class="n">input_tuple</span> <span class="ow">in</span> <span class="p">[</span><span class="n">inputs</span><span class="p">]</span> <span class="o">+</span> <span class="n">check_inputs</span><span class="p">:</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">input_tuple</span><span class="p">),</span> <span class="n">scripted_fn</span><span class="p">(</span><span class="o">*</span><span class="n">input_tuple</span><span class="p">))</span>
</pre></div>
</div>
<p>Which produces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="p">(</span><span class="o">%</span><span class="n">x</span> <span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">%</span><span class="mi">5</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">]()</span>
  <span class="o">%</span><span class="mi">1</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">]()</span>
  <span class="o">%</span><span class="n">result</span><span class="o">.</span><span class="mi">1</span> <span class="p">:</span> <span class="n">Tensor</span> <span class="o">=</span> <span class="n">aten</span><span class="p">::</span><span class="n">select</span><span class="p">(</span><span class="o">%</span><span class="n">x</span><span class="p">,</span> <span class="o">%</span><span class="mi">1</span><span class="p">,</span> <span class="o">%</span><span class="mi">1</span><span class="p">)</span>
  <span class="o">%</span><span class="mi">4</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">aten</span><span class="p">::</span><span class="n">size</span><span class="p">(</span><span class="o">%</span><span class="n">x</span><span class="p">,</span> <span class="o">%</span><span class="mi">1</span><span class="p">)</span>
  <span class="o">%</span><span class="n">result</span> <span class="p">:</span> <span class="n">Tensor</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Loop</span><span class="p">(</span><span class="o">%</span><span class="mi">4</span><span class="p">,</span> <span class="o">%</span><span class="mi">5</span><span class="p">,</span> <span class="o">%</span><span class="n">result</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">block0</span><span class="p">(</span><span class="o">%</span><span class="n">i</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">%</span><span class="mi">7</span> <span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="p">{</span>
      <span class="o">%</span><span class="mi">10</span> <span class="p">:</span> <span class="n">Tensor</span> <span class="o">=</span> <span class="n">aten</span><span class="p">::</span><span class="n">select</span><span class="p">(</span><span class="o">%</span><span class="n">x</span><span class="p">,</span> <span class="o">%</span><span class="mi">1</span><span class="p">,</span> <span class="o">%</span><span class="n">i</span><span class="p">)</span>
      <span class="o">%</span><span class="n">result</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span> <span class="n">Tensor</span> <span class="o">=</span> <span class="n">aten</span><span class="p">::</span><span class="n">mul</span><span class="p">(</span><span class="o">%</span><span class="mi">7</span><span class="p">,</span> <span class="o">%</span><span class="mi">10</span><span class="p">)</span>
      <span class="o">-&gt;</span> <span class="p">(</span><span class="o">%</span><span class="mi">5</span><span class="p">,</span> <span class="o">%</span><span class="n">result</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="p">(</span><span class="o">%</span><span class="n">result</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="tracer-warnings">
<h4><a class="toc-backref" href="#id36">Tracer Warnings</a><a class="headerlink" href="#tracer-warnings" title="Permalink to this headline">Â¶</a></h4>
<blockquote>
<div><p>The tracer produces warnings for several problematic patterns in traced
computation. As an example, take a trace of a function that contains an
in-place assignment on a slice (a view) of a Tensor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fill_row_zero</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="n">traced</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">fill_row_zero</span><span class="p">,</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">traced</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<p>Produces several warnings and a graph which simply returns the input:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>fill_row_zero.py:4: TracerWarning: There are 2 live references to the data region being modified when tracing in-place operator copy_ (possibly due to an assignment). This might cause the trace to be incorrect, because all other views that also reference this data will not reflect this change in the trace! On the other hand, if all other views use the same memory chunk, but are disjoint (e.g. are outputs of torch.split), this might still be safe.
  x[0] = torch.rand(*x.shape[1:2])
fill_row_zero.py:6: TracerWarning: Output nr 1. of the traced function does not match the corresponding output of the Python function. Detailed error:
Not within tolerance rtol=1e-05 atol=1e-05 at input[0, 1] (0.09115803241729736 vs. 0.6782537698745728) and 3 other locations (33.00%)
  traced = torch.jit.trace(fill_row_zero, (torch.rand(3, 4),))
graph(%0 : Float(3, 4)) {
  return (%0);
}
</pre></div>
</div>
<p>We can fix this by modifying the code to not use the in-place update, but
rather build up the result tensor out-of-place with <cite>torch.cat</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fill_row_zero</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]),</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="n">traced</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">fill_row_zero</span><span class="p">,</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">traced</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="frequently-asked-questions">
<h2><a class="toc-backref" href="#id37">Frequently Asked Questions</a><a class="headerlink" href="#frequently-asked-questions" title="Permalink to this headline">Â¶</a></h2>
<p>Q: I would like to train a model on GPU and do inference on CPU. What are the
best practices?</p>
<blockquote>
<div><p>First convert your model from GPU to CPU and then save it, like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cpu_model</span> <span class="o">=</span> <span class="n">gpu_model</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
<span class="n">sample_input_cpu</span> <span class="o">=</span> <span class="n">sample_input_gpu</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
<span class="n">traced_cpu</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">traced_cpu</span><span class="p">,</span> <span class="n">sample_input_cpu</span><span class="p">)</span>
<span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">traced_cpu</span><span class="p">,</span> <span class="s2">&quot;cpu.pth&quot;</span><span class="p">)</span>

<span class="n">traced_gpu</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">traced_gpu</span><span class="p">,</span> <span class="n">sample_input_gpu</span><span class="p">)</span>
<span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">traced_gpu</span><span class="p">,</span> <span class="s2">&quot;gpu.pth&quot;</span><span class="p">)</span>

<span class="c1"># ... later, when using the model:</span>

<span class="k">if</span> <span class="n">use_gpu</span><span class="p">:</span>
  <span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;gpu.pth&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
  <span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;cpu.pth&quot;</span><span class="p">)</span>

<span class="n">model</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</pre></div>
</div>
<p>This is recommended because the tracer may witness tensor creation on a
specific device, so casting an already-loaded model may have unexpected
effects. Casting the model <em>before</em> saving it ensures that the tracer has
the correct device information.</p>
</div></blockquote>
<p>Q: How do I store attributes on a <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code>?</p>
<blockquote>
<div><p>Say we have a model like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">ScriptModule</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>

  <span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script_method</span>
  <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">Model</span></code> is instantiated it will result in a compilation error
since the compiler doesnât know about <code class="docutils literal notranslate"><span class="pre">x</span></code>. There are 4 ways to inform the
compiler of attributes on <code class="docutils literal notranslate"><span class="pre">ScriptModule</span></code>:</p>
<p>1. <code class="docutils literal notranslate"><span class="pre">nn.Parameter</span></code> - values wrapped in <code class="docutils literal notranslate"><span class="pre">nn.Parameter</span></code> will work as they
do on <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code>s</p>
<p>2. <code class="docutils literal notranslate"><span class="pre">register_buffer</span></code> - values wrapped in <code class="docutils literal notranslate"><span class="pre">register_buffer</span></code> will work as
they do on <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code>s</p>
<p>3. <code class="docutils literal notranslate"><span class="pre">__constants__</span></code> - adding a list called <code class="docutils literal notranslate"><span class="pre">__constants__</span></code> at the
class definition level will mark the contained names as constants. Constants
are saved directly in the code of the model. See
<a class="reference internal" href="#python-defined-constants">Python-defined Constants</a>.</p>
<p>4. <code class="docutils literal notranslate"><span class="pre">torch.jit.Attribute</span></code> - values wrapped in <code class="docutils literal notranslate"><span class="pre">torch.jit.Attribute</span></code> can
be any <code class="docutils literal notranslate"><span class="pre">TorchScript</span></code> type, be mutated and are saved outside of the code of
the model. See <a class="reference internal" href="#module-attributes">Module Attributes</a>.</p>
</div></blockquote>
<p>Q: I would like to trace moduleâs method but I keep getting this error:</p>
<p><code class="docutils literal notranslate"><span class="pre">RuntimeError:</span> <span class="pre">Cannot</span> <span class="pre">insert</span> <span class="pre">a</span> <span class="pre">Tensor</span> <span class="pre">that</span> <span class="pre">requires</span> <span class="pre">grad</span> <span class="pre">as</span> <span class="pre">a</span> <span class="pre">constant.</span> <span class="pre">Consider</span> <span class="pre">making</span> <span class="pre">it</span> <span class="pre">a</span> <span class="pre">parameter</span> <span class="pre">or</span> <span class="pre">input,</span> <span class="pre">or</span> <span class="pre">detaching</span> <span class="pre">the</span> <span class="pre">gradient</span></code></p>
<blockquote>
<div><p>This error usually means that, the method you are tracing, uses moduleâs parameters and
you are passing moduleâs method instead of a module instance (e.g. <code class="docutils literal notranslate"><span class="pre">my_module_instance.forward</span></code> vs <code class="docutils literal notranslate"><span class="pre">my_module_instance</span></code>).</p>
<blockquote>
<div><ul class="simple">
<li><p>Invoking <code class="docutils literal notranslate"><span class="pre">trace</span></code> with moduleâs method captures module parameters (which may require gradients) as <strong>constants</strong>.</p></li>
<li><p>On the other hand, invoking <code class="docutils literal notranslate"><span class="pre">trace</span></code> with moduleâs instance (e.g. <code class="docutils literal notranslate"><span class="pre">my_module</span></code>) creates a new module and correctly copies parameters into the new module, so they can accumulate gradients if required.</p></li>
</ul>
</div></blockquote>
<p>Given that <code class="docutils literal notranslate"><span class="pre">trace</span></code> treats <code class="docutils literal notranslate"><span class="pre">my_module_instance.forward</span></code> as a standalone function, it also means there is <strong>not</strong> currently a way to trace
arbitrary methods in the module except for <code class="docutils literal notranslate"><span class="pre">forward</span></code> that use moduleâs parameters.
Version <strong>1.1.1</strong> will add a new API <code class="docutils literal notranslate"><span class="pre">trace_module</span></code> that will allow users to trace any method in the module and more than one method</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">weighted_kernel_sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">weight</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv</span><span class="o">.</span><span class="n">weight</span>

<span class="n">example_weight</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">example_forward_input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;forward&#39;</span> <span class="p">:</span> <span class="n">example_forward_input</span><span class="p">,</span> <span class="s1">&#39;weighted_kernel_sum&#39;</span> <span class="p">:</span> <span class="n">example_weight</span><span class="p">}</span>
<span class="n">module</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace_module</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">inputs</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<div class="section" id="builtin-functions">
<h3><a class="toc-backref" href="#id38">Builtin Functions</a><a class="headerlink" href="#builtin-functions" title="Permalink to this headline">Â¶</a></h3>
<p>TorchScript supports a subset of the builtin tensor and neural network
functions that PyTorch provides. Most methods on Tensor as well as functions in
the <code class="docutils literal notranslate"><span class="pre">torch</span></code> namespace, all functions in <code class="docutils literal notranslate"><span class="pre">torch.nn.functional</span></code> and all
modules from <code class="docutils literal notranslate"><span class="pre">torch.nn</span></code> are supported in TorchScript, excluding those in the
table below. For unsupported modules, we suggest using <a class="reference internal" href="#torch.jit.trace" title="torch.jit.trace"><code class="xref py py-meth docutils literal notranslate"><span class="pre">torch.jit.trace()</span></code></a>.</p>
<p>Unsupported <code class="docutils literal notranslate"><span class="pre">torch.nn</span></code> Modules</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">adaptive</span><span class="o">.</span><span class="n">AdaptiveLogSoftmaxWithLoss</span>
<span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">normalization</span><span class="o">.</span><span class="n">CrossMapLRN2d</span>
<span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">fold</span><span class="o">.</span><span class="n">Fold</span>
<span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">fold</span><span class="o">.</span><span class="n">Unfold</span>
<span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">rnn</span><span class="o">.</span><span class="n">GRU</span>
<span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">rnn</span><span class="o">.</span><span class="n">RNN</span>
</pre></div>
</div>
</div>
</div>
</div>


             </article>
             
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="multiprocessing.html" class="btn btn-neutral float-right" title="Multiprocessing package - torch.multiprocessing" accesskey="n" rel="next">Next <img src="_static/images/chevron-right-orange.svg" class="next-page"></a>
      
      
        <a href="hub.html" class="btn btn-neutral" title="torch.hub" accesskey="p" rel="prev"><img src="_static/images/chevron-right-orange.svg" class="previous-page"> Previous</a>
      
    </div>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Torch Contributors.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              <ul>
<li><a class="reference internal" href="#">TorchScript</a><ul>
<li><a class="reference internal" href="#creating-torchscript-code">Creating TorchScript Code</a></li>
<li><a class="reference internal" href="#mixing-tracing-and-scripting">Mixing Tracing and Scripting</a></li>
<li><a class="reference internal" href="#torchscript-language-reference">TorchScript Language Reference</a><ul>
<li><a class="reference internal" href="#types">Types</a><ul>
<li><a class="reference internal" href="#default-types">Default Types</a></li>
<li><a class="reference internal" href="#optional-type-refinement">Optional Type Refinement</a></li>
<li><a class="reference internal" href="#user-defined-types">User Defined Types</a></li>
</ul>
</li>
<li><a class="reference internal" href="#expressions">Expressions</a><ul>
<li><a class="reference internal" href="#literals">Literals</a><ul>
<li><a class="reference internal" href="#list-construction">List Construction</a></li>
<li><a class="reference internal" href="#tuple-construction">Tuple Construction</a></li>
<li><a class="reference internal" href="#dict-construction">Dict Construction</a></li>
</ul>
</li>
<li><a class="reference internal" href="#variables">Variables</a></li>
<li><a class="reference internal" href="#arithmetic-operators">Arithmetic Operators</a></li>
<li><a class="reference internal" href="#comparison-operators">Comparison Operators</a></li>
<li><a class="reference internal" href="#logical-operators">Logical Operators</a></li>
<li><a class="reference internal" href="#subscripts">Subscripts</a></li>
<li><a class="reference internal" href="#function-calls">Function Calls</a></li>
<li><a class="reference internal" href="#method-calls">Method Calls</a></li>
<li><a class="reference internal" href="#ternary-expressions">Ternary Expressions</a></li>
<li><a class="reference internal" href="#casts">Casts</a></li>
<li><a class="reference internal" href="#accessing-module-parameters">Accessing Module Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#statements">Statements</a></li>
<li><a class="reference internal" href="#variable-resolution">Variable Resolution</a></li>
<li><a class="reference internal" href="#use-of-python-values">Use of Python Values</a><ul>
<li><a class="reference internal" href="#functions">Functions</a></li>
<li><a class="reference internal" href="#attribute-lookup-on-python-modules">Attribute Lookup On Python Modules</a></li>
<li><a class="reference internal" href="#python-defined-constants">Python-defined Constants</a></li>
<li><a class="reference internal" href="#module-attributes">Module Attributes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#debugging">Debugging</a><ul>
<li><a class="reference internal" href="#disable-jit-for-debugging">Disable JIT for Debugging</a></li>
<li><a class="reference internal" href="#inspecting-code">Inspecting Code</a></li>
<li><a class="reference internal" href="#interpreting-graphs">Interpreting Graphs</a></li>
<li><a class="reference internal" href="#tracing-edge-cases">Tracing Edge Cases</a></li>
<li><a class="reference internal" href="#automatic-trace-checking">Automatic Trace Checking</a></li>
<li><a class="reference internal" href="#tracer-warnings">Tracer Warnings</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#frequently-asked-questions">Frequently Asked Questions</a><ul>
<li><a class="reference internal" href="#builtin-functions">Builtin Functions</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
         <script type="text/javascript" src="_static/jquery.js"></script>
         <script type="text/javascript" src="_static/underscore.js"></script>
         <script type="text/javascript" src="_static/doctools.js"></script>
         <script type="text/javascript" src="_static/language_data.js"></script>
     

  

  <script type="text/javascript" src="_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="_static/js/vendor/bootstrap.min.js"></script>
  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access comprehensive developer documentation for PyTorch</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get in-depth tutorials for beginners and advanced developers</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Resources</h2>
          <p>Find development resources and get your questions answered</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">View Resources</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">Get Started</a></li>
            <li><a href="https://pytorch.org/features">Features</a></li>
            <li><a href="https://pytorch.org/ecosystem">Ecosystem</a></li>
            <li><a href="https://pytorch.org/blog/">Blog</a></li>
            <li><a href="https://pytorch.org/resources">Resources</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/support">Support</a></li>
            <li><a href="https://pytorch.org/tutorials">Tutorials</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">Docs</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">Discuss</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github Issues</a></li>
            <li><a href="https://pytorch.slack.com" target="_blank">Slack</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md" target="_blank">Contributing</a></li>
          </ul>
        </div>

        <div class="footer-links-col follow-us-col">
          <ul>
            <li class="list-title">Follow Us</li>
            <li>
              <div id="mc_embed_signup">
                <form
                  action="https://twitter.us14.list-manage.com/subscribe/post?u=75419c71fe0a935e53dfa4a3f&id=91d0dccd39"
                  method="post"
                  id="mc-embedded-subscribe-form"
                  name="mc-embedded-subscribe-form"
                  class="email-subscribe-form validate"
                  target="_blank"
                  novalidate>
                  <div id="mc_embed_signup_scroll" class="email-subscribe-form-fields-wrapper">
                    <div class="mc-field-group">
                      <label for="mce-EMAIL" style="display:none;">Email Address</label>
                      <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="Email Address">
                    </div>

                    <div id="mce-responses" class="clear">
                      <div class="response" id="mce-error-response" style="display:none"></div>
                      <div class="response" id="mce-success-response" style="display:none"></div>
                    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->

                    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_75419c71fe0a935e53dfa4a3f_91d0dccd39" tabindex="-1" value=""></div>

                    <div class="clear">
                      <input type="submit" value="" name="subscribe" id="mc-embedded-subscribe" class="button email-subscribe-button">
                    </div>
                  </div>
                </form>
              </div>

            </li>
          </ul>

          <div class="footer-social-icons">
            <a href="https://www.facebook.com/pytorch" target="_blank" class="facebook"></a>
            <a href="https://twitter.com/pytorch" target="_blank" class="twitter"></a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebookâs Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="#">Get Started</a>
          </li>

          <li>
            <a href="#">Features</a>
          </li>

          <li>
            <a href="#">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="active">
            <a href="https://pytorch.org/docs/stable/index.html">Docs</a>
          </li>

          <li>
            <a href="https://pytorch.org/resources">Resources</a>
          </li>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>