


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta name="robots" content="noindex">
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TorchScript Language Reference &mdash; PyTorch 1.12 documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://pytorch.org/docs/stable/jit_language_reference_v2.html"/>
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/katex-math.css" type="text/css" />
  <link rel="stylesheet" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
  <link rel="stylesheet" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/jit.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="torch.jit.script" href="generated/torch.jit.script.html" />
    <link rel="prev" title="TorchScript Language Reference" href="jit_language_reference.html" />


  <!-- Google Analytics -->
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-117752657-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-117752657-2');
    </script>
  
  <!-- End Google Analytics -->
  


  
  <script src="_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="active docs-active">
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-orange-arrow">
                Docs
              </a>
              <div class="resources-dropdown-menu">
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/docs/stable/index.html">
                  <span class="dropdown-title">PyTorch</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/audio/stable/index.html">
                  <span class="dropdown-title">torchaudio</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/text/stable/index.html">
                  <span class="dropdown-title">torchtext</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/vision/stable/index.html">
                  <span class="dropdown-title">torchvision</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/torchrec">
                  <span class="dropdown-title">TorchRec</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/data">
                  <span class="dropdown-title">TorchData</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/serve/">
                  <span class="dropdown-title">TorchServe</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/torchx/">
                  <span class="dropdown-title">TorchX</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/xla">
                  <span class="dropdown-title">PyTorch on XLA Devices</span>
                  <p></p>
                </a>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-arrow">
                Resources
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/features">
                  <span class="dropdown-title">About</span>
                  <p>Learn about PyTorch’s features and capabilities</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/#community-module">
                  <span class="dropdown-title">Community</span>
                  <p>Join the PyTorch developer community to contribute, learn, and get your questions answered.</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/resources">
                  <span class="dropdown-title">Developer Resources</span>
                  <p>Find resources and get questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="https://discuss.pytorch.org/" target="_blank">
                  <span class="dropdown-title">Forums</span>
                  <p>A place to discuss PyTorch code, issues, install, research</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/hub">
                  <span class="dropdown-title">Models (Beta)</span>
                  <p>Discover, publish, and reuse pre-trained models</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <a href="https://github.com/pytorch/pytorch">GitHub</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>

<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            
    <div class="version">
      <a href='https://pytorch.org/docs/versions.html'>1.12 &#x25BC</a>
    </div>
    


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          </div>

          


            
            
              
            
            
<p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="community/build_ci_governance.html">PyTorch Governance | Build + CI</a></li>
<li class="toctree-l1"><a class="reference internal" href="community/contribution_guide.html">PyTorch Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="community/design.html">PyTorch Design Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="community/governance.html">PyTorch Governance | Mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="community/persons_of_interest.html">PyTorch Governance | Maintainers</a></li>
</ul>
              <p class="caption"><span class="caption-text">Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="notes/amp_examples.html">CUDA Automatic Mixed Precision examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/autograd.html">Autograd mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/broadcasting.html">Broadcasting semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/cpu_threading_torchscript_inference.html">CPU threading and TorchScript inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/cuda.html">CUDA semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/ddp.html">Distributed Data Parallel</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/extending.html">Extending PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/gradcheck.html">Gradcheck mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/hip.html">HIP (ROCm) semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/large_scale_deployments.html">Features for large-scale deployments</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/mps.html">MPS backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/multiprocessing.html">Multiprocessing best practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/numerical_accuracy.html">Numerical accuracy</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/randomness.html">Reproducibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/serialization.html">Serialization semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/windows.html">Windows FAQ</a></li>
</ul>
<p class="caption"><span class="caption-text">Language Bindings</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cpp_index.html">C++</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/javadoc/">Javadoc</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy.html">torch::deploy</a></li>
</ul>
<p class="caption"><span class="caption-text">Python API</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="torch.html">torch</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.html">torch.nn</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.functional.html">torch.nn.functional</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensors.html">torch.Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensor_attributes.html">Tensor Attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensor_view.html">Tensor Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="amp.html">torch.amp</a></li>
<li class="toctree-l1"><a class="reference internal" href="autograd.html">torch.autograd</a></li>
<li class="toctree-l1"><a class="reference internal" href="library.html">torch.library</a></li>
<li class="toctree-l1"><a class="reference internal" href="cuda.html">torch.cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="backends.html">torch.backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.html">torch.distributed</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.algorithms.join.html">torch.distributed.algorithms.join</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.elastic.html">torch.distributed.elastic</a></li>
<li class="toctree-l1"><a class="reference internal" href="fsdp.html">torch.distributed.fsdp</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.optim.html">torch.distributed.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributions.html">torch.distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="fft.html">torch.fft</a></li>
<li class="toctree-l1"><a class="reference internal" href="futures.html">torch.futures</a></li>
<li class="toctree-l1"><a class="reference internal" href="fx.html">torch.fx</a></li>
<li class="toctree-l1"><a class="reference internal" href="hub.html">torch.hub</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="jit.html">torch.jit</a></li>
<li class="toctree-l1"><a class="reference internal" href="linalg.html">torch.linalg</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitor.html">torch.monitor</a></li>
<li class="toctree-l1"><a class="reference internal" href="special.html">torch.special</a></li>
<li class="toctree-l1"><a class="reference internal" href="torch.overrides.html">torch.overrides</a></li>
<li class="toctree-l1"><a class="reference internal" href="package.html">torch.package</a></li>
<li class="toctree-l1"><a class="reference internal" href="profiler.html">torch.profiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.init.html">torch.nn.init</a></li>
<li class="toctree-l1"><a class="reference internal" href="onnx.html">torch.onnx</a></li>
<li class="toctree-l1"><a class="reference internal" href="optim.html">torch.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="complex_numbers.html">Complex Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="ddp_comm_hooks.html">DDP Communication Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipeline.html">Pipeline Parallelism</a></li>
<li class="toctree-l1"><a class="reference internal" href="quantization.html">Quantization</a></li>
<li class="toctree-l1"><a class="reference internal" href="rpc.html">Distributed RPC Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="random.html">torch.random</a></li>
<li class="toctree-l1"><a class="reference internal" href="nested.html">torch.nested</a></li>
<li class="toctree-l1"><a class="reference internal" href="sparse.html">torch.sparse</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage.html">torch.Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">torch.testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmark_utils.html">torch.utils.benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="bottleneck.html">torch.utils.bottleneck</a></li>
<li class="toctree-l1"><a class="reference internal" href="checkpoint.html">torch.utils.checkpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpp_extension.html">torch.utils.cpp_extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">torch.utils.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="dlpack.html">torch.utils.dlpack</a></li>
<li class="toctree-l1"><a class="reference internal" href="mobile_optimizer.html">torch.utils.mobile_optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_zoo.html">torch.utils.model_zoo</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensorboard.html">torch.utils.tensorboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="type_info.html">Type Info</a></li>
<li class="toctree-l1"><a class="reference internal" href="named_tensor.html">Named Tensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="name_inference.html">Named Tensors operator coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="config_mod.html">torch.__config__</a></li>
</ul>
<p class="caption"><span class="caption-text">Libraries</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/audio/stable">torchaudio</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/data">TorchData</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/torchrec">TorchRec</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/serve">TorchServe</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/text/stable">torchtext</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/vision/stable">torchvision</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pytorch.org/xla/">PyTorch on XLA Devices</a></li>
</ul>

            
          

        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
          <li><a href="jit.html">TorchScript</a> &gt;</li>
        
      <li>TorchScript Language Reference</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
            
            <a href="_sources/jit_language_reference_v2.rst.txt" rel="nofollow"><img src="_static/images/view-page-source-icon.svg"></a>
          
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <div class="section" id="torchscript-language-reference">
<span id="language-reference-v2"></span><h1>TorchScript Language Reference<a class="headerlink" href="#torchscript-language-reference" title="Permalink to this headline">¶</a></h1>
<p>This reference manual describes the syntax and core semantics of the TorchScript language.
TorchScript is a statically typed subset of the Python language. This document explains the supported features of
Python in TorchScript and also how the language diverges from regular Python. Any features of Python that are not mentioned in
this reference manual are not part of TorchScript. TorchScript focuses specifically on the features of Python that are needed to
represent neural network models in PyTorch.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#terminology" id="id7">Terminology</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id8">Type System</a></p></li>
<li><p><a class="reference internal" href="#type-annotation" id="id9">Type Annotation</a></p></li>
<li><p><a class="reference internal" href="#expressions" id="id10">Expressions</a></p></li>
<li><p><a class="reference internal" href="#simple-statements" id="id11">Simple Statements</a></p></li>
<li><p><a class="reference internal" href="#compound-statements" id="id12">Compound Statements</a></p></li>
<li><p><a class="reference internal" href="#python-values" id="id13">Python Values</a></p></li>
<li><p><a class="reference internal" href="#torch-apis" id="id14">torch.* APIs</a></p></li>
</ul>
</div>
<div class="section" id="terminology">
<span id="type-system"></span><h2><a class="toc-backref" href="#id7">Terminology</a><a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h2>
<p>This document uses the following terminologies:</p>
<table class="colwidths-given docutils colwidths-auto align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Pattern</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">::=</span></code></p></td>
<td><p>Indicates that the given symbol is defined as.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;</span> <span class="pre">&quot;</span></code></p></td>
<td><p>Represents real keywords and delimiters that are part of the syntax.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">|</span> <span class="pre">B</span></code></p></td>
<td><p>Indicates either A or B.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">(</span> <span class="pre">)</span></code></p></td>
<td><p>Indicates grouping.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">[]</span></code></p></td>
<td><p>Indicates optional.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">A+</span></code></p></td>
<td><p>Indicates a regular expression where term A is repeated at least once.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">A*</span></code></p></td>
<td><p>Indicates a regular expression where term A is repeated zero or more times.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id8">Type System</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>TorchScript is a statically typed subset of Python. The largest difference between TorchScript and the full Python language is that TorchScript only supports a small set of types that are needed to express
neural net models.</p>
<div class="section" id="torchscript-types">
<h3>TorchScript Types<a class="headerlink" href="#torchscript-types" title="Permalink to this headline">¶</a></h3>
<p>The TorchScript type system consists of <code class="docutils literal notranslate"><span class="pre">TSType</span></code> and <code class="docutils literal notranslate"><span class="pre">TSModuleType</span></code> as defined below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TSAllType</span> <span class="p">:</span><span class="o">:=</span> <span class="n">TSType</span> <span class="o">|</span> <span class="n">TSModuleType</span>
<span class="n">TSType</span>    <span class="p">:</span><span class="o">:=</span> <span class="n">TSMetaType</span> <span class="o">|</span> <span class="n">TSPrimitiveType</span> <span class="o">|</span> <span class="n">TSStructuralType</span> <span class="o">|</span> <span class="n">TSNominalType</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">TSType</span></code> represents the majority of TorchScript types that are composable and that can be used in TorchScript type annotations.
<code class="docutils literal notranslate"><span class="pre">TSType</span></code> refers to any of the following:</p>
<ul class="simple">
<li><p>Meta Types, e.g., <code class="docutils literal notranslate"><span class="pre">Any</span></code></p></li>
<li><p>Primitive Types, e.g., <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code>, and <code class="docutils literal notranslate"><span class="pre">str</span></code></p></li>
<li><p>Structural Types, e.g., <code class="docutils literal notranslate"><span class="pre">Optional[int]</span></code> or <code class="docutils literal notranslate"><span class="pre">List[MyClass]</span></code></p></li>
<li><p>Nominal Types (Python classes), e.g., <code class="docutils literal notranslate"><span class="pre">MyClass</span></code> (user-defined), <code class="docutils literal notranslate"><span class="pre">torch.tensor</span></code> (built-in)</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">TSModuleType</span></code> represents <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> and its subclasses. It is treated differently from <code class="docutils literal notranslate"><span class="pre">TSType</span></code> because its type schema is inferred partly from the object instance and partly from the class definition.
As such, instances of a <code class="docutils literal notranslate"><span class="pre">TSModuleType</span></code> may not follow the same static type schema. <code class="docutils literal notranslate"><span class="pre">TSModuleType</span></code> cannot be used as a TorchScript type annotation or be composed with <code class="docutils literal notranslate"><span class="pre">TSType</span></code> for type safety considerations.</p>
</div>
<div class="section" id="meta-types">
<h3>Meta Types<a class="headerlink" href="#meta-types" title="Permalink to this headline">¶</a></h3>
<p>Meta types are so abstract that they are more like type constraints than concrete types.
Currently TorchScript defines one meta-type, <code class="docutils literal notranslate"><span class="pre">Any</span></code>, that represents any TorchScript type.</p>
<div class="section" id="any-type">
<h4><code class="docutils literal notranslate"><span class="pre">Any</span></code> Type<a class="headerlink" href="#any-type" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">Any</span></code> type represents any TorchScript type. <code class="docutils literal notranslate"><span class="pre">Any</span></code> specifies no type constraints, thus there is no type-checking on <code class="docutils literal notranslate"><span class="pre">Any</span></code>.
As such it can be bound to any Python or TorchScript data types (e.g., <code class="docutils literal notranslate"><span class="pre">int</span></code>, TorchScript <code class="docutils literal notranslate"><span class="pre">tuple</span></code>, or an arbitrary Python class that is not scripted).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TSMetaType</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;Any&quot;</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Any</span></code> is the Python class name from the typing module. Therefore, to use the <code class="docutils literal notranslate"><span class="pre">Any</span></code> type, you must import it from <code class="docutils literal notranslate"><span class="pre">typing</span></code> (e.g., <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">typing</span> <span class="pre">import</span> <span class="pre">Any</span></code>).</p></li>
<li><p>Since <code class="docutils literal notranslate"><span class="pre">Any</span></code> can represent any TorchScript type, the set of operators that are allowed to operate on values of this type on <code class="docutils literal notranslate"><span class="pre">Any</span></code> is limited.</p></li>
</ul>
</div>
<div class="section" id="operators-supported-for-any-type">
<h4>Operators Supported for <code class="docutils literal notranslate"><span class="pre">Any</span></code> Type<a class="headerlink" href="#operators-supported-for-any-type" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Assignment to data of <code class="docutils literal notranslate"><span class="pre">Any</span></code> type.</p></li>
<li><p>Binding to parameter or return of <code class="docutils literal notranslate"><span class="pre">Any</span></code> type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">is</span></code>, <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">is</span> <span class="pre">not</span></code> where <code class="docutils literal notranslate"><span class="pre">x</span></code> is of <code class="docutils literal notranslate"><span class="pre">Any</span></code> type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">isinstance(x,</span> <span class="pre">Type)</span></code> where <code class="docutils literal notranslate"><span class="pre">x</span></code> is of <code class="docutils literal notranslate"><span class="pre">Any</span></code> type.</p></li>
<li><p>Data of <code class="docutils literal notranslate"><span class="pre">Any</span></code> type is printable.</p></li>
<li><p>Data of <code class="docutils literal notranslate"><span class="pre">List[Any]</span></code> type may be sortable if the data is a list of values of the same type <code class="docutils literal notranslate"><span class="pre">T</span></code> and that <code class="docutils literal notranslate"><span class="pre">T</span></code> supports comparison operators.</p></li>
</ul>
<p><strong>Compared to Python</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">Any</span></code> is the least constrained type in the TorchScript type system. In that sense, it is quite similar to the
<code class="docutils literal notranslate"><span class="pre">Object</span></code> class in Python. However, <code class="docutils literal notranslate"><span class="pre">Any</span></code> only supports a subset of the operators and methods that are supported by <code class="docutils literal notranslate"><span class="pre">Object</span></code>.</p>
</div>
<div class="section" id="design-notes">
<h4>Design Notes<a class="headerlink" href="#design-notes" title="Permalink to this headline">¶</a></h4>
<p>When we script a PyTorch module, we may encounter data that is not involved in the execution of the script. Nevertheless, it has to be described
by a type schema. It is not only cumbersome to describe static types for unused data (in the context of the script), but also may lead to unnecessary
scripting failures. <code class="docutils literal notranslate"><span class="pre">Any</span></code> is introduced to describe the type of the data where precise static types are not necessary for compilation.</p>
<p><strong>Example 1</strong></p>
<p>This example illustrates how <code class="docutils literal notranslate"><span class="pre">Any</span></code> can be used to allow the second element of the tuple parameter to be of any type. This is possible
because <code class="docutils literal notranslate"><span class="pre">x[1]</span></code> is not involved in any computation that requires knowing its precise type.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">export</span>
<span class="k">def</span> <span class="nf">inc_first_element</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">inc_first_element</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mf">2.0</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">((</span><span class="mi">1</span><span class="p">,(</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">))))</span>
</pre></div>
</div>
<p>The example above produces the following output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(2, 2.0)
(2, (100, 200))
</pre></div>
</div>
<p>The second element of the tuple is of <code class="docutils literal notranslate"><span class="pre">Any</span></code> type, thus can bind to multiple types.
For example, <code class="docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">2.0)</span></code> binds a float type to <code class="docutils literal notranslate"><span class="pre">Any</span></code> as in <code class="docutils literal notranslate"><span class="pre">Tuple[int,</span> <span class="pre">Any]</span></code>,
whereas <code class="docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">(100,</span> <span class="pre">200))</span></code> binds a tuple to <code class="docutils literal notranslate"><span class="pre">Any</span></code> in the second invocation.</p>
<p><strong>Example 2</strong></p>
<p>This example illustrates how we can use <code class="docutils literal notranslate"><span class="pre">isinstance</span></code> to dynamically check the type of the data that is annotated as <code class="docutils literal notranslate"><span class="pre">Any</span></code> type:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="n">Any</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">))</span>

<span class="n">ones</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">ones</span><span class="p">))</span>
</pre></div>
</div>
<p>The example above produces the following output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> 1
 1
[ CPUFloatType{2} ]
True
</pre></div>
</div>
</div>
</div>
<div class="section" id="primitive-types">
<h3>Primitive Types<a class="headerlink" href="#primitive-types" title="Permalink to this headline">¶</a></h3>
<p>Primitive TorchScript types are types that represent a single type of value and go with a single pre-defined
type name.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TSPrimitiveType</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;int&quot;</span> <span class="o">|</span> <span class="s2">&quot;float&quot;</span> <span class="o">|</span> <span class="s2">&quot;double&quot;</span> <span class="o">|</span> <span class="s2">&quot;complex&quot;</span> <span class="o">|</span> <span class="s2">&quot;bool&quot;</span> <span class="o">|</span> <span class="s2">&quot;str&quot;</span> <span class="o">|</span> <span class="s2">&quot;None&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="structural-types">
<h3>Structural Types<a class="headerlink" href="#structural-types" title="Permalink to this headline">¶</a></h3>
<p>Structural types are types that are structurally defined without a user-defined name (unlike nominal types),
such as <code class="docutils literal notranslate"><span class="pre">Future[int]</span></code>. Structural types are composable with any <code class="docutils literal notranslate"><span class="pre">TSType</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TSStructuralType</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">TSTuple</span> <span class="o">|</span> <span class="n">TSNamedTuple</span> <span class="o">|</span> <span class="n">TSList</span> <span class="o">|</span> <span class="n">TSDict</span> <span class="o">|</span>
                    <span class="n">TSOptional</span> <span class="o">|</span> <span class="n">TSUnion</span> <span class="o">|</span> <span class="n">TSFuture</span> <span class="o">|</span> <span class="n">TSRRef</span>

<span class="n">TSTuple</span>          <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;Tuple&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="p">(</span><span class="n">TSType</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">*</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">TSNamedTuple</span>     <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;namedtuple&quot;</span> <span class="s2">&quot;(&quot;</span> <span class="p">(</span><span class="n">TSType</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">*</span> <span class="n">TSType</span> <span class="s2">&quot;)&quot;</span>
<span class="n">TSList</span>           <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;List&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">TSOptional</span>       <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;Optional&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">TSUnion</span>          <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;Union&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="p">(</span><span class="n">TSType</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">*</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">TSFuture</span>         <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;Future&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">TSRRef</span>           <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;RRef&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">TSDict</span>           <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;Dict&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="n">KeyType</span> <span class="s2">&quot;,&quot;</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">KeyType</span>          <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;str&quot;</span> <span class="o">|</span> <span class="s2">&quot;int&quot;</span> <span class="o">|</span> <span class="s2">&quot;float&quot;</span> <span class="o">|</span> <span class="s2">&quot;bool&quot;</span> <span class="o">|</span> <span class="n">TensorType</span> <span class="o">|</span> <span class="s2">&quot;Any&quot;</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Tuple</span></code>, <code class="docutils literal notranslate"><span class="pre">List</span></code>, <code class="docutils literal notranslate"><span class="pre">Optional</span></code>, <code class="docutils literal notranslate"><span class="pre">Union</span></code>, <code class="docutils literal notranslate"><span class="pre">Future</span></code>, <code class="docutils literal notranslate"><span class="pre">Dict</span></code> represent Python type class names that are defined in the module <code class="docutils literal notranslate"><span class="pre">typing</span></code>. To use these type names, you must import them from <code class="docutils literal notranslate"><span class="pre">typing</span></code> (e.g., <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">typing</span> <span class="pre">import</span> <span class="pre">Tuple</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">namedtuple</span></code> represents the Python class <code class="docutils literal notranslate"><span class="pre">collections.namedtuple</span></code> or <code class="docutils literal notranslate"><span class="pre">typing.NamedTuple</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Future</span></code> and <code class="docutils literal notranslate"><span class="pre">RRef</span></code> represent the Python classes <code class="docutils literal notranslate"><span class="pre">torch.futures</span></code> and <code class="docutils literal notranslate"><span class="pre">torch.distributed.rpc</span></code>.</p></li>
</ul>
<p><strong>Compared to Python</strong></p>
<p>Apart from being composable with TorchScript types, these TorchScript structural types often support a common subset of the operators and methods of their Python counterparts.</p>
<p><strong>Example 1</strong></p>
<p>This example uses <code class="docutils literal notranslate"><span class="pre">typing.NamedTuple</span></code> syntax to define a tuple:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>

<span class="k">class</span> <span class="nc">MyTuple</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
    <span class="n">first</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">second</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">MyTuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">first</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">second</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">MyTuple</span><span class="p">(</span><span class="n">first</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">scripted_inc</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TorchScript:&quot;</span><span class="p">,</span> <span class="n">scripted_inc</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
</pre></div>
</div>
<p>The example above produces the following output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>TorchScript: (2, 3)
</pre></div>
</div>
<p><strong>Example 2</strong></p>
<p>This example uses <code class="docutils literal notranslate"><span class="pre">collections.namedtuple</span></code> syntax to define a tuple:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="n">_AnnotatedNamedTuple</span> <span class="o">=</span> <span class="n">NamedTuple</span><span class="p">(</span><span class="s1">&#39;_NamedTupleAnnotated&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">)])</span>
<span class="n">_UnannotatedNamedTuple</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;_NamedTupleAnnotated&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">_AnnotatedNamedTuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">first</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">second</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">inc</span><span class="p">(</span><span class="n">_UnannotatedNamedTuple</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
<p>The example above produces the following output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(2, 3)
</pre></div>
</div>
<p><strong>Example 3</strong></p>
<p>This example illustrates a common mistake of annotating structural types, i.e., not importing the composite type
classes from the <code class="docutils literal notranslate"><span class="pre">typing</span></code> module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="c1"># ERROR: Tuple not recognized because not imported from typing</span>
<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">export</span>
<span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
<p>Running the above code yields the following scripting error:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">File</span> <span class="s2">&quot;test-tuple.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">5</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
<span class="ne">NameError</span><span class="p">:</span> <span class="n">name</span> <span class="s1">&#39;Tuple&#39;</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span>
</pre></div>
</div>
<p>The remedy is to add the line <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">typing</span> <span class="pre">import</span> <span class="pre">Tuple</span></code> to the beginning of the code.</p>
</div>
<div class="section" id="nominal-types">
<h3>Nominal Types<a class="headerlink" href="#nominal-types" title="Permalink to this headline">¶</a></h3>
<p>Nominal TorchScript types are Python classes. These types are called nominal because they are declared with a custom
name and are compared using class names. Nominal classes are further classified into the following categories:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TSNominalType</span> <span class="p">:</span><span class="o">:=</span> <span class="n">TSBuiltinClasses</span> <span class="o">|</span> <span class="n">TSCustomClass</span> <span class="o">|</span> <span class="n">TSEnum</span>
</pre></div>
</div>
<p>Among them, <code class="docutils literal notranslate"><span class="pre">TSCustomClass</span></code> and <code class="docutils literal notranslate"><span class="pre">TSEnum</span></code> must be compilable to TorchScript Intermediate Representation (IR). This is enforced by the type-checker.</p>
</div>
<div class="section" id="built-in-class">
<h3>Built-in Class<a class="headerlink" href="#built-in-class" title="Permalink to this headline">¶</a></h3>
<p>Built-in nominal types are Python classes whose semantics are built into the TorchScript system (e.g., tensor types).
TorchScript defines the semantics of these built-in nominal types, and often supports only a subset of the methods or
attributes of its Python class definition.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TSBuiltinClass</span> <span class="p">:</span><span class="o">:=</span> <span class="n">TSTensor</span> <span class="o">|</span> <span class="s2">&quot;torch.device&quot;</span> <span class="o">|</span> <span class="s2">&quot;torch.Stream&quot;</span> <span class="o">|</span> <span class="s2">&quot;torch.dtype&quot;</span> <span class="o">|</span>
                   <span class="s2">&quot;torch.nn.ModuleList&quot;</span> <span class="o">|</span> <span class="s2">&quot;torch.nn.ModuleDict&quot;</span> <span class="o">|</span> <span class="o">...</span>
<span class="n">TSTensor</span>       <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;torch.Tensor&quot;</span> <span class="o">|</span> <span class="s2">&quot;common.SubTensor&quot;</span> <span class="o">|</span> <span class="s2">&quot;common.SubWithTorchFunction&quot;</span> <span class="o">|</span>
                   <span class="s2">&quot;torch.nn.parameter.Parameter&quot;</span> <span class="o">|</span> <span class="ow">and</span> <span class="n">subclasses</span> <span class="n">of</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</pre></div>
</div>
<div class="section" id="special-note-on-torch-nn-modulelist-and-torch-nn-moduledict">
<h4>Special Note on torch.nn.ModuleList and torch.nn.ModuleDict<a class="headerlink" href="#special-note-on-torch-nn-modulelist-and-torch-nn-moduledict" title="Permalink to this headline">¶</a></h4>
<p>Although <code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleList</span></code> and <code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleDict</span></code> are defined as a list and dictionary in Python,
they behave more like tuples in TorchScript:</p>
<ul class="simple">
<li><p>In TorchScript, instances of <code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleList</span></code>  or <code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleDict</span></code> are immutable.</p></li>
<li><p>Code that iterates over <code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleList</span></code> or <code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleDict</span></code> is completely unrolled so that elements of <code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleList</span></code> or keys of <code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleDict</span></code> can be of different subclasses of <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>.</p></li>
</ul>
<p><strong>Example</strong></p>
<p>The following example highlights the use of a few built-in Torchscript classes (<code class="docutils literal notranslate"><span class="pre">torch.*</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">g</span><span class="p">():</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">))</span>

<span class="n">script_g</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">script_g</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="custom-class">
<h3>Custom Class<a class="headerlink" href="#custom-class" title="Permalink to this headline">¶</a></h3>
<p>Unlike built-in classes, semantics of custom classes are user-defined and the entire class definition must be compilable to TorchScript IR and subject to TorchScript type-checking rules.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TSClassDef</span> <span class="p">:</span><span class="o">:=</span> <span class="p">[</span> <span class="s2">&quot;@torch.jit.script&quot;</span> <span class="p">]</span>
                 <span class="s2">&quot;class&quot;</span> <span class="n">ClassName</span> <span class="p">[</span> <span class="s2">&quot;(object)&quot;</span> <span class="p">]</span>  <span class="s2">&quot;:&quot;</span>
                    <span class="n">MethodDefinition</span> <span class="o">|</span>
                <span class="p">[</span> <span class="s2">&quot;@torch.jit.ignore&quot;</span> <span class="p">]</span> <span class="o">|</span> <span class="p">[</span> <span class="s2">&quot;@torch.jit.unused&quot;</span> <span class="p">]</span>
                    <span class="n">MethodDefinition</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p>Classes must be new-style classes. Python 3 supports only new-style classes. In Python 2.x, a new-style class is specified by subclassing from the object.</p></li>
<li><p>Instance data attributes are statically typed, and instance attributes must be declared by assignments inside the <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> method.</p></li>
<li><p>Method overloading is not supported (i.e., you cannot have multiple methods with the same method name).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MethodDefinition</span></code> must be compilable to TorchScript IR and adhere to TorchScript’s type-checking rules, (i.e., all methods must be valid TorchScript functions and class attribute definitions must be valid TorchScript statements).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">torch.jit.ignore</span></code> and <code class="docutils literal notranslate"><span class="pre">torch.jit.unused</span></code> can be used to ignore the method or function that is not fully torchscriptable or should be ignored by the compiler.</p></li>
</ul>
<p><strong>Compared to Python</strong></p>
<p>TorchScript custom classes are quite limited compared to their Python counterpart. Torchscript custom classes:</p>
<ul class="simple">
<li><p>Do not support class attributes.</p></li>
<li><p>Do not support subclassing except for subclassing an interface type or object.</p></li>
<li><p>Do not support method overloading.</p></li>
<li><p>Must initialize all its instance attributes in  <code class="docutils literal notranslate"><span class="pre">__init__()</span></code>; this is because TorchScript constructs a static schema of the class by inferring attribute types in <code class="docutils literal notranslate"><span class="pre">__init__()</span></code>.</p></li>
<li><p>Must contain only methods that satisfy TorchScript type-checking rules and are compilable to TorchScript IRs.</p></li>
</ul>
<p><strong>Example 1</strong></p>
<p>Python classes can be used in TorchScript if they are annotated with <code class="docutils literal notranslate"><span class="pre">&#64;torch.jit.script</span></code>, similar to how a TorchScript function would be declared:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">class</span> <span class="nc">MyClass</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">val</span>
</pre></div>
</div>
<p><strong>Example 2</strong></p>
<p>A TorchScript custom class type must “declare” all its instance attributes by assignments in <code class="docutils literal notranslate"><span class="pre">__init__()</span></code>. If an instance attribute is not defined in <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> but accessed in other methods of the class, the class cannot be compiled as a TorchScript class, as shown in the following example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">class</span> <span class="nc">foo</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># ERROR: self.x is not defined in __init__</span>
<span class="k">def</span> <span class="nf">assign_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>The class will fail to compile and issue the following error:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>RuntimeError:
Tried to set nonexistent attribute: x. Did you forget to initialize it in __init__()?:
def assign_x(self):
    self.x = torch.rand(2, 3)
    ~~~~~~~~~~~~~~~~~~~~~~~~ &lt;--- HERE
</pre></div>
</div>
<p><strong>Example 3</strong></p>
<p>In this example, a TorchScript custom class defines a class variable name, which is not allowed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;MyClass&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>

<span class="k">def</span> <span class="nf">fn</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">MyClass</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<p>It leads to the following compile-time error:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>RuntimeError:
&#39;__torch__.MyClass&#39; object has no attribute or method &#39;name&#39;. Did you forget to initialize an attribute in __init__()?:
    File &quot;test-class2.py&quot;, line 10
def fn(a: MyClass):
    return a.name
        ~~~~~~ &lt;--- HERE
</pre></div>
</div>
</div>
<div class="section" id="enum-type">
<h3>Enum Type<a class="headerlink" href="#enum-type" title="Permalink to this headline">¶</a></h3>
<p>Like custom classes, semantics of the enum type are user-defined and the entire class definition must be compilable to TorchScript IR and adhere to TorchScript type-checking rules.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TSEnumDef</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;class&quot;</span> <span class="n">Identifier</span> <span class="s2">&quot;(enum.Enum | TSEnumType)&quot;</span> <span class="s2">&quot;:&quot;</span>
               <span class="p">(</span> <span class="n">MemberIdentifier</span> <span class="s2">&quot;=&quot;</span> <span class="n">Value</span> <span class="p">)</span><span class="o">+</span>
               <span class="p">(</span> <span class="n">MethodDefinition</span> <span class="p">)</span><span class="o">*</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p>Value must be a TorchScript literal of type <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code>, or <code class="docutils literal notranslate"><span class="pre">str</span></code>, and must be of the same TorchScript type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TSEnumType</span></code> is the name of a TorchScript enumerated type. Similar to Python enum, TorchScript allows restricted <code class="docutils literal notranslate"><span class="pre">Enum</span></code> subclassing, that is, subclassing an enumerated is allowed only if it does not define any members.</p></li>
</ul>
<p><strong>Compared to Python</strong></p>
<ul class="simple">
<li><p>TorchScript supports only <code class="docutils literal notranslate"><span class="pre">enum.Enum</span></code>. It does not support other variations such as <code class="docutils literal notranslate"><span class="pre">enum.IntEnum</span></code>, <code class="docutils literal notranslate"><span class="pre">enum.Flag</span></code>, <code class="docutils literal notranslate"><span class="pre">enum.IntFlag</span></code>, and <code class="docutils literal notranslate"><span class="pre">enum.auto</span></code>.</p></li>
<li><p>Values of TorchScript enum members must be of the same type and can only be <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code>, or <code class="docutils literal notranslate"><span class="pre">str</span></code> types, whereas Python enum members can be of any type.</p></li>
<li><p>Enums containing methods are ignored in TorchScript.</p></li>
</ul>
<p><strong>Example 1</strong></p>
<p>The following example defines the class <code class="docutils literal notranslate"><span class="pre">Color</span></code> as an <code class="docutils literal notranslate"><span class="pre">Enum</span></code> type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>

<span class="k">class</span> <span class="nc">Color</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">RED</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">GREEN</span> <span class="o">=</span> <span class="mi">2</span>

<span class="k">def</span> <span class="nf">enum_fn</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Color</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">Color</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">enum_fn</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Eager: &quot;</span><span class="p">,</span> <span class="n">enum_fn</span><span class="p">(</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREEN</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TorchScript: &quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">(</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREEN</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>Example 2</strong></p>
<p>The following example shows the case of restricted enum subclassing, where <code class="docutils literal notranslate"><span class="pre">BaseColor</span></code> does not define any member, thus can be subclassed by <code class="docutils literal notranslate"><span class="pre">Color</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>

<span class="k">class</span> <span class="nc">BaseColor</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Color</span><span class="p">(</span><span class="n">BaseColor</span><span class="p">):</span>
    <span class="n">RED</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">GREEN</span> <span class="o">=</span> <span class="mi">2</span>

<span class="k">def</span> <span class="nf">enum_fn</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Color</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">Color</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">enum_fn</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TorchScript: &quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">(</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREEN</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Eager: &quot;</span><span class="p">,</span> <span class="n">enum_fn</span><span class="p">(</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREEN</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="torchscript-module-class">
<h3>TorchScript Module Class<a class="headerlink" href="#torchscript-module-class" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">TSModuleType</span></code> is a special class type that is inferred from object instances that are created outside TorchScript. <code class="docutils literal notranslate"><span class="pre">TSModuleType</span></code> is named by the Python class of the object instance. The <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> method of the Python class is not considered a TorchScript method, so it does not have to comply with TorchScript’s type-checking rules.</p>
<p>The type schema of a module instance class is constructed directly from an instance object (created outside the scope of TorchScript) rather than inferred from <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> like custom classes. It is possible that two objects of the same instance class type follow two different type schemas.</p>
<p>In this sense, <code class="docutils literal notranslate"><span class="pre">TSModuleType</span></code> is not really a static type. Therefore, for type safety considerations, <code class="docutils literal notranslate"><span class="pre">TSModuleType</span></code> cannot be used in a TorchScript type annotation or be composed with <code class="docutils literal notranslate"><span class="pre">TSType</span></code>.</p>
</div>
<div class="section" id="module-instance-class">
<h3>Module Instance Class<a class="headerlink" href="#module-instance-class" title="Permalink to this headline">¶</a></h3>
<p>TorchScript module type represents the type schema of a user-defined PyTorch module instance.  When scripting a PyTorch module, the module object is always created outside TorchScript (i.e., passed in as parameter to <code class="docutils literal notranslate"><span class="pre">forward</span></code>). The Python module class is treated as a module instance class, so the <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> method of the Python module class is not subject to the type-checking rules of TorchScript.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TSModuleType</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;class&quot;</span> <span class="n">Identifier</span> <span class="s2">&quot;(torch.nn.Module)&quot;</span> <span class="s2">&quot;:&quot;</span>
                    <span class="n">ClassBodyDefinition</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">forward()</span></code> and other methods decorated with <code class="docutils literal notranslate"><span class="pre">&#64;torch.jit.export</span></code> must be compilable to TorchScript IR and subject to TorchScript’s type-checking rules.</p></li>
</ul>
<p>Unlike custom classes, only the forward method and other methods decorated with <code class="docutils literal notranslate"><span class="pre">&#64;torch.jit.export</span></code>  of the module type need to be compilable. Most notably, <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> is not considered a TorchScript method. Consequently, module type constructors cannot be invoked within the scope of TorchScript. Instead, TorchScript module objects are always constructed outside and passed into <code class="docutils literal notranslate"><span class="pre">torch.jit.script(ModuleObj)</span></code>.</p>
<p><strong>Example 1</strong></p>
<p>This example illustrates a few features of module types:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">TestModule</span></code> instance is created outside the scope of TorchScript (i.e., before invoking <code class="docutils literal notranslate"><span class="pre">torch.jit.script</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__init__()</span></code> is not considered a TorchScript method, therefore, it does not have to be annotated and can contain arbitrary Python code. In addition, the <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> method of an instance class cannot be invoked in TorchScript code. Because <code class="docutils literal notranslate"><span class="pre">TestModule</span></code> instances are instantiated in Python, in this example, <code class="docutils literal notranslate"><span class="pre">TestModule(2.0)</span></code> and <code class="docutils literal notranslate"><span class="pre">TestModule(2)</span></code> create two instances with different types for its data attributes. <code class="docutils literal notranslate"><span class="pre">self.x</span></code> is of type <code class="docutils literal notranslate"><span class="pre">float</span></code> for <code class="docutils literal notranslate"><span class="pre">TestModule(2.0)</span></code>, whereas <code class="docutils literal notranslate"><span class="pre">self.y</span></code> is of type <code class="docutils literal notranslate"><span class="pre">int</span></code> for <code class="docutils literal notranslate"><span class="pre">TestModule(2.0)</span></code>.</p></li>
<li><p>TorchScript automatically compiles other methods (e.g., <code class="docutils literal notranslate"><span class="pre">mul()</span></code>) invoked by methods annotated via <code class="docutils literal notranslate"><span class="pre">&#64;torch.jit.export</span></code> or <code class="docutils literal notranslate"><span class="pre">forward()</span></code> methods.</p></li>
<li><p>Entry-points to a TorchScript program are either <code class="docutils literal notranslate"><span class="pre">forward()</span></code> of a module type, functions annotated as <code class="docutils literal notranslate"><span class="pre">torch.jit.script</span></code>, or methods annotated as <code class="docutils literal notranslate"><span class="pre">torch.jit.export</span></code>.</p></li>
</ul>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="k">class</span> <span class="nc">TestModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inc</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">inc</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">TestModule</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;First instance: </span><span class="si">{</span><span class="n">m</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">TestModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">5</span><span class="p">])))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Second instance: </span><span class="si">{</span><span class="n">m</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The example above produces the following output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>First instance: 4
Second instance: tensor([4., 4., 4., 4., 4.])
</pre></div>
</div>
<p><strong>Example 2</strong></p>
<p>The following example shows an incorrect usage of module type. Specifically, this example invokes the constructor of <code class="docutils literal notranslate"><span class="pre">TestModule</span></code> inside the scope of TorchScript:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="k">class</span> <span class="nc">TestModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">v</span>

    <span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">export</span>
    <span class="k">def</span> <span class="nf">doSomething</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="c1"># error: should not invoke the constructor of module type</span>
        <span class="n">myModel</span> <span class="o">=</span> <span class="n">TestModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">myModel</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

<span class="c1"># m = torch.jit.script(MyModel(2)) # Results in below RuntimeError</span>
<span class="c1"># RuntimeError: Could not get name of python class object</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="type-annotation">
<span id="id2"></span><h2><a class="toc-backref" href="#id9">Type Annotation</a><a class="headerlink" href="#type-annotation" title="Permalink to this headline">¶</a></h2>
<p>Since TorchScript is statically typed, programmers need to annotate types at <em>strategic points</em> of TorchScript code so that every local variable or
instance data attribute has a static type, and every function and method has a statically typed signature.</p>
<div class="section" id="when-to-annotate-types">
<h3>When to Annotate Types<a class="headerlink" href="#when-to-annotate-types" title="Permalink to this headline">¶</a></h3>
<p>In general, type annotations are only needed in places where static types cannot be automatically inferred (e.g., parameters or sometimes return types to
methods or functions). Types of local variables and data attributes are often automatically inferred from their assignment statements. Sometimes an inferred type
may be too restrictive, e.g., <code class="docutils literal notranslate"><span class="pre">x</span></code> being inferred as <code class="docutils literal notranslate"><span class="pre">NoneType</span></code> through assignment <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">None</span></code>, whereas <code class="docutils literal notranslate"><span class="pre">x</span></code> is actually used as an <code class="docutils literal notranslate"><span class="pre">Optional</span></code>. In such
cases, type annotations may be needed to overwrite auto inference, e.g., <code class="docutils literal notranslate"><span class="pre">x:</span> <span class="pre">Optional[int]</span> <span class="pre">=</span> <span class="pre">None</span></code>. Note that it is always safe to type annotate a local variable
or data attribute even if its type can be automatically inferred. The annotated type must be congruent with TorchScript’s type-checking.</p>
<p>When a parameter, local variable, or data attribute is not type annotated and its type cannot be automatically inferred, TorchScript assumes it to be a
default type of <code class="docutils literal notranslate"><span class="pre">TensorType</span></code>, <code class="docutils literal notranslate"><span class="pre">List[TensorType]</span></code>, or <code class="docutils literal notranslate"><span class="pre">Dict[str,</span> <span class="pre">TensorType]</span></code>.</p>
</div>
<div class="section" id="annotate-function-signature">
<h3>Annotate Function Signature<a class="headerlink" href="#annotate-function-signature" title="Permalink to this headline">¶</a></h3>
<p>Since a parameter may not be automatically inferred from the body of the function (including both functions and methods), they need to be type annotated. Otherwise, they assume the default type <code class="docutils literal notranslate"><span class="pre">TensorType</span></code>.</p>
<p>TorchScript supports two styles for method and function signature type annotation:</p>
<ul class="simple">
<li><p><strong>Python3-style</strong> annotates types directly on the signature. As such, it allows individual parameters to be left unannotated (whose type will be the default type of <code class="docutils literal notranslate"><span class="pre">TensorType</span></code>), or allows the return type to be left unannotated (whose type will be automatically inferred).</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Python3Annotation</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;def&quot;</span> <span class="n">Identifier</span> <span class="p">[</span> <span class="s2">&quot;(&quot;</span> <span class="n">ParamAnnot</span><span class="o">*</span> <span class="s2">&quot;)&quot;</span> <span class="p">]</span> <span class="p">[</span><span class="n">ReturnAnnot</span><span class="p">]</span> <span class="s2">&quot;:&quot;</span>
                            <span class="n">FuncOrMethodBody</span>
<span class="n">ParamAnnot</span>        <span class="p">:</span><span class="o">:=</span> <span class="n">Identifier</span> <span class="p">[</span> <span class="s2">&quot;:&quot;</span> <span class="n">TSType</span> <span class="p">]</span> <span class="s2">&quot;,&quot;</span>
<span class="n">ReturnAnnot</span>       <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;-&gt;&quot;</span> <span class="n">TSType</span>
</pre></div>
</div>
<p>Note that when using Python3 style, the type <code class="docutils literal notranslate"><span class="pre">self</span></code> is automatically inferred and should not be annotated.</p>
<ul class="simple">
<li><p><strong>Mypy style</strong> annotates types as a comment right below the function/method declaration. In the Mypy style, since parameter names do not appear in the annotation, all parameters have to be annotated.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MyPyAnnotation</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;# type:&quot;</span> <span class="s2">&quot;(&quot;</span> <span class="n">ParamAnnot</span><span class="o">*</span> <span class="s2">&quot;)&quot;</span> <span class="p">[</span> <span class="n">ReturnAnnot</span> <span class="p">]</span>
<span class="n">ParamAnnot</span>     <span class="p">:</span><span class="o">:=</span> <span class="n">TSType</span> <span class="s2">&quot;,&quot;</span>
<span class="n">ReturnAnnot</span>    <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;-&gt;&quot;</span> <span class="n">TSType</span>
</pre></div>
</div>
<p><strong>Example 1</strong></p>
<p>In this example:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">a</span></code> is not annotated and assumes the default type of <code class="docutils literal notranslate"><span class="pre">TensorType</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">b</span></code> is annotated as type <code class="docutils literal notranslate"><span class="pre">int</span></code>.</p></li>
<li><p>The return type is not annotated and is automatically inferred as type <code class="docutils literal notranslate"><span class="pre">TensorType</span></code> (based on the type of the value being returned).</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TorchScript:&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">6</span><span class="p">]),</span> <span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>Example 2</strong></p>
<p>The following example uses Mypy style annotation. Note that parameters or return values must be annotated even if some of
them assume the default type.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="c1"># type: (torch.Tensor, int) → torch.Tensor</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TorchScript:&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">6</span><span class="p">]),</span> <span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="annotate-variables-and-data-attributes">
<h3>Annotate Variables and Data Attributes<a class="headerlink" href="#annotate-variables-and-data-attributes" title="Permalink to this headline">¶</a></h3>
<p>In general, types of data attributes (including class and instance data attributes) and local variables can be automatically inferred from assignment statements.
Sometimes, however, if a variable or attribute is associated with values of different types (e.g., as <code class="docutils literal notranslate"><span class="pre">None</span></code> or <code class="docutils literal notranslate"><span class="pre">TensorType</span></code>), then they may need to be explicitly
type annotated as a <em>wider</em> type such as <code class="docutils literal notranslate"><span class="pre">Optional[int]</span></code> or <code class="docutils literal notranslate"><span class="pre">Any</span></code>.</p>
<div class="section" id="local-variables">
<h4>Local Variables<a class="headerlink" href="#local-variables" title="Permalink to this headline">¶</a></h4>
<p>Local variables can be annotated according to Python3 typing module annotation rules, i.e.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LocalVarAnnotation</span> <span class="p">:</span><span class="o">:=</span> <span class="n">Identifier</span> <span class="p">[</span><span class="s2">&quot;:&quot;</span> <span class="n">TSType</span><span class="p">]</span> <span class="s2">&quot;=&quot;</span> <span class="n">Expr</span>
</pre></div>
</div>
<p>In general, types of local variables can be automatically inferred. In some cases, however, you may need to annotate a multi-type for local variables
that may be associated with different concrete types. Typical multi-types include <code class="docutils literal notranslate"><span class="pre">Optional[T]</span></code> and <code class="docutils literal notranslate"><span class="pre">Any</span></code>.</p>
<p><strong>Example</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">setVal</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">setVal</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">a</span>
    <span class="k">return</span> <span class="n">value</span>

<span class="n">ones</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">6</span><span class="p">])</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TorchScript:&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">(</span><span class="n">ones</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> <span class="n">m</span><span class="p">(</span><span class="n">ones</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="instance-data-attributes">
<h4>Instance Data Attributes<a class="headerlink" href="#instance-data-attributes" title="Permalink to this headline">¶</a></h4>
<p>For <code class="docutils literal notranslate"><span class="pre">ModuleType</span></code> classes, instance data attributes can be annotated according to Python3 typing module annotation rules. Instance data attributes can be annotated (optionally) as final
via <code class="docutils literal notranslate"><span class="pre">Final</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;class&quot;</span> <span class="n">ClassIdentifier</span> <span class="s2">&quot;(torch.nn.Module):&quot;</span>
<span class="n">InstanceAttrIdentifier</span> <span class="s2">&quot;:&quot;</span> <span class="p">[</span><span class="s2">&quot;Final(&quot;</span><span class="p">]</span> <span class="n">TSType</span> <span class="p">[</span><span class="s2">&quot;)&quot;</span><span class="p">]</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">InstanceAttrIdentifier</span></code> is the name of an instance attribute.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Final</span></code> indicates that the attribute cannot be re-assigned outside of <code class="docutils literal notranslate"><span class="pre">__init__</span></code> or overridden in subclasses.</p></li>
</ul>
<p><strong>Example</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="k">class</span> <span class="nc">MyModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="n">offset_</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">offset_</span> <span class="o">=</span> <span class="n">offset</span>

<span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="type-annotation-apis">
<h3>Type Annotation APIs<a class="headerlink" href="#type-annotation-apis" title="Permalink to this headline">¶</a></h3>
<div class="section" id="torch-jit-annotate-t-expr">
<h4><code class="docutils literal notranslate"><span class="pre">torch.jit.annotate(T,</span> <span class="pre">expr)</span></code><a class="headerlink" href="#torch-jit-annotate-t-expr" title="Permalink to this headline">¶</a></h4>
<p>This API annotates type <code class="docutils literal notranslate"><span class="pre">T</span></code> to an expression <code class="docutils literal notranslate"><span class="pre">expr</span></code>. This is often used when the default type of an expression is not the type intended by the programmer.
For instance, an empty list (dictionary) has the default type of <code class="docutils literal notranslate"><span class="pre">List[TensorType]</span></code> (<code class="docutils literal notranslate"><span class="pre">Dict[TensorType,</span> <span class="pre">TensorType]</span></code>), but sometimes it may be used to initialize
a list of some other types. Another common use case is for annotating the return type of <code class="docutils literal notranslate"><span class="pre">tensor.tolist()</span></code>. Note, however, that it cannot be used to annotate
the type of a module attribute in <cite>__init__</cite>; <code class="docutils literal notranslate"><span class="pre">torch.jit.Attribute</span></code> should be used for this instead.</p>
<p><strong>Example</strong></p>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">[]</span></code> is declared as a list of integers via <code class="docutils literal notranslate"><span class="pre">torch.jit.annotate</span></code> (instead of assuming <code class="docutils literal notranslate"><span class="pre">[]</span></code> to be the default type of <code class="docutils literal notranslate"><span class="pre">List[TensorType]</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">l</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">l</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="p">[]),</span> <span class="n">val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">l</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Eager:&quot;</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TorchScript:&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="generated/torch.jit.annotate.html#torch.jit.annotate" title="torch.jit.annotate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">torch.jit.annotate()</span></code></a> for more information.</p>
</div>
</div>
<div class="section" id="type-annotation-appendix">
<h3>Type Annotation Appendix<a class="headerlink" href="#type-annotation-appendix" title="Permalink to this headline">¶</a></h3>
<div class="section" id="torchscript-type-system-definition">
<h4>TorchScript Type System Definition<a class="headerlink" href="#torchscript-type-system-definition" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TSAllType</span>       <span class="p">:</span><span class="o">:=</span> <span class="n">TSType</span> <span class="o">|</span> <span class="n">TSModuleType</span>
<span class="n">TSType</span>          <span class="p">:</span><span class="o">:=</span> <span class="n">TSMetaType</span> <span class="o">|</span> <span class="n">TSPrimitiveType</span> <span class="o">|</span> <span class="n">TSStructuralType</span> <span class="o">|</span> <span class="n">TSNominalType</span>

<span class="n">TSMetaType</span>      <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;Any&quot;</span>
<span class="n">TSPrimitiveType</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;int&quot;</span> <span class="o">|</span> <span class="s2">&quot;float&quot;</span> <span class="o">|</span> <span class="s2">&quot;double&quot;</span> <span class="o">|</span> <span class="s2">&quot;complex&quot;</span> <span class="o">|</span> <span class="s2">&quot;bool&quot;</span> <span class="o">|</span> <span class="s2">&quot;str&quot;</span> <span class="o">|</span> <span class="s2">&quot;None&quot;</span>

<span class="n">TSStructualType</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">TSTuple</span> <span class="o">|</span> <span class="n">TSNamedTuple</span> <span class="o">|</span> <span class="n">TSList</span> <span class="o">|</span> <span class="n">TSDict</span> <span class="o">|</span>
                     <span class="n">TSOptional</span> <span class="o">|</span> <span class="n">TSUnion</span> <span class="o">|</span> <span class="n">TSFuture</span> <span class="o">|</span> <span class="n">TSRRef</span>
<span class="n">TSTuple</span>         <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;Tuple&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="p">(</span><span class="n">TSType</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">*</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">TSNamedTuple</span>    <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;namedtuple&quot;</span> <span class="s2">&quot;(&quot;</span> <span class="p">(</span><span class="n">TSType</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">*</span> <span class="n">TSType</span> <span class="s2">&quot;)&quot;</span>
<span class="n">TSList</span>          <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;List&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">TSOptional</span>      <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;Optional&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">TSUnion</span>         <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;Union&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="p">(</span><span class="n">TSType</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">*</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">TSFuture</span>        <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;Future&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">TSRRef</span>          <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;RRef&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">TSDict</span>          <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;Dict&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="n">KeyType</span> <span class="s2">&quot;,&quot;</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">KeyType</span>         <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;str&quot;</span> <span class="o">|</span> <span class="s2">&quot;int&quot;</span> <span class="o">|</span> <span class="s2">&quot;float&quot;</span> <span class="o">|</span> <span class="s2">&quot;bool&quot;</span> <span class="o">|</span> <span class="n">TensorType</span> <span class="o">|</span> <span class="s2">&quot;Any&quot;</span>

<span class="n">TSNominalType</span>   <span class="p">:</span><span class="o">:=</span> <span class="n">TSBuiltinClasses</span> <span class="o">|</span> <span class="n">TSCustomClass</span> <span class="o">|</span> <span class="n">TSEnum</span>
<span class="n">TSBuiltinClass</span>  <span class="p">:</span><span class="o">:=</span> <span class="n">TSTensor</span> <span class="o">|</span> <span class="s2">&quot;torch.device&quot;</span> <span class="o">|</span> <span class="s2">&quot;torch.stream&quot;</span><span class="o">|</span>
                    <span class="s2">&quot;torch.dtype&quot;</span> <span class="o">|</span> <span class="s2">&quot;torch.nn.ModuleList&quot;</span> <span class="o">|</span>
                    <span class="s2">&quot;torch.nn.ModuleDict&quot;</span> <span class="o">|</span> <span class="o">...</span>
<span class="n">TSTensor</span>        <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;torch.tensor&quot;</span> <span class="ow">and</span> <span class="n">subclasses</span>
</pre></div>
</div>
</div>
<div class="section" id="unsupported-typing-constructs">
<h4>Unsupported Typing Constructs<a class="headerlink" href="#unsupported-typing-constructs" title="Permalink to this headline">¶</a></h4>
<p>TorchScript does not support all features and types of the Python3 <a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing">typing</a> module.
Any functionality from the <a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing">typing</a> module that is not explicitly specified in this
documentation is unsupported. The following table summarizes <code class="docutils literal notranslate"><span class="pre">typing</span></code> constructs that are either unsupported or supported with restrictions in TorchScript.</p>
<table class="docutils colwidths-auto align-default">
<tbody>
<tr class="row-odd"><td><p>Item</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">typing.Any</span></code></p></td>
<td><p>In development</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">typing.NoReturn</span></code></p></td>
<td><p>Not supported</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">typing.Callable</span></code></p></td>
<td><p>Not supported</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">typing.Literal</span></code></p></td>
<td><p>Not supported</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">typing.ClassVar</span></code></p></td>
<td><p>Not supported</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">typing.Final</span></code></p></td>
<td><p>Supported for module attributes, class attribute, and annotations, but not for functions.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">typing.AnyStr</span></code></p></td>
<td><p>Not supported</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">typing.overload</span></code></p></td>
<td><p>In development</p></td>
</tr>
<tr class="row-even"><td><p>Type aliases</p></td>
<td><p>Not supported</p></td>
</tr>
<tr class="row-odd"><td><p>Nominal typing</p></td>
<td><p>In development</p></td>
</tr>
<tr class="row-even"><td><p>Structural typing</p></td>
<td><p>Not supported</p></td>
</tr>
<tr class="row-odd"><td><p>NewType</p></td>
<td><p>Not supported</p></td>
</tr>
<tr class="row-even"><td><p>Generics</p></td>
<td><p>Not supported</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="expressions">
<span id="id4"></span><h2><a class="toc-backref" href="#id10">Expressions</a><a class="headerlink" href="#expressions" title="Permalink to this headline">¶</a></h2>
<p>The following section describes the grammar of expressions that are supported in TorchScript.
It is modeled after <a class="reference external" href="https://docs.python.org/3/reference/expressions.html">the expressions chapter of the Python language reference</a>.</p>
<div class="section" id="arithmetic-conversions">
<h3>Arithmetic Conversions<a class="headerlink" href="#arithmetic-conversions" title="Permalink to this headline">¶</a></h3>
<p>There are a number of implicit type conversions that are performed in TorchScript:</p>
<ul class="simple">
<li><p>A <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> with a <code class="docutils literal notranslate"><span class="pre">float</span></code> or <code class="docutils literal notranslate"><span class="pre">int</span></code> data type can be implicitly converted to an instance of <code class="docutils literal notranslate"><span class="pre">FloatType</span></code> or <code class="docutils literal notranslate"><span class="pre">IntType</span></code> provided that it has a size of 0, does not have <code class="docutils literal notranslate"><span class="pre">require_grad</span></code> set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, and will not require narrowing.</p></li>
<li><p>Instances of <code class="docutils literal notranslate"><span class="pre">StringType</span></code> can be implicitly converted to <code class="docutils literal notranslate"><span class="pre">DeviceType</span></code>.</p></li>
<li><p>The implicit conversion rules from the two bullet points above can be applied to instances of <code class="docutils literal notranslate"><span class="pre">TupleType</span></code> to produce instances of <code class="docutils literal notranslate"><span class="pre">ListType</span></code> with the appropriate contained type.</p></li>
</ul>
<p>Explicit conversions can be invoked using the <code class="docutils literal notranslate"><span class="pre">float</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">bool</span></code>, and <code class="docutils literal notranslate"><span class="pre">str</span></code> built-in functions
that accept primitive data types as arguments and can accept user-defined types if they implement
<code class="docutils literal notranslate"><span class="pre">__bool__</span></code>, <code class="docutils literal notranslate"><span class="pre">__str__</span></code>, etc.</p>
</div>
<div class="section" id="atoms">
<h3>Atoms<a class="headerlink" href="#atoms" title="Permalink to this headline">¶</a></h3>
<p>Atoms are the most basic elements of expressions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">atom</span>      <span class="p">:</span><span class="o">:=</span>  <span class="n">identifier</span> <span class="o">|</span> <span class="n">literal</span> <span class="o">|</span> <span class="n">enclosure</span>
<span class="n">enclosure</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">parenth_form</span> <span class="o">|</span> <span class="n">list_display</span> <span class="o">|</span> <span class="n">dict_display</span>
</pre></div>
</div>
<div class="section" id="identifiers">
<h4>Identifiers<a class="headerlink" href="#identifiers" title="Permalink to this headline">¶</a></h4>
<p>The rules that dictate what is a legal identifer in TorchScript are the same as
their <a class="reference external" href="https://docs.python.org/3/reference/lexical_analysis.html#identifiers">Python counterparts</a>.</p>
</div>
<div class="section" id="literals">
<h4>Literals<a class="headerlink" href="#literals" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">literal</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">stringliteral</span> <span class="o">|</span> <span class="n">integer</span> <span class="o">|</span> <span class="n">floatnumber</span>
</pre></div>
</div>
<p>Evaluation of a literal yields an object of the appropriate type with the specific value
(with approximations applied as necessary for floats). Literals are immutable, and multiple evaluations
of identical literals may obtain the same object or distinct objects with the same value.
<a class="reference external" href="https://docs.python.org/3/reference/lexical_analysis.html#string-and-bytes-literals">stringliteral</a>,
<a class="reference external" href="https://docs.python.org/3/reference/lexical_analysis.html#integer-literals">integer</a>, and
<a class="reference external" href="https://docs.python.org/3/reference/lexical_analysis.html#floating-point-literals">floatnumber</a>
are defined in the same way as their Python counterparts.</p>
</div>
<div class="section" id="parenthesized-forms">
<h4>Parenthesized Forms<a class="headerlink" href="#parenthesized-forms" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">parenth_form</span> <span class="p">:</span><span class="o">:=</span>  <span class="s1">&#39;(&#39;</span> <span class="p">[</span><span class="n">expression_list</span><span class="p">]</span> <span class="s1">&#39;)&#39;</span>
</pre></div>
</div>
<p>A parenthesized expression list yields whatever the expression list yields. If the list contains at least one
comma, it yields a <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>; otherwise, it yields the single expression inside the expression list. An empty
pair of parentheses yields an empty <code class="docutils literal notranslate"><span class="pre">Tuple</span></code> object (<code class="docutils literal notranslate"><span class="pre">Tuple[]</span></code>).</p>
</div>
<div class="section" id="list-and-dictionary-displays">
<h4>List and Dictionary Displays<a class="headerlink" href="#list-and-dictionary-displays" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">list_comprehension</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">expression</span> <span class="n">comp_for</span>
<span class="n">comp_for</span>           <span class="p">:</span><span class="o">:=</span>  <span class="s1">&#39;for&#39;</span> <span class="n">target_list</span> <span class="s1">&#39;in&#39;</span> <span class="n">or_expr</span>
<span class="n">list_display</span>       <span class="p">:</span><span class="o">:=</span>  <span class="s1">&#39;[&#39;</span> <span class="p">[</span><span class="n">expression_list</span> <span class="o">|</span> <span class="n">list_comprehension</span><span class="p">]</span> <span class="s1">&#39;]&#39;</span>
<span class="n">dict_display</span>       <span class="p">:</span><span class="o">:=</span>  <span class="s1">&#39;{&#39;</span> <span class="p">[</span><span class="n">key_datum_list</span> <span class="o">|</span> <span class="n">dict_comprehension</span><span class="p">]</span> <span class="s1">&#39;}&#39;</span>
<span class="n">key_datum_list</span>     <span class="p">:</span><span class="o">:=</span>  <span class="n">key_datum</span> <span class="p">(</span><span class="s1">&#39;,&#39;</span> <span class="n">key_datum</span><span class="p">)</span><span class="o">*</span>
<span class="n">key_datum</span>          <span class="p">:</span><span class="o">:=</span>  <span class="n">expression</span> <span class="s1">&#39;:&#39;</span> <span class="n">expression</span>
<span class="n">dict_comprehension</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">key_datum</span> <span class="n">comp_for</span>
</pre></div>
</div>
<p>Lists and dicts can be constructed by either listing the container contents explicitly or by providing
instructions on how to compute them via a set of looping instructions (i.e. a <em>comprehension</em>). A comprehension
is semantically equivalent to using a for loop and appending to an ongoing list.
Comprehensions implicitly create their own scope to make sure that the items of the target list do not leak into the
enclosing scope. In the case that container items are explicitly listed, the expressions in the expression list
are evaluated left-to-right. If a key is repeated in a <code class="docutils literal notranslate"><span class="pre">dict_display</span></code> that has a <code class="docutils literal notranslate"><span class="pre">key_datum_list</span></code>, the
resultant dictionary uses the value from the rightmost datum in the list that uses the repeated key.</p>
</div>
</div>
<div class="section" id="primaries">
<h3>Primaries<a class="headerlink" href="#primaries" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">primary</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">atom</span> <span class="o">|</span> <span class="n">attributeref</span> <span class="o">|</span> <span class="n">subscription</span> <span class="o">|</span> <span class="n">slicing</span> <span class="o">|</span> <span class="n">call</span>
</pre></div>
</div>
<div class="section" id="attribute-references">
<h4>Attribute References<a class="headerlink" href="#attribute-references" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">attributeref</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">primary</span> <span class="s1">&#39;.&#39;</span> <span class="n">identifier</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">primary</span></code> must evaluate to an object of a type that supports attribute references that have an attribute named
<code class="docutils literal notranslate"><span class="pre">identifier</span></code>.</p>
</div>
<div class="section" id="subscriptions">
<h4>Subscriptions<a class="headerlink" href="#subscriptions" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">subscription</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">primary</span> <span class="s1">&#39;[&#39;</span> <span class="n">expression_list</span> <span class="s1">&#39;]&#39;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">primary</span></code> must evaluate to an object that supports subscription.</p>
<ul class="simple">
<li><p>If the primary is a <code class="docutils literal notranslate"><span class="pre">List</span></code>, <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>, or <code class="docutils literal notranslate"><span class="pre">str</span></code>, the expression list must evaluate to an integer or slice.</p></li>
<li><p>If the primary is a <code class="docutils literal notranslate"><span class="pre">Dict</span></code>, the expression list must evaluate to an object of the same type as the key type of the <code class="docutils literal notranslate"><span class="pre">Dict</span></code>.</p></li>
<li><p>If the primary is a <code class="docutils literal notranslate"><span class="pre">ModuleList</span></code>, the expression list must be an <code class="docutils literal notranslate"><span class="pre">integer</span></code> literal.</p></li>
<li><p>If the primary is a <code class="docutils literal notranslate"><span class="pre">ModuleDict</span></code>, the expression must be a <code class="docutils literal notranslate"><span class="pre">stringliteral</span></code>.</p></li>
</ul>
</div>
<div class="section" id="slicings">
<h4>Slicings<a class="headerlink" href="#slicings" title="Permalink to this headline">¶</a></h4>
<p>A slicing selects a range of items in a <code class="docutils literal notranslate"><span class="pre">str</span></code>, <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>, <code class="docutils literal notranslate"><span class="pre">List</span></code>, or <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>. Slicings may be used as
expressions or targets in assignment or <code class="docutils literal notranslate"><span class="pre">del</span></code> statements.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">slicing</span>      <span class="p">:</span><span class="o">:=</span>  <span class="n">primary</span> <span class="s1">&#39;[&#39;</span> <span class="n">slice_list</span> <span class="s1">&#39;]&#39;</span>
<span class="n">slice_list</span>   <span class="p">:</span><span class="o">:=</span>  <span class="n">slice_item</span> <span class="p">(</span><span class="s1">&#39;,&#39;</span> <span class="n">slice_item</span><span class="p">)</span><span class="o">*</span> <span class="p">[</span><span class="s1">&#39;,&#39;</span><span class="p">]</span>
<span class="n">slice_item</span>   <span class="p">:</span><span class="o">:=</span>  <span class="n">expression</span> <span class="o">|</span> <span class="n">proper_slice</span>
<span class="n">proper_slice</span> <span class="p">:</span><span class="o">:=</span>  <span class="p">[</span><span class="n">expression</span><span class="p">]</span> <span class="s1">&#39;:&#39;</span> <span class="p">[</span><span class="n">expression</span><span class="p">]</span> <span class="p">[</span><span class="s1">&#39;:&#39;</span> <span class="p">[</span><span class="n">expression</span><span class="p">]</span> <span class="p">]</span>
</pre></div>
</div>
<p>Slicings with more than one slice item in their slice lists can only be used with primaries that evaluate to an
object of type <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>.</p>
</div>
<div class="section" id="calls">
<h4>Calls<a class="headerlink" href="#calls" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">call</span>          <span class="p">:</span><span class="o">:=</span>  <span class="n">primary</span> <span class="s1">&#39;(&#39;</span> <span class="n">argument_list</span> <span class="s1">&#39;)&#39;</span>
<span class="n">argument_list</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">args</span> <span class="p">[</span><span class="s1">&#39;,&#39;</span> <span class="n">kwargs</span><span class="p">]</span> <span class="o">|</span> <span class="n">kwargs</span>
<span class="n">args</span>          <span class="p">:</span><span class="o">:=</span>  <span class="p">[</span><span class="n">arg</span> <span class="p">(</span><span class="s1">&#39;,&#39;</span> <span class="n">arg</span><span class="p">)</span><span class="o">*</span><span class="p">]</span>
<span class="n">kwargs</span>        <span class="p">:</span><span class="o">:=</span>  <span class="p">[</span><span class="n">kwarg</span> <span class="p">(</span><span class="s1">&#39;,&#39;</span> <span class="n">kwarg</span><span class="p">)</span><span class="o">*</span><span class="p">]</span>
<span class="n">kwarg</span>         <span class="p">:</span><span class="o">:=</span>  <span class="n">arg</span> <span class="s1">&#39;=&#39;</span> <span class="n">expression</span>
<span class="n">arg</span>           <span class="p">:</span><span class="o">:=</span>  <span class="n">identifier</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">primary</span></code> must desugar or evaluate to a callable object. All argument expressions are evaluated
before the call is attempted.</p>
</div>
</div>
<div class="section" id="power-operator">
<h3>Power Operator<a class="headerlink" href="#power-operator" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">power</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">primary</span> <span class="p">[</span><span class="s1">&#39;**&#39;</span> <span class="n">u_expr</span><span class="p">]</span>
</pre></div>
</div>
<p>The power operator has the same semantics as the built-in pow function (not supported); it computes its
left argument raised to the power of its right argument. It binds more tightly than unary operators on the
left, but less tightly than unary operators on the right; i.e. <code class="docutils literal notranslate"><span class="pre">-2</span> <span class="pre">**</span> <span class="pre">-3</span> <span class="pre">==</span> <span class="pre">-(2</span> <span class="pre">**</span> <span class="pre">(-3))</span></code>.  The left and right
operands can be <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code> or <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>. Scalars are broadcast in the case of scalar-tensor/tensor-scalar
exponentiation operations, and tensor-tensor exponentiation is done elementwise without any broadcasting.</p>
</div>
<div class="section" id="unary-and-arithmetic-bitwise-operations">
<h3>Unary and Arithmetic Bitwise Operations<a class="headerlink" href="#unary-and-arithmetic-bitwise-operations" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">u_expr</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">power</span> <span class="o">|</span> <span class="s1">&#39;-&#39;</span> <span class="n">power</span> <span class="o">|</span> <span class="s1">&#39;~&#39;</span> <span class="n">power</span>
</pre></div>
</div>
<p>The unary <code class="docutils literal notranslate"><span class="pre">-</span></code> operator yields the negation of its argument. The unary <code class="docutils literal notranslate"><span class="pre">~</span></code> operator yields the bitwise inversion
of its argument. <code class="docutils literal notranslate"><span class="pre">-</span></code> can be used with <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code>, and <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> of <code class="docutils literal notranslate"><span class="pre">int</span></code> and <code class="docutils literal notranslate"><span class="pre">float</span></code>.
<code class="docutils literal notranslate"><span class="pre">~</span></code> can only be used with <code class="docutils literal notranslate"><span class="pre">int</span></code> and <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> of <code class="docutils literal notranslate"><span class="pre">int</span></code>.</p>
</div>
<div class="section" id="binary-arithmetic-operations">
<h3>Binary Arithmetic Operations<a class="headerlink" href="#binary-arithmetic-operations" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">m_expr</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">u_expr</span> <span class="o">|</span> <span class="n">m_expr</span> <span class="s1">&#39;*&#39;</span> <span class="n">u_expr</span> <span class="o">|</span> <span class="n">m_expr</span> <span class="s1">&#39;@&#39;</span> <span class="n">m_expr</span> <span class="o">|</span> <span class="n">m_expr</span> <span class="s1">&#39;//&#39;</span> <span class="n">u_expr</span> <span class="o">|</span> <span class="n">m_expr</span> <span class="s1">&#39;/&#39;</span> <span class="n">u_expr</span> <span class="o">|</span> <span class="n">m_expr</span> <span class="s1">&#39;%&#39;</span> <span class="n">u_expr</span>
<span class="n">a_expr</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">m_expr</span> <span class="o">|</span> <span class="n">a_expr</span> <span class="s1">&#39;+&#39;</span> <span class="n">m_expr</span> <span class="o">|</span> <span class="n">a_expr</span> <span class="s1">&#39;-&#39;</span> <span class="n">m_expr</span>
</pre></div>
</div>
<p>The binary arithmetic operators can operate on <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code>, and <code class="docutils literal notranslate"><span class="pre">float</span></code>. For tensor-tensor ops, both arguments must
have the same shape. For scalar-tensor or tensor-scalar ops, the scalar is usually broadcast to the size of the
tensor. Division ops can only accept scalars as their right-hand side argument, and do not support broadcasting.
The <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> operator is for matrix multiplication and only operates on <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> arguments. The multiplication operator
(<code class="docutils literal notranslate"><span class="pre">*</span></code>) can be used with a list and integer in order to get a result that is the original list repeated a certain
number of times.</p>
</div>
<div class="section" id="shifting-operations">
<h3>Shifting Operations<a class="headerlink" href="#shifting-operations" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shift_expr</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">a_expr</span> <span class="o">|</span> <span class="n">shift_expr</span> <span class="p">(</span> <span class="s1">&#39;&lt;&lt;&#39;</span> <span class="o">|</span> <span class="s1">&#39;&gt;&gt;&#39;</span> <span class="p">)</span> <span class="n">a_expr</span>
</pre></div>
</div>
<p>These operators accept two <code class="docutils literal notranslate"><span class="pre">int</span></code> arguments, two <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> arguments, or a <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> argument and an <code class="docutils literal notranslate"><span class="pre">int</span></code> or
<code class="docutils literal notranslate"><span class="pre">float</span></code> argument. In all cases, a right shift by <code class="docutils literal notranslate"><span class="pre">n</span></code> is defined as floor division by <code class="docutils literal notranslate"><span class="pre">pow(2,</span> <span class="pre">n)</span></code>, and a left shift
by <code class="docutils literal notranslate"><span class="pre">n</span></code> is defined as multiplication by <code class="docutils literal notranslate"><span class="pre">pow(2,</span> <span class="pre">n)</span></code>. When both arguments are <code class="docutils literal notranslate"><span class="pre">Tensors</span></code>, they must have the same
shape. When one is a scalar and the other is a <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>, the scalar is logically broadcast to match the size of
the <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>.</p>
</div>
<div class="section" id="binary-bitwise-operations">
<h3>Binary Bitwise Operations<a class="headerlink" href="#binary-bitwise-operations" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">and_expr</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">shift_expr</span> <span class="o">|</span> <span class="n">and_expr</span> <span class="s1">&#39;&amp;&#39;</span> <span class="n">shift_expr</span>
<span class="n">xor_expr</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">and_expr</span> <span class="o">|</span> <span class="n">xor_expr</span> <span class="s1">&#39;^&#39;</span> <span class="n">and_expr</span>
<span class="n">or_expr</span>  <span class="p">:</span><span class="o">:=</span>  <span class="n">xor_expr</span> <span class="o">|</span> <span class="n">or_expr</span> <span class="s1">&#39;|&#39;</span> <span class="n">xor_expr</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> operator computes the bitwise AND of its arguments, the <code class="docutils literal notranslate"><span class="pre">^</span></code> the bitwise XOR, and the <code class="docutils literal notranslate"><span class="pre">|</span></code> the bitwise OR.
Both operands must be <code class="docutils literal notranslate"><span class="pre">int</span></code> or <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>, or the left operand must be <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> and the right operand must be
<code class="docutils literal notranslate"><span class="pre">int</span></code>. When both operands are <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>, they must have the same shape. When the right operand is <code class="docutils literal notranslate"><span class="pre">int</span></code>, and
the left operand is <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>, the right operand is logically broadcast to match the shape of the <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>.</p>
</div>
<div class="section" id="comparisons">
<h3>Comparisons<a class="headerlink" href="#comparisons" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">comparison</span>    <span class="p">:</span><span class="o">:=</span>  <span class="n">or_expr</span> <span class="p">(</span><span class="n">comp_operator</span> <span class="n">or_expr</span><span class="p">)</span><span class="o">*</span>
<span class="n">comp_operator</span> <span class="p">:</span><span class="o">:=</span>  <span class="s1">&#39;&lt;&#39;</span> <span class="o">|</span> <span class="s1">&#39;&gt;&#39;</span> <span class="o">|</span> <span class="s1">&#39;==&#39;</span> <span class="o">|</span> <span class="s1">&#39;&gt;=&#39;</span> <span class="o">|</span> <span class="s1">&#39;&lt;=&#39;</span> <span class="o">|</span> <span class="s1">&#39;!=&#39;</span> <span class="o">|</span> <span class="s1">&#39;is&#39;</span> <span class="p">[</span><span class="s1">&#39;not&#39;</span><span class="p">]</span> <span class="o">|</span> <span class="p">[</span><span class="s1">&#39;not&#39;</span><span class="p">]</span> <span class="s1">&#39;in&#39;</span>
</pre></div>
</div>
<p>A comparison yields a boolean value (<code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code>), or if one of the operands is a <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>, a boolean
<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>. Comparisons can be chained arbitrarily as long as they do not yield boolean <code class="docutils literal notranslate"><span class="pre">Tensors</span></code> that have more
than one element. <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">op1</span> <span class="pre">b</span> <span class="pre">op2</span> <span class="pre">c</span> <span class="pre">...</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">op1</span> <span class="pre">b</span> <span class="pre">and</span> <span class="pre">b</span> <span class="pre">op2</span> <span class="pre">c</span> <span class="pre">and</span> <span class="pre">...</span></code>.</p>
<div class="section" id="value-comparisons">
<h4>Value Comparisons<a class="headerlink" href="#value-comparisons" title="Permalink to this headline">¶</a></h4>
<p>The operators <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">==</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>, and <code class="docutils literal notranslate"><span class="pre">!=</span></code> compare the values of two objects. The two objects generally need to be of
the same type, unless there is an implicit type conversion available between the objects. User-defined types can
be compared if rich comparison methods (e.g., <code class="docutils literal notranslate"><span class="pre">__lt__</span></code>) are defined on them. Built-in type comparison works like
Python:</p>
<ul class="simple">
<li><p>Numbers are compared mathematically.</p></li>
<li><p>Strings are compared lexicographically.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lists</span></code>, <code class="docutils literal notranslate"><span class="pre">tuples</span></code>, and <code class="docutils literal notranslate"><span class="pre">dicts</span></code> can be compared only to other <code class="docutils literal notranslate"><span class="pre">lists</span></code>, <code class="docutils literal notranslate"><span class="pre">tuples</span></code>, and <code class="docutils literal notranslate"><span class="pre">dicts</span></code> of the same type and are compared using the comparison operator of corresponding elements.</p></li>
</ul>
</div>
<div class="section" id="membership-test-operations">
<h4>Membership Test Operations<a class="headerlink" href="#membership-test-operations" title="Permalink to this headline">¶</a></h4>
<p>The operators <code class="docutils literal notranslate"><span class="pre">in</span></code> and <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">in</span></code> test for membership. <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">in</span> <span class="pre">s</span></code> evaluates to <code class="docutils literal notranslate"><span class="pre">True</span></code> if <code class="docutils literal notranslate"><span class="pre">x</span></code> is a member of <code class="docutils literal notranslate"><span class="pre">s</span></code> and <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.
<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">not</span> <span class="pre">in</span> <span class="pre">s</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">x</span> <span class="pre">in</span> <span class="pre">s</span></code>. This operator is supported for <code class="docutils literal notranslate"><span class="pre">lists</span></code>, <code class="docutils literal notranslate"><span class="pre">dicts</span></code>, and <code class="docutils literal notranslate"><span class="pre">tuples</span></code>, and can be used with
user-defined types if they implement the <code class="docutils literal notranslate"><span class="pre">__contains__</span></code> method.</p>
</div>
<div class="section" id="identity-comparisons">
<h4>Identity Comparisons<a class="headerlink" href="#identity-comparisons" title="Permalink to this headline">¶</a></h4>
<p>For all types except <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">double</span></code>, <code class="docutils literal notranslate"><span class="pre">bool</span></code>, and <code class="docutils literal notranslate"><span class="pre">torch.device</span></code>, operators <code class="docutils literal notranslate"><span class="pre">is</span></code> and <code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">not</span></code> test for the object’s identity;
<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">is</span> <span class="pre">y</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> if and and only if <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> are the same object. For all other types, <code class="docutils literal notranslate"><span class="pre">is</span></code> is equivalent to
comparing them using <code class="docutils literal notranslate"><span class="pre">==</span></code>. <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">y</span></code> yields the inverse of <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">is</span> <span class="pre">y</span></code>.</p>
</div>
</div>
<div class="section" id="boolean-operations">
<h3>Boolean Operations<a class="headerlink" href="#boolean-operations" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">or_test</span>  <span class="p">:</span><span class="o">:=</span>  <span class="n">and_test</span> <span class="o">|</span> <span class="n">or_test</span> <span class="s1">&#39;or&#39;</span> <span class="n">and_test</span>
<span class="n">and_test</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">not_test</span> <span class="o">|</span> <span class="n">and_test</span> <span class="s1">&#39;and&#39;</span> <span class="n">not_test</span>
<span class="n">not_test</span> <span class="p">:</span><span class="o">:=</span>  <span class="s1">&#39;bool&#39;</span> <span class="s1">&#39;(&#39;</span> <span class="n">or_expr</span> <span class="s1">&#39;)&#39;</span> <span class="o">|</span> <span class="n">comparison</span> <span class="o">|</span> <span class="s1">&#39;not&#39;</span> <span class="n">not_test</span>
</pre></div>
</div>
<p>User-defined objects can customize their conversion to <code class="docutils literal notranslate"><span class="pre">bool</span></code> by implementing a <code class="docutils literal notranslate"><span class="pre">__bool__</span></code> method. The operator <code class="docutils literal notranslate"><span class="pre">not</span></code>
yields <code class="docutils literal notranslate"><span class="pre">True</span></code> if its operand is false, <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise. The expression <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> first evaluates <code class="docutils literal notranslate"><span class="pre">x</span></code>; if it is <code class="docutils literal notranslate"><span class="pre">False</span></code>, its
value (<code class="docutils literal notranslate"><span class="pre">False</span></code>) is returned; otherwise, <code class="docutils literal notranslate"><span class="pre">y</span></code> is evaluated and its value is returned (<code class="docutils literal notranslate"><span class="pre">False</span></code> or <code class="docutils literal notranslate"><span class="pre">True</span></code>). The expression <code class="docutils literal notranslate"><span class="pre">x</span></code> or <code class="docutils literal notranslate"><span class="pre">y</span></code>
first evaluates <code class="docutils literal notranslate"><span class="pre">x</span></code>; if it is <code class="docutils literal notranslate"><span class="pre">True</span></code>, its value (<code class="docutils literal notranslate"><span class="pre">True</span></code>) is returned; otherwise, <code class="docutils literal notranslate"><span class="pre">y</span></code> is evaluated and its value is returned
(<code class="docutils literal notranslate"><span class="pre">False</span></code> or <code class="docutils literal notranslate"><span class="pre">True</span></code>).</p>
</div>
<div class="section" id="conditional-expressions">
<h3>Conditional Expressions<a class="headerlink" href="#conditional-expressions" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conditional_expression</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">or_expr</span> <span class="p">[</span><span class="s1">&#39;if&#39;</span> <span class="n">or_test</span> <span class="s1">&#39;else&#39;</span> <span class="n">conditional_expression</span><span class="p">]</span>
 <span class="n">expression</span>            <span class="p">:</span><span class="o">:=</span>  <span class="n">conditional_expression</span>
</pre></div>
</div>
<p>The expression <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">if</span> <span class="pre">c</span> <span class="pre">else</span> <span class="pre">y</span></code> first evaluates the condition <code class="docutils literal notranslate"><span class="pre">c</span></code> rather than x. If <code class="docutils literal notranslate"><span class="pre">c</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>, <code class="docutils literal notranslate"><span class="pre">x</span></code> is
evaluated and its value is returned; otherwise, <code class="docutils literal notranslate"><span class="pre">y</span></code> is evaluated and its value is returned. As with if-statements,
<code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> must evaluate to a value of the same type.</p>
</div>
<div class="section" id="expression-lists">
<h3>Expression Lists<a class="headerlink" href="#expression-lists" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">expression_list</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">expression</span> <span class="p">(</span><span class="s1">&#39;,&#39;</span> <span class="n">expression</span><span class="p">)</span><span class="o">*</span> <span class="p">[</span><span class="s1">&#39;,&#39;</span><span class="p">]</span>
<span class="n">starred_item</span>    <span class="p">:</span><span class="o">:=</span>  <span class="s1">&#39;*&#39;</span> <span class="n">primary</span>
</pre></div>
</div>
<p>A starred item can only appear on the left-hand side of an assignment statement, e.g., <code class="docutils literal notranslate"><span class="pre">a,</span> <span class="pre">*b,</span> <span class="pre">c</span> <span class="pre">=</span> <span class="pre">...</span></code>.</p>
</div>
</div>
<div class="section" id="simple-statements">
<h2><a class="toc-backref" href="#id11">Simple Statements</a><a class="headerlink" href="#simple-statements" title="Permalink to this headline">¶</a></h2>
<p>The following section describes the syntax of simple statements that are supported in TorchScript.
It is modeled after <a class="reference external" href="https://docs.python.org/3/reference/simple_stmts.html">the simple statements chapter of the Python language reference</a>.</p>
<div class="section" id="expression-statements">
<h3>Expression Statements<a class="headerlink" href="#expression-statements" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">expression_stmt</span>    <span class="p">:</span><span class="o">:=</span>  <span class="n">starred_expression</span>
<span class="n">starred_expression</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">expression</span> <span class="o">|</span> <span class="p">(</span><span class="n">starred_item</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">*</span> <span class="p">[</span><span class="n">starred_item</span><span class="p">]</span>
<span class="n">starred_item</span>       <span class="p">:</span><span class="o">:=</span>  <span class="n">assignment_expression</span> <span class="o">|</span> <span class="s2">&quot;*&quot;</span> <span class="n">or_expr</span>
</pre></div>
</div>
</div>
<div class="section" id="assignment-statements">
<h3>Assignment Statements<a class="headerlink" href="#assignment-statements" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">assignment_stmt</span> <span class="p">:</span><span class="o">:=</span>  <span class="p">(</span><span class="n">target_list</span> <span class="s2">&quot;=&quot;</span><span class="p">)</span><span class="o">+</span> <span class="p">(</span><span class="n">starred_expression</span><span class="p">)</span>
<span class="n">target_list</span>     <span class="p">:</span><span class="o">:=</span>  <span class="n">target</span> <span class="p">(</span><span class="s2">&quot;,&quot;</span> <span class="n">target</span><span class="p">)</span><span class="o">*</span> <span class="p">[</span><span class="s2">&quot;,&quot;</span><span class="p">]</span>
<span class="n">target</span>          <span class="p">:</span><span class="o">:=</span>  <span class="n">identifier</span>
                     <span class="o">|</span> <span class="s2">&quot;(&quot;</span> <span class="p">[</span><span class="n">target_list</span><span class="p">]</span> <span class="s2">&quot;)&quot;</span>
                     <span class="o">|</span> <span class="s2">&quot;[&quot;</span> <span class="p">[</span><span class="n">target_list</span><span class="p">]</span> <span class="s2">&quot;]&quot;</span>
                     <span class="o">|</span> <span class="n">attributeref</span>
                     <span class="o">|</span> <span class="n">subscription</span>
                     <span class="o">|</span> <span class="n">slicing</span>
                     <span class="o">|</span> <span class="s2">&quot;*&quot;</span> <span class="n">target</span>
</pre></div>
</div>
</div>
<div class="section" id="augmented-assignment-statements">
<h3>Augmented Assignment Statements<a class="headerlink" href="#augmented-assignment-statements" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">augmented_assignment_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="n">augtarget</span> <span class="n">augop</span> <span class="p">(</span><span class="n">expression_list</span><span class="p">)</span>
<span class="n">augtarget</span>                 <span class="p">:</span><span class="o">:=</span> <span class="n">identifier</span> <span class="o">|</span> <span class="n">attributeref</span> <span class="o">|</span> <span class="n">subscription</span>
<span class="n">augop</span>                     <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;+=&quot;</span> <span class="o">|</span> <span class="s2">&quot;-=&quot;</span> <span class="o">|</span> <span class="s2">&quot;*=&quot;</span> <span class="o">|</span> <span class="s2">&quot;/=&quot;</span> <span class="o">|</span> <span class="s2">&quot;//=&quot;</span> <span class="o">|</span> <span class="s2">&quot;%=&quot;</span> <span class="o">|</span>
                              <span class="s2">&quot;**=&quot;</span><span class="o">|</span> <span class="s2">&quot;&gt;&gt;=&quot;</span> <span class="o">|</span> <span class="s2">&quot;&lt;&lt;=&quot;</span> <span class="o">|</span> <span class="s2">&quot;&amp;=&quot;</span> <span class="o">|</span> <span class="s2">&quot;^=&quot;</span> <span class="o">|</span> <span class="s2">&quot;|=&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="annotated-assignment-statements">
<h3>Annotated Assignment Statements<a class="headerlink" href="#annotated-assignment-statements" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">annotated_assignment_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="n">augtarget</span> <span class="s2">&quot;:&quot;</span> <span class="n">expression</span>
                              <span class="p">[</span><span class="s2">&quot;=&quot;</span> <span class="p">(</span><span class="n">starred_expression</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="section" id="the-raise-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">raise</span></code> Statement<a class="headerlink" href="#the-raise-statement" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">raise_stmt</span> <span class="p">:</span><span class="o">:=</span>  <span class="s2">&quot;raise&quot;</span> <span class="p">[</span><span class="n">expression</span> <span class="p">[</span><span class="s2">&quot;from&quot;</span> <span class="n">expression</span><span class="p">]]</span>
</pre></div>
</div>
<p>Raise statements in TorchScript do not support <code class="docutils literal notranslate"><span class="pre">try\except\finally</span></code>.</p>
</div>
<div class="section" id="the-assert-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">assert</span></code> Statement<a class="headerlink" href="#the-assert-statement" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">assert_stmt</span> <span class="p">:</span><span class="o">:=</span>  <span class="s2">&quot;assert&quot;</span> <span class="n">expression</span> <span class="p">[</span><span class="s2">&quot;,&quot;</span> <span class="n">expression</span><span class="p">]</span>
</pre></div>
</div>
<p>Assert statements in TorchScript do not support <code class="docutils literal notranslate"><span class="pre">try\except\finally</span></code>.</p>
</div>
<div class="section" id="the-return-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">return</span></code> Statement<a class="headerlink" href="#the-return-statement" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">return_stmt</span> <span class="p">:</span><span class="o">:=</span>  <span class="s2">&quot;return&quot;</span> <span class="p">[</span><span class="n">expression_list</span><span class="p">]</span>
</pre></div>
</div>
<p>Return statements in TorchScript do not support <code class="docutils literal notranslate"><span class="pre">try\except\finally</span></code>.</p>
</div>
<div class="section" id="the-del-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">del</span></code> Statement<a class="headerlink" href="#the-del-statement" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">del_stmt</span> <span class="p">:</span><span class="o">:=</span>  <span class="s2">&quot;del&quot;</span> <span class="n">target_list</span>
</pre></div>
</div>
</div>
<div class="section" id="the-pass-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">pass</span></code> Statement<a class="headerlink" href="#the-pass-statement" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pass_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;pass&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="the-print-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">print</span></code> Statement<a class="headerlink" href="#the-print-statement" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">print_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;print&quot;</span> <span class="s2">&quot;(&quot;</span> <span class="n">expression</span>  <span class="p">[,</span> <span class="n">expression</span><span class="p">]</span> <span class="p">[</span><span class="o">.</span><span class="n">format</span><span class="p">{</span><span class="n">expression_list</span><span class="p">}]</span> <span class="s2">&quot;)&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="the-break-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">break</span></code> Statement<a class="headerlink" href="#the-break-statement" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">break_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;break&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="the-continue-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">continue</span></code> Statement:<a class="headerlink" href="#the-continue-statement" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">continue_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;continue&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="compound-statements">
<h2><a class="toc-backref" href="#id12">Compound Statements</a><a class="headerlink" href="#compound-statements" title="Permalink to this headline">¶</a></h2>
<p>The following section describes the syntax of compound statements that are supported in TorchScript.
The section also highlights how Torchscript differs from regular Python statements.
It is modeled after <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html">the compound statements chapter of the Python language reference</a>.</p>
<div class="section" id="the-if-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">if</span></code> Statement<a class="headerlink" href="#the-if-statement" title="Permalink to this headline">¶</a></h3>
<p>Torchscript supports both basic <code class="docutils literal notranslate"><span class="pre">if/else</span></code> and ternary <code class="docutils literal notranslate"><span class="pre">if/else</span></code>.</p>
<div class="section" id="basic-if-else-statement">
<h4>Basic <code class="docutils literal notranslate"><span class="pre">if/else</span></code> Statement<a class="headerlink" href="#basic-if-else-statement" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">if_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;if&quot;</span> <span class="n">assignment_expression</span> <span class="s2">&quot;:&quot;</span> <span class="n">suite</span>
            <span class="p">(</span><span class="s2">&quot;elif&quot;</span> <span class="n">assignment_expression</span> <span class="s2">&quot;:&quot;</span> <span class="n">suite</span><span class="p">)</span>
            <span class="p">[</span><span class="s2">&quot;else&quot;</span> <span class="s2">&quot;:&quot;</span> <span class="n">suite</span><span class="p">]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">elif</span></code> statements can repeat for an arbitrary number of times, but it needs to be before <code class="docutils literal notranslate"><span class="pre">else</span></code> statement.</p>
</div>
<div class="section" id="ternary-if-else-statement">
<h4>Ternary <code class="docutils literal notranslate"><span class="pre">if/else</span></code> Statement<a class="headerlink" href="#ternary-if-else-statement" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">if_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="k">return</span> <span class="p">[</span><span class="n">expression_list</span><span class="p">]</span> <span class="s2">&quot;if&quot;</span> <span class="n">assignment_expression</span> <span class="s2">&quot;else&quot;</span> <span class="p">[</span><span class="n">expression_list</span><span class="p">]</span>
</pre></div>
</div>
<p><strong>Example 1</strong></p>
<p>A <code class="docutils literal notranslate"><span class="pre">tensor</span></code> with 1 dimension is promoted to <code class="docutils literal notranslate"><span class="pre">bool</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">def</span> <span class="nf">fn</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span><span class="p">:</span> <span class="c1"># The tensor gets promoted to bool</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fn</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
<p>The example above produces the following output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
<p><strong>Example 2</strong></p>
<p>A <code class="docutils literal notranslate"><span class="pre">tensor</span></code> with multi dimensions are not promoted to <code class="docutils literal notranslate"><span class="pre">bool</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="c1"># Multi dimensional Tensors error out.</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">def</span> <span class="nf">fn</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tensor is available&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tensor is available&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">fn</span><span class="p">())</span>
</pre></div>
</div>
<p>Running the above code yields the following <code class="docutils literal notranslate"><span class="pre">RuntimeError</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ne">RuntimeError</span><span class="p">:</span> <span class="n">The</span> <span class="n">following</span> <span class="n">operation</span> <span class="n">failed</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">TorchScript</span> <span class="n">interpreter</span><span class="o">.</span>
<span class="n">Traceback</span> <span class="n">of</span> <span class="n">TorchScript</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">def</span> <span class="nf">fn</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
       <span class="o">~~~~~~~~~~~~</span> <span class="o">&lt;---</span> <span class="n">HERE</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tensor is available&quot;</span><span class="p">)</span>
<span class="ne">RuntimeError</span><span class="p">:</span> <span class="n">Boolean</span> <span class="n">value</span> <span class="n">of</span> <span class="n">Tensor</span> <span class="k">with</span> <span class="n">more</span> <span class="n">than</span> <span class="n">one</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">ambiguous</span>
</pre></div>
</div>
<p>If a conditional variable is annotated as <code class="docutils literal notranslate"><span class="pre">final</span></code>, either the true or false branch is evaluated depending on the evaluation of the conditional variable.</p>
<p><strong>Example 3</strong></p>
<p>In this example, only the True branch is evaluated, since <code class="docutils literal notranslate"><span class="pre">a</span></code> is annotated as <code class="docutils literal notranslate"><span class="pre">final</span></code> and set to <code class="docutils literal notranslate"><span class="pre">True</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="n">a</span> <span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">final</span><span class="p">[</span><span class="n">Bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">if</span> <span class="n">a</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">[]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-while-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">while</span></code> Statement<a class="headerlink" href="#the-while-statement" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">while_stmt</span> <span class="p">:</span><span class="o">:=</span>  <span class="s2">&quot;while&quot;</span> <span class="n">assignment_expression</span> <span class="s2">&quot;:&quot;</span> <span class="n">suite</span>
</pre></div>
</div>
<p><cite>while…else</cite> statements are not supported in Torchscript. It results in a <code class="docutils literal notranslate"><span class="pre">RuntimeError</span></code>.</p>
</div>
<div class="section" id="the-for-in-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">for-in</span></code> Statement<a class="headerlink" href="#the-for-in-statement" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">for_stmt</span> <span class="p">:</span><span class="o">:=</span>  <span class="s2">&quot;for&quot;</span> <span class="n">target_list</span> <span class="s2">&quot;in&quot;</span> <span class="n">expression_list</span> <span class="s2">&quot;:&quot;</span> <span class="n">suite</span>
              <span class="p">[</span><span class="s2">&quot;else&quot;</span> <span class="s2">&quot;:&quot;</span> <span class="n">suite</span><span class="p">]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">for...else</span></code> statements are not supported in Torchscript. It results in a <code class="docutils literal notranslate"><span class="pre">RuntimeError</span></code>.</p>
<p><strong>Example 1</strong></p>
<p>For loops on tuples: these unroll the loop, generating a body for each member of the tuple. The body must type-check correctly for each member.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">def</span> <span class="nf">fn</span><span class="p">():</span>
    <span class="n">tup</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tup</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">fn</span><span class="p">()</span>
</pre></div>
</div>
<p>The example above produces the following output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>3
 1
 1
 1
 1
[ CPUFloatType{4} ]
</pre></div>
</div>
<p><strong>Example 2</strong></p>
<p>For loops on lists: for loops over a <code class="docutils literal notranslate"><span class="pre">nn.ModuleList</span></code> will unroll the body of the loop at compile time, with each member of the module list.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SubModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SubModule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">+</span> <span class="nb">input</span>

<span class="k">class</span> <span class="nc">MyModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyModule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mods</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">([</span><span class="n">SubModule</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mods</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">module</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">MyModule</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="the-with-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">with</span></code> Statement<a class="headerlink" href="#the-with-statement" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">with</span></code> statement is used to wrap the execution of a block with methods defined by a context manager.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">with_stmt</span> <span class="p">:</span><span class="o">:=</span>  <span class="s2">&quot;with&quot;</span> <span class="n">with_item</span> <span class="p">(</span><span class="s2">&quot;,&quot;</span> <span class="n">with_item</span><span class="p">)</span> <span class="s2">&quot;:&quot;</span> <span class="n">suite</span>
<span class="n">with_item</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">expression</span> <span class="p">[</span><span class="s2">&quot;as&quot;</span> <span class="n">target</span><span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>If a target was included in the <code class="docutils literal notranslate"><span class="pre">with</span></code> statement, the return value from the context manager’s <code class="docutils literal notranslate"><span class="pre">__enter__()</span></code> is assigned to it. Unlike python, if an exception caused the suite to be exited, its type, value, and traceback are not passed as arguments to <code class="docutils literal notranslate"><span class="pre">__exit__()</span></code>. Three <code class="docutils literal notranslate"><span class="pre">None</span></code> arguments are supplied.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">try</span></code>, <code class="docutils literal notranslate"><span class="pre">except</span></code>, and <code class="docutils literal notranslate"><span class="pre">finally</span></code> statements are not supported inside <code class="docutils literal notranslate"><span class="pre">with</span></code> blocks.</p></li>
<li><p>Exceptions raised within <code class="docutils literal notranslate"><span class="pre">with</span></code> block cannot be suppressed.</p></li>
</ul>
</div>
<div class="section" id="the-tuple-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">tuple</span></code> Statement<a class="headerlink" href="#the-tuple-statement" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tuple_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">iterables</span><span class="p">])</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Iterable types in TorchScript include <code class="docutils literal notranslate"><span class="pre">Tensors</span></code>, <code class="docutils literal notranslate"><span class="pre">lists</span></code>, <code class="docutils literal notranslate"><span class="pre">tuples</span></code>, <code class="docutils literal notranslate"><span class="pre">dictionaries</span></code>, <code class="docutils literal notranslate"><span class="pre">strings</span></code>, <code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleList</span></code>, and <code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleDict</span></code>.</p></li>
<li><p>You cannot convert a List to Tuple by using this built-in function.</p></li>
</ul>
<p>Unpacking all outputs into a tuple is covered by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">abc</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span> <span class="c1"># Function that returns a tuple</span>
<span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="the-getattr-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">getattr</span></code> Statement<a class="headerlink" href="#the-getattr-statement" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">getattr_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">[,</span> <span class="n">default</span><span class="p">])</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Attribute name must be a literal string.</p></li>
<li><p>Module type object is not supported (e.g., torch._C).</p></li>
<li><p>Custom class object is not supported (e.g., torch.classes.*).</p></li>
</ul>
</div>
<div class="section" id="the-hasattr-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">hasattr</span></code> Statement<a class="headerlink" href="#the-hasattr-statement" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hasattr_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Attribute name must be a literal string.</p></li>
<li><p>Module type object is not supported (e.g., torch._C).</p></li>
<li><p>Custom class object is not supported (e.g., torch.classes.*).</p></li>
</ul>
</div>
<div class="section" id="the-zip-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">zip</span></code> Statement<a class="headerlink" href="#the-zip-statement" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">zip_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">iterable1</span><span class="p">,</span> <span class="n">iterable2</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Arguments must be iterables.</p></li>
<li><p>Two iterables of same outer container type but different length are supported.</p></li>
</ul>
<p><strong>Example 1</strong></p>
<p>Both the iterables must be of the same container type:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="c1"># List</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="c1"># List</span>
<span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="c1"># works</span>
</pre></div>
</div>
<p><strong>Example 2</strong></p>
<p>This example fails because the iterables are of different container types:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># Tuple</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="c1"># List</span>
<span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="c1"># Runtime error</span>
</pre></div>
</div>
<p>Running the above code yields the following <code class="docutils literal notranslate"><span class="pre">RuntimeError</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ne">RuntimeError</span><span class="p">:</span> <span class="n">Can</span> <span class="ow">not</span> <span class="n">iterate</span> <span class="n">over</span> <span class="n">a</span> <span class="n">module</span> <span class="nb">list</span> <span class="ow">or</span>
    <span class="nb">tuple</span> <span class="k">with</span> <span class="n">a</span> <span class="n">value</span> <span class="n">that</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">have</span> <span class="n">a</span> <span class="n">statically</span> <span class="n">determinable</span> <span class="n">length</span><span class="o">.</span>
</pre></div>
</div>
<p><strong>Example 3</strong></p>
<p>Two iterables of the same container Type but different data type is supported:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.3</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="c1"># Works</span>
</pre></div>
</div>
<p>Iterable types in TorchScript include <code class="docutils literal notranslate"><span class="pre">Tensors</span></code>, <code class="docutils literal notranslate"><span class="pre">lists</span></code>, <code class="docutils literal notranslate"><span class="pre">tuples</span></code>, <code class="docutils literal notranslate"><span class="pre">dictionaries</span></code>, <code class="docutils literal notranslate"><span class="pre">strings</span></code>, <code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleList</span></code>, and <code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleDict</span></code>.</p>
</div>
<div class="section" id="the-enumerate-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">enumerate</span></code> Statement<a class="headerlink" href="#the-enumerate-statement" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">enumerate_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">iterable</span><span class="p">])</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Arguments must be iterables.</p></li>
<li><p>Iterable types in TorchScript include <code class="docutils literal notranslate"><span class="pre">Tensors</span></code>, <code class="docutils literal notranslate"><span class="pre">lists</span></code>, <code class="docutils literal notranslate"><span class="pre">tuples</span></code>, <code class="docutils literal notranslate"><span class="pre">dictionaries</span></code>, <code class="docutils literal notranslate"><span class="pre">strings</span></code>, <code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleList</span></code> and <code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleDict</span></code>.</p></li>
</ul>
</div>
</div>
<div class="section" id="python-values">
<span id="python-values-torch-script"></span><h2><a class="toc-backref" href="#id13">Python Values</a><a class="headerlink" href="#python-values" title="Permalink to this headline">¶</a></h2>
<div class="section" id="resolution-rules">
<span id="python-builtin-functions-values-resolution"></span><h3>Resolution Rules<a class="headerlink" href="#resolution-rules" title="Permalink to this headline">¶</a></h3>
<p>When given a Python value, TorchScript attempts to resolve it in the following five different ways:</p>
<ul class="simple">
<li><dl class="simple">
<dt>Compilable Python Implementation:</dt><dd><ul>
<li><p>When a Python value is backed by a Python implementation that can be compiled by TorchScript, TorchScript compiles and uses the underlying Python implementation.</p></li>
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">torch.jit.Attribute</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Op Python Wrapper:</dt><dd><ul>
<li><p>When a Python value is a wrapper of a native PyTorch op, TorchScript emits the corresponding operator.</p></li>
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">torch.jit._logging.add_stat_value</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Python Object Identity Match:</dt><dd><ul>
<li><p>For a limited set of <code class="docutils literal notranslate"><span class="pre">torch.*</span></code> API calls (in the form of Python values) that TorchScript supports, TorchScript attempts to match a Python value against each item in the set.</p></li>
<li><p>When matched, TorchScript generates a corresponding <code class="docutils literal notranslate"><span class="pre">SugaredValue</span></code> instance that contains lowering logic for these values.</p></li>
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">torch.jit.isinstance()</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Name Match:</dt><dd><ul>
<li><p>For Python built-in functions and constants, TorchScript identifies them by name, and creates a corresponding <code class="docutils literal notranslate"><span class="pre">SugaredValue</span></code> instance that implements their functionality.</p></li>
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">all()</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Value Snapshot:</dt><dd><ul>
<li><p>For Python values from unrecognized modules, TorchScript attempts to take a snapshot of the value and converts it to a constant in the graph of the function(s) or method(s) that are being compiled.</p></li>
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">math.pi</span></code></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="python-built-in-functions-support">
<span id="python-builtin-functions-support"></span><h3>Python Built-in Functions Support<a class="headerlink" href="#python-built-in-functions-support" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-given docutils colwidths-auto align-default" id="id5">
<caption><span class="caption-text">TorchScript Support for Python Built-in Functions</span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Built-in Function</p></th>
<th class="head"><p>Support Level</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">abs()</span></code></p></td>
<td><p>Partial</p></td>
<td><p>Only supports <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>/<code class="docutils literal notranslate"><span class="pre">Int</span></code>/<code class="docutils literal notranslate"><span class="pre">Float</span></code> type inputs. | Doesn’t honor <code class="docutils literal notranslate"><span class="pre">__abs__</span></code> override.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">all()</span></code></p></td>
<td><p>Full</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">any()</span></code></p></td>
<td><p>Full</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ascii()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">bin()</span></code></p></td>
<td><p>Partial</p></td>
<td><p>Only supports <code class="docutils literal notranslate"><span class="pre">Int</span></code> type input.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">bool()</span></code></p></td>
<td><p>Partial</p></td>
<td><p>Only supports <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>/<code class="docutils literal notranslate"><span class="pre">Int</span></code>/<code class="docutils literal notranslate"><span class="pre">Float</span></code> type inputs.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">breakpoint()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">bytearray()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">bytes()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">callable()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">chr()</span></code></p></td>
<td><p>Partial</p></td>
<td><p>Only ASCII character set is supported.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">classmethod()</span></code></p></td>
<td><p>Full</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">compile()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">complex()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">delattr()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">dict()</span></code></p></td>
<td><p>Full</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">dir()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">divmod()</span></code></p></td>
<td><p>Full</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">enumerate()</span></code></p></td>
<td><p>Full</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">eval()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">exec()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">filter()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">float()</span></code></p></td>
<td><p>Partial</p></td>
<td><p>Doesn’t honor <code class="docutils literal notranslate"><span class="pre">__index__</span></code> override.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">format()</span></code></p></td>
<td><p>Partial</p></td>
<td><p>Manual index specification not supported. | Format type modifier not supported.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">frozenset()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">getattr()</span></code></p></td>
<td><p>Partial</p></td>
<td><p>Attribute name must be string literal.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">globals()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hasattr()</span></code></p></td>
<td><p>Partial</p></td>
<td><p>Attribute name must be string literal.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hash()</span></code></p></td>
<td><p>Full</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Tensor</span></code>’s hash is based on identity not numeric value.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hex()</span></code></p></td>
<td><p>Partial</p></td>
<td><p>Only supports <code class="docutils literal notranslate"><span class="pre">Int</span></code> type input.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">id()</span></code></p></td>
<td><p>Full</p></td>
<td><p>Only supports <code class="docutils literal notranslate"><span class="pre">Int</span></code> type input.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">input()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">int()</span></code></p></td>
<td><p>Partial</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">base</span></code> argument not supported. | Doesn’t honor <code class="docutils literal notranslate"><span class="pre">__index__</span></code> override.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">isinstance()</span></code></p></td>
<td><p>Full</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">torch.jit.isintance</span></code> provides better support when checking against container types like <code class="docutils literal notranslate"><span class="pre">Dict[str,</span> <span class="pre">int]</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">issubclass()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">iter()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">len()</span></code></p></td>
<td><p>Full</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">list()</span></code></p></td>
<td><p>Full</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ord()</span></code></p></td>
<td><p>Partial</p></td>
<td><p>Only ASCII character set is supported.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">pow()</span></code></p></td>
<td><p>Full</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">print()</span></code></p></td>
<td><p>Partial</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">separate</span></code>, <code class="docutils literal notranslate"><span class="pre">end</span></code> and <code class="docutils literal notranslate"><span class="pre">file</span></code> arguments are not supported.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">property()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">range()</span></code></p></td>
<td><p>Full</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">repr()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">reversed()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">round()</span></code></p></td>
<td><p>Partial</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ndigits</span></code> argument is not supported.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">set()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">setattr()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">slice()</span></code></p></td>
<td><p>Full</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sorted()</span></code></p></td>
<td><p>Partial</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">key</span></code> argument is not supported.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">staticmethod()</span></code></p></td>
<td><p>Full</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">str()</span></code></p></td>
<td><p>Partial</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">encoding</span></code> and <code class="docutils literal notranslate"><span class="pre">errors</span></code> arguments are not supported.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">sum()</span></code></p></td>
<td><p>Full</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">super()</span></code></p></td>
<td><p>Partial</p></td>
<td><p>It can only be used in <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code>’s <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">type()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">vars()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">zip()</span></code></p></td>
<td><p>Full</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__import__()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="python-built-in-values-support">
<span id="python-builtin-values-support"></span><h3>Python Built-in Values Support<a class="headerlink" href="#python-built-in-values-support" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-given docutils colwidths-auto align-default" id="id6">
<caption><span class="caption-text">TorchScript Support for Python Built-in Values</span><a class="headerlink" href="#id6" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Built-in Value</p></th>
<th class="head"><p>Support Level</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">False</span></code></p></td>
<td><p>Full</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">True</span></code></p></td>
<td><p>Full</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>Full</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">NotImplemented</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Ellipsis</span></code></p></td>
<td><p>Full</p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="torch-apis">
<span id="torch-apis-in-torchscript"></span><h2><a class="toc-backref" href="#id14">torch.* APIs</a><a class="headerlink" href="#torch-apis" title="Permalink to this headline">¶</a></h2>
<div class="section" id="remote-procedure-calls">
<span id="torch-apis-in-torchscript-rpc"></span><h3>Remote Procedure Calls<a class="headerlink" href="#remote-procedure-calls" title="Permalink to this headline">¶</a></h3>
<p>TorchScript supports a subset of RPC APIs that supports running a function on
a specified remote worker instead of locally.</p>
<p>Specifically, following APIs are fully supported:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">torch.distributed.rpc.rpc_sync()</span></code></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">rpc_sync()</span></code> makes a blocking RPC call to run a function on a remote worker. RPC messages are sent and received in parallel to execution of Python code.</p></li>
<li><p>More details about its usage and examples can be found in <a class="reference internal" href="rpc.html#torch.distributed.rpc.rpc_sync" title="torch.distributed.rpc.rpc_sync"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rpc_sync()</span></code></a>.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">torch.distributed.rpc.rpc_async()</span></code></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">rpc_async()</span></code> makes a non-blocking RPC call to run a function on a remote worker. RPC messages are sent and received in parallel to execution of Python code.</p></li>
<li><p>More deatils about its usage and examples can be found in <a class="reference internal" href="rpc.html#torch.distributed.rpc.rpc_async" title="torch.distributed.rpc.rpc_async"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rpc_async()</span></code></a>.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">torch.distributed.rpc.remote()</span></code></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">remote.()</span></code> executes a remote call on a worker and gets a Remote Reference <code class="docutils literal notranslate"><span class="pre">RRef</span></code> as the return value.</p></li>
<li><p>More details about its usage and examples can be found in <a class="reference internal" href="rpc.html#torch.distributed.rpc.remote" title="torch.distributed.rpc.remote"><code class="xref py py-meth docutils literal notranslate"><span class="pre">remote()</span></code></a>.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="asynchronous-execution">
<span id="torch-apis-in-torchscript-async"></span><h3>Asynchronous Execution<a class="headerlink" href="#asynchronous-execution" title="Permalink to this headline">¶</a></h3>
<p>TorchScript enables you to create asynchronous computation tasks to make better use
of computation resources. This is done via supporting a list of APIs that are
only usable within TorchScript:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">torch.jit.fork()</span></code></dt><dd><ul>
<li><p>Creates an asynchronous task executing func and a reference to the value of the result of this execution. Fork will return immediately.</p></li>
<li><p>Synonymous to <code class="docutils literal notranslate"><span class="pre">torch.jit._fork()</span></code>, which is only kept for backward compatibility reasons.</p></li>
<li><p>More deatils about its usage and examples can be found in <a class="reference internal" href="generated/torch.jit.fork.html#torch.jit.fork" title="torch.jit.fork"><code class="xref py py-meth docutils literal notranslate"><span class="pre">fork()</span></code></a>.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">torch.jit.wait()</span></code></dt><dd><ul>
<li><p>Forces completion of a <code class="docutils literal notranslate"><span class="pre">torch.jit.Future[T]</span></code> asynchronous task, returning the result of the task.</p></li>
<li><p>Synonymous to <code class="docutils literal notranslate"><span class="pre">torch.jit._wait()</span></code>, which is only kept for backward compatibility reasons.</p></li>
<li><p>More deatils about its usage and examples can be found in <a class="reference internal" href="generated/torch.jit.wait.html#torch.jit.wait" title="torch.jit.wait"><code class="xref py py-meth docutils literal notranslate"><span class="pre">wait()</span></code></a>.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="type-annotations">
<span id="torch-apis-in-torchscript-annotation"></span><h3>Type Annotations<a class="headerlink" href="#type-annotations" title="Permalink to this headline">¶</a></h3>
<p>TorchScript is statically-typed. It provides and supports a set of utilities to help annotate variables and attributes:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">torch.jit.annotate()</span></code></dt><dd><ul>
<li><p>Provides a type hint to TorchScript where Python 3 style type hints do not work well.</p></li>
<li><p>One common example is to annotate type for expressions like <code class="docutils literal notranslate"><span class="pre">[]</span></code>. <code class="docutils literal notranslate"><span class="pre">[]</span></code> is treated as <code class="docutils literal notranslate"><span class="pre">List[torch.Tensor]</span></code> by default. When a different type is needed, you can use this code to hint TorchScript: <code class="docutils literal notranslate"><span class="pre">torch.jit.annotate(List[int],</span> <span class="pre">[])</span></code>.</p></li>
<li><p>More details can be found in <a class="reference internal" href="generated/torch.jit.annotate.html#torch.jit.annotate" title="torch.jit.annotate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">annotate()</span></code></a></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">torch.jit.Attribute</span></code></dt><dd><ul>
<li><p>Common use cases include providing type hint for <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> attributes. Because their <code class="docutils literal notranslate"><span class="pre">__init__</span></code> methods are not parsed by TorchScript, <code class="docutils literal notranslate"><span class="pre">torch.jit.Attribute</span></code> should be used instead of <code class="docutils literal notranslate"><span class="pre">torch.jit.annotate</span></code> in the module’s <code class="docutils literal notranslate"><span class="pre">__init__</span></code> methods.</p></li>
<li><p>More details can be found in <a class="reference internal" href="generated/torch.jit.Attribute.html#torch.jit.Attribute" title="torch.jit.Attribute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Attribute()</span></code></a></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">torch.jit.Final</span></code></dt><dd><ul>
<li><p>An alias for Python’s <code class="docutils literal notranslate"><span class="pre">typing.Final</span></code>. <code class="docutils literal notranslate"><span class="pre">torch.jit.Final</span></code> is kept only for backward compatibility reasons.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="meta-programming">
<span id="torch-apis-in-torchscript-meta-programming"></span><h3>Meta Programming<a class="headerlink" href="#meta-programming" title="Permalink to this headline">¶</a></h3>
<p>TorchScript provides a set of utilities to facilitate meta programming:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">torch.jit.is_scripting()</span></code></dt><dd><ul>
<li><p>Returns a boolean value indicating whether the current program is compiled by <code class="docutils literal notranslate"><span class="pre">torch.jit.script</span></code> or not.</p></li>
<li><p>When used in an <code class="docutils literal notranslate"><span class="pre">assert</span></code> or an <code class="docutils literal notranslate"><span class="pre">if</span></code> statement, the scope or branch where <code class="docutils literal notranslate"><span class="pre">torch.jit.is_scripting()</span></code> evaluates to <code class="docutils literal notranslate"><span class="pre">False</span></code> is not compiled.</p></li>
<li><p>Its value can be evaluated statically at compile time, thus commonly used in <code class="docutils literal notranslate"><span class="pre">if</span></code> statements to stop TorchScript from compiling one of the branches.</p></li>
<li><p>More details and examples can be found in <a class="reference internal" href="jit_language_reference.html#torch.jit.is_scripting" title="torch.jit.is_scripting"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_scripting()</span></code></a></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">torch.jit.is_tracing()</span></code></dt><dd><ul>
<li><p>Returns a boolean value indicating whether the current program is traced by <code class="docutils literal notranslate"><span class="pre">torch.jit.trace</span></code> / <code class="docutils literal notranslate"><span class="pre">torch.jit.trace_module</span></code> or not.</p></li>
<li><p>More details can be found in <a class="reference internal" href="jit_language_reference.html#torch.jit.is_tracing" title="torch.jit.is_tracing"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_tracing()</span></code></a></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">&#64;torch.jit.ignore</span></code></dt><dd><ul>
<li><p>This decorator indicates to the compiler that a function or method should be ignored and left as a Python function.</p></li>
<li><p>This allows you to leave code in your model that is not yet TorchScript compatible.</p></li>
<li><p>If a function decorated by <code class="docutils literal notranslate"><span class="pre">&#64;torch.jit.ignore</span></code> is called from TorchScript, ignored functions will dispatch the call to the Python interpreter.</p></li>
<li><p>Models with ignored functions cannot be exported.</p></li>
<li><p>More details and examples can be found in <a class="reference internal" href="generated/torch.jit.ignore.html#torch.jit.ignore" title="torch.jit.ignore"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ignore()</span></code></a></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">&#64;torch.jit.unused</span></code></dt><dd><ul>
<li><p>This decorator indicates to the compiler that a function or method should be ignored and replaced with the raising of an exception.</p></li>
<li><p>This allows you to leave code in your model that is not yet TorchScript compatible and still export your model.</p></li>
<li><p>If a function decorated by <code class="docutils literal notranslate"><span class="pre">&#64;torch.jit.unused</span></code> is called from TorchScript, a runtime error will be raised.</p></li>
<li><p>More details and examples can be found in <a class="reference internal" href="generated/torch.jit.unused.html#torch.jit.unused" title="torch.jit.unused"><code class="xref py py-meth docutils literal notranslate"><span class="pre">unused()</span></code></a></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="type-refinement">
<span id="torch-apis-in-torchscript-type-refinement"></span><h3>Type Refinement<a class="headerlink" href="#type-refinement" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">torch.jit.isinstance()</span></code></dt><dd><ul>
<li><p>Returns a boolean indicating whether a variable is of the specified type.</p></li>
<li><p>More details about its usage and examples can be found in <a class="reference internal" href="generated/torch.jit.isinstance.html#torch.jit.isinstance" title="torch.jit.isinstance"><code class="xref py py-meth docutils literal notranslate"><span class="pre">isinstance()</span></code></a>.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
</div>


             </article>
             
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="generated/torch.jit.script.html" class="btn btn-neutral float-right" title="torch.jit.script" accesskey="n" rel="next">Next <img src="_static/images/chevron-right-orange.svg" class="next-page"></a>
      
      
        <a href="jit_language_reference.html" class="btn btn-neutral" title="TorchScript Language Reference" accesskey="p" rel="prev"><img src="_static/images/chevron-right-orange.svg" class="previous-page"> Previous</a>
      
    </div>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, PyTorch Contributors.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              <ul>
<li><a class="reference internal" href="#">TorchScript Language Reference</a><ul>
<li><a class="reference internal" href="#terminology">Terminology</a></li>
<li><a class="reference internal" href="#id1">Type System</a><ul>
<li><a class="reference internal" href="#torchscript-types">TorchScript Types</a></li>
<li><a class="reference internal" href="#meta-types">Meta Types</a><ul>
<li><a class="reference internal" href="#any-type"><code class="docutils literal notranslate"><span class="pre">Any</span></code> Type</a></li>
<li><a class="reference internal" href="#operators-supported-for-any-type">Operators Supported for <code class="docutils literal notranslate"><span class="pre">Any</span></code> Type</a></li>
<li><a class="reference internal" href="#design-notes">Design Notes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#primitive-types">Primitive Types</a></li>
<li><a class="reference internal" href="#structural-types">Structural Types</a></li>
<li><a class="reference internal" href="#nominal-types">Nominal Types</a></li>
<li><a class="reference internal" href="#built-in-class">Built-in Class</a><ul>
<li><a class="reference internal" href="#special-note-on-torch-nn-modulelist-and-torch-nn-moduledict">Special Note on torch.nn.ModuleList and torch.nn.ModuleDict</a></li>
</ul>
</li>
<li><a class="reference internal" href="#custom-class">Custom Class</a></li>
<li><a class="reference internal" href="#enum-type">Enum Type</a></li>
<li><a class="reference internal" href="#torchscript-module-class">TorchScript Module Class</a></li>
<li><a class="reference internal" href="#module-instance-class">Module Instance Class</a></li>
</ul>
</li>
<li><a class="reference internal" href="#type-annotation">Type Annotation</a><ul>
<li><a class="reference internal" href="#when-to-annotate-types">When to Annotate Types</a></li>
<li><a class="reference internal" href="#annotate-function-signature">Annotate Function Signature</a></li>
<li><a class="reference internal" href="#annotate-variables-and-data-attributes">Annotate Variables and Data Attributes</a><ul>
<li><a class="reference internal" href="#local-variables">Local Variables</a></li>
<li><a class="reference internal" href="#instance-data-attributes">Instance Data Attributes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#type-annotation-apis">Type Annotation APIs</a><ul>
<li><a class="reference internal" href="#torch-jit-annotate-t-expr"><code class="docutils literal notranslate"><span class="pre">torch.jit.annotate(T,</span> <span class="pre">expr)</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#type-annotation-appendix">Type Annotation Appendix</a><ul>
<li><a class="reference internal" href="#torchscript-type-system-definition">TorchScript Type System Definition</a></li>
<li><a class="reference internal" href="#unsupported-typing-constructs">Unsupported Typing Constructs</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#expressions">Expressions</a><ul>
<li><a class="reference internal" href="#arithmetic-conversions">Arithmetic Conversions</a></li>
<li><a class="reference internal" href="#atoms">Atoms</a><ul>
<li><a class="reference internal" href="#identifiers">Identifiers</a></li>
<li><a class="reference internal" href="#literals">Literals</a></li>
<li><a class="reference internal" href="#parenthesized-forms">Parenthesized Forms</a></li>
<li><a class="reference internal" href="#list-and-dictionary-displays">List and Dictionary Displays</a></li>
</ul>
</li>
<li><a class="reference internal" href="#primaries">Primaries</a><ul>
<li><a class="reference internal" href="#attribute-references">Attribute References</a></li>
<li><a class="reference internal" href="#subscriptions">Subscriptions</a></li>
<li><a class="reference internal" href="#slicings">Slicings</a></li>
<li><a class="reference internal" href="#calls">Calls</a></li>
</ul>
</li>
<li><a class="reference internal" href="#power-operator">Power Operator</a></li>
<li><a class="reference internal" href="#unary-and-arithmetic-bitwise-operations">Unary and Arithmetic Bitwise Operations</a></li>
<li><a class="reference internal" href="#binary-arithmetic-operations">Binary Arithmetic Operations</a></li>
<li><a class="reference internal" href="#shifting-operations">Shifting Operations</a></li>
<li><a class="reference internal" href="#binary-bitwise-operations">Binary Bitwise Operations</a></li>
<li><a class="reference internal" href="#comparisons">Comparisons</a><ul>
<li><a class="reference internal" href="#value-comparisons">Value Comparisons</a></li>
<li><a class="reference internal" href="#membership-test-operations">Membership Test Operations</a></li>
<li><a class="reference internal" href="#identity-comparisons">Identity Comparisons</a></li>
</ul>
</li>
<li><a class="reference internal" href="#boolean-operations">Boolean Operations</a></li>
<li><a class="reference internal" href="#conditional-expressions">Conditional Expressions</a></li>
<li><a class="reference internal" href="#expression-lists">Expression Lists</a></li>
</ul>
</li>
<li><a class="reference internal" href="#simple-statements">Simple Statements</a><ul>
<li><a class="reference internal" href="#expression-statements">Expression Statements</a></li>
<li><a class="reference internal" href="#assignment-statements">Assignment Statements</a></li>
<li><a class="reference internal" href="#augmented-assignment-statements">Augmented Assignment Statements</a></li>
<li><a class="reference internal" href="#annotated-assignment-statements">Annotated Assignment Statements</a></li>
<li><a class="reference internal" href="#the-raise-statement">The <code class="docutils literal notranslate"><span class="pre">raise</span></code> Statement</a></li>
<li><a class="reference internal" href="#the-assert-statement">The <code class="docutils literal notranslate"><span class="pre">assert</span></code> Statement</a></li>
<li><a class="reference internal" href="#the-return-statement">The <code class="docutils literal notranslate"><span class="pre">return</span></code> Statement</a></li>
<li><a class="reference internal" href="#the-del-statement">The <code class="docutils literal notranslate"><span class="pre">del</span></code> Statement</a></li>
<li><a class="reference internal" href="#the-pass-statement">The <code class="docutils literal notranslate"><span class="pre">pass</span></code> Statement</a></li>
<li><a class="reference internal" href="#the-print-statement">The <code class="docutils literal notranslate"><span class="pre">print</span></code> Statement</a></li>
<li><a class="reference internal" href="#the-break-statement">The <code class="docutils literal notranslate"><span class="pre">break</span></code> Statement</a></li>
<li><a class="reference internal" href="#the-continue-statement">The <code class="docutils literal notranslate"><span class="pre">continue</span></code> Statement:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#compound-statements">Compound Statements</a><ul>
<li><a class="reference internal" href="#the-if-statement">The <code class="docutils literal notranslate"><span class="pre">if</span></code> Statement</a><ul>
<li><a class="reference internal" href="#basic-if-else-statement">Basic <code class="docutils literal notranslate"><span class="pre">if/else</span></code> Statement</a></li>
<li><a class="reference internal" href="#ternary-if-else-statement">Ternary <code class="docutils literal notranslate"><span class="pre">if/else</span></code> Statement</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-while-statement">The <code class="docutils literal notranslate"><span class="pre">while</span></code> Statement</a></li>
<li><a class="reference internal" href="#the-for-in-statement">The <code class="docutils literal notranslate"><span class="pre">for-in</span></code> Statement</a></li>
<li><a class="reference internal" href="#the-with-statement">The <code class="docutils literal notranslate"><span class="pre">with</span></code> Statement</a></li>
<li><a class="reference internal" href="#the-tuple-statement">The <code class="docutils literal notranslate"><span class="pre">tuple</span></code> Statement</a></li>
<li><a class="reference internal" href="#the-getattr-statement">The <code class="docutils literal notranslate"><span class="pre">getattr</span></code> Statement</a></li>
<li><a class="reference internal" href="#the-hasattr-statement">The <code class="docutils literal notranslate"><span class="pre">hasattr</span></code> Statement</a></li>
<li><a class="reference internal" href="#the-zip-statement">The <code class="docutils literal notranslate"><span class="pre">zip</span></code> Statement</a></li>
<li><a class="reference internal" href="#the-enumerate-statement">The <code class="docutils literal notranslate"><span class="pre">enumerate</span></code> Statement</a></li>
</ul>
</li>
<li><a class="reference internal" href="#python-values">Python Values</a><ul>
<li><a class="reference internal" href="#resolution-rules">Resolution Rules</a></li>
<li><a class="reference internal" href="#python-built-in-functions-support">Python Built-in Functions Support</a></li>
<li><a class="reference internal" href="#python-built-in-values-support">Python Built-in Values Support</a></li>
</ul>
</li>
<li><a class="reference internal" href="#torch-apis">torch.* APIs</a><ul>
<li><a class="reference internal" href="#remote-procedure-calls">Remote Procedure Calls</a></li>
<li><a class="reference internal" href="#asynchronous-execution">Asynchronous Execution</a></li>
<li><a class="reference internal" href="#type-annotations">Type Annotations</a></li>
<li><a class="reference internal" href="#meta-programming">Meta Programming</a></li>
<li><a class="reference internal" href="#type-refinement">Type Refinement</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
         <script src="_static/jquery.js"></script>
         <script src="_static/underscore.js"></script>
         <script src="_static/doctools.js"></script>
         <script src="_static/clipboard.min.js"></script>
         <script src="_static/copybutton.js"></script>
     

  

  <script type="text/javascript" src="_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 
<script script type="text/javascript">
  var collapsedSections = ['Notes', 'Language Bindings', 'Libraries', 'Community'];
</script>

<img height="1" width="1" style="border-style:none;" alt="" src="https://www.googleadservices.com/pagead/conversion/795629140/?label=txkmCPmdtosBENSssfsC&amp;guid=ON&amp;script=0"/>


  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access comprehensive developer documentation for PyTorch</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get in-depth tutorials for beginners and advanced developers</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Resources</h2>
          <p>Find development resources and get your questions answered</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">View Resources</a>
        </div>
      </div>
    </div>
  </div>


 <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>
      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">Get Started</a></li>
            <li><a href="https://pytorch.org/features">Features</a></li>
            <li><a href="https://pytorch.org/ecosystem">Ecosystem</a></li>
            <li><a href="https://pytorch.org/blog/">Blog</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">Contributing</a></li>
          </ul>
        </div>
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/resources">Resources</a></li>
            <li><a href="https://pytorch.org/tutorials">Tutorials</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">Docs</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">Discuss</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github Issues</a></li>
            <li><a href="https://pytorch.org/assets/brand-guidelines/PyTorch-Brand-Guidelines.pdf" target="_blank">Brand Guidelines</a></li>
          </ul>
        </div>
        <div class="footer-links-col">
          <ul>
            <li class="list-title">Stay up to date</li>
            <li><a href="https://www.facebook.com/pytorch" target="_blank">Facebook</a></li>
            <li><a href="https://twitter.com/pytorch" target="_blank">Twitter</a></li>
            <li><a href="https://www.youtube.com/pytorch" target="_blank">YouTube</a></li>
            <li><a href="https://www.linkedin.com/company/pytorch" target="_blank">LinkedIn</a></li>
          </ul>
          </div>
        <div class="footer-links-col">
          <ul>
            <li class="list-title">PyTorch Podcasts</li>
            <li><a href="https://open.spotify.com/show/6UzHKeiy368jKfQMKKvJY5" target="_blank">Spotify</a></li>
            <li><a href="https://podcasts.apple.com/us/podcast/pytorch-developer-podcast/id1566080008" target="_blank">Apple</a></li>
            <li><a href="https://www.google.com/podcasts?feed=aHR0cHM6Ly9mZWVkcy5zaW1wbGVjYXN0LmNvbS9PQjVGa0lsOA%3D%3D" target="_blank">Google</a></li>
            <li><a href="https://music.amazon.com/podcasts/7a4e6f0e-26c2-49e9-a478-41bd244197d0/PyTorch-Developer-Podcast?" target="_blank">Amazon</a></li>
          </ul>
         </div>
        </div>
        <hr size="20" color="white" />
         <div class="privacy-policy">
            <p class="privacy-policy-links"><a href="https://www.linuxfoundation.org/terms/" target="_blank">Terms</a>&nbsp;&nbsp; | &nbsp;&nbsp; <a href="https://www.linuxfoundation.org/privacy-policy/" target="_blank">Privacy</a></p>
        </div>
        <hr size="20" color="white" />
        <div class="copyright">
        <p>© Copyright The Linux Foundation. The PyTorch Foundation is a project of The Linux Foundation.
          For web site terms of use, trademark policy and other policies applicable to The PyTorch Foundation please see
          <a href="https://www.linuxfoundation.org/policies/" style="color:#ee4c2c">www.linuxfoundation.org/policies/</a>. The PyTorch Foundation supports the PyTorch open source
          project, which has been established as PyTorch Project a Series of LF Projects, LLC. For policies applicable to the PyTorch Project a Series of LF Projects, LLC,
          please see <a href="https://www.lfprojects.org/policies/" style="color:#ee4c2c">www.lfprojects.org/policies/</a>.</p>
      </div>
     </div>
  </footer>
  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebook’s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/hub">PyTorch Hub</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="resources-mobile-menu-title" class="active">
            Docs
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/docs/stable/index.html">PyTorch</a>
            </li>

            <li>
              <a href="https://pytorch.org/audio/stable/index.html">torchaudio</a>
            </li>

            <li>
              <a href="https://pytorch.org/text/stable/index.html">torchtext</a>
            </li>

            <li>
              <a href="https://pytorch.org/vision/stable/index.html">torchvision</a>
            </li>

            <li>
              <a href="https://pytorch.org/serve/">TorchServe</a>
            </li>

            <li>
              <a href="https://pytorch.org/torchx/">TorchX</a>
            </li>

            <li>
              <a href="https://pytorch.org/xla">PyTorch on XLA Devices</a>
            </li>
          </ul>

          <li class="resources-mobile-menu-title">
            Resources
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/resources">Developer Resources</a>
            </li>

            <li>
              <a href="https://pytorch.org/features">About</a>
            </li>

            <li>
              <a href="https://pytorch.org/hub">Models (Beta)</a>
            </li>

            <li>
              <a href="https://pytorch.org/#community-module">Community</a>
            </li>

            <li>
              <a href="https://discuss.pytorch.org/">Forums</a>
            </li>
          </ul>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>