


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta name="robots" content="noindex">
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>torchrun (Elastic Launch) &mdash; PyTorch 1.12 documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://pytorch.org/docs/stable/elastic/run.html"/>
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/katex-math.css" type="text/css" />
  <link rel="stylesheet" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
  <link rel="stylesheet" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/jit.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Elastic Agent" href="agent.html" />
    <link rel="prev" title="Examples" href="examples.html" />


  <!-- Google Analytics -->
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-117752657-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-117752657-2');
    </script>
  
  <!-- End Google Analytics -->
  


  
  <script src="../_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="active docs-active">
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-orange-arrow">
                Docs
              </a>
              <div class="resources-dropdown-menu">
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/docs/stable/index.html">
                  <span class="dropdown-title">PyTorch</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/audio/stable/index.html">
                  <span class="dropdown-title">torchaudio</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/text/stable/index.html">
                  <span class="dropdown-title">torchtext</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/vision/stable/index.html">
                  <span class="dropdown-title">torchvision</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/torchrec">
                  <span class="dropdown-title">TorchRec</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/data">
                  <span class="dropdown-title">TorchData</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/serve/">
                  <span class="dropdown-title">TorchServe</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/torchx/">
                  <span class="dropdown-title">TorchX</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/xla">
                  <span class="dropdown-title">PyTorch on XLA Devices</span>
                  <p></p>
                </a>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-arrow">
                Resources
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/features">
                  <span class="dropdown-title">About</span>
                  <p>Learn about PyTorch’s features and capabilities</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/#community-module">
                  <span class="dropdown-title">Community</span>
                  <p>Join the PyTorch developer community to contribute, learn, and get your questions answered.</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/resources">
                  <span class="dropdown-title">Developer Resources</span>
                  <p>Find resources and get questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="https://discuss.pytorch.org/" target="_blank">
                  <span class="dropdown-title">Forums</span>
                  <p>A place to discuss PyTorch code, issues, install, research</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/hub">
                  <span class="dropdown-title">Models (Beta)</span>
                  <p>Discover, publish, and reuse pre-trained models</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <a href="https://github.com/pytorch/pytorch">GitHub</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>

<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            
    <div class="version">
      <a href='https://pytorch.org/docs/versions.html'>1.12 &#x25BC</a>
    </div>
    


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          </div>

          


            
            
              
            
            
<p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../community/build_ci_governance.html">PyTorch Governance | Build + CI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/contribution_guide.html">PyTorch Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/design.html">PyTorch Design Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/governance.html">PyTorch Governance | Mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/persons_of_interest.html">PyTorch Governance | Maintainers</a></li>
</ul>
              <p class="caption"><span class="caption-text">Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notes/amp_examples.html">CUDA Automatic Mixed Precision examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/autograd.html">Autograd mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/broadcasting.html">Broadcasting semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/cpu_threading_torchscript_inference.html">CPU threading and TorchScript inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/cuda.html">CUDA semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/ddp.html">Distributed Data Parallel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/extending.html">Extending PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/gradcheck.html">Gradcheck mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/hip.html">HIP (ROCm) semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/large_scale_deployments.html">Features for large-scale deployments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/mps.html">MPS backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/multiprocessing.html">Multiprocessing best practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/numerical_accuracy.html">Numerical accuracy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/randomness.html">Reproducibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/serialization.html">Serialization semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/windows.html">Windows FAQ</a></li>
</ul>
<p class="caption"><span class="caption-text">Language Bindings</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cpp_index.html">C++</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/javadoc/">Javadoc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy.html">torch::deploy</a></li>
</ul>
<p class="caption"><span class="caption-text">Python API</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../torch.html">torch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nn.html">torch.nn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nn.functional.html">torch.nn.functional</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tensors.html">torch.Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tensor_attributes.html">Tensor Attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tensor_view.html">Tensor Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="../amp.html">torch.amp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autograd.html">torch.autograd</a></li>
<li class="toctree-l1"><a class="reference internal" href="../library.html">torch.library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cuda.html">torch.cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backends.html">torch.backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distributed.html">torch.distributed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distributed.algorithms.join.html">torch.distributed.algorithms.join</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../distributed.elastic.html">torch.distributed.elastic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fsdp.html">torch.distributed.fsdp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distributed.optim.html">torch.distributed.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distributions.html">torch.distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fft.html">torch.fft</a></li>
<li class="toctree-l1"><a class="reference internal" href="../futures.html">torch.futures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fx.html">torch.fx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hub.html">torch.hub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jit.html">torch.jit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../linalg.html">torch.linalg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../monitor.html">torch.monitor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special.html">torch.special</a></li>
<li class="toctree-l1"><a class="reference internal" href="../torch.overrides.html">torch.overrides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../package.html">torch.package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profiler.html">torch.profiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nn.init.html">torch.nn.init</a></li>
<li class="toctree-l1"><a class="reference internal" href="../onnx.html">torch.onnx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optim.html">torch.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../complex_numbers.html">Complex Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ddp_comm_hooks.html">DDP Communication Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipeline.html">Pipeline Parallelism</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quantization.html">Quantization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rpc.html">Distributed RPC Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../random.html">torch.random</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nested.html">torch.nested</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sparse.html">torch.sparse</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage.html">torch.Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">torch.testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../benchmark_utils.html">torch.utils.benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bottleneck.html">torch.utils.bottleneck</a></li>
<li class="toctree-l1"><a class="reference internal" href="../checkpoint.html">torch.utils.checkpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpp_extension.html">torch.utils.cpp_extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data.html">torch.utils.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dlpack.html">torch.utils.dlpack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mobile_optimizer.html">torch.utils.mobile_optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_zoo.html">torch.utils.model_zoo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tensorboard.html">torch.utils.tensorboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../type_info.html">Type Info</a></li>
<li class="toctree-l1"><a class="reference internal" href="../named_tensor.html">Named Tensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../name_inference.html">Named Tensors operator coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config_mod.html">torch.__config__</a></li>
</ul>
<p class="caption"><span class="caption-text">Libraries</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/audio/stable">torchaudio</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/data">TorchData</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/torchrec">TorchRec</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/serve">TorchServe</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/text/stable">torchtext</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/vision/stable">torchvision</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pytorch.org/xla/">PyTorch on XLA Devices</a></li>
</ul>

            
          

        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="../index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
          <li><a href="../distributed.elastic.html">Torch Distributed Elastic</a> &gt;</li>
        
      <li>torchrun (Elastic Launch)</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
            
            <a href="../_sources/elastic/run.rst.txt" rel="nofollow"><img src="../_static/images/view-page-source-icon.svg"></a>
          
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <div class="section" id="module-torch.distributed.run">
<span id="torchrun-elastic-launch"></span><span id="launcher-api"></span><h1>torchrun (Elastic Launch)<a class="headerlink" href="#module-torch.distributed.run" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">torchrun</span></code> provides a superset of the functionality as <code class="docutils literal notranslate"><span class="pre">torch.distributed.launch</span></code>
with the following additional functionalities:</p>
<ol class="arabic simple">
<li><p>Worker failures are handled gracefully by restarting all workers.</p></li>
<li><p>Worker <code class="docutils literal notranslate"><span class="pre">RANK</span></code> and <code class="docutils literal notranslate"><span class="pre">WORLD_SIZE</span></code> are assigned automatically.</p></li>
<li><p>Number of nodes is allowed to change between minimum and maximum sizes (elasticity).</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">torchrun</span></code> is a python
<a class="reference external" href="https://packaging.python.org/en/latest/specifications/entry-points/#use-for-scripts">console script</a>
to the main module
<a class="reference external" href="https://github.com/pytorch/pytorch/blob/master/torch/distributed/run.py">torch.distributed.run</a>
declared in the <code class="docutils literal notranslate"><span class="pre">entry_points</span></code> configuration in
<a class="reference external" href="https://github.com/pytorch/pytorch/blob/master/setup.py">setup.py</a>.
It is equivalent to invoking <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">torch.distributed.run</span></code>.</p>
</div>
<div class="section" id="transitioning-from-torch-distributed-launch-to-torchrun">
<h2>Transitioning from torch.distributed.launch to torchrun<a class="headerlink" href="#transitioning-from-torch-distributed-launch-to-torchrun" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">torchrun</span></code> supports the same arguments as <code class="docutils literal notranslate"><span class="pre">torch.distributed.launch</span></code> <strong>except</strong>
for <code class="docutils literal notranslate"><span class="pre">--use_env</span></code> which is now deprecated. To migrate from <code class="docutils literal notranslate"><span class="pre">torch.distributed.launch</span></code>
to <code class="docutils literal notranslate"><span class="pre">torchrun</span></code> follow these steps:</p>
<ol class="arabic">
<li><p>If your training script is already reading <code class="docutils literal notranslate"><span class="pre">local_rank</span></code> from the <code class="docutils literal notranslate"><span class="pre">LOCAL_RANK</span></code> environment variable.
Then you need simply omit the <code class="docutils literal notranslate"><span class="pre">--use_env</span></code> flag, e.g.:</p>
<table class="docutils colwidths-auto align-default">
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">torch.distributed.launch</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">torchrun</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python -m torch.distributed.launch --use_env train_script.py
</pre></div>
</div>
</td>
<td><div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>torchrun train_script.py
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
<li><p>If your training script reads local rank from a <code class="docutils literal notranslate"><span class="pre">--local_rank</span></code> cmd argument.
Change your training script to read from the <code class="docutils literal notranslate"><span class="pre">LOCAL_RANK</span></code> environment variable as
demonstrated by the following code snippet:</p>
<table class="docutils colwidths-auto align-default">
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">torch.distributed.launch</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">torchrun</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--local_rank&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="n">local_rank</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">local_rank</span>
</pre></div>
</div>
</td>
<td><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">local_rank</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LOCAL_RANK&quot;</span><span class="p">])</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ol>
<p>The aformentioned changes suffice to migrate from <code class="docutils literal notranslate"><span class="pre">torch.distributed.launch</span></code> to <code class="docutils literal notranslate"><span class="pre">torchrun</span></code>.
To take advantage of new features such as elasticity, fault-tolerance, and error reporting of <code class="docutils literal notranslate"><span class="pre">torchrun</span></code>
please refer to:</p>
<ul class="simple">
<li><p><a class="reference internal" href="train_script.html#elastic-train-script"><span class="std std-ref">Train script</span></a> for more information on authoring training scripts that are <code class="docutils literal notranslate"><span class="pre">torchrun</span></code> compliant.</p></li>
<li><p>the rest of this page for more information on the features of <code class="docutils literal notranslate"><span class="pre">torchrun</span></code>.</p></li>
</ul>
<div class="section" id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h3>
<div class="section" id="single-node-multi-worker">
<h4>Single-node multi-worker<a class="headerlink" href="#single-node-multi-worker" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">torchrun</span>
<span class="go">    --standalone</span>
<span class="go">    --nnodes=1</span>
<span class="go">    --nproc_per_node=$NUM_TRAINERS</span>
<span class="go">    YOUR_TRAINING_SCRIPT.py (--arg1 ... train script args...)</span>
</pre></div>
</div>
</div>
<div class="section" id="stacked-single-node-multi-worker">
<h4>Stacked single-node multi-worker<a class="headerlink" href="#stacked-single-node-multi-worker" title="Permalink to this headline">¶</a></h4>
<p>To run multiple instances (separate jobs) of single-node, multi-worker on the
same host, we need to make sure that each instance (job) is
setup on different ports to avoid port conflicts (or worse, two jobs being merged
as a single job). To do this you have to run with <code class="docutils literal notranslate"><span class="pre">--rdzv_backend=c10d</span></code>
and specify a different port by setting <code class="docutils literal notranslate"><span class="pre">--rdzv_endpoint=localhost:$PORT_k</span></code>.
For <code class="docutils literal notranslate"><span class="pre">--nodes=1</span></code>, its often convenient to let <code class="docutils literal notranslate"><span class="pre">torchrun</span></code> pick a free random
port automatically instead of manually assgining different ports for each run.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">torchrun</span>
<span class="go">    --rdzv_backend=c10d</span>
<span class="go">    --rdzv_endpoint=localhost:0</span>
<span class="go">    --nnodes=1</span>
<span class="go">    --nproc_per_node=$NUM_TRAINERS</span>
<span class="go">    YOUR_TRAINING_SCRIPT.py (--arg1 ... train script args...)</span>
</pre></div>
</div>
</div>
<div class="section" id="fault-tolerant-fixed-sized-number-of-workers-no-elasticity-tolerates-3-failures">
<h4>Fault tolerant (fixed sized number of workers, no elasticity, tolerates 3 failures)<a class="headerlink" href="#fault-tolerant-fixed-sized-number-of-workers-no-elasticity-tolerates-3-failures" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">torchrun</span>
<span class="go">    --nnodes=$NUM_NODES</span>
<span class="go">    --nproc_per_node=$NUM_TRAINERS</span>
<span class="go">    --max_restarts=3</span>
<span class="go">    --rdzv_id=$JOB_ID</span>
<span class="go">    --rdzv_backend=c10d</span>
<span class="go">    --rdzv_endpoint=$HOST_NODE_ADDR</span>
<span class="go">    YOUR_TRAINING_SCRIPT.py (--arg1 ... train script args...)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">HOST_NODE_ADDR</span></code>, in form &lt;host&gt;[:&lt;port&gt;] (e.g. node1.example.com:29400), specifies the node and
the port on which the C10d rendezvous backend should be instantiated and hosted. It can be any
node in your training cluster, but ideally you should pick a node that has a high bandwidth.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If no port number is specified <code class="docutils literal notranslate"><span class="pre">HOST_NODE_ADDR</span></code> defaults to 29400.</p>
</div>
</div>
<div class="section" id="elastic-min-1-max-4-tolerates-up-to-3-membership-changes-or-failures">
<h4>Elastic (<code class="docutils literal notranslate"><span class="pre">min=1</span></code>, <code class="docutils literal notranslate"><span class="pre">max=4</span></code>, tolerates up to 3 membership changes or failures)<a class="headerlink" href="#elastic-min-1-max-4-tolerates-up-to-3-membership-changes-or-failures" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">torchrun</span>
<span class="go">    --nnodes=1:4</span>
<span class="go">    --nproc_per_node=$NUM_TRAINERS</span>
<span class="go">    --max_restarts=3</span>
<span class="go">    --rdzv_id=$JOB_ID</span>
<span class="go">    --rdzv_backend=c10d</span>
<span class="go">    --rdzv_endpoint=$HOST_NODE_ADDR</span>
<span class="go">    YOUR_TRAINING_SCRIPT.py (--arg1 ... train script args...)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">HOST_NODE_ADDR</span></code>, in form &lt;host&gt;[:&lt;port&gt;] (e.g. node1.example.com:29400), specifies the node and
the port on which the C10d rendezvous backend should be instantiated and hosted. It can be any
node in your training cluster, but ideally you should pick a node that has a high bandwidth.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If no port number is specified <code class="docutils literal notranslate"><span class="pre">HOST_NODE_ADDR</span></code> defaults to 29400.</p>
</div>
</div>
</div>
<div class="section" id="note-on-rendezvous-backend">
<h3>Note on rendezvous backend<a class="headerlink" href="#note-on-rendezvous-backend" title="Permalink to this headline">¶</a></h3>
<p>For multi-node training you need to specify:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--rdzv_id</span></code>: A unique job id (shared by all nodes participating in the job)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--rdzv_backend</span></code>: An implementation of
<a class="reference internal" href="rendezvous.html#torch.distributed.elastic.rendezvous.RendezvousHandler" title="torch.distributed.elastic.rendezvous.RendezvousHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.distributed.elastic.rendezvous.RendezvousHandler</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--rdzv_endpoint</span></code>: The endpoint where the rendezvous backend is running; usually in form
<code class="docutils literal notranslate"><span class="pre">host:port</span></code>.</p></li>
</ol>
<p>Currently <code class="docutils literal notranslate"><span class="pre">c10d</span></code> (recommended), <code class="docutils literal notranslate"><span class="pre">etcd-v2</span></code>, and <code class="docutils literal notranslate"><span class="pre">etcd</span></code> (legacy)  rendezvous backends are
supported out of the box. To use <code class="docutils literal notranslate"><span class="pre">etcd-v2</span></code> or <code class="docutils literal notranslate"><span class="pre">etcd</span></code>, setup an etcd server with the <code class="docutils literal notranslate"><span class="pre">v2</span></code> api
enabled (e.g. <code class="docutils literal notranslate"><span class="pre">--enable-v2</span></code>).</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="docutils literal notranslate"><span class="pre">etcd-v2</span></code> and <code class="docutils literal notranslate"><span class="pre">etcd</span></code> rendezvous use etcd API v2. You MUST enable the v2 API on the etcd
server. Our tests use etcd v3.4.3.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>For etcd-based rendezvous we recommend using <code class="docutils literal notranslate"><span class="pre">etcd-v2</span></code> over <code class="docutils literal notranslate"><span class="pre">etcd</span></code> which is functionally
equivalent, but uses a revised implementation. <code class="docutils literal notranslate"><span class="pre">etcd</span></code> is in maintenance mode and will be
removed in a future version.</p>
</div>
</div>
<div class="section" id="definitions">
<h3>Definitions<a class="headerlink" href="#definitions" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Node</span></code> - A physical instance or a container; maps to the unit that the job manager works with.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Worker</span></code> - A worker in the context of distributed training.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WorkerGroup</span></code> - The set of workers that execute the same function (e.g. trainers).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LocalWorkerGroup</span></code> - A subset of the workers in the worker group running on the same node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RANK</span></code> - The rank of the worker within a worker group.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WORLD_SIZE</span></code> - The total number of workers in a worker group.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LOCAL_RANK</span></code> - The rank of the worker within a local worker group.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LOCAL_WORLD_SIZE</span></code> - The size of the local worker group.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rdzv_id</span></code> - A user-defined id that uniquely identifies the worker group for a job. This id is
used by each node to join as a member of a particular worker group.</p></li>
</ol>
<ol class="arabic simple" start="9">
<li><p><code class="docutils literal notranslate"><span class="pre">rdzv_backend</span></code> - The backend of the rendezvous (e.g. <code class="docutils literal notranslate"><span class="pre">c10d</span></code>). This is typically a strongly
consistent key-value store.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rdzv_endpoint</span></code> - The rendezvous backend endpoint; usually in form <code class="docutils literal notranslate"><span class="pre">&lt;host&gt;:&lt;port&gt;</span></code>.</p></li>
</ol>
<p>A <code class="docutils literal notranslate"><span class="pre">Node</span></code> runs <code class="docutils literal notranslate"><span class="pre">LOCAL_WORLD_SIZE</span></code> workers which comprise a <code class="docutils literal notranslate"><span class="pre">LocalWorkerGroup</span></code>. The union of
all <code class="docutils literal notranslate"><span class="pre">LocalWorkerGroups</span></code> in the nodes in the job comprise the <code class="docutils literal notranslate"><span class="pre">WorkerGroup</span></code>.</p>
</div>
<div class="section" id="environment-variables">
<h3>Environment Variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h3>
<p>The following environment variables are made available to you in your script:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">LOCAL_RANK</span></code> -  The local rank.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RANK</span></code> -  The global rank.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GROUP_RANK</span></code> - The rank of the worker group. A number between 0 and <code class="docutils literal notranslate"><span class="pre">max_nnodes</span></code>. When
running a single worker group per node, this is the rank of the node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ROLE_RANK</span></code> -  The rank of the worker across all the workers that have the same role. The role
of the worker is specified in the <code class="docutils literal notranslate"><span class="pre">WorkerSpec</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LOCAL_WORLD_SIZE</span></code> - The local world size (e.g. number of workers running locally); equals to
<code class="docutils literal notranslate"><span class="pre">--nproc_per_node</span></code> specified on <code class="docutils literal notranslate"><span class="pre">torchrun</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WORLD_SIZE</span></code> - The world size (total number of workers in the job).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ROLE_WORLD_SIZE</span></code> - The total number of workers that was launched with the same role specified
in <code class="docutils literal notranslate"><span class="pre">WorkerSpec</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MASTER_ADDR</span></code> - The FQDN of the host that is running worker with rank 0; used to initialize
the Torch Distributed backend.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MASTER_PORT</span></code> - The port on the <code class="docutils literal notranslate"><span class="pre">MASTER_ADDR</span></code> that can be used to host the C10d TCP store.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TORCHELASTIC_RESTART_COUNT</span></code> - The number of worker group restarts so far.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TORCHELASTIC_MAX_RESTARTS</span></code> - The configured maximum number of restarts.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TORCHELASTIC_RUN_ID</span></code> - Equal to the rendezvous <code class="docutils literal notranslate"><span class="pre">run_id</span></code> (e.g. unique job id).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PYTHON_EXEC</span></code> - System executable override. If provided, the python user script will
use the value of <code class="docutils literal notranslate"><span class="pre">PYTHON_EXEC</span></code> as executable. The <cite>sys.executable</cite> is used by default.</p></li>
</ol>
</div>
<div class="section" id="deployment">
<h3>Deployment<a class="headerlink" href="#deployment" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>(Not needed for the C10d backend) Start the rendezvous backend server and get the endpoint (to be
passed as <code class="docutils literal notranslate"><span class="pre">--rdzv_endpoint</span></code> to the launcher script)</p></li>
<li><p>Single-node multi-worker: Start the launcher on the host to start the agent process which
creates and monitors a local worker group.</p></li>
<li><p>Multi-node multi-worker: Start the launcher with the same arguments on all the nodes
participating in training.</p></li>
</ol>
<p>When using a job/cluster manager the entry point command to the multi-node job should be this
launcher.</p>
</div>
<div class="section" id="failure-modes">
<h3>Failure Modes<a class="headerlink" href="#failure-modes" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Worker failure: For a training job with <code class="docutils literal notranslate"><span class="pre">n</span></code> workers, if <code class="docutils literal notranslate"><span class="pre">k&lt;=n</span></code> workers fail all workers
are stopped and restarted up to <code class="docutils literal notranslate"><span class="pre">max_restarts</span></code>.</p></li>
<li><p>Agent failure: An agent failure results in a local worker group failure. It is up to the job
manager to fail the entire job (gang semantics) or attempt to replace the node. Both behaviors
are supported by the agent.</p></li>
<li><p>Node failure: Same as agent failure.</p></li>
</ol>
</div>
<div class="section" id="membership-changes">
<h3>Membership Changes<a class="headerlink" href="#membership-changes" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Node departure (scale-down): The agent is notified of the departure, all existing workers are
stopped, a new <code class="docutils literal notranslate"><span class="pre">WorkerGroup</span></code> is formed, and all workers are started with a new <code class="docutils literal notranslate"><span class="pre">RANK</span></code> and
<code class="docutils literal notranslate"><span class="pre">WORLD_SIZE</span></code>.</p></li>
<li><p>Node arrival (scale-up): The new node is admitted to the job, all existing workers are stopped,
a new <code class="docutils literal notranslate"><span class="pre">WorkerGroup</span></code> is formed, and all workers are started with a new <code class="docutils literal notranslate"><span class="pre">RANK</span></code> and
<code class="docutils literal notranslate"><span class="pre">WORLD_SIZE</span></code>.</p></li>
</ol>
</div>
<div class="section" id="important-notices">
<h3>Important Notices<a class="headerlink" href="#important-notices" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>This utility and multi-process distributed (single-node or
multi-node) GPU training currently only achieves the best performance using
the NCCL distributed backend. Thus NCCL backend is the recommended backend to
use for GPU training.</p></li>
<li><p>The environment variables necessary to initialize a Torch process group are provided to you by
this module, no need for you to pass <code class="docutils literal notranslate"><span class="pre">RANK</span></code> manually.  To initialize a process group in your
training script, simply run:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">torch.distributed</span> <span class="k">as</span> <span class="nn">dist</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dist</span><span class="o">.</span><span class="n">init_process_group</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="s2">&quot;gloo|nccl&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>In your training program, you can either use regular distributed functions
or use <a class="reference internal" href="../generated/torch.nn.parallel.DistributedDataParallel.html#torch.nn.parallel.DistributedDataParallel" title="torch.nn.parallel.DistributedDataParallel"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.nn.parallel.DistributedDataParallel()</span></code></a> module. If your
training program uses GPUs for training and you would like to use
<a class="reference internal" href="../generated/torch.nn.parallel.DistributedDataParallel.html#torch.nn.parallel.DistributedDataParallel" title="torch.nn.parallel.DistributedDataParallel"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.nn.parallel.DistributedDataParallel()</span></code></a> module,
here is how to configure it.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">local_rank</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LOCAL_RANK&quot;</span><span class="p">])</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">parallel</span><span class="o">.</span><span class="n">DistributedDataParallel</span><span class="p">(</span><span class="n">model</span><span class="p">,</span>
                                                  <span class="n">device_ids</span><span class="o">=</span><span class="p">[</span><span class="n">local_rank</span><span class="p">],</span>
                                                  <span class="n">output_device</span><span class="o">=</span><span class="n">local_rank</span><span class="p">)</span>
</pre></div>
</div>
<p>Please ensure that <code class="docutils literal notranslate"><span class="pre">device_ids</span></code> argument is set to be the only GPU device id
that your code will be operating on. This is generally the local rank of the
process. In other words, the <code class="docutils literal notranslate"><span class="pre">device_ids</span></code> needs to be <code class="docutils literal notranslate"><span class="pre">[int(os.environ(&quot;LOCAL_RANK&quot;))]</span></code>,
and <code class="docutils literal notranslate"><span class="pre">output_device</span></code> needs to be <code class="docutils literal notranslate"><span class="pre">int(os.environ(&quot;LOCAL_RANK&quot;))</span></code> in order to use this
utility</p>
<ol class="arabic simple" start="4">
<li><p>On failures or membership changes ALL surviving workers are killed immediately. Make sure to
checkpoint your progress. The frequency of checkpoints should depend on your job’s tolerance
for lost work.</p></li>
<li><p>This module only supports homogeneous <code class="docutils literal notranslate"><span class="pre">LOCAL_WORLD_SIZE</span></code>. That is, it is assumed that all
nodes run the same number of local workers (per role).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RANK</span></code> is NOT stable. Between restarts, the local workers on a node can be assgined a
different range of ranks than before. NEVER hard code any assumptions about the stable-ness of
ranks or some correlation between <code class="docutils literal notranslate"><span class="pre">RANK</span></code> and <code class="docutils literal notranslate"><span class="pre">LOCAL_RANK</span></code>.</p></li>
<li><p>When using elasticity (<code class="docutils literal notranslate"><span class="pre">min_size!=max_size</span></code>) DO NOT hard code assumptions about
<code class="docutils literal notranslate"><span class="pre">WORLD_SIZE</span></code> as the world size can change as nodes are allowed to leave and join.</p></li>
<li><p>It is recommended for your script to have the following structure:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
  <span class="n">load_checkpoint</span><span class="p">(</span><span class="n">checkpoint_path</span><span class="p">)</span>
  <span class="n">initialize</span><span class="p">()</span>
  <span class="n">train</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">train</span><span class="p">():</span>
  <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">dataset</span><span class="p">):</span>
    <span class="n">train_step</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">should_checkpoint</span><span class="p">:</span>
      <span class="n">save_checkpoint</span><span class="p">(</span><span class="n">checkpoint_path</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="9">
<li><p>(Recommended) On worker errors, this tool will summarize the details of the error
(e.g. time, rank, host, pid, traceback, etc). On each node, the first error (by timestamp)
is heuristically reported as the “Root Cause” error. To get tracebacks as part of this
error summary print out, you must decorate your main entrypoint function in your
training script as shown in the example below. If not decorated, then the summary
will not include the traceback of the exception and will only contain the exitcode.
For details on torchelastic error handling see: <a class="reference external" href="https://pytorch.org/docs/stable/elastic/errors.html">https://pytorch.org/docs/stable/elastic/errors.html</a></p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">torch.distributed.elastic.multiprocessing.errors</span> <span class="kn">import</span> <span class="n">record</span>

<span class="nd">@record</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># do train</span>
    <span class="k">pass</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>


             </article>
             
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="agent.html" class="btn btn-neutral float-right" title="Elastic Agent" accesskey="n" rel="next">Next <img src="../_static/images/chevron-right-orange.svg" class="next-page"></a>
      
      
        <a href="examples.html" class="btn btn-neutral" title="Examples" accesskey="p" rel="prev"><img src="../_static/images/chevron-right-orange.svg" class="previous-page"> Previous</a>
      
    </div>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, PyTorch Contributors.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              <ul>
<li><a class="reference internal" href="#">torchrun (Elastic Launch)</a><ul>
<li><a class="reference internal" href="#transitioning-from-torch-distributed-launch-to-torchrun">Transitioning from torch.distributed.launch to torchrun</a><ul>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#single-node-multi-worker">Single-node multi-worker</a></li>
<li><a class="reference internal" href="#stacked-single-node-multi-worker">Stacked single-node multi-worker</a></li>
<li><a class="reference internal" href="#fault-tolerant-fixed-sized-number-of-workers-no-elasticity-tolerates-3-failures">Fault tolerant (fixed sized number of workers, no elasticity, tolerates 3 failures)</a></li>
<li><a class="reference internal" href="#elastic-min-1-max-4-tolerates-up-to-3-membership-changes-or-failures">Elastic (<code class="docutils literal notranslate"><span class="pre">min=1</span></code>, <code class="docutils literal notranslate"><span class="pre">max=4</span></code>, tolerates up to 3 membership changes or failures)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#note-on-rendezvous-backend">Note on rendezvous backend</a></li>
<li><a class="reference internal" href="#definitions">Definitions</a></li>
<li><a class="reference internal" href="#environment-variables">Environment Variables</a></li>
<li><a class="reference internal" href="#deployment">Deployment</a></li>
<li><a class="reference internal" href="#failure-modes">Failure Modes</a></li>
<li><a class="reference internal" href="#membership-changes">Membership Changes</a></li>
<li><a class="reference internal" href="#important-notices">Important Notices</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
         <script src="../_static/jquery.js"></script>
         <script src="../_static/underscore.js"></script>
         <script src="../_static/doctools.js"></script>
         <script src="../_static/clipboard.min.js"></script>
         <script src="../_static/copybutton.js"></script>
     

  

  <script type="text/javascript" src="../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 
<script script type="text/javascript">
  var collapsedSections = ['Notes', 'Language Bindings', 'Libraries', 'Community'];
</script>

<img height="1" width="1" style="border-style:none;" alt="" src="https://www.googleadservices.com/pagead/conversion/795629140/?label=txkmCPmdtosBENSssfsC&amp;guid=ON&amp;script=0"/>


  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access comprehensive developer documentation for PyTorch</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get in-depth tutorials for beginners and advanced developers</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Resources</h2>
          <p>Find development resources and get your questions answered</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">View Resources</a>
        </div>
      </div>
    </div>
  </div>


 <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>
      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">Get Started</a></li>
            <li><a href="https://pytorch.org/features">Features</a></li>
            <li><a href="https://pytorch.org/ecosystem">Ecosystem</a></li>
            <li><a href="https://pytorch.org/blog/">Blog</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">Contributing</a></li>
          </ul>
        </div>
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/resources">Resources</a></li>
            <li><a href="https://pytorch.org/tutorials">Tutorials</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">Docs</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">Discuss</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github Issues</a></li>
            <li><a href="https://pytorch.org/assets/brand-guidelines/PyTorch-Brand-Guidelines.pdf" target="_blank">Brand Guidelines</a></li>
          </ul>
        </div>
        <div class="footer-links-col">
          <ul>
            <li class="list-title">Stay up to date</li>
            <li><a href="https://www.facebook.com/pytorch" target="_blank">Facebook</a></li>
            <li><a href="https://twitter.com/pytorch" target="_blank">Twitter</a></li>
            <li><a href="https://www.youtube.com/pytorch" target="_blank">YouTube</a></li>
            <li><a href="https://www.linkedin.com/company/pytorch" target="_blank">LinkedIn</a></li>
          </ul>
          </div>
        <div class="footer-links-col">
          <ul>
            <li class="list-title">PyTorch Podcasts</li>
            <li><a href="https://open.spotify.com/show/6UzHKeiy368jKfQMKKvJY5" target="_blank">Spotify</a></li>
            <li><a href="https://podcasts.apple.com/us/podcast/pytorch-developer-podcast/id1566080008" target="_blank">Apple</a></li>
            <li><a href="https://www.google.com/podcasts?feed=aHR0cHM6Ly9mZWVkcy5zaW1wbGVjYXN0LmNvbS9PQjVGa0lsOA%3D%3D" target="_blank">Google</a></li>
            <li><a href="https://music.amazon.com/podcasts/7a4e6f0e-26c2-49e9-a478-41bd244197d0/PyTorch-Developer-Podcast?" target="_blank">Amazon</a></li>
          </ul>
         </div>
        </div>
        <hr size="20" color="white" />
         <div class="privacy-policy">
            <p class="privacy-policy-links"><a href="https://www.linuxfoundation.org/terms/" target="_blank">Terms</a>&nbsp;&nbsp; | &nbsp;&nbsp; <a href="https://www.linuxfoundation.org/privacy-policy/" target="_blank">Privacy</a></p>
        </div>
        <hr size="20" color="white" />
        <div class="copyright">
        <p>© Copyright The Linux Foundation. The PyTorch Foundation is a project of The Linux Foundation.
          For web site terms of use, trademark policy and other policies applicable to The PyTorch Foundation please see
          <a href="https://www.linuxfoundation.org/policies/" style="color:#ee4c2c">www.linuxfoundation.org/policies/</a>. The PyTorch Foundation supports the PyTorch open source
          project, which has been established as PyTorch Project a Series of LF Projects, LLC. For policies applicable to the PyTorch Project a Series of LF Projects, LLC,
          please see <a href="https://www.lfprojects.org/policies/" style="color:#ee4c2c">www.lfprojects.org/policies/</a>.</p>
      </div>
     </div>
  </footer>
  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebook’s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="../_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/hub">PyTorch Hub</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="resources-mobile-menu-title" class="active">
            Docs
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/docs/stable/index.html">PyTorch</a>
            </li>

            <li>
              <a href="https://pytorch.org/audio/stable/index.html">torchaudio</a>
            </li>

            <li>
              <a href="https://pytorch.org/text/stable/index.html">torchtext</a>
            </li>

            <li>
              <a href="https://pytorch.org/vision/stable/index.html">torchvision</a>
            </li>

            <li>
              <a href="https://pytorch.org/serve/">TorchServe</a>
            </li>

            <li>
              <a href="https://pytorch.org/torchx/">TorchX</a>
            </li>

            <li>
              <a href="https://pytorch.org/xla">PyTorch on XLA Devices</a>
            </li>
          </ul>

          <li class="resources-mobile-menu-title">
            Resources
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/resources">Developer Resources</a>
            </li>

            <li>
              <a href="https://pytorch.org/features">About</a>
            </li>

            <li>
              <a href="https://pytorch.org/hub">Models (Beta)</a>
            </li>

            <li>
              <a href="https://pytorch.org/#community-module">Community</a>
            </li>

            <li>
              <a href="https://discuss.pytorch.org/">Forums</a>
            </li>
          </ul>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>